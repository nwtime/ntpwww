<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8"><meta name = "robots" content = "noindex">


  
  <meta name="description" content="from Alice&rsquo;s Adventures in Wonderland, Lewis Carroll
Make sure who your friends are.
Last update: 25-Nov-2009 UTC

Table of Contents â€¦">
<meta property="og:title" content="Automatic Server Discovery" />
<meta property="og:description" content="from Alice&rsquo;s Adventures in Wonderland, Lewis Carroll
Make sure who your friends are.
Last update: 25-Nov-2009 UTC
 Table of Contents  Introduction Association Management Broadcast/Multicast Scheme Manycast Scheme Server Pool Scheme   Introduction This page describes the automatic server discovery schemes provided in NTPv4. Details about the configuration commands and options are described on the Configuration Options page. Details about the cryptographic authentication schemes are described on the Authentication Options page." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://doc.ntp.org/archives/4.2.6-series/manyopt/" /><meta property="article:section" content="archives" />

<meta property="og:site_name" content="NTP: Network Time Protocol" />



<script async src="https://www.googletagmanager.com/gtag/js?id=G-BN61ZTDHBP"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-BN61ZTDHBP', { 'anonymize_ip': false });
}
</script>


  
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,400i,700,800,800i,900i&display=swap" rel="stylesheet"/>
   
  <title>Automatic Server Discovery</title>

  <!-- Mobile Responsive Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  
  <meta name="generator" content="Hugo 0.83.1" />

  <!-- Plugins -->
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://doc.ntp.org/scss/nwtime.min.css" media="screen">

  <!-- Favicon -->
  <link rel="shortcut icon" href="https://doc.ntp.org/favicons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="https://doc.ntp.org/favicons/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" href="https://doc.ntp.org/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="https://doc.ntp.org/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://doc.ntp.org/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="https://doc.ntp.org/favicons/android-chrome-512x512.png" sizes="512x512"></head>
<body><!-- navigation -->

<nav class="navbar navbar-expand-lg navbar-light">
  <div class="container-fluid">


	<div>
	  <a class="navbar-brand" href="https://www.nwtime.org"><img height="80" width="80" src="https://doc.ntp.org/images/logo.png" alt=""></a>
	  <a class="navbar-brand" href="https://doc.ntp.org/"><img height="80" width="80" src="https://doc.ntp.org/images/ntp_logo.jpg" alt="NTP: Network Time Protocol"></a> 
    </div>


    <div>
      
		<button class="btn btn-light btn-lg" type="button" id="dropdownMenu2" aria-expanded="false"><a class="nav-item" style="text-decoration: none" href="https://doc.ntp.org/support">Support</a>
        </button>
      
		<button class="btn btn-light btn-lg" type="button" id="dropdownMenu2" aria-expanded="false"><a class="nav-item" style="text-decoration: none" href="https://doc.ntp.org/reflib">Reference Library</a>
        </button>
      
		<button class="btn btn-light btn-lg" type="button" id="dropdownMenu2" aria-expanded="false"><a class="nav-item" style="text-decoration: none" href="https://doc.ntp.org/documentation">Documentation</a>
        </button>
      
    </div>


<script async src="https://cse.google.com/cse.js?cx=bb3c9b3e375d856be"></script>
  <div class="gcse-search">
  </div>
</nav>


  <div class="header-border">
  </div>
<!-- /navigation --><nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="https://doc.ntp.org/documentation/">Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://doc.ntp.org/archives/4.2.6-series/">4.2.6-series</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://doc.ntp.org/archives/4.2.6-series/manyopt/">Automatic Server Discovery</a>
</li>

	</ol>
</nav	>


<section class="section pt-0  pb-auto">
  <div class="container">
  	<h1>Automatic Server Discovery</h1>
     
    <p><img src="/archives/pic/alice51.gif" alt="gif"><a href="/reflib/pictures/">from <em>Alice&rsquo;s Adventures in Wonderland</em>, Lewis Carroll</a></p>
<p>Make sure who your friends are.</p>
<p>Last update: 25-Nov-2009 UTC</p>
<hr>
<h4 id="table-of-contents">Table of Contents</h4>
<ul>
<li><a href="/archives/4.2.6-series/manyopt/#introduction">Introduction</a></li>
<li><a href="/archives/4.2.6-series/manyopt/#association-management">Association Management</a></li>
<li><a href="/archives/4.2.6-series/manyopt/#broadcastmulticast-scheme">Broadcast/Multicast Scheme</a></li>
<li><a href="/archives/4.2.6-series/manyopt/#manycast-scheme">Manycast Scheme</a></li>
<li><a href="/archives/4.2.6-series/manyopt/#server-pool-scheme">Server Pool Scheme</a></li>
</ul>
<hr>
<h4 id="introduction">Introduction</h4>
<p>This page describes the automatic server discovery schemes provided in NTPv4. Details about the configuration commands and options are described on the <a href="/archives/4.2.6-series/confopt/">Configuration Options</a> page. Details about the cryptographic authentication schemes are described on the <a href="/archives/4.2.6-series/authopt/">Authentication Options</a> page. Details about the other modes not directly involved in these schemes are described on the <a href="/archives/4.2.6-series/assoc/">Association Management</a> page. Additional information is available in the papers, reports, memoranda and briefings on the <a href="/reflib/ntp/">NTP Project</a> page.</p>
<p>There are three automatic server discovery schemes: broadcast/multicast, manycast and server pool described on this page. The broadcast/multicast and manycast schemes utilize the ubiquitous broadcast or one-to-many paradigm native to IPv4 and IPv6. The server pool scheme uses DNS to resolve addresses of multiple volunteer servers scattered throughout the world. All three schemes work in much the same way and might be described as <em>grab-n'-prune</em>. Through one means or another they grab a number of associations either directly or indirectly from the configuration file, order them from best to worst according to a defined metric, then cast off the associations with the lowest metric until no more than the number specified by the <code>maxclock</code> option of the <code>tos</code> command remain.</p>
<hr>
<h4 id="association-management">Association Management</h4>
<p>All schemes use a stratum filter to select just those servers with stratum considered useful. This can avoid large numbers of clients ganging up on a small number of low-stratum servers and avoid servers below or above specified stratum levels. By default, servers of all strata are acceptable; however, the <code>tos</code> command can be used to restrict the acceptable range from the <code>floor</code> option, inclusive, to the <code>ceiling</code> option, exclusive. Potential servers operating at the same stratum as the client will be avoided, unless the <code>cohort</code> option is present.</p>
<p>The pruning process is handled using a set of counters, one for each preemptible association. Once each poll interval the counter is increased by one. If the association survives the selection and clustering algorithms; that is, it is a candidate for synchronization, the counter is reset to zero. If not and the counter reaches a defined threshold and the number of assocations is greater than <code>maxclock</code>, the association becomes a candidate for pruning. The pruning algorithm assigns to each association a metric ranging from the lowest, corresponding to no possibility of synchronization, to the highest, corresponding to a very likely possibility of synchronization. Upon reaching the threshold, an association is demobilized if it has the lowest metric of all associations. Operation continues in this way until the number of remaining associations is not greater than <code>maxclock</code>.</p>
<p>Following is a summary of each scheme. Note that reference to option applies to the commands described on the <a href="/archives/4.2.6-series/confopt/">Configuration Options</a> page. See that page for applicability and defaults.</p>
<hr>
<h4 id="broadcastmulticast-scheme">Broadcast/Multicast Scheme</h4>
<p>A broadcast server generates messages continuously at intervals by default 64 s and time-to-live by default 127. These defaults can be overridden by the <code>minpoll</code> and <code>ttl</code> options, respectively. Not all kernels support the <code>ttl</code> option. A broadcast client responds to the first message received by waiting a randomized interval to avoid implosion at the server. It then polls the server in client/server mode using the <code>iburst</code> option in order to quickly authenticate the server, calibrate the propagation delay and set the host clock. This normally results in a volley of six client/server exchanges at 2-s intervals during which both the synchronization and cryptographic protocols run concurrently.</p>
<p>Following the volley, the server continues in listen-only mode and sends no further messages. If for some reason the broadcast server does not respond to these messages, the client will cease transmission and continue in listen-only mode with a default propagation delay. The volley can be avoided by using the <code>authdelay</code> command with nonzero argument.</p>
<p>A server is configured in broadcast mode using the <code>broadcast</code> command and specifying the broadcast address of a local interface. If two or more local interfaces are installed with different broadcast addresses, a <code>broadcast</code> command is needed for each address. This provides a way to limit exposure in a firewall, for example. A broadcast client is configured using the <code>broadcastclient</code> command.</p>
<p>NTP multicast mode can be used to extend the scope using IPv4 multicast or IPv6 broadcast with defined span. The IANA has assigned IPv4 multicast address 224.0.1.1 and IPv6 address FF05::101 (site local) to NTP, but these addresses should be used only where the multicast span can be reliably constrained to protect neighbor networks. In general, administratively scoped IPv4 group addresses should be used, as described in RFC-2365, or GLOP group addresses, as described in RFC-2770.</p>
<p>A multicast server is configured using the <code>broadcast</code> command, but specifying a multicast address instead of a broadcast address. A multicast client is configured using the <code>multicastclient</code> command specifying a list of one or more multicast addresses. Note that there is a subtle distinction between the IPv4 and IPv6 address families. The IPv4 broadcast or mulitcast mode is determined by the IPv4 class. For IPv6 the same distinction can be made using the link-local prefix FF02 for each interface and site-local prefix FF05 for all interfaces.</p>
<p>It is possible and frequently useful to configure a host as both broadcast client and broadcast server. A number of hosts configured this way and sharing a common broadcast address will automatically organize themselves in an optimum configuration based on stratum and synchronization distance.</p>
<p>Since an intruder can impersonate a broadcast server and inject false time values, broadcast mode should always be cryptographically authenticated. By default, a broadcast association will not be mobilized unless cryptographically authenticated. If necessary, the <code>auth</code> option of the <code>disable</code> command will disable this feature. The feature can be selectively enabled using the <code>notrust</code> option of the <code>restrict</code> command.</p>
<p>With symmetric key cryptography each broadcast server can use the same or different keys. In one scenario on a broadcast LAN, a set of broadcast clients and servers share the same key along with another set that share a different key. Only the clients with matching key will respond to a server broadcast.</p>
<p>Public key cryptography can be used with some restrictions. If multiple servers belonging to different secure groups share the same broadcast LAN, the clients on that LAN must have the client keys for all of them. This scenario is illustrated in the example on the <a href="/archives/4.2.6-series/authopt/">Authentication Options</a> page.</p>
<hr>
<h4 id="manycast-scheme">Manycast Scheme</h4>
<p>Manycast is a automatic server discovery and configuration paradigm new to NTPv4. It is intended as a means for a client to troll the nearby network neighborhood to find cooperating servers, validate them using cryptographic means and evaluate their time values with respect to other servers that might be lurking in the vicinity. It uses the grab-n'-drop paradigm with the additional feature that active means are used to grab additional servers should the number of survivors fall below the <code>minclock</code> option of the <code>tos</code> command.</p>
<p>The manycast paradigm is not the anycast paradigm described in RFC-1546, which is designed to find a single server from a clique of servers providing the same service. The manycast paradigm is designed to find a plurality of redundant servers satisfying defined optimality criteria.</p>
<p>A manycast clients is configured using the <code>manycastclient</code> configuration command, which is similar to the <code>server</code> configuration command. It sends ordinary client mode messages, but with a broadcast address rather than a unicast address and sends only if less than <code>minclock</code> associateons remain and then only at the minimum feasible rate and minimum feasible time-to-live (TTL) hops. The polling strategy is designed to reduce as much as possible the volume of broadcast messages and the effects of implosion due to near-simultaneous arrival of manycast server messages. There can be as many manycast client associations as different addresses, each one serving as a template for a future unicast client/server association.</p>
<p>A manycast server is configured using the <code>manycastserver</code> command, which listens on the specified broadcast address for manycast client messages. If a manycast server is in scope of the current TTL and is itself synchronized to a valid source and operating at a stratum level equal to or lower than the manycast client, it replies with an ordinary unicast server message.</p>
<p>The manycast client receiving this message mobilizes a preemptable client association according to the matching manycast client template, but only if cryptographically authenticated and the server stratum is less than or equal to the client stratum.</p>
<p>It is possible and frequently useful to configure a host as both manycast client and manycast server. A number of hosts configured this way and sharing a common multicast group address will automatically organize themselves in an optimum configuration based on stratum and synchronization distance.</p>
<p>The use of cryptograpic authentication is always a good idea in any server descovery scheme. Both symmetric key and public key cryptography can be used in the same scenarios as described above for the broadast/multicast scheme.</p>
<h4 id="server-pool-scheme">Server Pool Scheme</h4>
<p>The idea of targeting servers on a random basis to distribute and balance the load is not a new one; however, the NTP pool scheme puts this on steroids. At present, several hundred operators around the globe have volunteered their servers for public access. In general, NTP is a lightweight service and servers used for other purposes don&rsquo;t mind an additional small load. The trick is to randomize over the population and minimize the load on any one server while retaining the advantages of multiple servers using the NTP mitigation algorithms.</p>
<p>To support this service the DNS for some volunteer servers as been modified to collect a number of other volunteer servers and return a randomized list in response to a DNS query. The client receiving this list mobilizes some or all of them just as in the other discovery schemes and casts off the excess.</p>
<p>The pool scheme is configured using one or <code>pool</code> commands with the DNS name <code><em>region</em>.pool.ntp.org</code>, where <code><em>region</em></code> is a region of the world, country of the region or state of the country or even the whole world if absent. The <code>pool</code> command can be used more than once; duplicate servers are detected and discarded. In principle, it is possible to use a configuration file containing a single line <code>pool pool.ntp.org</code>.</p>

	  
	  <style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<div>
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="btn-primary mb-5 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn-primary mb-5 feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it!</a>
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that.</a>
</p>
</div>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

	  <br />
	
  </div>
</section>
<nav class="site-footer navbar navbar-expand-sm mt-auto">
  <div class="container">
      <ul class="navbar-nav">
        
        <li class="nav-item" title="Twitter" aria-label="Twitter">
          <a class="nav-link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/ntp">
          <img src="/images/icons/twitter.svg" width="20" height="20"></img>
          </a>
       </li>
       
        <li class="nav-item" title="LinkedIn" aria-label="LinkedIn">
          <a class="nav-link" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/groups/4651343">
          <img src="/images/icons/linkedin.svg" width="20" height="20"></img>
          </a>
       </li>
       
        <li class="nav-item" title="Facebook" aria-label="Facebook">
          <a class="nav-link" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/networktimeprotocol">
          <img src="/images/icons/facebook.svg" width="20" height="20"></img>
          </a>
       </li>
       
	  </ul>
	  <ul class="mx-auto pt-3">
        <p>&copy; 2022 <a class="navbar-text text-white" href="https://www.nwtime.org/">Network Time Foundation</a></p>	
      </ul>
    </div>
</nav>
</body>
</html>