<!doctype html><html lang=en><head><meta charset=utf-8><meta name=ROBOTS content="INDEX, FOLLOW"><meta name=description content="from Pogo, Walt Kelly
The skunk watches for intruders and sprays.
Last update: 30-Sep-2009 17:16 UTC

Table of Contents

Access Control Support
Access â€¦"><meta property="og:title" content="Access Control Options"><meta property="og:description" content="from Pogo, Walt Kelly
The skunk watches for intruders and sprays.
Last update: 30-Sep-2009 17:16 UTC
 Table of Contents  Access Control Support Access Control Commands   Access Control Support The ntpd daemon implements a general purpose access control list (ACL) containing address/match entries sorted first by increasing address values and then by increasing mask values. A match occurs when the bitwise AND of the mask and the packet source address is equal to the bitwise AND of the mask and address in the list."><meta property="og:type" content="article"><meta property="og:url" content="https://test.doc.ntp.org/archives/4.2.6-series/accopt/"><meta property="article:section" content="archives"><meta property="og:site_name" content="NTP: Network Time Protocol"><title>Access Control Options</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.83.1"><link rel=stylesheet href=https://necolas.github.io/normalize.css/latest/normalize.css><link rel=stylesheet href=https://test.doc.ntp.org/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://test.doc.ntp.org/scss/nwtime.min.css media=screen><link rel="shortcut icon" href=https://test.doc.ntp.org/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=https://test.doc.ntp.org/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=https://test.doc.ntp.org/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://test.doc.ntp.org/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://test.doc.ntp.org/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=https://test.doc.ntp.org/favicons/android-chrome-512x512.png sizes=512x512></head><body><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css><header class="sticky-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light py-0"><div class="d-flex align-items-center" style=height:80px;width:80px><a class="py-0 mx-1" href=https://www.nwtime.org><img class=img-fluid src=https://test.doc.ntp.org/images/logo.png alt></a></div><div class="d-flex align-items-center" style=height:80px;width:80px><a class="navbar-brand py-0 mx-1" href=https://test.doc.ntp.org/><img class=img-fluid src=https://test.doc.ntp.org/images/ntp_logo.jpg alt="NTP: Network Time Protocol"></a></div><button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class=bi-plus></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto py-0"><li class="nav-item py-0"><a class="nav-link py-0" style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/></a></li><li class="nav-item dropdown py-0"><a class="nav-link dropdown-toggle py-0" style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Support</a><div class=dropdown-menu><a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://support.ntp.org/>Support Wiki</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://support.ntp.org/bin/view/Servers/WebHome>Time Servers</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/support/securitynotice>Security</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/ntpfaq>FAQ</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://support.ntp.org/bin/view/Dev/WebHome>Developer Resources</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/contributorslist>Contributors List</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/contact>Contacts</a></div></li><li class="nav-item dropdown py-0"><a class="nav-link dropdown-toggle py-0" style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Reference Library</a><div class=dropdown-menu><a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/reflib/brief>Briefs</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/reflib/memos>Memos</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/reflib/reports>Reports</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/reflib/rfc>RFCs</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/reflib/software>Software</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/reflib/papers>White Papers</a></div></li><li class="nav-item dropdown py-0"><a class="nav-link dropdown-toggle py-0" style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Documentation</a><div class=dropdown-menu><a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/archives/4.2.8-series>4.2.8-series</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/archives/4.2.6-series>4.2.6-series</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/archives/4.2.4-series>4.2.4-series</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/archives/4.2.2-series>4.2.2-series</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/archives/4.2.0>4.2.0</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/archives/4.1.2>4.1.2</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/archives/4.1.1>4.1.1</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/archives/4.1.0>4.1.0</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://test.doc.ntp.org/archives/3-5.93e>3-5.93e</a></div></li></ul></div><script async src="https://cse.google.com/cse.js?cx=bb3c9b3e375d856be"></script><div class=gcse-search></div></nav></div><div class=header-border></div></header><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://test.doc.ntp.org/documentation/>Documentation</a></li><li class=breadcrumb-item><a href=https://test.doc.ntp.org/archives/4.2.6-series/>4.2.6-series</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://test.doc.ntp.org/archives/4.2.6-series/accopt/>Access Control Options</a></li></ol></nav><section class="section pt-0 pb-auto"><div class=container><h1>Access Control Options</h1><p><img src=/archives/pic/pogo6.gif alt=gif><a href=/reflib/pictures/>from <em>Pogo</em>, Walt Kelly</a></p><p>The skunk watches for intruders and sprays.</p><p>Last update: 30-Sep-2009 17:16 UTC</p><hr><h4 id=table-of-contents>Table of Contents</h4><ul><li><a href=/archives/4.2.6-series/accopt/#access-control-support>Access Control Support</a></li><li><a href=/archives/4.2.6-series/accopt/#access-control-commands>Access Control Commands</a></li></ul><hr><h4 id=access-control-support>Access Control Support</h4><p>The <code>ntpd</code> daemon implements a general purpose access control list (ACL) containing address/match entries sorted first by increasing address values and then by increasing mask values. A match occurs when the bitwise AND of the mask and the packet source address is equal to the bitwise AND of the mask and address in the list. The list is searched in order with the last match found defining the restriction flags associated with the entry.</p><p>An example may clarify how it works. Our campus has two class-B networks, 128.4 for the ECE and CIS departments and 128.175 for the rest of campus. Let&rsquo;s assume (not true!) that subnet 128.4.1 homes critical services like class rosters and spread sheets. A suitable ACL might be</p><pre>restrict default nopeer				# deny new associations
restrict 128.175.0.0 mask 255.255.0.0 		# allow campus access
restrict 128.4.0.0 mask 255.255.0.0 none	# allow ECE and CIS access
restrict 128.4.1.0 mask 255.255.255.0 notrust # require authentication on subnet 1
restrict time.nist.gov				# allow access
</pre><p>While this facility may be useful for keeping unwanted, broken or malicious clients from congesting innocent servers, it should not be considered an alternative to the NTP authentication facilities. Source address based restrictions are easily circumvented by a determined cracker.</p><h4 id=access-control-commands>Access Control Commands</h4><dl><dt><code><strong>discard [ average <em>avg</em> ][ minimum <em>min</em> ] [ monitor <em>prob</em> ]</strong></code></dt><dd><p>Set the parameters of the rate control facility which protects the server from client abuse. If the <code>limited</code> flag is present in the ACL, packets that violate these limits are discarded. If in addition the <code>kod</code> restriction is present, a kiss-o'-death packet is returned.</p></dd><dt><code>average <em>avg</em></code></dt><dd><p>Specify the minimum average interpacket spacing (minimum average headway time) in log<sub>2</sub> s with default 3.</p></dd><dt><code>minimum <em>min</em></code></dt><dd><p>Specify the minimum interpacket spacing (guard time) in log<sub>2</sub> s with default 1.</p></dd><dt><code>monitor</code></dt><dd><p>Specify the probability of discard for packets that overflow the rate-control window. This is a performance optimization for servers with aggregate arrivals of 1000 packets per second or more.</p></dd><dt><code><strong>restrict <em>address</em> [mask <em>mask</em>] [<em>flag</em>][&mldr;]</strong></code></dt><dd><p>The <code><em>address</em></code> argument expressed in dotted-quad form is the address of a host or network. Alternatively, the <code><em>address</em></code> argument can be a valid host DNS name. The <code><em>mask</em></code> argument expressed in dotted-quad form defaults to <code>255.255.255.255</code>, meaning that the <code><em>address</em></code> is treated as the address of an individual host. A default entry (<code>address 0.0.0.0, mask 0.0.0.0</code>) is always included and is always the first entry in the list. Note that the text string <code>default</code>, with no mask option, may be used to indicate the default entry.</p></dd></dl><p>Some flags have the effect to deny service, some have the effect to enable service and some are conditioned by other flags. The flags. are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags that deny service are classed in two categories, those that restrict time service and those that restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified:</p><dl><dt><code>flake</code></dt><dd><p>Discard received NTP packets with probability 0.1; that is, on average drop one packet in ten. This is for testing and amusement. The name comes from Bob Braden&rsquo;s <em>flakeway</em>, which once did a similar thing for early Internet testing.</p></dd><dt><code>ignore</code></dt><dd><p>Deny packets of all kinds, including <code>ntpq</code> and <code>ntpdc</code> queries.</p></dd><dt><code>kod</code></dt><dd><p>Send a kiss-o'-death (KoD) packet if the <code>limited</code> flag is present and a packet violates the rate limits established by the <code>discard</code> command. KoD packets are themselves rate limited for each source address separately. If this flag is not present, packets that violate the rate limits are discarded.</p></dd><dt><code>limited</code></dt><dd><p>Deny time service if the packet violates the rate limits established by the <code>discard</code> command. This does not apply to <code>ntpq</code> and <code>ntpdc</code> queries.</p></dd><dt><code>lowpriotrap</code></dt><dd><p>Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.</p></dd><dt><code>mssntp</code></dt><dd><p>Enable Microsoft Windows MS-SNTP authentication using Active Directory services.</p></dd></dl><blockquote><p><strong>Note: Potential users should be aware that these services involve a TCP connection to another process that could potentially block, denying services to other users. Therefore, this flag should be used only for a dedicated server with no clients other than MS-SNTP</strong>.</span></p></blockquote><dl><dt><code>nomodify</code></dt><dd><p>Deny <code>ntpq</code> and <code>ntpdc</code> queries which attempt to modify the state of the server (i.e., run time reconfiguration). Queries which return information are permitted.</p></dd><dt><code>noquery</code></dt><dd><p>Deny <code>ntpq</code> and <code>ntpdc</code> queries. Time service is not affected.</p></dd><dt><code>nopeer</code></dt><dd><p>Deny packets that might mobilize an association unless authenticated. This includes broadcast, symmetric-active and manycast server packets when a configured association does not exist. Note that this flag does not apply to packets that do not attempt to mobilize an association.</p></dd><dt><code>noserve</code></dt><dd><p>Deny all packets except <code>ntpq</code> and <code>ntpdc</code> queries.</p></dd><dt><code>notrap</code></dt><dd><p>Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the <code>ntpdc</code> control message protocol which is intended for use by remote event logging programs.</p></dd><dt><code>notrust</code></dt><dd><p>Deny packets that are not cryptographically authenticated. Note carefully how this flag interacts with the <code>auth</code> option of the <code>enable</code> and <code>disable</code> commands. If <code>auth</code> is enabled, which is the default, authentication is required for all packets that might mobilize an association. If <code>auth</code> is disabled, but the <code>notrust</code> flag is not present, an association can be mobilized whether or not authenticated. If <code>auth</code> is disabled, but the <code>notrust</code> flag is present, authentication is required only for the specified address/mask range.</p></dd><dt><code>ntpport</code></dt><dd><code>non-ntpport</code></dd><dd><p>This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both <code>ntpport</code> and <code>non-ntpport</code> may be specified. The <code>ntpport</code> is considered more specific and is sorted later in the list.</p></dd><dt><code>version</code></dt><dd><p>Deny packets that do not match the current NTP version.</p></dd></dl><p>Default restriction list entries with the flags <code>ignore, ntpport</code>, for each of the local host&rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).</p></div></section><footer class="navbar site-footer fixed-bottom py-0"><ul class=mx-auto><li class=navbar-text data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/ntp><i class=bi-twitter></i></a></li><li class=navbar-text data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/groups/4651343><i class=bi-linkedin></i></a></li><li class=navbar-text data-toggle=tooltip data-placement=top title=Facebook aria-label=Facebook><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.facebook.com/networktimeprotocol><i class=bi-facebook></i></a></li><li class=navbar-text><p>&copy; 2022 <a class="navbar-text text-white" href=https://www.nwtime.org>Network Time Foundation</a></p></li></ul></footer></body></html>