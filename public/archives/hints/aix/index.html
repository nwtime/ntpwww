<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.84.1" /><META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>AIX Hints | NTP: Network Time Protocol</title>
<meta name="description" content="NTP Documentation Archive"><meta property="og:title" content="AIX Hints" />
<meta property="og:description" content="Problem with recent ANSI compilers On some systems, including AIX, the compiler quits on the ntp_refclock.c file when processing the refclock_report() routine. The problem, which is eithre a feature or a bug, has to do with an unwanted promotion of the u_char argument to an int and a failure of the compiler to recognize the preceding prototype. A workaround is to use ANSI syntax to delare the arguments. Since ANSI compilers are not universally available, this syntax can&#39;t be used in the stock distribution." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/hints/aix/" /><meta property="article:section" content="archives" />

<meta property="og:site_name" content="NTP: Network Time Protocol" />

<meta itemprop="name" content="AIX Hints">
<meta itemprop="description" content="Problem with recent ANSI compilers On some systems, including AIX, the compiler quits on the ntp_refclock.c file when processing the refclock_report() routine. The problem, which is eithre a feature or a bug, has to do with an unwanted promotion of the u_char argument to an int and a failure of the compiler to recognize the preceding prototype. A workaround is to use ANSI syntax to delare the arguments. Since ANSI compilers are not universally available, this syntax can&#39;t be used in the stock distribution.">

<meta itemprop="wordCount" content="430">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="AIX Hints"/>
<meta name="twitter:description" content="Problem with recent ANSI compilers On some systems, including AIX, the compiler quits on the ntp_refclock.c file when processing the refclock_report() routine. The problem, which is eithre a feature or a bug, has to do with an unwanted promotion of the u_char argument to an int and a failure of the compiler to recognize the preceding prototype. A workaround is to use ANSI syntax to delare the arguments. Since ANSI compilers are not universally available, this syntax can&#39;t be used in the stock distribution."/>




<link rel="preload" href="/scss/main.min.c7590aab2525bc59dfb1dc16e6ad51978d04d1687ab16e19453b88b4ff42ceea.css" as="style">
<link href="/scss/main.min.c7590aab2525bc59dfb1dc16e6ad51978d04d1687ab16e19453b88b4ff42ceea.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>





  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">NTP: Network Time Protocol</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://www.nwtime.org" target="_blank" ><span>Network Time Foundation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/reflib/" ><span>Reference Library</span></a>
			</li>
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Docs
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/archives/4.2.8-series/toc">4.2.8-series</a>
	
	<a class="dropdown-item" href="/archives/4.2.6-series/toc">4.2.6-series</a>
	
	<a class="dropdown-item" href="/archives/4.2.4-series/toc">4.2.4-series</a>
	
	<a class="dropdown-item" href="/archives/4.2.2-series/toc">4.2.2-series</a>
	
	<a class="dropdown-item" href="/archives/4.2.0/toc">4.2.0</a>
	
	<a class="dropdown-item" href="/archives/4.1.2/toc">4.1.2</a>
	
	<a class="dropdown-item" href="/archives/4.1.1/toc">4.1.1</a>
	
	<a class="dropdown-item" href="/archives/4.1.0/toc">4.1.0</a>
	
	<a class="dropdown-item" href="/archives/3-5.93e/toc">3-5.93e</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="/archives/">Docs</a>
</li>




<li class="breadcrumb-item" >
	<a href="/archives/hints/">Hints</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/archives/hints/aix/">AIX Hints</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>AIX Hints</h1>
    
	       
	<div id="body">
<pre>Problem with recent ANSI compilers

On some systems, including AIX, the compiler quits on the ntp_refclock.c
file when processing the refclock_report() routine. The problem, which
is eithre a feature or a bug, has to do with an unwanted promotion of
the u_char argument to an int and a failure of the compiler to recognize
the preceding prototype. A workaround is to use ANSI syntax to delare
the arguments. Since ANSI compilers are not universally available, this
syntax can't be used in the stock distribution.

(Message # 60: 2884 bytes, New)
Date: Sat, 19 Aug 1995 13:20:50 -0400
From: "R. Bernstein" <rocky@panix.com>Newsgroups: comp.protocols.time.ntp
to: mills@udel.edu
return-receipt-to: rocky@panix.com
Subject: time and AIX 3.2.5 raw tty bug

This posting isn't strictly about NTP, any program that may stop the
clock or set the clock backwards is subject to the AIX 3.2.5 bug.

On AIX 3.2.5, there is a bug in the tty driver for a raw device which
may crash the box under certain conditions: basically a read() on a
raw tty in effect, a character was read but not as many as specified
by VMIN when a read timeout occurred. VTIME specifies the timeout. See
the AIX manual page on termios.h or that include file. for Information
on VMIN (or MIN) VTIME (or TIME).

A remedy other than to not use raw tty's is to apply patch U435110.

Details of the problem report follow.

> ABSTRACT:
> IX43779: TRAP IN PSX_TIMEO
>
> ORIGINATING DETAILS:
> Stacktrace shows:
> IAR:      01460214   posixdd:psx_timeo  + 8bf4: ti 4,r12,0x0
> *LR:      014601a0   posixdd:psx_timeo  + 8b80
> 00212c60: 014604f4   posixdd:psx_timer  + 8ed4
> 00212cc0: 0144b74c   ttydd:tty_do_offlevel  + 4284
> 00212d20: 000216fc  .i_offlevel + 8c
> 00212d70: 00021d78  .i_softint + c8
> 00001004: 00008714  .finish_interrupt + 80
>
> RESPONDER SUMMARY:
> AIX asserted in psx_timeo(). Reason for the assert was that
> the current time was behind psx_ctime. Since this state
> can occur when the current time is changed after a character
> is received but before the VTIME interbyte timer pops, we
> should not assert on this.
>
> RESPONDER CONCLUSION:
> Removed the requirement that current time > psx_ctime by
> adding a new L_ntimersub macro that is used instead of the
> ntimersub macro in time.h. Also added a test for (current
> time - psx_ctime) being negative, in that case we do not
> adjust the new timeout.
>
> Reported to Correct a PTF in Error:     NO
> Reported as a Highly pervasive problem: NO
>
> PE Apar?:       NoPE
> Hiper Apar?:    NoHiper
> Status:         CLOSED  PER
> Component Name: AIX V3 FOR RS/6
> Version:        320
> Component ID:   575603001
> Submitted:      94/05/03
> Closed:         94/05/05
> ChangeTeam:     TX2527
>
> APAR FIXED BY:  U431696  U432151  U432844  U432870  U432979
> U433049  U433081  U433459  U433876  U433906  U434598  U434453
> U434672  U434737  U435110</rocky@panix.com> </pre>
</div>

	
		<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<div class="d-print-none">
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it!</a>.
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that.</a>.
</p>
</div>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

		<br />
	
	
</div>


          </main>
        </div>
      </div>
      <link href="/assets/scss/_variables_project.css" rel="stylesheet">

<footer class="navbar site-footer fixed-bottom py-0">
      <div>
        
        
        
<ul class="list-inline">
  
  <li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="Mailing lists" aria-label="Mailing lists">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://lists.ntp.org/listinfo">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://twitter.com/ntp">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="LinkedIn" aria-label="LinkedIn">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/groups/4651343">
      <i class="fab fa-linkedin-in"></i>
    </a>
  </li>
  
  <li class="list-inline-item" data-toggle="tooltip" data-placement="top" title="Facebook" aria-label="Facebook">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/networktimeprotocol">
      <i class="fab fa-facebook-f"></i>
    </a>
  </li>
  
</ul>

        
        
		</div>
		<div>
        <p style="font-size: 12px; font-family: 'Nunito Sans', sans-serif;">&copy; 2021 <a class="text-white" href="https://www.nwtime.org">Network Time Foundation</a></p>	
    </div>
	</div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>






 











<script src="/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js" integrity="sha256-XHS4cMaVOTGnBfOQpJx&#43;TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin="anonymous"></script>




  </body>
</html>