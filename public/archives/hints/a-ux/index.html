<!doctype html><html lang=en><head><meta charset=utf-8><meta name=ROBOTS content="INDEX, FOLLOW"><meta name=description content="Last revision:  06-Jul-1994

Introduction
Included in this distribution of XNTP V3 is a configuration file suitable for use under Apple&rsquo;s A/UX â€¦"><meta property="og:title" content="A-UX Hints"><meta property="og:description" content="Last revision: 06-Jul-1994
 Introduction Included in this distribution of XNTP V3 is a configuration file suitable for use under Apple&rsquo;s A/UX Version 3.x.x There is also one for A/UX 2.0.1 but it has not been fully tested. To make the executables follow the steps outlined below.
 NOTE: You must have gcc installed to successfully compile the current distribution; the native cc supplied with A/UX will NOT correctly compile this source."><meta property="og:type" content="article"><meta property="og:url" content="https://doc.ntp.org/archives/hints/a-ux/"><meta property="article:section" content="archives"><meta property="og:site_name" content="NTP: Network Time Protocol"><script async src="https://www.googletagmanager.com/gtag/js?id=G-BN61ZTDHBP"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-BN61ZTDHBP',{anonymize_ip:!1})}</script><title>A-UX Hints</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.83.1"><link rel=stylesheet href=https://doc.ntp.org/plugins/bootstrap-5.0.2-dist/css/bootstrap.min.css><link rel=stylesheet href=https://doc.ntp.org/scss/nwtime.min.css media=screen><link rel="shortcut icon" href=https://doc.ntp.org/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=https://doc.ntp.org/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=https://doc.ntp.org/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://doc.ntp.org/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://doc.ntp.org/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=https://doc.ntp.org/favicons/android-chrome-512x512.png sizes=512x512></head><body><header class="sticky-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light py-0"><div class="d-flex align-items-center" style=height:80px;width:80px><a class="py-0 mx-1" href=https://www.nwtime.org><img class=img-fluid src=https://doc.ntp.org/images/logo.png alt></a></div><div class="d-flex align-items-center" style=height:80px;width:80px><a class="navbar-brand py-0 mx-1" href=https://doc.ntp.org/><img class=img-fluid src=https://doc.ntp.org/images/ntp_logo.jpg alt="NTP: Network Time Protocol"></a></div><button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class=bi-plus></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto py-0"><li class="nav-item py-0"><a class="nav-link py-0" style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/></a></li><li class="nav-item dropdown py-0"><a class="nav-link dropdown-toggle py-0" style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Support</a><div class=dropdown-menu><a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://support.ntp.org/>Support Wiki</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://support.ntp.org/bin/view/Servers/WebHome>Time Servers</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/support/securitynotice>Security</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/ntpfaq>FAQ</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://support.ntp.org/bin/view/Dev/WebHome>Developer Resources</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/contributorslist>Contributors List</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/contact>Contacts</a></div></li><li class="nav-item dropdown py-0"><a class="nav-link dropdown-toggle py-0" style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Reference Library</a><div class=dropdown-menu><a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/reflib/brief>Briefs</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/reflib/memos>Memos</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/reflib/reports>Reports</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/reflib/rfc>RFCs</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/reflib/software>Software</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/reflib/papers>White Papers</a></div></li><li class="nav-item dropdown py-0"><a class="nav-link dropdown-toggle py-0" style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=# role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Documentation</a><div class=dropdown-menu><a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/archives/4.2.8-series>4.2.8-series</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/archives/4.2.6-series>4.2.6-series</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/archives/4.2.4-series>4.2.4-series</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/archives/4.2.2-series>4.2.2-series</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/archives/4.2.0>4.2.0</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/archives/4.1.2>4.1.2</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/archives/4.1.1>4.1.1</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/archives/4.1.0>4.1.0</a>
<a class=dropdown-item style="text-decoration:none;font-size:16px;font-family:nunito sans,sans-serif" href=https://doc.ntp.org/archives/3-5.93e>3-5.93e</a></div></li></ul></div><script async src="https://cse.google.com/cse.js?cx=bb3c9b3e375d856be"></script><div class=gcse-search></div></nav></div><div class=header-border></div></header><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://doc.ntp.org/documentation/>Documentation</a></li><li class=breadcrumb-item><a href=https://doc.ntp.org/archives/hints/>Hints</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://doc.ntp.org/archives/hints/a-ux/>A-UX Hints</a></li></ol></nav><section class="section pt-0 pb-auto"><div class=container><h1>A-UX Hints</h1><p>Last revision: 06-Jul-1994</p><hr><h4 id=introduction>Introduction</h4><p>Included in this distribution of XNTP V3 is a configuration file suitable for use under Apple&rsquo;s A/UX Version 3.x.x There is also one for A/UX 2.0.1 but it has not been fully tested. To make the executables follow the steps outlined below.</p><blockquote><p><strong>NOTE:</strong> You must have <code>gcc</code> installed to successfully compile the current distribution; the native <code>cc</code> supplied with A/UX will NOT correctly compile this source. See the FAQ in comp.unix.aux for places to obtain <code>gcc</code> from and how to install it.</p></blockquote><hr><h4 id=making-xntpd-for-aux>Making XNTPD for A/UX</h4><p>First, you need to create the makefiles (after you&rsquo;ve downloaded the source, of course):</p><p><code>make clean</code></p><p><code>make refconf</code></p><p>After that, you should edit <code>Config.local</code> to make sure that <code>BINDIR</code> is correct for where you wish the programs to be installed. The default (and what I use) is <code>/usr/local/etc</code>. Make sure that <code>DEFS_LOCAL</code> and <code>CLOCKDEFS</code> are commented out! Presently, only the <code>LOCAL_CLOCK/REFCLOCK</code> clock is used and supported.</p><p>After this is done (you should be told that your system is A/UX 3), make <code>xntpd</code> (the options to <code>gcc</code> are held in <code>compilers/aux3.gcc</code>):</p><p><code>make</code></p><p>I do not normally use the <code>make install</code> option and so have not verified its compatibility with A/UX. Rather, I pull out each of the executables and place them in the locally appropriate locations.</p><hr><h4 id=starting-xntpd>Starting XNTPD</h4><p>At this point you need to set things up so that <code>xntpd</code> is started upon boot-up. You can do this in 1 of 2 ways: either add entries in <code>/etc/inittab</code> or, more ideally, create and use an <code>/etc/rc.local</code> file. Since <code>rc.local</code> is what I recommend, here&rsquo;s how you do it:</p><p>By default, A/UX doesn&rsquo;t have <code>rc.local</code>, so you&rsquo;ll need to add the following to <code>/etc/inittab</code>:</p><pre>
net6:2:wait:/etc/syslogd		        # set to "wait" to run a syslog daemon
jmj0:2:wait:/etc/rc.local 1>/dev/syscon 2>&1	# Local stuff
dbg2::wait:/etc/telinit v	                # turn off init's verbose mode
</pre><p>Now, the look of a sample <code>/etc/rc.local</code> is as follows:</p><pre><code>#!/bin/sh
:
: rc.local
:
#	@(#)Copyright Apple Computer 1987	Version 1.17 of rc.sh on 91/11/08 15:56:21 (ATT 1.12)

#	Push line discipline/set the device so it will print
/etc/line_sane 1
echo &quot; &quot;
echo &quot;Entering rc.local...&quot;

set `/bin/who -r`
if [ &quot;$7&quot; = 2 ]
then
    /bin/echo &quot; now setting the time...&quot;
    /usr/local/etc/ntpdate -s -b &lt;host.domain&gt;
    sleep 5
#
# start up 'xntpd' if we want
#
    if [ -f /etc/ntp.conf ]
    then
	/bin/echo &quot; setting tick and tickadj...&quot;
	/usr/local/etc/tickadj -t 16672 -a 54
	sleep 5
	/bin/echo &quot; starting xntpd...&quot;
	/usr/local/etc/xntpd &lt;&amp;- &gt; /dev/null 2&gt;&amp;1
	sleep 5
    fi
#
fi

echo &quot;Leaving rc.local...&quot;
</code></pre><p>There are a few things to notice about the above:</p><ul><li><p>When run, <code>ntpdate</code> forces your clock to the time returned by the host(s) specified by <code>&lt;host.domain></code> (you&rsquo;ll need to replace this with the IP address(es) of your timehosts). This is good since it gets things close to start off with. You can use more than one time server.</p></li><li><p><code>tickadj</code> is also called. This does two things: changes the default value of <code>tick</code> (which is the amount of time, in ms, that is added to the clock every 1/60 seconds) and changes the value of <code>tickadj</code> which is the amount that is added or subtracted from <code>tickadj</code> when <code>adjtime()</code> is called.</p></li></ul><p>Now Mac clocks are pretty bad and tend to be slow. So, instead of having A/UX add the default of 16666 ms every 1/60th of a second, you may want it to add more (or less) so that it keeps better time. The above value works for me but your best value may be different and will likely require some fooling around to find the best value. As a general rule of thumb, if you see <code>xntpd</code> make a lot of negative clock adjustments, then your clock is fast and you&rsquo;ll need to <em>decrease</em> the value of <code>tick</code>. If your adjustments are positive, then you need to increase <code>tick</code>. To make a guess on how fast/slow your clock is, use <code>ntpdate</code> to sync your clock. Now watch <code>xntpd</code> and see how it operates. If, for example, it resets your clock by 1 second every 30 minutes, then your clock is (<code>1/(30*60)</code>) about 0.056% off and you&rsquo;ll need to adjust <code>tick</code> by 16666*0.00056 or about 9 (i.e. <code>tick</code> should be ~16675 if slow or ~16657 if fast).</p><p>A/UX&rsquo;s default value of <code>tickadj</code> is 1666 which is too big for <code>xntpd</code> so it also needs to be adjusted. I like using larger values than the recommended value of 9 for <code>tickadj</code> (although not anything near as big as 1666) since this allows for quick slews when adjusting the clock. Even with semi-large values of <code>tickadj</code> (~200), getting 5ms (1/200 s) accuracy is easy.</p><p>Finally, before A/UX and <code>xntpd</code> will work happily together, you need to patch the kernel. This is due to the fact that A/UX attempts to keep the UNIX-software clock and the Mac-hardware clock in sync. Neither the h/w or the s/w clock are too accurate. Also, <code>xntpd</code> will be attempting to adjust the software clock as well, so having A/UX muck around with it is asking for headaches. What you therefore need to do is tell the kernel <em>not</em> to sync the s/w clock with the h/w one. This is done using <code>adb</code>. The following is a shell script that will do the patch for you:</p><pre><code>#! /bin/sh
adb -w /unix &lt;&lt;!
init_time_fix_timeout?4i
init_time_fix_timeout?w 0x4e75
init_time_fix_timeout?4i
$q
!
</code></pre><p>This must be done <em>every</em> time you create a new kernel (via <code>newconfig</code> or <code>newunix</code>) or else <code>xntpd</code> will go crazy.</p><hr><h4 id=history>History</h4><p>John Dundas was the original porter of <code>xntpd</code> and a lot of the additions and A/UX-ports are from him. I got involved when I wanted to run <code>xntpd</code> on jagubox. It was also around this time that the base-patchlevel of <code>xntpd</code> changed relatively (the so-called &ldquo;jones&rdquo; version). Since then, I&rsquo;ve been maintaining <code>xntpd</code> for A/UX for the xntp development team.</p><p>The original kernel patch (which patched <code>time_fix_timeout</code>) was from Richard Todd. I suggest patching <code>init_time_fix_timeout</code> which prevents <code>time_fix_timeout</code> from even being called.</p><hr><h4 id=technical-notes>Technical Notes</h4><ul><li><p>As configured (see <code>machines/aux3</code>), <code>xntpd</code> will log messages via <code>syslogd</code> using the <code>LOC_LOCAL1</code> facility. I would suggest the following in <code>/etc/syslog.conf</code>:</p><p><code>local1.notice /usr/adm/ntpd-syslog</code></p></li><li><p>As mentioned above, the clocks on A/UX and Macs are kinda bad. Not only that, but logging in and out of the MacOS mode as well as extensive floppy use causes A/UX to drop and lose clock interupts (these are sent every 1/60th of a second). So, if you do these activities a lot, you find out that you lose about 300ms of time (i.e., you become 300ms slow). The <code>xntpd</code> default way of handling this is to call <code>settimeofday()</code> and step the clock to the correct time. I prefer having <code>xntpd</code> slew the clock back into line by making gradual adjustments to the clock over a couple of minutes or so. It&rsquo;s for this reason that <code>SLEWALWAYS</code> is defined in <code>include/ntp_machine.h</code> for SYS_AUX3. It&rsquo;s also for this reason than I like larger values of <code>tickadj</code>.</p></li></ul><p>Good luck! If you have problems under A/UX feel free to contact me (e-mail is preferred).</p><pre><code>Jim Jagielski               |  &quot;That is no ordinary rabbit... 'tis the
                            |   most foul, cruel and bad-tempered
NASA/GSFC, Code 734.4       |   rodent you ever set eyes on&quot;
Greenbelt, MD 20771         |                   Tim the Enchanter</code></pre><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn-primary mb-5 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn-primary mb-5 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it!</a></p><p class="feedback--response feedback--response-no">Sorry to hear that.</a></p></div><script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script><br></div></section><footer class="navbar site-footer fixed-bottom pb-0 py-0"><div class=container-fluid style=height:3%><ul class="nav justify-content-center"><li class=nav-item data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class="nav-link text-white" target=_blank rel="noopener noreferrer" href=https://twitter.com/ntp><img src=images/icons/twitter.svg width=16 height=16></img></a></li><li class=nav-item data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class="nav-link text-white" target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/groups/4651343><img src=images/icons/linkedin.svg width=16 height=16></img></a></li><li class=nav-item data-toggle=tooltip data-placement=top title=Facebook aria-label=Facebook><a class="nav-link text-white" target=_blank rel="noopener noreferrer" href=https://www.facebook.com/networktimeprotocol><img src=images/icons/facebook.svg width=16 height=16></img></a></li></ul><ul class="mx-auto pt-3"><li class=nav-item><p>&copy; 2022 <a class="navbar-text text-white" href=https://www.nwtime.org>Network Time Foundation</a></p></li></ul></div></footer></body></html>