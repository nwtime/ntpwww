<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8">
  <title>Solaris Hints</title>

  <!-- Mobile Responsive Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="NTP Documentation Archive">
  
  <meta name="generator" content="Hugo 0.84.1" />

  <!-- Plugins -->
  
    <link rel="stylesheet" href="https://necolas.github.io/normalize.css/latest/normalize.css">
  
    <link rel="stylesheet" href="/plugins/bootstrap/bootstrap.min.css">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="/scss/nwtime.min.css" media="screen">

  <!-- Favicon -->
  <link rel="shortcut icon" href="/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="/images/favicon.png " type="image/x-icon">
</head>
<body><!-- navigation -->
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

<header class="sticky-top navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-light py-0">
		<div class="d-flex align-items-center" style="height:100px; width:100px;">
		 <a class="navbar-brand py-0" href="/"><img class="img-fluid" src="/icons/ntp_logo.jpg" alt="NTP: Network Time Protocol"></a> 
      </div>
	  <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="bi-plus"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <ul class="navbar-nav ml-auto py-0">
          <li class="nav-item py-0">
            <a class="nav-link py-0" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/"></a>
          </li>
          
          
          <li class="nav-item py-0">
            <a class="nav-link py-0" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="https://www.nwtime.org">Network Time Foundation</a>
          </li>
          
          
          
          <li class="nav-item dropdown py-0">
            <a class="nav-link dropdown-toggle py-0" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Reference Library
            </a>
            <div class="dropdown-menu">
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/reflib/brief">Briefs</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/reflib/memos">Memos</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/reflib/reports">Reports</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/reflib/rfc">RFCs</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/reflib/software">Software</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/reflib/papers">White Papers</a>
              
            </div>
          </li>
          
          
          
          <li class="nav-item dropdown py-0">
            <a class="nav-link dropdown-toggle py-0" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Docs
            </a>
            <div class="dropdown-menu">
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/archives/4.2.8-series/toc">4.2.8-series</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/archives/4.2.6-series/toc">4.2.6-series</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/archives/4.2.4-series/toc">4.2.4-series</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/archives/4.2.2-series/toc">4.2.2-series</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/archives/4.2.0/toc">4.2.0</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/archives/4.1.2/toc">4.1.2</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/archives/4.1.1/toc">4.1.1</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/archives/4.1.0/toc">4.1.0</a>
              
              <a class="dropdown-item" style="text-decoration: none; font-size: 16px; font-family: 'Nunito Sans', sans-serif;" href="/archives/3-5.93e/toc">3-5.93e</a>
              
            </div>
          </li>
          
          
        </ul>

      </div>
    </nav>
  </div>
  <div class="header-border">
  </div>
</header>
<!-- /navigation --><nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="/archives/">Docs</a>
</li>




<li class="breadcrumb-item" >
	<a href="/archives/hints/">Hints</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/archives/hints/solaris/">Solaris Hints</a>
</li>

	</ol>
</nav	>


<section class="section pt-0  pb-auto">
  <div class="container">
  	<h1>Solaris Hints</h1>
     
    <p>Information on compiling and executing ntpd under Solaris.</p>
<p>Last update: 27-Jan-2014 05:31 UTC, John Hawkinson, <a href="mailto:jhawk@MIT.EDU">jhawk@MIT.EDU</a></p>
<p>If you&rsquo;re not running Solaris 2.5.1 or later, it is likely that you will have problems; upgrading would be a really good plan.</p>
<hr>
<h4 id="table-of-contents">Table of Contents</h4>
<ul>
<li><a href="/archives/hints/solaris/#all-solaris-versions">All Solaris versions</a></li>
<li><a href="/archives/hints/solaris/#dealing-with-frequency-tolerance-violations">Dealing with Frequency Tolerance Violations</a></li>
<li><a href="/archives/hints/solaris/#solaris-26">Solaris 2.6</a></li>
<li><a href="/archives/hints/solaris/#solaris-25-and-251">Solaris 2.5 and 2.5.1</a></li>
<li><a href="/archives/hints/solaris/#solaris-22">Solaris 2.2</a></li>
<li><a href="/archives/hints/solaris/#solaris-21">Solaris 2.1</a></li>
</ul>
<h3 id="all-solaris-versions">All Solaris versions</h3>
<p>We have a report that says starting with Solaris 2.6 we should leave <em>dosynctodr</em> alone. <a href="/archives/hints/solaris-dosynctodr">Here is the report</a>.</p>
<p>Proper operation of ntp under Solaris may require setting the kernel variable <em>dosynctodr</em> to zero (meaning &ldquo;do not synchronize the clock to the hardware time-of-day clock&rdquo;). This can be done with the tickadj utility:</p>
<p><code>tickadj -s</code></p>
<p>If you prefer, it can also be done with the native Solaris kernel debugger:</p>
<p><code>echo dosynctodr/W0 | adb -k -w /dev/ksyms /dev/mem</code></p>
<p>Or, it can also be set by adding a line to /etc/system:</p>
<p><code>set dosynctodr = 0</code></p>
<p>Instead of the <em>tick</em> kernel variable, which many operating systems use to control microseconds added to the system time every clock tick (c.f. <a href="/archives/hints/solaris/#dealing-with-frequency-tolerance-violations">Dealing with Frequency Tolerance Violations</a>, Solaris has the variables <em>nsec_per_tick</em> and <em>usec_per_tick</em>.</p>
<p><em>nsec_per_tick</em> and <em>usec_per_tick</em> control the number of nanoseconds and microseconds, respectively, added to the system clock each clock interrupt. Enterprising souls may set these based on information collected by ntpd in the <code>/etc/ntp.drift</code> file to correct for individual hardware variations.</p>
<p>On UltraSPARC systems, <em>nsec_per_tick</em> and <em>usec_per_tick</em> are ignored in favor of the <em>cpu_tick_freq</em> variable, which should be automatically be determined by the PROM in an accurate fashion.</p>
<p>In general, the same ntp binaries should not be used across multiple operating system releases. There is enough variation in the core operating system support for timekeeping that a rebuild of ntpd for the idiosyncracies of your specific operating system version is advisable.</p>
<p>It is recommended that ntp be started via a script like <a href="/archives/hints/solaris.xtra.S99ntpd">this one</a>, installed in <code>/etc/init.d/ntpd</code> with a symbol link from <code>/etc/rc2.d/S99ntpd</code>.<a id="frequency_tolerance"></a></p>
<hr>
<h4 id="dealing-with-frequency-tolerance-violations">Dealing with Frequency Tolerance Violations</h4>
<p>The NTP Version 3 specification RFC-1305 calls for a maximum oscillator frequency tolerance of +-100 parts-per-million (PPM), which is representative of those components suitable for use in relatively inexpensive workstation platforms. For those platforms meeting this tolerance, NTP will automatically compensate for the frequency errors of the individual oscillator and no further adjustments are required, either to the configuration file or to various kernel variables. For the NTP Version 4 release, this tolerance has been increased to +-500 PPM.</p>
<p>However, in the case of certain notorious platforms, in particular Sun 4.1.1 systems, the performance can be improved by adjusting the values of certain kernel variables; in particular, <tt>tick</tt> and <tt>tickadj</tt>. The variable <tt>tick</tt> is the increment in microseconds added to the system time on each interval- timer interrupt, while the variable <tt>tickadj</tt> is used by the time adjustment code as a slew rate, in microseconds per tick. When the time is being adjusted via a call to the system routine <tt>adjtime()</tt>, the kernel increases or reduces tick by <tt>tickadj</tt> microseconds per tick until the specified adjustment has been completed. Unfortunately, in most Unix implementations the tick increment must be either zero or plus/minus exactly <tt>tickadj</tt> microseconds, meaning that adjustments are truncated to be an integral multiple of <tt>tickadj</tt> (this latter behaviour is a misfeature, and is the only reason the <tt>tickadj</tt> code needs to concern itself with the internal implementation of <tt>tickadj</tt> at all). In addition, the stock Unix implementation considers it an error to request another adjustment before a prior one has completed.</p>
<p>Thus, to make very sure it avoids problems related to the roundoff, the <tt>tickadj</tt> program can be used to adjust the values of <tt>tick</tt> and <tt>tickadj</tt>. This ensures that all adjustments given to <tt>adjtime()</tt> are an even multiple of <tt>tickadj</tt> microseconds and computes the largest adjustment that can be completed in the adjustment interval (using both the value of <tt>tick</tt> and the value of <tt>tickadj</tt>) so it can avoid exceeding this limit. It is important to note that not all systems will allow inspection or modification of kernel variables other than at system build time. It is also important to know that, with the current NTP tolerances, it is rarely necessary to make these changes, but in many cases they will substantially improve the general accuracy of the time service.</p>
<p>Unfortunately, the value of <tt>tickadj</tt> set by default is almost always too large for <tt>ntpd</tt>. NTP operates by continuously making small adjustments to the clock, usually at one-second intervals. If <tt>tickaj</tt> is set too large, the adjustments will disappear in the roundoff; while, if <tt>tickadj</tt> is too small, NTP will have difficulty if it needs to make an occasional large adjustment. While the daemon itself will read the kernel&rsquo;s values of these variables, it will not change the values, even if they are unsuitable. You must do this yourself before the daemon is started using the <tt>tickadj</tt> program included in the <tt>./util</tt> directory of the distribution. Note that the latter program will also compute an optimal value of <tt>tickadj</tt> for NTP use based on the kernel&rsquo;s value of <tt>tick</tt>.</p>
<p>The <tt>tickadj</tt> program can reset several other kernel variables if asked. It can change the value of <tt>tick</tt> if asked. This is handy to compensate for kernel bugs which cause the clock to run with a very large frequency error, as with SunOS 4.1.1 systems. It can also be used to set the value of the kernel <tt>dosynctodr</tt> variable to zero. This variable controls whether to synchronize the system clock to the time-of-day clock, something you really don&rsquo;t want to be happen when <tt>ntpd</tt> is trying to keep it under control. In some systems, such as recent Sun Solaris kernels, the <tt>dosynctodr</tt> variable is the only one that can be changed by the <tt>tickadj</tt> program. In this and other modern kernels, it is not necessary to change the other variables in any case.</p>
<p>We have a report that says starting with Solaris 2.6 we should leave <em>dosynctodr</em> alone.</p>
<p>In order to maintain reasonable correctness bounds, as well as reasonably good accuracy with acceptable polling intervals, <tt>ntpd</tt> will complain if the frequency error is greater than 500 PPM. For machines with a value of <tt>tick</tt> in the 10-ms range, a change of one in the value of <tt>tick</tt> will change the frequency by about 100 PPM. In order to determine the value of <tt>tick</tt> for a particular CPU, disconnect the machine from all source s of time (<tt>dosynctodr</tt> = 0) and record its actual time compared to an outside source (eyeball-and-wristwatch will do) over a day or more. Multiply the time change over the day by 0.116 and add or subtract the result to tick, depending on whether the CPU is fast or slow. An example call to <tt>tickadj</tt> useful on SunOS 4.1.1 is:</p>
<p><code>tickadj -t 9999 -a 5 -s</code></p>
<p>which sets tick 100 PPM fast, <tt>tickadj</tt> to 5 microseconds and turns off the clock/calendar chip fiddle. This line can be added to the <tt>rc.local</tt> configuration file to automatically set the kernel variables at boot time.</p>
<p>All this stuff about diddling kernel variables so the NTP daemon will work is really silly. If vendors would ship machines with clocks that kept reasonable time and would make their <tt>adjtime()</tt> system call apply the slew it is given exactly, independent of the value of <tt>tickadj</tt>, all this could go away. This is in fact the case on many current Unix systems.</p>
<hr>
<h3 id="solaris-26">Solaris 2.6</h3>
</a>
<p><a id="frequency_tolerance">Solaris 2.6 adds support for kernel PLL timekeeping, but breaks this support in such a fashion that using it worse than not. This is</a> <a href="/archives/hints/solaris.xtra.4095849">SUN Bug ID 4095849</a>, and it is not yet fixed as of June 1998.</p>
<hr>
<h3 id="solaris-25-and-251">Solaris 2.5 and 2.5.1</h3>
<p>On UltraSPARC systems, calculation of <em>cpu_tick_freq</em> is broken such that values that are off by significant amounts may be used instead. This unfortunately means that ntpd may have severe problems keeping synchronization. This is <a href="/archives/hints/solaris.xtra.4023118">SUN Bug ID 4023118</a>. Bryan Cantrill of Sun posted <a href="/archives/hints/solaris.xtra.patchfreq">patchfreq</a>, a workaround script, to comp.protocols.time.ntp in March of 1997.</p>
<hr>
<h2 id="old-data">OLD DATA</h2>
<p><strong>I can&rsquo;t vouch for the accuracy the information below this rule. It may be significantly dated or incorrect.</strong></p>
<hr>
<h3 id="solaris-22">Solaris 2.2</h3>
<p>Solaris 2.2 and later contain completely re-written clock code to provide high resolution microsecond timers. A benefit of the re-written clock code is that adjtime does not round off its adjustments, so ntp does not have to compensate for this rounding. Under Solaris 2.2 and later, ntp #define&rsquo;s <code>ADJTIME_IS_ACCURATE</code>, and does not look for the <em>tickadj</em> kernel variable.</p>
<hr>
<h3 id="solaris-21">Solaris 2.1</h3>
<p>(This originally written by William L. Jones <a href="mailto:jones@chpc.utexas.edu">jones@chpc.utexas.edu</a>)</p>
<p>Solaris 2.1 contains fairly traditional clock code, with <em>tick</em> and <em>tickadj</em>.</p>
<p>Since settimeofday under Solaris 2.1 only sets the seconds part of timeval care must be used in starting xntpd. I suggest the following start up script:</p>
<pre>tickadj -s -a 1000  
ntpdate -v server1 server2  
sleep 20  
ntpdate -v server1 server2  
sleep 20  
tickadj -a 200  
xntpd</pre>
<p>The first tickadj turns of the time of day clock and sets the tick adjust value to 1 millisecond. This will insure that an adjtime value of at most 2 seconds will complete in 20 seconds.</p>
<p>The first ntpdate will set the time to within two seconds using settimeofday or it will adjust time using adjtime.</p>
<p>The first sleep insures the adjtime has completed for the first ntpdate.</p>
<p>The second ntpdate will use adjtime to set the time of day since the clock should be within 2 seconds of the correct time.</p>
<p>The second tickadj set the tick adjust system value to 5 microseconds.</p>
<p>The second sleeps insure that adjtime will complete before starting the next xntpd.</p>
<p>I tried running with a tickadj of 5 microseconds with out much success. 200 microseconds seems to work well.</p>
<hr>
<p>Prior versions of this file had major text contributed by:</p>
<ul>
<li>Denny Gentry <a href="mailto:denny@eng.sun.com">denny@eng.sun.com</a></li>
</ul>

<<<<<<< HEAD
	
		<style>
=======
	  
	  <style>
>>>>>>> 6d5d26678335f136d76d3690b58ec7d8917691a8
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<<<<<<< HEAD
<div class="d-print-none">
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it!</a>.
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that.</a>.
</p>
</div>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

		<br />
	
	
=======
<div>
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="btn-primary mb-5 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn-primary mb-5 feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it!</a>
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that.</a>
</p>
>>>>>>> 6d5d26678335f136d76d3690b58ec7d8917691a8
</div>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

	  <br />
	
  </div>
</section>
<footer class="navbar site-footer fixed-bottom py-0">
  <ul class="mx-auto">
    
    <li class="navbar-text" data-toggle="tooltip" data-placement="top" title="Mailing lists" aria-label="Mailing lists">
      <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://lists.ntp.org/listinfo">
        <i class="bi-envelope"></i>
      </a>
    </li>
    
    <li class="navbar-text" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
      <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://twitter.com/ntp">
        <i class="bi-twitter"></i>
      </a>
    </li>
    
    <li class="navbar-text" data-toggle="tooltip" data-placement="top" title="LinkedIn" aria-label="LinkedIn">
      <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/groups/4651343">
        <i class="bi-linkedin"></i>
      </a>
    </li>
    
    <li class="navbar-text" data-toggle="tooltip" data-placement="top" title="Facebook" aria-label="Facebook">
      <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/networktimeprotocol">
        <i class="bi-facebook"></i>
      </a>
    </li>
    
    <li class="navbar-text">
      <p>&copy; 2021 <a class="navbar-text text-white" href="https://www.nwtime.org">Network Time Foundation</a></p>	
    </li>
  </ul>
</footer>


<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>









<script src="/js/main.min.edda36f11310414202808e2ac1dd0640e32cfff39126d93bd3d8a899e091711f.js" integrity="sha256-7do28RMQQUICgI4qwd0GQOMs//ORJtk709iomeCRcR8=" crossorigin="anonymous"></script>



  </body>
</html>