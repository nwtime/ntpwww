<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8"><meta name = "robots" content = "noindex">


  
  <meta name="description" content="Table of Contents

Synopsis
Description
Structure of shared memory-segment
Operation mode=0
Operation mode=1
Fudge Factors
Additional Information â€¦">
<meta property="og:title" content="Shared Memory Driver" />
<meta property="og:description" content="Table of Contents  Synopsis Description Structure of shared memory-segment Operation mode=0 Operation mode=1 Fudge Factors Additional Information   Synopsis  Address: 127.127.28.u Reference ID: SHM Driver ID: SHM   Description This driver receives its reference clock info from a shared memory-segment. The shared memory-segment is created with owner-only access for unit 0 and 1, and world access for unit 2 and 3.
 Structure of shared memory-segment struct shmTime {int mode; /* 0 - if valid set* use values, * clear valid* 1 - if valid set * if count before and after read of * values is equal,* use values * clear valid*/int count;time_t clockTimeStampSec; /* external clock */int clockTimeStampUSec; /* external clock */time_t receiveTimeStampSec; /* internal clock, when external value was received */int receiveTimeStampUSec; /* internal clock, when external value was received */int leap;int precision;int nsamples;int valid;int dummy[10]; }; Operation mode=0 When the poll-method of the driver is called, the valid-flag of the shared memory-segment is checked:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://doc.ntp.org/archives/3-5.93e/driver28/" /><meta property="article:section" content="archives" />

<meta property="og:site_name" content="NTP: Network Time Protocol" />



<script async src="https://www.googletagmanager.com/gtag/js?id=G-BN61ZTDHBP"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-BN61ZTDHBP', { 'anonymize_ip': false });
}
</script>


  
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,400i,700,800,800i,900i&display=swap" rel="stylesheet"/>
   
  <title>Shared Memory Driver</title>

  <!-- Mobile Responsive Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  
  <meta name="generator" content="Hugo 0.83.1" />

  <!-- Plugins -->
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://doc.ntp.org/scss/nwtime.min.css" media="screen">

  <!-- Favicon -->
  <link rel="shortcut icon" href="https://doc.ntp.org/favicons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="https://doc.ntp.org/favicons/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" href="https://doc.ntp.org/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="https://doc.ntp.org/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://doc.ntp.org/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="https://doc.ntp.org/favicons/android-chrome-512x512.png" sizes="512x512"></head>
<body><!-- navigation -->

<nav class="navbar navbar-expand-lg navbar-light">
  <div class="container-fluid">


	<div>
	  <a class="navbar-brand" href="https://www.nwtime.org"><img height="80" width="80" src="https://doc.ntp.org/images/logo.png" alt=""></a>
	  <a class="navbar-brand" href="https://doc.ntp.org/"><img height="80" width="80" src="https://doc.ntp.org/images/ntp_logo.jpg" alt="NTP: Network Time Protocol"></a> 
    </div>


    <div>
      
		<button class="btn btn-light btn-lg" type="button" id="dropdownMenu2" aria-expanded="false"><a class="nav-item" style="text-decoration: none; text-transform: uppercase" href="https://doc.ntp.org/support">Support</a>
        </button>
      
		<button class="btn btn-light btn-lg" type="button" id="dropdownMenu2" aria-expanded="false"><a class="nav-item" style="text-decoration: none; text-transform: uppercase" href="https://doc.ntp.org/reflib">Reference Library</a>
        </button>
      
		<button class="btn btn-light btn-lg" type="button" id="dropdownMenu2" aria-expanded="false"><a class="nav-item" style="text-decoration: none; text-transform: uppercase" href="https://doc.ntp.org/documentation">Documentation</a>
        </button>
      
    </div>


<script async src="https://cse.google.com/cse.js?cx=bb3c9b3e375d856be"></script>
  <div class="gcse-search">
  </div>
</nav>


  <div class="header-border">
  </div>
<!-- /navigation --><nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="https://doc.ntp.org/documentation/">Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://doc.ntp.org/archives/3-5.93e/">3-5.93e</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://doc.ntp.org/archives/3-5.93e/driver28/">Shared Memory Driver</a>
</li>

	</ol>
</nav	>


<section class="section pt-0  pb-auto">
  <div class="container">
  	<h1>Shared Memory Driver</h1>
     
    <h4 id="table-of-contents">Table of Contents</h4>
<ul>
<li><a href="/archives/3-5.93e/driver28/#synopsis">Synopsis</a></li>
<li><a href="/archives/3-5.93e/driver28/#description">Description</a></li>
<li><a href="/archives/3-5.93e/driver28/#structure-of-shared-memory-segment">Structure of shared memory-segment</a></li>
<li><a href="/archives/3-5.93e/driver28/#operation-mode0">Operation mode=0</a></li>
<li><a href="/archives/3-5.93e/driver28/#operation-mode1">Operation mode=1</a></li>
<li><a href="/archives/3-5.93e/driver28/#fudge-factors">Fudge Factors</a></li>
<li><a href="/archives/3-5.93e/driver28/#additional-information">Additional Information</a></li>
</ul>
<hr>
<h4 id="synopsis">Synopsis</h4>
<dl>
<dt><strong>Address:</strong> <code>127.127.28.<em>u</em></code></dt>
<dd><strong>Reference ID:</strong> <code>SHM</code></dd>
<dd><strong>Driver ID:</strong> <code>SHM</code></dd>
</dl>
<hr>
<h4 id="description">Description</h4>
<p>This driver receives its reference clock info from a shared memory-segment. The shared memory-segment is created with owner-only access for unit 0 and 1, and world access for unit 2 and 3.</p>
<hr>
<h4 id="structure-of-shared-memory-segment">Structure of shared memory-segment</h4>
<pre>
struct shmTime {
  int    mode; /* 0 - if valid set
                *       use values, 
                *       clear valid
                * 1 - if valid set 
                *       if count before and after read of 
                *       values is equal,
                *         use values 
                *       clear valid
                */
  int    count;
  time_t clockTimeStampSec;      /* external clock */
  int    clockTimeStampUSec;     /* external clock */
  time_t receiveTimeStampSec;    /* internal clock, when external value was received */
  int    receiveTimeStampUSec;   /* internal clock, when external value was received */
  int    leap;
  int    precision;
  int    nsamples;
  int    valid;
  int    dummy[10]; 
};
</pre>
<hr>
<h4 id="operation-mode0">Operation mode=0</h4>
<p>When the poll-method of the driver is called, the valid-flag of the shared memory-segment is checked:</p>
<p>If set, the values in the record (<code>clockTimeStampSec, clockTimeStampUSec, receiveTimeStampSec, receiveTimeStampUSec, leap, precision</code>) are passed to ntp, and the <code>valid-flag</code> is cleared.</p>
<p>If not set, a timeout is reported to ntp, nothing else happened.</p>
<hr>
<h4 id="operation-mode1">Operation mode=1</h4>
<p>When the poll-method of the driver is called, the valid-flag of the shared memory-segment is checked:</p>
<p>If set, the count-field of the record is remembered, and the values in the record (<code>clockTimeStampSec, clockTimeStampUSec, receiveTimeStampSec, receiveTimeStampUSec, leap, precision</code>) are read. Then, the remembered count is compared to the count now in the record. If both are equal, the values read from the record are passed to ntp. If they differ, another process has modified the record while it was read out (was not able to produce this case), and failure is reported to ntp. The valid flag is cleared.</p>
<p>If not set, a timeout is reported to ntp, nothing else happened.</p>
<hr>
<h4 id="fudge-factors">Fudge Factors</h4>
<dl>
<dt><code><strong>time1 <em>time</em></strong></code></dt>
<dd>
<p>Specifies the time offset calibration factor, in seconds and fraction, with default 0.0.</p>
</dd>
<dt><code><strong>time2 <em>time</em></strong></code></dt>
<dd>
<p>Not used by this driver.</p>
</dd>
<dt><code><strong>stratum <em>number</em></strong></code></dt>
<dd>
<p>Specifies the driver stratum, in decimal from 0 to 15, with default 0.</p>
</dd>
<dt><code><strong>refid <em>string</em></strong></code></dt>
<dd>
<p>Specifies the driver reference identifier, an ASCII string from one to four characters, with default <code>SHM</code>.</p>
</dd>
<dt><code><strong>flag1 0 | 1</strong></code></dt>
<dd>
<p>Not used by this driver.</p>
</dd>
<dt><code><strong>flag2 0 | 1</strong></code></dt>
<dd>
<p>Not used by this driver.</p>
</dd>
<dt><code><strong>flag3 0 | 1</strong></code></dt>
<dd>
<p>Not used by this driver.</p>
</dd>
<dt><code><strong>flag4 0 | 1</strong></code></dt>
<dd>
<p>Not used by this driver.</p>
</dd>
</dl>
<hr>
<h4 id="additional-information">Additional Information</h4>
<p><a href="/archives/3-5.93e/refclock/">Reference Clock Drivers</a></p>

	  
	  <style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<div>
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="btn-primary mb-5 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn-primary mb-5 feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it!</a>
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that.</a>
</p>
</div>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

	  <br />
	
  </div>
</section>
<nav class="site-footer navbar navbar-expand-sm mt-auto">
  <div class="container">
      <ul class="navbar-nav">
        
        <li class="nav-item" title="Twitter" aria-label="Twitter">
          <a class="nav-link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/ntp">
          <img src="/images/icons/twitter.svg" width="20" height="20"></img>
          </a>
       </li>
       
        <li class="nav-item" title="LinkedIn" aria-label="LinkedIn">
          <a class="nav-link" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/groups/4651343">
          <img src="/images/icons/linkedin.svg" width="20" height="20"></img>
          </a>
       </li>
       
        <li class="nav-item" title="Facebook" aria-label="Facebook">
          <a class="nav-link" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/networktimeprotocol">
          <img src="/images/icons/facebook.svg" width="20" height="20"></img>
          </a>
       </li>
       
	  </ul>
	  <ul class="mx-auto pt-3">
        <p>&copy; 2022 <a class="navbar-text text-white" href="https://www.nwtime.org/">Network Time Foundation</a></p>	
      </ul>
    </div>
</nav>
</body>
</html>