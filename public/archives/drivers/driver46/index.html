<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.84.1" /><META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>GPSD-NG client driver | NTP: Network Time Protocol</title>
<meta name="description" content="NTP Documentation Archive"><meta property="og:title" content="GPSD-NG client driver" />
<meta property="og:description" content="Last update: 30-Apr-2015 05:53 UTC
 Table of Contents  Synopsis Description Naming a Device The ‘mode’ word Syslog flood throttle PPS secondary clock unit Clockstats Fudge Factors Additional Information   Synopsis Address: 127.127.46._u_
Reference ID: GPSD
Driver ID: GPSD_JSON
Serial Port: /dev/gps_u_ as symlink to the true device (not used directly; see below)
Features:
 Description This driver is a client driver to the GPSD daemon, which over the time became increasingly popular for UN*Xish platforms." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/drivers/driver46/" /><meta property="article:section" content="archives" />

<meta property="og:site_name" content="NTP: Network Time Protocol" />

<meta itemprop="name" content="GPSD-NG client driver">
<meta itemprop="description" content="Last update: 30-Apr-2015 05:53 UTC
 Table of Contents  Synopsis Description Naming a Device The ‘mode’ word Syslog flood throttle PPS secondary clock unit Clockstats Fudge Factors Additional Information   Synopsis Address: 127.127.46._u_
Reference ID: GPSD
Driver ID: GPSD_JSON
Serial Port: /dev/gps_u_ as symlink to the true device (not used directly; see below)
Features:
 Description This driver is a client driver to the GPSD daemon, which over the time became increasingly popular for UN*Xish platforms.">

<meta itemprop="wordCount" content="1812">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="GPSD-NG client driver"/>
<meta name="twitter:description" content="Last update: 30-Apr-2015 05:53 UTC
 Table of Contents  Synopsis Description Naming a Device The ‘mode’ word Syslog flood throttle PPS secondary clock unit Clockstats Fudge Factors Additional Information   Synopsis Address: 127.127.46._u_
Reference ID: GPSD
Driver ID: GPSD_JSON
Serial Port: /dev/gps_u_ as symlink to the true device (not used directly; see below)
Features:
 Description This driver is a client driver to the GPSD daemon, which over the time became increasingly popular for UN*Xish platforms."/>




<link rel="preload" href="/scss/main.min.c7590aab2525bc59dfb1dc16e6ad51978d04d1687ab16e19453b88b4ff42ceea.css" as="style">
<link href="/scss/main.min.c7590aab2525bc59dfb1dc16e6ad51978d04d1687ab16e19453b88b4ff42ceea.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>





  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">NTP: Network Time Protocol</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Docs
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/archives/4.2.8-series/toc">4.2.8-series</a>
	
	<a class="dropdown-item" href="/archives/4.2.6-series/toc">4.2.6-series</a>
	
	<a class="dropdown-item" href="/archives/4.2.4-series/toc">4.2.4-series</a>
	
	<a class="dropdown-item" href="/archives/4.2.2-series/toc">4.2.2-series</a>
	
	<a class="dropdown-item" href="/archives/4.2.0/toc">4.2.0</a>
	
	<a class="dropdown-item" href="/archives/4.1.2/toc">4.1.2</a>
	
	<a class="dropdown-item" href="/archives/4.1.1/toc">4.1.1</a>
	
	<a class="dropdown-item" href="/archives/4.1.0/toc">4.1.0</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="/archives/">Docs</a>
</li>




<li class="breadcrumb-item" >
	<a href="/archives/drivers/">Drivers</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/archives/drivers/driver46/">GPSD-NG client driver</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<h1>GPSD-NG client driver</h1>
    
	       
	<p>Last update: 30-Apr-2015 05:53 UTC</p>
<hr>
<h4 id="table-of-contents">Table of Contents</h4>
<ul>
<li><a href="/archives/drivers/driver46/#synopsis">Synopsis</a></li>
<li><a href="/archives/drivers/driver46/#description">Description</a></li>
<li><a href="/archives/drivers/driver46/#naming-a-device">Naming a Device</a></li>
<li><a href="/archives/drivers/driver46/#the-mode-word">The ‘mode’ word</a></li>
<li><a href="/archives/drivers/driver46/#syslog-flood-throttle">Syslog flood throttle</a></li>
<li><a href="/archives/drivers/driver46/#pps-secondary-clock-unit">PPS secondary clock unit</a></li>
<li><a href="/archives/drivers/driver46/#clockstats">Clockstats</a></li>
<li><a href="/archives/drivers/driver46/#fudge-factors">Fudge Factors</a></li>
<li><a href="/archives/drivers/driver46/#additional-information">Additional Information</a></li>
</ul>
<hr>
<h4 id="synopsis">Synopsis</h4>
<p>Address: <code>127.127.46._u_</code><br>
Reference ID: <tt>GPSD</tt><br>
Driver ID: <tt>GPSD_JSON</tt><br>
Serial Port: <tt>/dev/gps_u_</tt> as symlink to the true device (not used directly; see below)<br>
Features:</p>
<hr>
<h4 id="description">Description</h4>
<p>This driver is a client driver to the <em>GPSD</em> daemon, which over the time became increasingly popular for UN*Xish platforms. <em>GPSD</em> can manage several devices in parallel, aggregate information, and acts as a data hub for client applications. <em>GPSD</em> can also auto-detect and handle PPS hardware signals on serial ports. Have a look at <a href="https://gpsd.gitlab.io/gpsd/index.html">the <em>GPSD</em> project page</a>.</p>
<p><strong>It is important to understand that this driver works best using a GPS device with PPS support.</strong></p>
<p>The GPSD-NG protocol is text based, using JSON notation to transfer records in form of JSON objects. The driver uses a TCP/IP connection to <tt>localhost:gpsd</tt> to connect to the daemon and then requests the GPS device <tt>/dev/gps_u_</tt> to be watched. Different clock units use different devices, and GPSD is able to give only the relevant information to a clock instance.</p>
<p>This driver does not expect <em>GPSD</em> to be running or the clock device to be present <em>a priori</em>; it will try to re-establish a lost or hitherto unsuccessful connection and will wait for device to come up in <em>GPSD.</em> There is an initial 10 seconds delay between a connection loss or failed attempt and the next reconnect attempt; this makes sure that there is no thrashing on the network layer. If the connection fails again, an exponential back off is used with an upper limit of approximately 10 minutes.</p>
<p>The overall accuracy depends on the receiver used. The driver uses the error estimations (95% probability limits) provided by <em>GPSD</em> to set the clock precision dynamically according to these readings.</p>
<p>The driver needs the VERSION, TPV, PPS, WATCH and TOFF objects of the <em>GPSD</em> protocol. (Others are quietly ignored.) The driver can operate without the TOFF objects, which are available with the <em>protocol</em> version 3.10 and above. (Not to be confused with the <em>release</em> version of <em>GPSD</em>!) Running without TOFF objects has a negative impact on the jitter and offset of the serial timing information; if possible, a version of <em>GPSD</em> with support for TOFF objects should be used.</p>
<p>The acronym <u>STI</u> is used here as a synonym for <em>serial time information</em> from the data channel of the receiver, no matter what objects were used to obtain it.</p>
<hr>
<h4 id="naming-a-device">Naming a Device</h4>
<p>The <em>GPSD</em> driver uses the same device name as the NMEA driver, namely <tt>/dev/gps_u_</tt>. There is a simple reason for that: While the NMEA driver and the GPSD driver can be active at the same time for different devices, they cannot access the same device at a time. Having the same name helps on that. It also eases migration from using NMEA directly to using GPSD, as no new links etc need to be created.</p>
<p><em>GPSD</em> is normally started with the device name to access; it can also be instructed by hot-plug scripts to add or remove devices from its device pool. Luckily, the symlinks used by the NMEA driver are happily accepted and used by <em>GPSD</em>; this makes it possible to use the symlink names as device identification. This makes the migration from the built-in NMEA driver a bit easier.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Note</h4>

    <em>GPSD</em> (as of version 3.10) cannot use kernel mode PPS on devices that are hot-plugged. This would require to attach the PPS line discipline to the character special file, which is not possible when running with root privileges already dropped. This is not likely to change in the future.

</div>

<h4 id="the-mode-word">The &lsquo;mode&rsquo; word</h4>
<p>A few operation modes can be selected with the mode word.</p>
<p><strong>The Mode Word</strong></p>
<table>
<thead>
<tr>
<th>Bits</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0-1</td>
<td><code>0</code></td>
<td>STI only operation. This mode is affected by the timing stability of whatever protocol is used between the GPS device and GPSD.  Running on STI only is not recommended in general. Possible use cases include:<br> - The receiver does not provide a PPS signal.<br> - The receiver <em>does</em> provide a PPS signal and the secondary PPS unit is used.<br> - The receiver has a stable serial timing and a proper fudge can be established.<br> - You have other time sources available and want to establish a useful fudge value for <tt>time2</tt>.</td>
</tr>
<tr>
<td></td>
<td><code>1</code></td>
<td>Strict operation. This mode needs a valid PPS and a valid STI to combine the absolute time from the STI with the time stamp from the PPS record. Does not feed clock samples if no valid PPS+STI pair is available. This type of operation results in an ordinary clock with a very low jitter as long as the PPS data is available, but the clock fails once PPS drops out. This mode is a possible choice for receivers that provide a PPS signal most of the time but have an unstable serial timing that cannot be fudge-compensated.</td>
</tr>
<tr>
<td></td>
<td><code>2</code></td>
<td>Automatic mode. Tries to operate in strict mode unless it fails to process valid samples for some time, currently 120s. Then it reverts to STI-only operation until the PPS is stable again for 40s, when strict mode is engaged again. <strong>Important Notice: This is an expiremental feature!</strong>  Switching between strict and STI-only mode will cause changes in offset and jitter. Use this mode only if STI-only works fairly well with your setup, or if you expect longer dropouts of the PPS signal and prefer to use STI alone over not getting synchronised at all.</td>
</tr>
<tr>
<td></td>
<td><code>3</code></td>
<td>reserved for future extension, do not use</td>
</tr>
<tr>
<td>2-31</td>
<td></td>
<td>reserved for future extension, do not use</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="syslog-flood-throttle">Syslog flood throttle</h4>
<p>This driver can create a lot of syslog messages when things go wrong, and cluttering the log files is frowned upon. So we attempt to log persistent or recurring errors only once per hour. On the other hand, when tracking a problem the syslog flood throttle can get into the way.</p>
<p>Therefore, fudge <em>flag3</em> can be used to <em>disable</em> the flood throttle at any time; the throttle is engaged by default. Running with the syslog flood throttle disabled for lengthy time is not recommended unless the log files are closely monitored.</p>
<hr>
<h4 id="pps-secondary-clock-unit">PPS secondary clock unit</h4>
<p>Units with numbers ≥128 act as secondary clock unit for the primary clock unit (u mod 128). A secondary unit processes only the PPS data from <em>GPSD</em> and needs the corresponding master unit to work<sup><a href="#myfootnote1">1</a></sup>. Use the <code>noselect</code> keyword on the primary unit if you are not interested in its data.</p>
<p>The secondary unit employs the usual precautions before feeding clock samples:</p>
<ul>
<li>The system must be already in a synchronised state.</li>
<li>The system offset must be less than 400ms absolute.</li>
<li>The phase adjustment from the PPS signal must also be less than 400ms absolute.</li>
</ul>
<p>If fudge flag <tt>flag1</tt> is set for the secondary unit, the unit asserts the PPS flag on the clock as long as PPS data is available. This makes the unit eligible as PPS peer and should only be used if the GPS receiver can be trusted for the quality of its PPS signal<sup><a href="#myfootnote2">2</a></sup>. The PPS flag gets cleared if no PPS records can be aquired for some time. The unit also flushes the sample buffer at this point to avoid the use of stale PPS data.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Attention</h4>

    This unit uses its own PPS fudge value which must be set as fudge <tt>time1</tt>. Only the fudge values <tt>time1</tt> and <tt>flag1</tt> have an impact on secondary units.

</div>

<hr>
<h4 id="clockstats">Clockstats</h4>
<p>If flag4 is set when the driver is polled, a clockstats record is written for the primary clock unit. (The secondary PPS unit does not provide clock stats on its own.) The first 3 fields are the normal date, time, and IP address common to all clockstats records.</p>
<p><strong>The Clockstats Line</strong></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>1</code></td>
<td>Date as day number since NTP epoch.</td>
</tr>
<tr>
<td><code>2</code></td>
<td>Time as seconds since midnight.</td>
</tr>
<tr>
<td><code>3</code></td>
<td>(Pseudo-) IP address of clock unit.</td>
</tr>
<tr>
<td><code>4</code></td>
<td>Number of received known JSON records since last poll. The driver knows about TPV, PPS, TOFF, VERSION, and WATCH records; others are silently ignored.</td>
</tr>
<tr>
<td><code>5</code></td>
<td>Bad replies since last poll. A record is considered malformed or a bad reply when it is missing vital fields or the fields contain malformed data that cannot be parsed.</td>
</tr>
<tr>
<td><code>6</code></td>
<td>Number of sample cycles since last poll that were discarded because there was no GPS fix. This is effectively the number of TPV records with a fix value &lt; 2 or without a time stamp.</td>
</tr>
<tr>
<td><code>7</code></td>
<td>Number of serial time information records (TPV or TOFF, depending on the GPSD version) received since last poll.</td>
</tr>
<tr>
<td><code>8</code></td>
<td>Number of serial time information records used for clock samples since the last poll.</td>
</tr>
<tr>
<td><code>9</code></td>
<td>Number of PPS records received since the last poll.</td>
</tr>
<tr>
<td><code>10</code></td>
<td>Number of PPS records used for clock samples on the secondary channel since the last poll.</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="fudge-factors">Fudge Factors</h4>
<dt><tt>time1 _time_</tt></dt>
<p>Specifies the PPS time offset calibration factor, in seconds and fraction, with default 0.0.</p>
<dt><a name="fudgetime2"><tt>time2 _time_</tt></a></dt>
<p><em>[Primary Unit]</em> Specifies the TPV/TIME time offset calibration factor, in seconds and fraction, with default 0.0.</p>
<dt><tt>stratum _number_</tt></dt>
<p>Specifies the driver stratum, in decimal from 0 to 15, with default 0.</p>
<dt><tt>refid _string_</tt></dt>
<p>Specifies the driver reference identifier, an ASCII string from one to four characters, with default <tt>GPSD</tt>.</p>
<dt><tt>flag1 0 | 1</tt></dt>
<p><em>[Secondary Unit]</em> When set, flags the secondary clock unit as a potential PPS peer as long as good PPS data is available.</p>
<dt><tt>flag2 0 | 1</tt></dt>
<p><em>[Primary Unit]</em> When set, disables the processing of incoming PPS records. Intended as an aide to test the effects of a PPS dropout when using automatic mode (mode 2).</p>
<dt><tt>flag3 0 | 1</tt></dt>
<p><em>[Primary Unit]</em> If set, disables the log throttle. Useful when tracking problems in the interaction between <em>GPSD</em> and <em>NTPD</em>, since now all error events are logged. Persistent/recurrent errors can easily fill up the log, so this should only be enabled during bug hunts.</p>
<dt><tt>flag4 0 | 1</tt></dt>
<p><em>[Primary Unit]</em> If set, write a clock stats line on every poll cycle.</p>
</dl>
<hr>
<h4 id="additional-information">Additional Information</h4>
<p><a name="myfootnote1">1</a>  Data transmission and decoding is done only once by the primary unit. The decoded data is then processed independently in both clock units. This avoids double transmission over two sockets and decoding the same data twice, but the primary unit is always needed as a downside of this approach.</p>
<p><a name="myfootnote2">2</a>  The clock driver suppresses the processing PPS records when the TPV/TIME data indicates the receiver has no fix. It can also deal with situations where the PPS signal is not delivered to <em>GPSD</em>. But once it is available, it is also processed and used to create samples. If a receiver cannot be trusted for the precision of its PPS signal, it should not be used to create a possible PPS peer: These get extra clout and can effectively become the sole source of input for the control loop. You do not want to use sloppy data for that.</p>
<p><a href="/archives/4.2.8-series/refclock">Reference Clock Drivers</a></p>

	
	
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing lists" aria-label="Mailing lists">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://lists.ntp.org/listinfo">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://twitter.com/ntp">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="LinkedIn" aria-label="LinkedIn">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/groups/4651343">
      <i class="fab fa-linkedin-in"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Facebook" aria-label="Facebook">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/networktimeprotocol">
      <i class="fab fa-facebook-f"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 Network Time Foundation All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>






 











<script src="/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js" integrity="sha256-XHS4cMaVOTGnBfOQpJx&#43;TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin="anonymous"></script>




  </body>
</html>