<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>NTP: Network Time Protocol â€“ Docs</title>
    <link>/archives/</link>
    <description>Recent content in Docs on NTP: Network Time Protocol</description>
    <generator>Hugo -- gohugo.io</generator>
    
	  <atom:link href="/archives/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Archives: </title>
      <link>/archives/3-5.93e/toc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/3-5.93e/toc/</guid>
      <description>
        
        
        

&lt;div class=&#34;pageinfo pageinfo-primary&#34;&gt;
&lt;p&gt;4.2.8p15 is the latest stable and recommended version of NTP. Click &lt;a href=&#34;/archives/4.2.8-series&#34;&gt;here&lt;/a&gt; to read the latest version of the docs.&lt;/p&gt;
&lt;p&gt;3-5.93e is the last released version for the deprecated NTPv3. It was released in November, 1998. Click &lt;a href=&#34;/archives/3-5.93e&#34;&gt;here&lt;/a&gt; to read the 3-5.93e version of the docs.&lt;/p&gt;

&lt;/div&gt;


      </description>
    </item>
    
    <item>
      <title>Archives: </title>
      <link>/archives/4.1.0/toc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.0/toc/</guid>
      <description>
        
        
        

&lt;div class=&#34;pageinfo pageinfo-primary&#34;&gt;
&lt;p&gt;4.2.8p15 is the latest stable and recommended version of NTP. Click &lt;a href=&#34;/archives/4.2.8-series&#34;&gt;here&lt;/a&gt; to read the latest version of the docs.&lt;/p&gt;
&lt;p&gt;4.1.0 is a historical release that was released in August, 2001. Click &lt;a href=&#34;/archives/4.1.0&#34;&gt;here&lt;/a&gt; to read the 4.1.0 version of the docs.&lt;/p&gt;

&lt;/div&gt;


      </description>
    </item>
    
    <item>
      <title>Archives: </title>
      <link>/archives/4.1.1/toc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.1/toc/</guid>
      <description>
        
        
        

&lt;div class=&#34;pageinfo pageinfo-primary&#34;&gt;
&lt;p&gt;4.2.8p15 is the latest stable and recommended version of NTP. Click &lt;a href=&#34;/archives/4.2.8-series&#34;&gt;here&lt;/a&gt; to read the latest version of the docs.&lt;/p&gt;
&lt;p&gt;4.1.1 is a historical release that was released in February, 2002. Click &lt;a href=&#34;/archives/4.1.1&#34;&gt;here&lt;/a&gt; to read the 4.1.1 version of the docs.&lt;/p&gt;

&lt;/div&gt;


      </description>
    </item>
    
    <item>
      <title>Archives: </title>
      <link>/archives/4.1.2/toc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.2/toc/</guid>
      <description>
        
        
        

&lt;div class=&#34;pageinfo pageinfo-primary&#34;&gt;
&lt;p&gt;4.2.8p15 is the latest stable and recommended version of NTP. Click &lt;a href=&#34;/archives/4.2.8-series&#34;&gt;here&lt;/a&gt; to read the latest version of the docs.&lt;/p&gt;
&lt;p&gt;4.1.2 is a historical release that was &lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2003-July/000003.html&#34;&gt;released on July 17, 2003&lt;/a&gt;. Click &lt;a href=&#34;/archives/4.1.2&#34;&gt;here&lt;/a&gt; to read the 4.1.2 version of the docs.&lt;/p&gt;

&lt;/div&gt;


      </description>
    </item>
    
    <item>
      <title>Archives: </title>
      <link>/archives/4.2.0/toc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.0/toc/</guid>
      <description>
        
        
        

&lt;div class=&#34;pageinfo pageinfo-primary&#34;&gt;
&lt;p&gt;4.2.8p15 is the latest stable and recommended version of NTP. Click &lt;a href=&#34;/archives/4.2.8-series&#34;&gt;here&lt;/a&gt; to read the latest version of the docs.&lt;/p&gt;
&lt;p&gt;4.2.0 is a historical release that was &lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2003-October/000006.html&#34;&gt;released on October 15, 2003&lt;/a&gt;. Click &lt;a href=&#34;/archives/4.2.0&#34;&gt;here&lt;/a&gt; to read the 4.2.0 version of the docs.&lt;/p&gt;

&lt;/div&gt;


      </description>
    </item>
    
    <item>
      <title>Archives: </title>
      <link>/archives/4.2.2-series/toc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.2-series/toc/</guid>
      <description>
        
        
        

&lt;div class=&#34;pageinfo pageinfo-primary&#34;&gt;
&lt;p&gt;4.2.8p15 is the latest stable and recommended version of NTP. Click &lt;a href=&#34;/archives/4.2.8-series&#34;&gt;here&lt;/a&gt; to read the latest version of the docs.&lt;/p&gt;
&lt;p&gt;Click &lt;a href=&#34;/archives/4.2.2-series&#34;&gt;here&lt;/a&gt; to read the 4.2.2 version of the docs. Refer to the table below for the release announcement for each patch level in the 4.2.2-series.&lt;/p&gt;

&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Release Date&lt;/th&gt;
&lt;th&gt;Release Announcement&lt;/th&gt;
&lt;th&gt;# of Security Fixes&lt;/th&gt;
&lt;th&gt;# of Fixes&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;October 15, 2006&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2006-October/000031.html&#34;&gt;4.2.2p4&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2 (bugs)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;August 5, 2006&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2006-August/000023.html&#34;&gt;4.2.2p3&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2 (bugs)&lt;br&gt; 4 improvements)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;July 9, 2006&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2006-July/000018.html&#34;&gt;4.2.2p2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;July 9, 2006&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2006-July/000017.html&#34;&gt;4.2.2p1&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;6 (bugs)&lt;br&gt; 6 (improvements)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;June 8, 2006&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2006-June/000014.html&#34;&gt;4.2.2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2 (bugs)&lt;br&gt; 7 (improvements)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: </title>
      <link>/archives/4.2.4-series/toc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.4-series/toc/</guid>
      <description>
        
        
        

&lt;div class=&#34;pageinfo pageinfo-primary&#34;&gt;
&lt;p&gt;4.2.8p15 is the latest stable and recommended version of NTP. Click &lt;a href=&#34;/archives/4.2.8-series&#34;&gt;here&lt;/a&gt; to read the latest version of the docs.&lt;/p&gt;
&lt;p&gt;Click &lt;a href=&#34;/archives/4.2.4-series&#34;&gt;here&lt;/a&gt; to read the 4.2.4 version of the docs. Refer to the table below for the release announcement for each patch level in the 4.2.4-series.&lt;/p&gt;

&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Release Date&lt;/th&gt;
&lt;th&gt;Release Announcement&lt;/th&gt;
&lt;th&gt;# of Security Fixes&lt;/th&gt;
&lt;th&gt;# of Fixes&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;December 8, 2009&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2009-December/000086.html&#34;&gt;4.2.4p8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1 HIGH&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;May 18, 2009&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2009-May/000062.html&#34;&gt;4.2.4p7&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;January 8, 2009&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2009-January/000055.html&#34;&gt;4.2.4p6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1 (bug)&lt;br&gt; 1 (improvement)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;August 17, 2008&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2008-August/000052.html&#34;&gt;4.2.4p5&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;94 (bugs)&lt;br&gt; 102 (improvements)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;August 28, 2007&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2007-August/000045.html&#34;&gt;4.2.4p4-RC2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;8 (bugs)&lt;br&gt; 2 (improvements)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;June 29, 2007&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2007-June/000043.html&#34;&gt; 4.2.4p3&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1 bug&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;June 20, 2007&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2007-June/000042.html&#34;&gt;4.2.4p2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;10 (bugs)&lt;br&gt; 2 (improvements)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;March 7, 2007&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2007-March/000035.html&#34;&gt;4.2.4p0&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;8 (bugs(&lt;br&gt; 2 (improvements)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;December 18, 2006&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2006-December/000032.html&#34;&gt;4.2.4&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;57 (bugs)&lt;br&gt; 8 (improvements)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: </title>
      <link>/archives/4.2.6-series/toc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.6-series/toc/</guid>
      <description>
        
        
        

&lt;div class=&#34;pageinfo pageinfo-primary&#34;&gt;
&lt;p&gt;4.2.8p15 is the latest stable and recommended version of NTP. Click &lt;a href=&#34;/archives/4.2.8-series&#34;&gt;here&lt;/a&gt; to read the latest version of the docs.&lt;/p&gt;
&lt;p&gt;Click &lt;a href=&#34;/archives/4.2.6-series&#34;&gt;here&lt;/a&gt; to read the 4.2.6 version of the docs. Refer to the table below for the release announcement for each patch level in the 4.2.6-series.&lt;/p&gt;

&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;Release Date&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Release Announcement&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;# of Security Fixes&lt;/th&gt;
&lt;th&gt;# of Fixes&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;December 24, 2011&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2011-December/000119.html&#34;&gt;4.2.6p5&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;September 22, 2011&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2011-September/000116.html&#34;&gt;4.2.6p4&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;January 3, 2011&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2011-January/000111.html&#34;&gt;4.2.6p3&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;40&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;July 9, 2010&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2010-July/000099.html&#34;&gt;4.2.6p2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;April 9, 2010&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2010-April/000095.html&#34;&gt;4.2.6p1&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;December 9, 2009&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2009-December/000088.html&#34;&gt;4.2.6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1 HIGH&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: </title>
      <link>/archives/4.2.8-series/toc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.8-series/toc/</guid>
      <description>
        
        
        

&lt;div class=&#34;pageinfo pageinfo-primary&#34;&gt;
&lt;p&gt;4.2.8p15 is the latest stable and recommended version of NTP. Click &lt;a href=&#34;/archives/4.2.8-series&#34;&gt;here&lt;/a&gt; to read the latest version of the docs. Refer to the table below for the release announcement for each patch level in the 4.2.8-series.&lt;/p&gt;

&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Release Date&lt;/th&gt;
&lt;th&gt;Release Announcement&lt;/th&gt;
&lt;th&gt;# of Security Fixes&lt;/th&gt;
&lt;th&gt;# of Fixes&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;June 23, 2020&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#June_2020_ntp_4_2_8p15_NTP_Relea&#34;&gt;4.2.8p15&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1 MEDIUM&lt;/td&gt;
&lt;td&gt;13 bugs&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;March 3, 2020&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#March_2020_ntp_4_2_8p14_NTP_Rele&#34;&gt;4.2.8p14&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;2 MEDIUM&lt;/td&gt;
&lt;td&gt;46 bugs&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;March 7, 2019&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#March_2019_ntp_4_2_8p13_NTP_Rele&#34;&gt;4.2.8p13&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1 MEDIUM&lt;/td&gt;
&lt;td&gt;17 bugs&lt;br&gt; 1 improvement&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;August 14, 2018&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#August_2018_ntp_4_2_8p12_NTP_Rel&#34;&gt;4.2.8p12&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1 MEDIUM&lt;br&gt; 1 LOW&lt;/td&gt;
&lt;td&gt;27 bugs&lt;br&gt; 4 improvements&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;February 27, 2018&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#February_2018_ntp_4_2_8p11_NTP_S&#34;&gt;4.2.8p11&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;4 MEDIUM&lt;br&gt; 2 LOW&lt;/td&gt;
&lt;td&gt;33 bugs&lt;br&gt; 32 improvements&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;March 21, 2017&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#March_2017_ntp_4_2_8p10_NTP_Secu&#34;&gt;4.2.8p10&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;6 MEDIUM&lt;br&gt; 5 LOW&lt;br&gt; 4 INF&lt;/td&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;November 21, 2016&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#November_2016_ntp_4_2_8p9_NTP_Se&#34;&gt;4.2.8p9&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1 HIGH&lt;br&gt; 4 MEDIUM&lt;br&gt; 5 LOW&lt;/td&gt;
&lt;td&gt;28&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;June 2, 2016&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#June_2016_ntp_4_2_8p8_NTP_Securi&#34;&gt;4.2.8p8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1 HIGH&lt;br&gt; 4 LOW&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;April 26, 2016&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#April_2016_ntp_4_2_8p7_Security&#34;&gt;4.2.8p7&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;7 MEDIUM&lt;br&gt; 4 LOW&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;January 20, 2016&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#January_2016_NTP_4_2_8p6_Securit&#34;&gt;4.2.8p6&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;11 MEDIUM/LOW&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;January 7, 2016&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#January_2016_NTP_4_2_8p5_Securit&#34;&gt;4.2.8p5&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1 MEDIUM&lt;/td&gt;
&lt;td&gt;14 bugs&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;October 21, 2015&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#October_2015_NTP_4_2_8p4_Securit&#34;&gt;4.2.8p4&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;13 MEDIUM/LOW&lt;/td&gt;
&lt;td&gt;3 bugs&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;June 27, 2015&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#June_2015_NTP_4_2_8p3_Security_V&#34;&gt;4.2.8p3&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;1 LOW&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;April 7, 2015&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#April_2015_NTP_4_2_8p2_Security&#34;&gt;4.2.8p2&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;February 4, 2015&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://support.ntp.org/bin/view/Main/SecurityNotice#December_2014_NTP_4_2_8p1_Securi&#34;&gt;4.2.8p1&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;December 19, 2014&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://lists.ntp.org/pipermail/announce/2014-December/000122.html&#34;&gt;4.2.8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;6 HIGH&lt;/td&gt;
&lt;td&gt;1100+&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: A Kernel Model for Precision Timekeeping</title>
      <link>/archives/3-5.93e/kern/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/3-5.93e/kern/</guid>
      <description>
        
        
        &lt;p&gt;The technical memorandum: &lt;cite&gt;A Kernel Model for Precision Timekeeping&lt;/cite&gt; &lt;a href=&#34;https://www.eecis.udel.edu/~mills/database/memos/memo96b.ps&#34;&gt;(PostScript)&lt;/a&gt; describes an engineering model which implements a precision time-of-day function for a generic operating system. The model is based on the principles of disciplined oscillators using phase-lock loops (PLL) and frequency-lock loops (FLL) often found in the engineering literature. The model implements a hybrid PLL/FLL discipline algorithm implemented in the kernel. The hybrid loop provides automatic time and frequency steering with update intervals from a few seconds to several hours.&lt;/p&gt;
&lt;p&gt;The hybrid PLL/FLL has been implemented in the Unix kernels for several workstations, including those made by Sun Microsystems, Digital and Hewlett Packard. The model changes the way the system clock is adjusted in time and frequency, as well as provides mechanisms to discipline its time and frequency to an external precision timing source, such as a pulse-per-second (PPS) signal. The model incorporates a generic system-call interface for use with the Network Time Protocol (NTP) or similar time synchronization protocol. The NTP Version 3 daemon &lt;tt&gt;xntpd&lt;/tt&gt; operates with this model to provide synchronization limited in principle only by the accuracy and stability of the external timing source.&lt;/p&gt;
&lt;p&gt;This memorandum does not propose a standard protocol, specification or algorithm. It is intended to provoke comment, refinement and implementations for kernels not considered herein. While a working knowledge of NTP is not required for an understanding of the design principles or implementation of the model, it may be helpful in understanding how the model behaves in a fully functional timekeeping system.&lt;/p&gt;
&lt;p&gt;The model has been implemented in the Unix kernels for Sun Microsystems, Digital and Hewlett Packard workstations. In addition, for the Digital machines the model provides improved precision to one microsecond. Since these specific implementations involve modifications to licensed code, they cannot be provided directly. Inquiries should be directed to the manufacturer&amp;rsquo;s representatives. However, the engineering model for these implementations, including a simulator with code segments almost identical to the implementations, but not involving licensed code, is available at &lt;a href=&#34;https://www.eecis.udel.edu/~ntp/ntp_spool/software/kernel.tar.Z&#34;&gt;kernel.tar.Z&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are two new system calls defined in the model, &lt;tt&gt;ntp_gettime()&lt;/tt&gt;, which returns a structure including the
current time, estimated error and maximum error, and &lt;tt&gt;ntp_adjtime()&lt;/tt&gt;, which provides a means to adjust kernel
variables, including the current time and frequency offsets. Further information on the calling sequences and variable definitions are in the &lt;tt&gt;./include/sys/timex.h&lt;/tt&gt; file.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: A Kernel Programming Interface for Precision Time Signals</title>
      <link>/archives/3-5.93e/kernpps/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/3-5.93e/kernpps/</guid>
      <description>
        
        
        &lt;p&gt;The technical memorandum: &lt;cite&gt;A Kernel Programming Interface for Precision Time Signals&lt;/cite&gt; &lt;a href=&#34;https://www.eecis.udel.edu/~mills/database/memos/memo96c.ps&#34;&gt;(PostScript)&lt;/a&gt; describes a proposed programming interface for external precision time signals, such as the pulse-per-second (PPS) signal generated by some radio clocks and cesium oscillators.&lt;/p&gt;
&lt;p&gt;The memorandum argues for a generic capability in the ubiquitous Unix kernel, which could be used for a wide variety of measurement applications, including network time synchronization and experiments involving performance measurement and evaluation of computer networks and transmission systems. The hardware to do this requires only a serial port and a modem control lead, such as the data carrier detect (DCD) lead, which can be driven by an external source via a level converter/pulse generator.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: A-UX Hints</title>
      <link>/archives/hints/a-ux/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/hints/a-ux/</guid>
      <description>
        
        
        &lt;div id=&#34;body&#34;&gt;
&lt;pre&gt;-------------
INTRODUCTION:
-------------
Last revision:  06-Jul-1994

Included in this distribution of XNTP V3 is a configuration file suitable
for use under Apple&#39;s A/UX Version 3.x.x  There is also one for A/UX 2.0.1
but it has not been fully tested. To make the executables follow the steps
outlined below.

*** NOTE:  You must have gcc installed to successfully compile the current
distribution; the native cc supplied with A/UX will NOT correctly compile
this source.  See the FAQ in comp.unix.aux for places to obtain gcc from
and how to install it.

----------------------
MAKING XNTPD FOR A/UX:
----------------------

First, you need to create the makefiles (after you&#39;ve downloaded the
source, of course):

    % make clean
    % make refconf

After that, you should edit Config.local to make sure that BINDIR is
correct for where you wish the programs to be &#34;installed&#34;. The default
(and what I use) is /usr/local/etc. Make sure that DEFS_LOCAL and
CLOCKDEFS are commented out! Presently, only the LOCAL_CLOCK/REFCLOCK
clock is used and supported.

After this is done (you should be told that your system is A/UX 3), make
&#39;xntpd&#39; (the options to &#39;gcc&#39; are held in compilers/aux3.gcc):

    % make

I do not normally use the `make install&#39; option and so have not verified its
compatibility with A/UX.  Rather, I pull out each of the executables and
place them in the locally appropriate locations.

---------------
STARTING XNTPD:
---------------

At this point you need to set things up so that &#39;xntpd&#39; is started upon
boot-up. You can do this in 1 of 2 ways: either add entries in /etc/inittab
or, more ideally, create and use an /etc/rc.local file. Since rc.local is
what I recommend, here&#39;s how you do it:

By default, A/UX doesn&#39;t have rc.local, so you&#39;ll need to add the following to
/etc/inittab:

    net6:2:wait:/etc/syslogd		# set to &#34;wait&#34; to run a syslog daemon
+   jmj0:2:wait:/etc/rc.local 1&gt;/dev/syscon 2&gt;&amp;1	# Local stuff
    dbg2::wait:/etc/telinit v	# turn off init&#39;s verbose mode

Now, the look of a sample /etc/rc.local is as follows:

    #!/bin/sh
    :
    : rc.local
    :
    #	@(#)Copyright Apple Computer 1987	Version 1.17 of rc.sh on 91/11/08 15:56:21 (ATT 1.12)

    #	Push line discipline/set the device so it will print
    /etc/line_sane 1
    echo &#34; &#34;
    echo &#34;Entering rc.local...&#34;

    set `/bin/who -r`
    if [ &#34;$7&#34; = 2 ]
    then
        /bin/echo &#34; now setting the time...&#34;
        /usr/local/etc/ntpdate -s -b &lt;host.domain&gt;
        sleep 5
    #
    # start up &#39;xntpd&#39; if we want
    #
        if [ -f /etc/ntp.conf ]
        then
    	/bin/echo &#34; setting tick and tickadj...&#34;
    	/usr/local/etc/tickadj -t 16672 -a 54
    	sleep 5
    	/bin/echo &#34; starting xntpd...&#34;
    	/usr/local/etc/xntpd &lt;&amp;- &gt; /dev/null 2&gt;&amp;1
    	sleep 5
        fi
    #
    fi

    echo &#34;Leaving rc.local...&#34;

There are a few things to notice about the above:

    o When run, &#39;ntpdate&#39; forces your clock to the time returned by the
      host(s) specified by &lt;host.domain&gt; (you&#39;ll need to replace this
      be the IP address(es) of your timehosts. This is good since it gets
      things close to start off with. You can use more than one time
      server.

    o &#39;tickadj&#39; is also called. This does two things: changes the
      default value of &#39;tick&#39; (which is the amount of time, in ms, that
      is added to the clock every 1/60 seconds) and changes the value
      of &#39;tickadj&#39; which is the amount that is added or subtracted
      from &#39;tickadj&#39; when adjtime() is called.

      Now Mac clocks are pretty bad and tend to be slow. Sooo, instead of
      having A/UX add the default of 16666ms every 1/60th of a second, you
      may want it to add more (or less) so that it keeps better time. The
      above value works for me but your &#34;best&#34; value may be different and
      will likely require some fooling around to find the best value. As a
      general rule of thumb, if you see &#39;xntpd&#39; make a lot of negative clock
      adjustments, then your clock is fast and you&#39;ll need to _decrease_
      the value of &#39;tick&#39;. If your adjustments are positive, then you need
      to increase &#39;tick&#39;. To make a guess on how fast/slow your clock is,
      use &#39;ntpdate&#39; to sync your clock. Now watch &#39;xntpd&#39; and see how it
      operates. If, for example, it resets your clock by 1 second every 30
      minutes, then your clock is (1/(30*60)) is about 0.056% off and you&#39;ll
      need to adjust &#39;tick&#39; by 16666*0.00056 or about 9 (i.e. &#39;tick&#39; should
      be ~16675 if slow or ~16657 if fast)

      A/UX&#39;s default value of &#39;tickadj&#39; is 1666 which is too big for
      &#39;xntpd&#39;... so it also needs to be adjusted. I like using larger
      values then the recommended value of 9 for &#39;tickadj&#39; (although not
      anything near as big as 1666) since this allows for quick slews
      when adjusting the clock. Even with semi-large values of &#39;tickadj&#39;
      (~200), getting 5ms (1/200 s) accuracy is easy.

Finally, before A/UX and &#39;xntpd&#39; will work happily together, you need to
patch the kernel. This is due to the fact that A/UX attempts to keep the
UNIX-software clock and the Mac-hardware clock in sync. Neither the h/w or
the s/w clock are too accurate. Also, &#39;xntpd&#39; will be attempting to adjust
the software clock as well, so having A/UX muck around with it is asking
for headaches. What you therefore need to do is tell the kernel _not_ to
sync the s/w clock with the h/w one. This is done using &#39;adb&#39;. The
following is a shell script that will do the patch for you:

    #! /bin/sh
    adb -w /unix &lt;&lt;!
    init_time_fix_timeout?4i
    init_time_fix_timeout?w 0x4e75
    init_time_fix_timeout?4i
    $q
    !

This must be done _every_ time you create a new kernel (via newconfig or
newunix) or else &#39;xntpd&#39; will go crazy.

--------
HISTORY:
--------

John Dundas was the original porter of &#39;xntpd&#39; and a lot of the additions
and A/UX-ports are from him. I got involved when I wanted to run &#39;xntpd&#39;
on jagubox. It was also around this time that the base-patchlevel of
&#39;xntpd&#39; changed relatively (the so-called &#34;jones&#34; version). Since then,
I&#39;ve been maintaining &#39;xntpd&#39; for A/UX for the xntp development team

The original kernel patch (which patched &#39;time_fix_timeout&#39;) was from
Richard Todd. I suggest patching &#39;init_time_fix_timeout&#39; which prevents
&#39;time_fix_timeout&#39; from even being called.

----------------
TECHNICAL NOTES:
----------------

    o As configured (see machines/aux3), &#39;xntpd&#39; will log messages via syslogd
      using the LOC_LOCAL1 facility. I would suggest the following in
      /etc/syslog.conf:

	local1.notice		/usr/adm/ntpd-syslog

    o As mentioned above, the clocks on A/UX and Macs are kinda bad. Not
      only that, but logging in and out of the MacOS mode as well as
      extensive floppy use causes A/UX to drop and lose clock interupts
      (these are sent every 1/60th of a second). So, if you do these
      activities a lot, you find out that you lose about 300ms of time
      (i.e., you become 300ms slow). &#39;xntpd&#39; default way of handling this
      is to called &#39;settimeofday()&#39; and step the clock to the correct
      time. I prefer having &#39;xntpd&#39; slew the clock back into line by
      making gradual adjustments to the clock over a coupla minutes
      or so. It&#39;s for this reason that SLEWALWAYS is defined in
      include/ntp_machine.h for SYS_AUX3. It&#39;s also for this reason than
      I like larger values of &#39;tickadj&#39;.

Good luck!  If you have problems under A/UX feel free to contact me (e-mail
is preferred).
--
    Jim Jagielski               |  &#34;That is no ordinary rabbit... &#39;tis the
    jim@jagubox.gsfc.nasa.gov   |   most foul, cruel and bad-tempered
    NASA/GSFC, Code 734.4       |   rodent you ever set eyes on&#34;
    Greenbelt, MD 20771         |                   Tim the Enchanter

&lt;/pre&gt;
&lt;/div&gt;

      </description>
    </item>
    
    <item>
      <title>Reflib: About the Pictures</title>
      <link>/reflib/pictures/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reflib/pictures/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/tribeb.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The Okefenokee Orchestra&lt;/em&gt;, Walt Kelly&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/pictures/#our-anthem&#34;&gt;Our Anthem&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/pictures/#the-pogo-collection&#34;&gt;The Pogo Collection&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/pictures/#the-alice-books&#34;&gt;The Alice Books&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/pictures/#the-oz-books&#34;&gt;The Oz Books&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/pictures/#the-maya-glyphs&#34;&gt;The Maya Glyphs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/pictures/#photography&#34;&gt;Photography&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/pictures/#references&#34;&gt;References&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;our-anthem&#34;&gt;Our Anthem&lt;/h4&gt;
&lt;p&gt;Sung to the tune of &lt;em&gt;Deck the halls with boughs of holly.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/bostona.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;dt&gt;Deck us all with Boston Charlie,&lt;/dt&gt;
&lt;p&gt;&lt;em&gt;Walla Walla, Wash., an&#39; Kalamazoo!&lt;/em&gt;&lt;/p&gt;
&lt;dt&gt;Nora&#39;s freezin&#39; on the trolley,&lt;/dt&gt;
&lt;p&gt;&lt;em&gt;swaller dollar cauliflower alleygaroo!&lt;/em&gt;&lt;/p&gt;
&lt;dt&gt;Don&#39;t we know archaic barrel,&lt;/dt&gt;
&lt;p&gt;&lt;em&gt;Lullaby Lilla Boy, Louisville Lou.&lt;/em&gt;&lt;/p&gt;
&lt;dt&gt;Trolley Molly don&#39;t love Harold,&lt;/dt&gt;
&lt;p&gt;&lt;em&gt;boola boola Pensacoola hullabalou!&lt;/em&gt;&lt;/p&gt;
&lt;dt&gt;- Walt Kelly&lt;/dt&gt;
&lt;hr&gt;
&lt;p&gt;The artwork sprinkled on these pages is drawn from several sources, including textbooks, children&amp;rsquo;s books and comic strips. Some effort was done to create a bit of ambience and relevance to the material of the page. With apologies to the authors of some of the artwork, the colorizations are by me.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;the-pogo-collection&#34;&gt;The Pogo Collection&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/pogo.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/w_kellya.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Pogo Possum&lt;/em&gt;, the DCnet mascot (top), carries a bag of tools used to repair Unix kernels, and a &lt;a href=&#34;https://www.history.navy.mil/our-collections/photography/numerical-list-of-images/nhhc-series/nh-series/NH-96000/NH-96566-KN.html&#34;&gt;bug&lt;/a&gt; in his hat, which is a hazard in much of the work we do.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;We have met the enemy and he is us&amp;rdquo; is probably the most famous line from the &lt;em&gt;Pogo&lt;/em&gt; comic strips and books published by Walt Kelly (above) &lt;sup&gt;&lt;a href=&#34;#myfootnote6&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;. The mugshots scattered over these pages were taken from his books &lt;a href=&#34;/reflib/pictures/#references&#34;&gt;4-11&lt;/a&gt;, some of which are now valuable collectors items. The workstations, routers and other Internet munchkins that lurk in the DCnet swamp are named after his critters.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/mugshot.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;Here are some songs from &lt;em&gt;Songs of the Pogo&lt;/em&gt; &lt;sup&gt;&lt;a href=&#34;#myfootnote5&#34;&gt;5&lt;/a&gt;&lt;/sup&gt; sung by Beverly Mills [Final Focus]:&lt;/p&gt;
&lt;dt&gt;Boston Charlie&lt;/dt&gt;
&lt;p&gt;&lt;em&gt;Deck us All with Boston Charlie,&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Wala, Wala Wash., an&#39; Kalamazoo! &amp;hellip;&lt;/em&gt;&lt;/p&gt;
&lt;dt&gt;Wry Song&lt;/dt&gt;
&lt;p&gt;&lt;em&gt;Oh, pick a pock of peach pits, pockets full of pie,&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Foreign twenty black boards baked until they cry, &amp;hellip;&lt;/em&gt;&lt;/p&gt;
&lt;dt&gt;Slopposition&lt;/dt&gt;
&lt;p&gt;&lt;em&gt;Oh, once the opposition was completally opposed&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;To all the suppositions that was gen&amp;rsquo;rally supposed; &amp;hellip;&lt;/em&gt;&lt;/p&gt;
&lt;dt&gt;Parsnoops&lt;/dt&gt;
&lt;p&gt;&lt;em&gt;Oh, the parsnips were snipping their snappers,&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;While the parsley was parceling the peas, &amp;hellip;&lt;/em&gt;&lt;/p&gt;
&lt;dt&gt;A Song Not for Now&lt;/dt&gt;
&lt;p&gt;&lt;em&gt;A song not for&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Now you need not put stay, &amp;hellip;&lt;/em&gt;&lt;/p&gt;
&lt;dt&gt;The Keen and the Quing&lt;/dt&gt;
&lt;p&gt;&lt;em&gt;The Keen and the Quing were quirling at quoits in the meadow behind of the mere,&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tho&#39; mainly the meadow was middled with mow, an heretical hitherto here, &amp;hellip;&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;the-alice-books&#34;&gt;The Alice Books&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/alice47.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/alice05s.jpg&#34; alt=&#34;jpg&#34;&gt;&lt;/p&gt;
&lt;p&gt;The artwork by Sir John Tenniel (top) was taken from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt; and &lt;em&gt;Through the Looking Glass&lt;/em&gt;, by Lewis Carroll, the pen name of Charles Dodgson. Sir John was a well known illustrator and political cartoonist of the day. His drawings have influenced the perceptions of Alice in books, films, plays and generations of children.&lt;/p&gt;
&lt;p&gt;The life and works of Lewis Carroll and the story behind the Alice books have become somewhat of an academic cottage industry. Dodgson dearly loved the English language and delighted, like Shakespeare, in turning a quaint phrase. Words like &lt;em&gt;galumphing&lt;/em&gt; from the poem &lt;em&gt;Jabberwocky&lt;/em&gt; in &lt;em&gt;Through the Looking Glass&lt;/em&gt;, live on in modern English patois. Martin Gardner &lt;sup&gt;&lt;a href=&#34;#myfootnote1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; decodes the topical references to contemporary Oxford life of the day and is essential reading for the serious Alice student. However, the story we now know is not the one written at the chiding of Alice, but a refinement over at least two revisions. The original story, in Dodgson&amp;rsquo;s own hand and with his own illustrations is in &lt;sup&gt;&lt;a href=&#34;#myfootnote2&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;Dodgson is the author not only of the Alice books &lt;a href=&#34;/reflib/pictures/#references&#34;&gt;1-2&lt;/a&gt;, but of many delightful poems and puzzles &lt;sup&gt;&lt;a href=&#34;#myfootnote3&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;, the best known of which may be &lt;em&gt;The Hunting of the Snark&lt;/em&gt;. In them can be found the &lt;em&gt;Bandersnatch&lt;/em&gt;, &lt;em&gt;Boojum&lt;/em&gt;, &lt;em&gt;Snark&lt;/em&gt;, and other creatures of imagination that make wonderful names for computers.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/alice100.jpg&#34; alt=&#34;jpg&#34;&gt;&lt;/p&gt;
&lt;p&gt;Curiously, Sir John&amp;rsquo;s rendition of Alice Pleasance Liddel, for whom the Alice books were written, is nothing like the real Alice, whose picture, taken by Dodgson himself and in the style of the day, is above &lt;sup&gt;&lt;a href=&#34;#myfootnote2&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/alice101a.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;Alice herself lived a long life, during which several musical plays, books and films were made about the story, which Dodgson first told to her and her two sisters during a boat trip in 1862. The picture above was taken during a visit to New York to collect an honorary degree when she was 80 &lt;sup&gt;&lt;a href=&#34;#myfootnote1&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;the-oz-books&#34;&gt;The Oz Books&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/flatheads.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;The books by L. Frank Baum that began with &lt;em&gt;The Wizard of Oz&lt;/em&gt; &lt;sup&gt;&lt;a href=&#34;#myfootnote13&#34;&gt;13&lt;/a&gt;&lt;/sup&gt;, first published in 1900, are probably, along with the Alice books, the best known children&amp;rsquo;s books in the world. The artwork appearing on these pages is from the original by W.W. Denslow.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;the-maya-glyphs&#34;&gt;The Maya Glyphs&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/kin1.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;/reflib/maya&#34;&gt;Classic Maya&lt;/a&gt; civilization of southern Mexico, Guatemala and Belize flourished in the fourth through tenth century AD. They were accomplished astronomers and mathematicians and left a historic record engraved as glyphs in stone monuments called &lt;em&gt;stellae&lt;/em&gt;. The glyphs record the rise and fall of the rulers, as well as the places, dates and atrocities of the age. The Maya calendar glyphs on these pages are from &lt;sup&gt;&lt;a href=&#34;#myfootnote14&#34;&gt;14&lt;/a&gt;&lt;/sup&gt;. They illustrate the Maya calendar and arithmetic systems, which were highly developed long before the Europeans expunged the awkward Roman arithmetic system in favor of the much more practical Arabic system.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;photography&#34;&gt;Photography&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/yandb1.jpg&#34; alt=&#34;jpg&#34;&gt;&lt;/p&gt;
&lt;p&gt;The unattributed photos on these web pages were taken and retouched by me. They are not copyrighted and you can use them any responsible way you want. Here are some adventures:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/gallery/gallery10&#34;&gt;The Fuzzball&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/gallery/gallery9&#34;&gt;Anatomy of a Hollerith Card&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/gallery/gallery7&#34;&gt;Data Concentrator Project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/gallery/gallery8&#34;&gt;Michigan Terminal System&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As for our &lt;a href=&#34;/reflib/fam&#34;&gt;young playful rascals&lt;/a&gt; here, be advised kittens use their sharp little claws to climb anything, especially humans.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;references&#34;&gt;References&lt;/h4&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote1&#34;&gt;1&lt;/a&gt;  Gardner, Martin. &lt;em&gt;The Annotated Alice&lt;/em&gt;. Penguin Group, London, 1970, 352 pp. Illustrations by Sir John Tenniel.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote2&#34;&gt;2&lt;/a&gt;  Carroll, Lewis. &lt;em&gt;Alice&amp;rsquo;s Adventures Under Ground&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote3&#34;&gt;3&lt;/a&gt;  Pavilion Books, Limited, and British Library, London, 1985. Illustrations by Sir John Tenniel.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote4&#34;&gt;4&lt;/a&gt;  Carroll, Lewis. &lt;em&gt;Complete Works&lt;/em&gt;. Penguin Group, London, 1988, 1165 pp. Illustrations by Sir John Tenniel.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote5&#34;&gt;5&lt;/a&gt;  Kelly, Walt. &lt;em&gt;Pogo Peek-a-Book&lt;/em&gt;. Simon and Shuster, New York, 1955.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote6&#34;&gt;6&lt;/a&gt;  Kelly, Walt. &lt;em&gt;Songs of the Pogo&lt;/em&gt;. Simon and Shuster, New York, 1956.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote7&#34;&gt;7&lt;/a&gt;  Kelly, Walt. &lt;em&gt;Pogo&amp;rsquo;s Sunday Punch&lt;/em&gt;. Simon and Shuster, New York, 1957.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote8&#34;&gt;8&lt;/a&gt;  Kelly, Walt. &lt;em&gt;Ten Ever-Lovin&#39; Blue-Eyed Years with Pogo&lt;/em&gt;. Simon and Shuster, New York, 1959, 288 pp.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote9&#34;&gt;9&lt;/a&gt;  Kelly, Walt. &lt;em&gt;Pogo a la Sunday&lt;/em&gt;. Simon and Shuster, New York, 1961, 127 pp.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote10&#34;&gt;10&lt;/a&gt;  Kelly, Walt. &lt;em&gt;Equal Time for Pogo&lt;/em&gt;. Simon and Shuster, New York, 1968, 128 pp.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote11&#34;&gt;11&lt;/a&gt;  Kelly, Walt. &lt;em&gt;Pogo Romances Recaptured&lt;/em&gt;. Simon and Shuster, New York, 1969, 312 pp.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote12&#34;&gt;12&lt;/a&gt;  Kelly, Walt. &lt;em&gt;The Best of Pogo&lt;/em&gt;. Simon and Shuster, New York, 1982, 127 pp.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote13&#34;&gt;13&lt;/a&gt;  Baum, L. Frank. &lt;em&gt;The Wizard of Oz&lt;/em&gt;. Rand McNally and Company, 1956. Illustrations by W.W. Denslow.&lt;/p&gt;
&lt;p&gt;&lt;a name=&#34;myfootnote14&#34;&gt;14&lt;/a&gt;  Morley, S.G., G.W. Brainerd and R.J. Sharer. _The Ancient Maya, 4th ed._Stanford University Press, Stanford, CA, 1983.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Access Control Commands and Options</title>
      <link>/archives/4.2.8-series/accopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.8-series/accopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/pogo6.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Pogo&lt;/em&gt;, Walt Kelly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The skunk watches for intruders and sprays.&lt;/p&gt;
&lt;p&gt;Last update: 7-Jan-2018 23:56 UTC&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;commands-and-options&#34;&gt;Commands and Options&lt;/h4&gt;
&lt;p&gt;Unless noted otherwise, further information about these commands is on the &lt;a href=&#34;/archives/4.2.8-series/access&#34;&gt;Access Control Support&lt;/a&gt; page.&lt;/p&gt;
&lt;dt id=&#34;discard&#34;&gt;&lt;tt&gt;discard [ average _avg_ ][ minimum _min_ ] [ monitor _prob_ ]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the parameters of the rate control facility which protects the server from client abuse. If the &lt;tt&gt;limited&lt;/tt&gt; flag is present in the ACL, packets that violate these limits are discarded. If, in addition, the &lt;tt&gt;kod&lt;/tt&gt; flag is present, a kiss-o&#39;-death packet is returned. See the &lt;a href=&#34;/archives/4.2.8-series/rate&#34;&gt;Rate Management&lt;/a&gt; page for further information. The options are:&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;average _avg_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specify the minimum average interpacket spacing (minimum average headway time) in log&lt;sub&gt;2&lt;/sub&gt; s with default 3.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;minimum _min_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specify the minimum interpacket spacing (guard time) in seconds with default 2.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;monitor&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specify the probability of being recorded for packets that overflow the MRU list size limit set by &lt;tt&gt;mru maxmem&lt;/tt&gt; or &lt;tt&gt;mru maxdepth&lt;/tt&gt;. This is a performance optimization for servers with aggregate arrivals of 1000 packets per second or more.&lt;/p&gt;
&lt;dt id=&#34;restrict&#34;&gt;&lt;tt&gt;restrict [-4 | -6] default [ippeerlimit _num_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;dt&gt;&lt;tt&gt;restrict source [ippeerlimit _num_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;dt&gt;&lt;tt&gt;restrict _address_ [mask _mask_] [ippeerlimit _num_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; argument expressed in IPv4 or IPv6 numeric address form is the address of a host or network. Alternatively, the &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; argument can be a valid host DNS name. The &lt;tt&gt;&lt;em&gt;mask&lt;/em&gt;&lt;/tt&gt; argument expressed in IPv4 or IPv6 numeric address form defaults to all mask bits on, meaning that the &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; is treated as the address of an individual host. A default entry (address 0.0.0.0, mask 0.0.0.0 for IPv4 and address :: mask :: for IPv6) is always the first entry in the list. &lt;tt&gt;restrict default&lt;/tt&gt;, with no mask option, modifies both IPv4 and IPv6 default entries. &lt;tt&gt;restrict source&lt;/tt&gt; configures a template restriction automatically added at runtime for each association, whether configured, ephemeral, or preemptible, and removed when the association is demobilized.&lt;/p&gt;
&lt;p&gt;The optional &lt;tt&gt;ippeerlimit&lt;/tt&gt; takes a numeric argument that indicates how many incoming (at present) peer requests will be permitted for each IP, regardless of whether or not the request comes from an authenticated source. A value of -1 means &amp;ldquo;unlimited&amp;rdquo;, which is the current default. A value of 0 means &amp;ldquo;none&amp;rdquo;. Ordinarily one would expect at most 1 of these sessions to exist per IP, however if the remote side is operating thru a proxy there would be one association for each remote peer at that IP.&lt;/p&gt;
&lt;p&gt;Some flags have the effect to deny service, some have the effect to enable service and some are conditioned by other flags. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags that deny service are classed in two categories, those that restrict time service and those that restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified:&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flake&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Discard received NTP packets with probability 0.1; that is, on average drop one packet in ten. This is for testing and amusement. The name comes from Bob Braden&amp;rsquo;s &lt;em&gt;flakeway&lt;/em&gt;, which once did a similar thing for early Internet testing.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;ignore&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Deny packets of all kinds, including &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;kod&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Send a kiss-o&#39;-death (KoD) packet if the &lt;tt&gt;limited&lt;/tt&gt; flag is present and a packet violates the rate limits established by the &lt;tt&gt;discard&lt;/tt&gt; command. KoD packets are themselves rate limited for each source address separately. If the &lt;tt&gt;kod&lt;/tt&gt; flag is used in a restriction which does not have the &lt;tt&gt;limited&lt;/tt&gt; flag, no KoD responses will result.&lt;/p&gt;
&lt;dt id=&#34;limited&#34;&gt;&lt;tt&gt;limited&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Deny time service if the packet violates the rate limits established by the &lt;tt&gt;discard&lt;/tt&gt; command. This does not apply to &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;lowpriotrap&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;mssntp&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Enable Microsoft Windows MS-SNTP authentication using Active Directory services.&lt;/p&gt;


&lt;div class=&#34;alert alert-warning&#34; role=&#34;alert&#34;&gt;
&lt;h4 class=&#34;alert-heading&#34;&gt;Note&lt;/h4&gt;

    Potential users should be aware that these services involve a TCP connection to another process that could potentially block, denying services to other users. Therefore, this flag should be used only for a dedicated server with no clients other than MS-SNTP.

&lt;/div&gt;

&lt;dt&gt;&lt;tt&gt;noepeer&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Deny packets that would mobilize an ephemeral peering association, even if authenticated.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;nomodify&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Deny &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries which attempt to modify the state of the server (i.e., run time reconfiguration). Queries which return information are permitted.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;noquery&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Deny &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries. Time service is not affected.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;nopeer&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Deny packets that might mobilize an association unless authenticated. This includes broadcast, symmetric-active and manycast server packets when a configured association does not exist. It also includes &lt;tt&gt;pool&lt;/tt&gt; associations, so if you want to use servers from a &lt;tt&gt;pool&lt;/tt&gt; directive and also want to use &lt;tt&gt;nopeer&lt;/tt&gt; by default, you&amp;rsquo;ll want a &lt;tt&gt;&amp;ldquo;restrict source &amp;hellip;&amp;quot;&lt;/tt&gt; line as well that does &lt;em&gt;not&lt;/em&gt; include the &lt;tt&gt;nopeer&lt;/tt&gt; directive. Note that this flag does not apply to packets that do not attempt to mobilize an association.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;noserve&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Deny all packets except &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;notrap&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the &lt;tt&gt;ntpdc&lt;/tt&gt; control message protocol which is intended for use by remote event logging programs.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;notrust&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Deny packets that are not cryptographically authenticated. Note carefully how this flag interacts with the &lt;tt&gt;auth&lt;/tt&gt; option of the &lt;tt&gt;enable&lt;/tt&gt; and &lt;tt&gt;disable&lt;/tt&gt; commands. If &lt;tt&gt;auth&lt;/tt&gt; is enabled, which is the default, authentication is required for all packets that might mobilize an association. If &lt;tt&gt;auth&lt;/tt&gt; is disabled, but the &lt;tt&gt;notrust&lt;/tt&gt; flag is not present, an association can be mobilized whether or not authenticated. If &lt;tt&gt;auth&lt;/tt&gt; is disabled, but the &lt;tt&gt;notrust&lt;/tt&gt; flag is present, authentication is required only for the specified address/mask range.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;ntpport&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). A restrict line containing &lt;tt&gt;ntpport&lt;/tt&gt; is considered more specific than one with the same address and mask, but lacking &lt;tt&gt;ntpport&lt;/tt&gt;.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;serverresponse fuzz&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;When responding to server requests, fuzz the low order bits of the &lt;tt&gt;reftime&lt;/tt&gt;.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;version&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Deny packets that do not match the current NTP version.&lt;/p&gt;
&lt;p&gt;Default restriction list entries with the flags &lt;tt&gt;ignore, ntpport&lt;/tt&gt;, for each of the local host&amp;rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Access Control Options</title>
      <link>/archives/3-5.93e/accopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/3-5.93e/accopt/</guid>
      <description>
        
        
        &lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/accopt/#access-control-support&#34;&gt;Access Control Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/accopt/#access-control-commands&#34;&gt;Access Control Commands&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-support&#34;&gt;Access Control Support&lt;/h4&gt;
&lt;p&gt;&lt;tt&gt;xntpd&lt;/tt&gt; implements a general purpose address-and-mask based restriction list. The list is sorted by address and by mask, and the list is searched in this order for matches, with the last match found defining the restriction flags associated with the incoming packets. The source address of incoming packets is used for the match, with the 32-bit address being and&amp;rsquo;ed with the mask associated with the restriction entry and then compared with the entry&amp;rsquo;s address (which has also been and&amp;rsquo;ed with the mask) to look for a match. Additional information and examples can be found in the &lt;a href=&#34;/archives/3-5.93e/notes&#34;&gt;Notes on Configuring NTP and Setting up a NTP Subnet&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The restriction facility was implemented in conformance with the access policies for the original NSFnet backbone time servers. While this facility may be otherwise useful for keeping unwanted or broken remote time servers from affecting your own, it should not be considered an alternative to the standard NTP authentication facility. Source address based restrictions are easily circumvented by a determined cracker.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-commands&#34;&gt;Access Control Commands&lt;/h4&gt;
&lt;dt id=&#34;restrict&#34;&gt;&lt;tt&gt;_numeric_address_ [mask _numeric_mask_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The &lt;tt&gt;&lt;em&gt;numeric_address&lt;/em&gt;&lt;/tt&gt; argument, expressed in dotted-quad form, is the address of an host or network. The &lt;tt&gt;mask&lt;/tt&gt; argument, also expressed in dotted-quad form, defaults to &lt;tt&gt;255.255.255.255&lt;/tt&gt;, meaning that the &lt;tt&gt;numeric_address&lt;/tt&gt; is treated as the address of an individual host. A default entry (address &lt;tt&gt;0.0.0.0&lt;/tt&gt;, mask &lt;tt&gt;0.0.0.0&lt;/tt&gt;) is always included and, given the sort algorithm, is always the first entry in the list. Note that, while &lt;tt&gt;numeric_address&lt;/tt&gt; is normally given in dotted-quad format, the text string &lt;tt&gt;default&lt;/tt&gt;, with no mask option, may be used to indicate the default entry.&lt;/p&gt;
&lt;p&gt;In the current implementation, &lt;tt&gt;flag&lt;/tt&gt; always restricts access, i.e., an entry with no flags indicates that free access to the server is to be given. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags can generally be classed into two catagories, those which restrict time service and those which restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ignore&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all packets from hosts which match this entry. If this flag is specified neither queries nor time server polls will be responded to.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noquery&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all NTP mode 6 and 7 packets (i.e. information queries and configuration requests) from the source. Time service is not affected.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nomodify&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all NTP mode 6 and 7 packets which attempt to modify the state of the server (i.e. run time reconfiguration). Queries which return information are permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the mode 6 control message protocol which is intended for use by remote event logging programs.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;lowpriotrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noserve&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore NTP packets whose mode is other than 6 or 7. In effect, time service is denied, though queries may still be permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nopeer&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Provide stateless time service to polling hosts, but do not allocate peer memory resources to these hosts even if they otherwise might be considered useful as future synchronization partners.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrust&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Treat these hosts normally in other respects, but never use them as synchronization sources.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;limited&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â These hosts are subject to limitation of number of clients from the same net. Net in this context refers to the IP notion of net (class A, class B, class C, etc.). Only the first &lt;tt&gt;client_limit&lt;/tt&gt; hosts that have shown up at the server and that have been active during the last &lt;tt&gt;client_limit_period&lt;/tt&gt; seconds are accepted. Requests from other clients from the same net are rejected. Only time request packets are taken into account. Query packets sent by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;xntpdc&lt;/tt&gt; programs are not subject to these limits. A history of clients is kept using the monitoring capability of &lt;tt&gt;xntpd&lt;/tt&gt;. Thus, monitoring is always active as long as there is a restriction entry with the &lt;tt&gt;limited&lt;/tt&gt; flag.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both &lt;tt&gt;ntpport&lt;/tt&gt; and &lt;tt&gt;non-ntpport&lt;/tt&gt; may be specified. The &lt;tt&gt;ntpport&lt;/tt&gt; is considered more specific and is sorted later in the list.&lt;/p&gt;
&lt;p&gt;Default restriction list entries with the flags &lt;tt&gt;ignore, ntpport&lt;/tt&gt;, for each of the local host&amp;rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;clientlimit _limit_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the &lt;tt&gt;client_limit&lt;/tt&gt; variable, which limits the number of simultaneous access-controlled clients. The default value for this variable is 3.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;clientperiod _period_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the &lt;tt&gt;client_limit_period&lt;/tt&gt; variable, which specifies the number of seconds after which a client is considered inactive and thus no longer is counted for client limit restriction. The default value for this variable is 3600 seconds.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Access Control Options</title>
      <link>/archives/4.1.0/accopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.0/accopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/pogo6.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Pogo&lt;/em&gt;, Walt Kelly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The skunk watches for intruders and sprays.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/accopt/#access-control-support&#34;&gt;Access Control Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/accopt/#the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/accopt/#access-control-commands&#34;&gt;Access Control Commands&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-support&#34;&gt;Access Control Support&lt;/h4&gt;
&lt;p&gt;&lt;tt&gt;ntpd&lt;/tt&gt; implements a general purpose address-and-mask based restriction list. The list is sorted by address and by mask, and the list is searched in this order for matches, with the last match found defining the restriction flags associated with the incoming packets. The source address of incoming packets is used for the match, with the 32- bit address being and&amp;rsquo;ed with the mask associated with the restriction entry and then compared with the entry&amp;rsquo;s address (which has also been and&amp;rsquo;ed with the mask) to look for a match. Additional information and examples can be found in the  &lt;a href=&#34;/archives/4.1.0/notes&#34;&gt;Notes on Configuring NTP and Setting up a NTP Subnet&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The restriction facility was implemented in conformance with the access policies for the original NSFnet backbone time servers. While this facility may be otherwise useful for keeping unwanted or broken remote time servers from affecting your own, it should not be considered an alternative to the standard NTP authentication facility. Source address based restrictions are easily circumvented by a determined cracker.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/h4&gt;
&lt;p&gt;Ordinarily, packets denied service are simply dropped with no further action except incrementing statistics counters. Sometimes a more proactive response is needed, such as a server message that explicitly requests the client to stop sending and leave a message for the system operator. A special packet format has been created for this purpose called the kiss-of-death packet. If the &lt;tt&gt;kod&lt;/tt&gt; flag is set and either service is denied or the client limit is exceeded, the server it returns the packet and sets the leap bits unsynchronized, stratum zero and the ASCII string &amp;ldquo;DENY&amp;rdquo; in the reference source identifier field. If the &lt;tt&gt;kod&lt;/tt&gt; flag is not set, the server simply drops the packet.&lt;/p&gt;
&lt;p&gt;A client or peer receiving a kiss-of-death packet performs a set of sanity checks to minimize security exposure. If this is the first packet received from the server, the client assumes an access denied condition at the server. It updates the stratum and reference identifier peer variables and sets the access denied (test 4) bit in the peer flash variable. If this bit is set, the client sends no packets to the server. If this is not the first packet, the client assumes a client limit condition at the server, but does not update the peer variables. In either case, a message is sent to the system log.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-commands&#34;&gt;Access Control Commands&lt;/h4&gt;
&lt;dt id=&#34;restrict&#34;&gt;&lt;tt&gt;_numeric_address_ [mask _numeric_mask_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The &lt;tt&gt;&lt;em&gt;numeric_address&lt;/em&gt;&lt;/tt&gt; argument, expressed in dotted-quad form, is the address of an host or network. The &lt;tt&gt;mask&lt;/tt&gt; argument, also expressed in dotted-quad form, defaults to &lt;tt&gt;255.255.255.255&lt;/tt&gt;, meaning that the &lt;tt&gt;numeric_address&lt;/tt&gt; is treated as the address of an individual host. A default entry (address &lt;tt&gt;0.0.0.0&lt;/tt&gt;, mask &lt;tt&gt;0.0.0.0&lt;/tt&gt;) is always included and, given the sort algorithm, is always the first entry in the list. Note that, while &lt;tt&gt;numeric_address&lt;/tt&gt; is normally given in dotted-quad format, the text string &lt;tt&gt;default&lt;/tt&gt;, with no mask option, may be used to indicate the default entry.&lt;/p&gt;
&lt;p&gt;In the current implementation, &lt;tt&gt;flag&lt;/tt&gt; always restricts access, i.e., an entry with no flags indicates that free access to the server is to be given. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags can generally be classed into two catagories, those which restrict time service and those which restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;kod&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â If access is denied, send a kiss-of-death packet.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ignore&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all packets from hosts which match this entry. If this flag is specified neither queries nor time server polls will be responded to.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noquery&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all NTP mode 6 and 7 packets (i.e. information queries and configuration requests) from the source. Time service is not affected.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nomodify&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all NTP mode 6 and 7 packets which attempt to modify the state of the server (i.e. run time reconfiguration). Queries which return information are permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the mode 6 control message protocol which is intended for use by remote event logging programs.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;lowpriotrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noserve&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore NTP packets whose mode is other than 6 or 7. In effect, time service is denied, though queries may still be permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nopeer&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Provide stateless time service to polling hosts, but do not allocate peer memory resources to these hosts even if they otherwise might be considered useful as future synchronization partners.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrust&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Treat these hosts normally in other respects, but never use them as synchronization sources.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;limited&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â These hosts are subject to limitation of number of clients from the same net. Net in this context refers to the IP notion of net (class A, class B, class C, etc.). Only the first &lt;tt&gt;client_limit&lt;/tt&gt; hosts that have shown up at the server and that have been active during the last &lt;tt&gt;client_limit_period&lt;/tt&gt; seconds are accepted. Requests from other clients from the same net are rejected. Only time request packets are taken into account. Query packets sent by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; programs are not subject to these limits. A history of clients is kept using the monitoring capability of &lt;tt&gt;ntpd&lt;/tt&gt;. Thus, monitoring is always active as long as there is a restriction entry with the &lt;tt&gt;limited&lt;/tt&gt; flag.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both &lt;tt&gt;ntpport&lt;/tt&gt; and &lt;tt&gt;non-ntpport&lt;/tt&gt; may be specified. The &lt;tt&gt;ntpport&lt;/tt&gt; is considered more specific and is sorted later in the list.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;version&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore these hosts if not the current NTP version.&lt;/p&gt;
&lt;p&gt;Default restriction list entries with the flags &lt;tt&gt;ignore, interface, ntpport&lt;/tt&gt;, for each of the local host&amp;rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;clientlimit _limit_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the &lt;tt&gt;client_limit&lt;/tt&gt; variable, which limits the number of simultaneous access-controlled clients. The default value for this variable is 3.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;clientperiod _period_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the &lt;tt&gt;client_limit_period&lt;/tt&gt; variable, which specifies the number of seconds after which a client is considered inactive and thus no longer is counted for client limit restriction. The default value for this variable is 3600 seconds.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Access Control Options</title>
      <link>/archives/4.1.1/accopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.1/accopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/pogo6.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Pogo&lt;/em&gt;, Walt Kelly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The skunk watches for intruders and sprays.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/accopt/#access-control-support&#34;&gt;Access Control Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/accopt/#the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/accopt/#access-control-commands&#34;&gt;Access Control Commands&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-support&#34;&gt;Access Control Support&lt;/h4&gt;
&lt;p&gt;&lt;tt&gt;ntpd&lt;/tt&gt; implements a general purpose address-and-mask based restriction list. The list is sorted by address and by mask, and the list is searched in this order for matches, with the last match found defining the restriction flags associated with the incoming packets. The source address of incoming packets is used for the match, with the 32- bit address being and&amp;rsquo;ed with the mask associated with the restriction entry and then compared with the entry&amp;rsquo;s address (which has also been and&amp;rsquo;ed with the mask) to look for a match. Additional information and examples can be found in the  &lt;a href=&#34;/archives/4.1.1/notes&#34;&gt;Notes on Configuring NTP and Setting up a NTP Subnet&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The restriction facility was implemented in conformance with the access policies for the original NSFnet backbone time servers. While this facility may be otherwise useful for keeping unwanted or broken remote time servers from affecting your own, it should not be considered an alternative to the standard NTP authentication facility. Source address based restrictions are easily circumvented by a determined cracker.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/h4&gt;
&lt;p&gt;Ordinarily, packets denied service are simply dropped with no further action except incrementing statistics counters. Sometimes a more proactive response is needed, such as a server message that explicitly requests the client to stop sending and leave a message for the system operator. A special packet format has been created for this purpose called the kiss-of-death packet. If the &lt;tt&gt;kod&lt;/tt&gt; flag is set and either service is denied or the client limit is exceeded, the server it returns the packet and sets the leap bits unsynchronized, stratum zero and the ASCII string &amp;ldquo;DENY&amp;rdquo; in the reference source identifier field. If the &lt;tt&gt;kod&lt;/tt&gt; flag is not set, the server simply drops the packet.&lt;/p&gt;
&lt;p&gt;A client or peer receiving a kiss-of-death packet performs a set of sanity checks to minimize security exposure. If this is the first packet received from the server, the client assumes an access denied condition at the server. It updates the stratum and reference identifier peer variables and sets the access denied (test 4) bit in the peer flash variable. If this bit is set, the client sends no packets to the server. If this is not the first packet, the client assumes a client limit condition at the server, but does not update the peer variables. In either case, a message is sent to the system log.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-commands&#34;&gt;Access Control Commands&lt;/h4&gt;
&lt;dt id=&#34;restrict&#34;&gt;&lt;tt&gt;_numeric_address_ [mask _numeric_mask_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The &lt;tt&gt;&lt;em&gt;numeric_address&lt;/em&gt;&lt;/tt&gt; argument, expressed in dotted-quad form, is the address of an host or network. The &lt;tt&gt;mask&lt;/tt&gt; argument, also expressed in dotted-quad form, defaults to &lt;tt&gt;255.255.255.255&lt;/tt&gt;, meaning that the &lt;tt&gt;numeric_address&lt;/tt&gt; is treated as the address of an individual host. A default entry (address &lt;tt&gt;0.0.0.0&lt;/tt&gt;, mask &lt;tt&gt;0.0.0.0&lt;/tt&gt;) is always included and, given the sort algorithm, is always the first entry in the list. Note that, while &lt;tt&gt;numeric_address&lt;/tt&gt; is normally given in dotted-quad format, the text string &lt;tt&gt;default&lt;/tt&gt;, with no mask option, may be used to indicate the default entry.&lt;/p&gt;
&lt;p&gt;In the current implementation, &lt;tt&gt;flag&lt;/tt&gt; always restricts access, i.e., an entry with no flags indicates that free access to the server is to be given. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags can generally be classed into two catagories, those which restrict time service and those which restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;kod&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â If access is denied, send a kiss-of-death packet.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ignore&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all packets from hosts which match this entry. If this flag is specified neither queries nor time server polls will be responded to.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noquery&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all NTP mode 6 and 7 packets (i.e. information queries and configuration requests) from the source. Time service is not affected.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nomodify&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all NTP mode 6 and 7 packets which attempt to modify the state of the server (i.e. run time reconfiguration). Queries which return information are permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the mode 6 control message protocol which is intended for use by remote event logging programs.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;lowpriotrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noserve&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore NTP packets whose mode is other than 6 or 7. In effect, time service is denied, though queries may still be permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nopeer&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Provide stateless time service to polling hosts, but do not allocate peer memory resources to these hosts even if they otherwise might be considered useful as future synchronization partners.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrust&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Treat these hosts normally in other respects, but never use them as synchronization sources.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;limited&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â These hosts are subject to limitation of number of clients from the same net. Net in this context refers to the IP notion of net (class A, class B, class C, etc.). Only the first &lt;tt&gt;client_limit&lt;/tt&gt; hosts that have shown up at the server and that have been active during the last &lt;tt&gt;client_limit_period&lt;/tt&gt; seconds are accepted. Requests from other clients from the same net are rejected. Only time request packets are taken into account. Query packets sent by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; programs are not subject to these limits. A history of clients is kept using the monitoring capability of &lt;tt&gt;ntpd&lt;/tt&gt;. Thus, monitoring is always active as long as there is a restriction entry with the &lt;tt&gt;limited&lt;/tt&gt; flag.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both &lt;tt&gt;ntpport&lt;/tt&gt; and &lt;tt&gt;non-ntpport&lt;/tt&gt; may be specified. The &lt;tt&gt;ntpport&lt;/tt&gt; is considered more specific and is sorted later in the list.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;version&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore these hosts if not the current NTP version.&lt;/p&gt;
&lt;p&gt;Default restriction list entries with the flags &lt;tt&gt;ignore, interface, ntpport&lt;/tt&gt;, for each of the local host&amp;rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;clientlimit _limit_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the &lt;tt&gt;client_limit&lt;/tt&gt; variable, which limits the number of simultaneous access-controlled clients. The default value for this variable is 3.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;clientperiod _period_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the &lt;tt&gt;client_limit_period&lt;/tt&gt; variable, which specifies the number of seconds after which a client is considered inactive and thus no longer is counted for client limit restriction. The default value for this variable is 3600 seconds.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Access Control Options</title>
      <link>/archives/4.1.2/accopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.2/accopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/pogo6.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Pogo&lt;/em&gt;, Walt Kelly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The skunk watches for intruders and sprays.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/accopt/#access-control-support&#34;&gt;Access Control Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/accopt/#the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/accopt/#access-control-commands&#34;&gt;Access Control Commands&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-support&#34;&gt;Access Control Support&lt;/h4&gt;
&lt;p&gt;&lt;tt&gt;ntpd&lt;/tt&gt; implements a general purpose address-and-mask based restriction list. The list is sorted by address and by mask, and the list is searched in this order for matches, with the last match found defining the restriction flags associated with the incoming packets. The source address of incoming packets is used for the match, with the 32- bit address being and&amp;rsquo;ed with the mask associated with the restriction entry and then compared with the entry&amp;rsquo;s address (which has also been and&amp;rsquo;ed with the mask) to look for a match. Additional information and examples can be found in the  &lt;a href=&#34;/archives/4.1.2/notes&#34;&gt;Notes on Configuring NTP and Setting up a NTP Subnet&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The restriction facility was implemented in conformance with the access policies for the original NSFnet backbone time servers. While this facility may be otherwise useful for keeping unwanted or broken remote time servers from affecting your own, it should not be considered an alternative to the standard NTP authentication facility. Source address based restrictions are easily circumvented by a determined cracker.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/h4&gt;
&lt;p&gt;Ordinarily, packets denied service are simply dropped with no further action except incrementing statistics counters. Sometimes a more proactive response is needed, such as a server message that explicitly requests the client to stop sending and leave a message for the system operator. A special packet format has been created for this purpose called the kiss-of-death packet. If the &lt;tt&gt;kod&lt;/tt&gt; flag is set and either service is denied or the client limit is exceeded, the server it returns the packet and sets the leap bits unsynchronized, stratum zero and the ASCII string &amp;ldquo;DENY&amp;rdquo; in the reference source identifier field. If the &lt;tt&gt;kod&lt;/tt&gt; flag is not set, the server simply drops the packet.&lt;/p&gt;
&lt;p&gt;A client or peer receiving a kiss-of-death packet performs a set of sanity checks to minimize security exposure. If this is the first packet received from the server, the client assumes an access denied condition at the server. It updates the stratum and reference identifier peer variables and sets the access denied (test 4) bit in the peer flash variable. If this bit is set, the client sends no packets to the server. If this is not the first packet, the client assumes a client limit condition at the server, but does not update the peer variables. In either case, a message is sent to the system log.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-commands&#34;&gt;Access Control Commands&lt;/h4&gt;
&lt;dt id=&#34;restrict&#34;&gt;&lt;tt&gt;_numeric_address_ [mask _numeric_mask_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The &lt;tt&gt;&lt;em&gt;numeric_address&lt;/em&gt;&lt;/tt&gt; argument, expressed in dotted-quad form, is the address of an host or network. The &lt;tt&gt;mask&lt;/tt&gt; argument, also expressed in dotted-quad form, defaults to &lt;tt&gt;255.255.255.255&lt;/tt&gt;, meaning that the &lt;tt&gt;numeric_address&lt;/tt&gt; is treated as the address of an individual host. A default entry (address &lt;tt&gt;0.0.0.0&lt;/tt&gt;, mask &lt;tt&gt;0.0.0.0&lt;/tt&gt;) is always included and, given the sort algorithm, is always the first entry in the list. Note that, while &lt;tt&gt;numeric_address&lt;/tt&gt; is normally given in dotted-quad format, the text string &lt;tt&gt;default&lt;/tt&gt;, with no mask option, may be used to indicate the default entry.&lt;/p&gt;
&lt;p&gt;In the current implementation, &lt;tt&gt;flag&lt;/tt&gt; always restricts access, i.e., an entry with no flags indicates that free access to the server is to be given. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags can generally be classed into two catagories, those which restrict time service and those which restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;kod&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â If access is denied, send a kiss-of-death packet.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ignore&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all packets from hosts which match this entry. If this flag is specified neither queries nor time server polls will be responded to.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noquery&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all NTP mode 6 and 7 packets (i.e. information queries and configuration requests) from the source. Time service is not affected.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nomodify&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore all NTP mode 6 and 7 packets which attempt to modify the state of the server (i.e. run time reconfiguration). Queries which return information are permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the mode 6 control message protocol which is intended for use by remote event logging programs.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;lowpriotrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noserve&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore NTP packets whose mode is other than 6 or 7. In effect, time service is denied, though queries may still be permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nopeer&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Provide stateless time service to polling hosts, but do not allocate peer memory resources to these hosts even if they otherwise might be considered useful as future synchronization partners.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrust&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Treat these hosts normally in other respects, but never use them as synchronization sources.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;limited&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â These hosts are subject to limitation of number of clients from the same net. Net in this context refers to the IP notion of net (class A, class B, class C, etc.). Only the first &lt;tt&gt;client_limit&lt;/tt&gt; hosts that have shown up at the server and that have been active during the last &lt;tt&gt;client_limit_period&lt;/tt&gt; seconds are accepted. Requests from other clients from the same net are rejected. Only time request packets are taken into account. Query packets sent by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; programs are not subject to these limits. A history of clients is kept using the monitoring capability of &lt;tt&gt;ntpd&lt;/tt&gt;. Thus, monitoring is always active as long as there is a restriction entry with the &lt;tt&gt;limited&lt;/tt&gt; flag.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both &lt;tt&gt;ntpport&lt;/tt&gt; and &lt;tt&gt;non-ntpport&lt;/tt&gt; may be specified. The &lt;tt&gt;ntpport&lt;/tt&gt; is considered more specific and is sorted later in the list.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;version&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Ignore these hosts if not the current NTP version.&lt;/p&gt;
&lt;p&gt;Default restriction list entries with the flags &lt;tt&gt;ignore, interface, ntpport&lt;/tt&gt;, for each of the local host&amp;rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;clientlimit _limit_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the &lt;tt&gt;client_limit&lt;/tt&gt; variable, which limits the number of simultaneous access-controlled clients. The default value for this variable is 3.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;clientperiod _period_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the &lt;tt&gt;client_limit_period&lt;/tt&gt; variable, which specifies the number of seconds after which a client is considered inactive and thus no longer is counted for client limit restriction. The default value for this variable is 3600 seconds.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Access Control Options</title>
      <link>/archives/4.2.0/accopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.0/accopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/pogo6.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Pogo&lt;/em&gt;, Walt Kelly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The skunk watches for intruders and sprays.&lt;/p&gt;
&lt;p&gt;Last update: 03:02 AM UTC Monday, October 13, 2003&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/accopt/#access-control-support&#34;&gt;Access Control Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/accopt/#the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/accopt/#access-control-commands&#34;&gt;Access Control Commands&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-support&#34;&gt;Access Control Support&lt;/h4&gt;
&lt;p&gt;The &lt;tt&gt;ntpd&lt;/tt&gt; daemon implements a general purpose address/mask based restriction list. The list contains address/match entries sorted first by increasing address values and then by increasing mask values. A match occurs when the bitwise AND of the mask and the packet source address is equal to the bitwise AND of the mask and address in the list. The list is searched in order with the last match found defining the restriction flags associated with the entry. Additional information and examples can be found in the &lt;a href=&#34;/archives/4.2.0/notes&#34;&gt;Notes on Configuring NTP and Setting up a NTP Subnet&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The restriction facility was implemented in conformance with the access policies for the original NSFnet backbone time servers. Later the facility was expanded to deflect cryptographic and clogging attacks. While this facility may be useful for keeping unwanted or broken or malicious clients from congesting innocent servers, it should not be considered an alternative to the NTP authentication facilities. Source address based restrictions are easily circumvented by a determined cracker.&lt;/p&gt;
&lt;p&gt;Clients can be denied service because they are explicitly included in the restrict list created by the &lt;tt&gt;restrict&lt;/tt&gt; command or implicitly as the result of cryptographic or rate limit violations. Cryptographic violations include certificate or identity verification failure; rate limit violations generally result from defective NTP implementations that send packets at abusive rates. Some violations cause denied service only for the offending packet, others cause denied service for a timed period and others cause the denied service for an indefinite period. When a client or network is denied access for an indefinite period, the only way at present to remove the restrictions is by restarting the server.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/h4&gt;
&lt;p&gt;Ordinarily, packets denied service are simply dropped with no further action except incrementing statistics counters. Sometimes a more proactive response is needed, such as a server message that explicitly requests the client to stop sending and leave a message for the system operator. A special packet format has been created for this purpose called the &amp;ldquo;kiss-o&#39;-death&amp;rdquo; (KoD) packet. KoD packets have the leap bits set unsynchronized and stratum set to zero and the reference identifier field set to a four-byte ASCII code. If the &lt;tt&gt;noserve&lt;/tt&gt; or &lt;tt&gt;notrust&lt;/tt&gt; flag of the matching restrict list entry is set, the code is &amp;ldquo;DENY&amp;rdquo;; if the &lt;tt&gt;limited&lt;/tt&gt; flag is set and the rate limit is exceeded, the code is &amp;ldquo;RATE&amp;rdquo;. Finally, if a cryptographic violation occurs, the code is &amp;ldquo;CRYP&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;A client receiving a KoD performs a set of sanity checks to minimize security exposure, then updates the stratum and reference identifier peer variables, sets the access denied (TEST4) bit in the peer flash variable and sends a message to the log. As long as the TEST4 bit is set, the client will send no further packets to the server. The only way at present to recover from this condition is to restart the protocol at both the client and server. This happens automatically at the client when the association times out. It will happen at the server only if the server operator cooperates.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-commands&#34;&gt;Access Control Commands&lt;/h4&gt;
&lt;dt id=&#34;discard&#34;&gt;&lt;tt&gt;discard [ average _avg_ ][ minimum _min_ ] [ monitor _prob_ ]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the parameters of the &lt;tt&gt;limited&lt;/tt&gt; facility which protects the server from client abuse. The &lt;tt&gt;average&lt;/tt&gt; subcommand specifies the minimum average packet spacing, while the &lt;tt&gt;minimum&lt;/tt&gt; subcommand specifies the minimum packet spacing. Packets that violate these minima are discarded and a kiss-o&#39;-death packet returned if enabled. The default minimum average and minimum are 5 and 2, respectively. The monitor subcommand specifies the probability of discard for packets that overflow the rate-control window.&lt;/p&gt;
&lt;dt id=&#34;restrict&#34;&gt;&lt;tt&gt;restrict _address_ [mask _mask_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; argument expressed in dotted-quad form is the address of a host or network. Alternatively, the &lt;tt&gt;address&lt;/tt&gt; argument can be a valid host DNS name. The &lt;tt&gt;mask&lt;/tt&gt; argument expressed in dotted-quad form defaults to &lt;tt&gt;255.255.255.255&lt;/tt&gt;, meaning that the &lt;tt&gt;address&lt;/tt&gt; is treated as the address of an individual host. A default entry (address &lt;tt&gt;0.0.0.0&lt;/tt&gt;, mask &lt;tt&gt;0.0.0.0&lt;/tt&gt;) is always included and is always the first entry in the list. Note that text string &lt;tt&gt;default&lt;/tt&gt;, with no mask option, may be used to indicate the default entry.&lt;/p&gt;
&lt;p&gt;In the current implementation, &lt;tt&gt;flag&lt;/tt&gt; always restricts access, i.e., an entry with no flags indicates that free access to the server is to be given. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags can generally be classed into two catagories, those which restrict time service and those which restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ignore&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets of all kinds, including &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;kod&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â If this flag is set when an access violation occurs, a kiss-o&#39;-death (KoD) packet is sent. KoD packets are rate limited to no more than one per second. If another KoD packet occurs within one second after the last one, the packet is dropped.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;limited&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny service if the packet spacing violates the lower limits specified in the &lt;tt&gt;discard&lt;/tt&gt; command. A history of clients is kept using the monitoring capability of &lt;tt&gt;ntpd&lt;/tt&gt;. Thus, monitoring is always active as long as there is a restriction entry with the &lt;tt&gt;limited&lt;/tt&gt; flag.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;lowpriotrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nomodify&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries which attempt to modify the state of the server (i.e., run time reconfiguration). Queries which return information are permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noquery&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries. Time service is not affected.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nopeer&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets which would result in mobilizing a new association.  This includes broadcast, symmetric-active and manycast client packets when a configured association does not exist.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noserve&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny all packets except &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the &lt;tt&gt;ntpdc&lt;/tt&gt; control message protocol which is intended for use by remote event logging programs.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrust&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets unless the packet is cryptographically authenticated.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;non-ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both &lt;tt&gt;ntpport&lt;/tt&gt; and &lt;tt&gt;non-ntpport&lt;/tt&gt; may be specified. The &lt;tt&gt;ntpport&lt;/tt&gt; is considered more specific and is sorted later in the list.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;version&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets that do not match the current NTP version.&lt;/p&gt;
&lt;p&gt;Default restriction list entries with the flags &lt;tt&gt;ignore, interface, ntpport&lt;/tt&gt;, for each of the local host&amp;rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Access Control Options</title>
      <link>/archives/4.2.2-series/accopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.2-series/accopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/pogo6.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Pogo&lt;/em&gt;, Walt Kelly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The skunk watches for intruders and sprays.&lt;/p&gt;
&lt;p&gt;Last update: 18:35 UTC Thursday, July 28, 2005&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/accopt/#access-control-support&#34;&gt;Access Control Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/accopt/#the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/accopt/#access-control-commands&#34;&gt;Access Control Commands&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-support&#34;&gt;Access Control Support&lt;/h4&gt;
&lt;p&gt;The &lt;tt&gt;ntpd&lt;/tt&gt; daemon implements a general purpose address/mask based restriction list. The list contains address/match entries sorted first by increasing address values and then by increasing mask values. A match occurs when the bitwise AND of the mask and the packet source address is equal to the bitwise AND of the mask and address in the list. The list is searched in order with the last match found defining the restriction flags associated with the entry. Additional information and examples can be found in the &lt;a href=&#34;/archives/4.2.2-series/notes&#34;&gt;Notes on Configuring NTP and Setting up a NTP Subnet&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The restriction facility was implemented in conformance with the access policies for the original NSFnet backbone time servers. Later the facility was expanded to deflect cryptographic and clogging attacks. While this facility may be useful for keeping unwanted or broken or malicious clients from congesting innocent servers, it should not be considered an alternative to the NTP authentication facilities. Source address based restrictions are easily circumvented by a determined cracker.&lt;/p&gt;
&lt;p&gt;Clients can be denied service because they are explicitly included in the restrict list created by the &lt;tt&gt;restrict&lt;/tt&gt; command or implicitly as the result of cryptographic or rate limit violations. Cryptographic violations include certificate or identity verification failure; rate limit violations generally result from defective NTP implementations that send packets at abusive rates. Some violations cause denied service only for the offending packet, others cause denied service for a timed period and others cause the denied service for an indefinate period. When a client or network is denied access for an indefinate period, the only way at present to remove the restrictions is by restarting the server.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/h4&gt;
&lt;p&gt;Ordinarily, packets denied service are simply dropped with no further action except incrementing statistics counters. Sometimes a more proactive response is needed, such as a server message that explicitly requests the client to stop sending and leave a message for the system operator. A special packet format has been created for this purpose called the &amp;ldquo;kiss-o&#39;-death&amp;rdquo; (KoD) packet. KoD packets have the leap bits set unsynchronized and stratum set to zero and the reference identifier field set to a four-byte ASCII code. If the &lt;tt&gt;noserve&lt;/tt&gt; or &lt;tt&gt;notrust&lt;/tt&gt; flag of the matching restrict list entry is set, the code is &amp;ldquo;DENY&amp;rdquo;; if the &lt;tt&gt;limited&lt;/tt&gt; flag is set and the rate limit is exceeded, the code is &amp;ldquo;RATE&amp;rdquo;. Finally, if a cryptographic violation occurs, the code is &amp;ldquo;CRYP&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;A client receiving a KoD performs a set of sanity checks to minimize security exposure, then updates the stratum and reference identifier peer variables, sets the access denied (TEST4) bit in the peer flash variable and sends a message to the log. As long as the TEST4 bit is set, the client will send no further packets to the server. The only way at present to recover from this condition is to restart the protocol at both the client and server. This happens automatically at the client when the association times out. It will happen at the server only if the server operator cooperates.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-commands&#34;&gt;Access Control Commands&lt;/h4&gt;
&lt;dt id=&#34;discard&#34;&gt;&lt;tt&gt;discard [ average _avg_ ][ minimum _min_ ] [ monitor _prob_ ]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the parameters of the &lt;tt&gt;limited&lt;/tt&gt; facility which protects the server from client abuse. The &lt;tt&gt;average&lt;/tt&gt; subcommand specifies the minimum average packet spacing, while the &lt;tt&gt;minimum&lt;/tt&gt; subcommand specifies the minimum packet spacing. Packets that violate these minima are discarded and a kiss-o&#39;-death packet returned if enabled. The default minimum average and minimum are 5 and 2, respectively. The monitor subcommand specifies the probability of discard for packets that overflow the rate-control window.&lt;/p&gt;
&lt;dt id=&#34;restrict&#34;&gt;&lt;tt&gt;restrict _address_ [mask _mask_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; argument expressed in dotted-quad form is the address of a host or network. Alternatively, the &lt;tt&gt;address&lt;/tt&gt; argument can be a valid host DNS name. The &lt;tt&gt;mask&lt;/tt&gt; argument expressed in dotted-quad form defaults to &lt;tt&gt;255.255.255.255&lt;/tt&gt;, meaning that the &lt;tt&gt;address&lt;/tt&gt; is treated as the address of an individual host. A default entry (address &lt;tt&gt;0.0.0.0&lt;/tt&gt;, mask &lt;tt&gt;0.0.0.0&lt;/tt&gt;) is always included and is always the first entry in the list. Note that text string &lt;tt&gt;default&lt;/tt&gt;, with no mask option, may be used to indicate the default entry.&lt;/p&gt;
&lt;p&gt;In the current implementation, &lt;tt&gt;flag&lt;/tt&gt; always restricts access, i.e., an entry with no flags indicates that free access to the server is to be given. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags can generally be classed into two catagories, those which restrict time service and those which restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ignore&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets of all kinds, including &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;kod&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â If this flag is set when an access violation occurs, a kiss-o&#39;-death (KoD) packet is sent. KoD packets are rate limited to no more than one per second. If another KoD packet occurs within one second after the last one, the packet is dropped.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;limited&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny service if the packet spacing violates the lower limits specified in the &lt;tt&gt;discard&lt;/tt&gt; command. A history of clients is kept using the monitoring capability of &lt;tt&gt;ntpd&lt;/tt&gt;. Thus, monitoring is always active as long as there is a restriction entry with the &lt;tt&gt;limited&lt;/tt&gt; flag.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;lowpriotrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nomodify&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries which attempt to modify the state of the server (i.e., run time reconfiguration). Queries which return information are permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noquery&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries. Time service is not affected.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nopeer&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets which would result in mobilizing a new association.  This includes broadcast, symmetric-active and manycast client packets when a configured association does not exist.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noserve&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny all packets except &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the &lt;tt&gt;ntpdc&lt;/tt&gt; control message protocol which is intended for use by remote event logging programs.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrust&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets unless the packet is cryptographically authenticated.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;non-ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both &lt;tt&gt;ntpport&lt;/tt&gt; and &lt;tt&gt;non-ntpport&lt;/tt&gt; may be specified. The &lt;tt&gt;ntpport&lt;/tt&gt; is considered more specific and is sorted later in the list.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;version&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets that do not match the current NTP version.&lt;/p&gt;
&lt;p&gt;Default restriction list entries with the flags &lt;tt&gt;ignore, interface, ntpport&lt;/tt&gt;, for each of the local host&amp;rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Access Control Options</title>
      <link>/archives/4.2.4-series/accopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.4-series/accopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/pogo6.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Pogo&lt;/em&gt;, Walt Kelly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The skunk watches for intruders and sprays.&lt;/p&gt;
&lt;p&gt;Last update: 18:35 UTC Thursday, July 28, 2005&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/accopt/#access-control-support&#34;&gt;Access Control Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/accopt/#the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/accopt/#access-control-commands&#34;&gt;Access Control Commands&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-support&#34;&gt;Access Control Support&lt;/h4&gt;
&lt;p&gt;The &lt;tt&gt;ntpd&lt;/tt&gt; daemon implements a general purpose address/mask based restriction list. The list contains address/match entries sorted first by increasing address values and then by increasing mask values. A match occurs when the bitwise AND of the mask and the packet source address is equal to the bitwise AND of the mask and address in the list. The list is searched in order with the last match found defining the restriction flags associated with the entry. Additional information and examples can be found in the &lt;a href=&#34;/archives/4.2.4-series/notes&#34;&gt;Notes on Configuring NTP and Setting up a NTP Subnet&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The restriction facility was implemented in conformance with the access policies for the original NSFnet backbone time servers. Later the facility was expanded to deflect cryptographic and clogging attacks. While this facility may be useful for keeping unwanted or broken or malicious clients from congesting innocent servers, it should not be considered an alternative to the NTP authentication facilities. Source address based restrictions are easily circumvented by a determined cracker.&lt;/p&gt;
&lt;p&gt;Clients can be denied service because they are explicitly included in the restrict list created by the &lt;tt&gt;restrict&lt;/tt&gt; command or implicitly as the result of cryptographic or rate limit violations. Cryptographic violations include certificate or identity verification failure; rate limit violations generally result from defective NTP implementations that send packets at abusive rates. Some violations cause denied service only for the offending packet, others cause denied service for a timed period and others cause the denied service for an indefinate period. When a client or network is denied access for an indefinate period, the only way at present to remove the restrictions is by restarting the server.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;the-kiss-of-death-packet&#34;&gt;The Kiss-of-Death Packet&lt;/h4&gt;
&lt;p&gt;Ordinarily, packets denied service are simply dropped with no further action except incrementing statistics counters. Sometimes a more proactive response is needed, such as a server message that explicitly requests the client to stop sending and leave a message for the system operator. A special packet format has been created for this purpose called the &amp;ldquo;kiss-o&#39;-death&amp;rdquo; (KoD) packet. KoD packets have the leap bits set unsynchronized and stratum set to zero and the reference identifier field set to a four-byte ASCII code. If the &lt;tt&gt;noserve&lt;/tt&gt; or &lt;tt&gt;notrust&lt;/tt&gt; flag of the matching restrict list entry is set, the code is &amp;ldquo;DENY&amp;rdquo;; if the &lt;tt&gt;limited&lt;/tt&gt; flag is set and the rate limit is exceeded, the code is &amp;ldquo;RATE&amp;rdquo;. Finally, if a cryptographic violation occurs, the code is &amp;ldquo;CRYP&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;A client receiving a KoD performs a set of sanity checks to minimize security exposure, then updates the stratum and reference identifier peer variables, sets the access denied (TEST4) bit in the peer flash variable and sends a message to the log. As long as the TEST4 bit is set, the client will send no further packets to the server. The only way at present to recover from this condition is to restart the protocol at both the client and server. This happens automatically at the client when the association times out. It will happen at the server only if the server operator cooperates.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-commands&#34;&gt;Access Control Commands&lt;/h4&gt;
&lt;dt id=&#34;discard&#34;&gt;&lt;tt&gt;discard [ average _avg_ ][ minimum _min_ ] [ monitor _prob_ ]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the parameters of the &lt;tt&gt;limited&lt;/tt&gt; facility which protects the server from client abuse. The &lt;tt&gt;average&lt;/tt&gt; subcommand specifies the minimum average packet spacing, while the &lt;tt&gt;minimum&lt;/tt&gt; subcommand specifies the minimum packet spacing. Packets that violate these minima are discarded and a kiss-o&#39;-death packet returned if enabled. The default minimum average and minimum are 5 and 2, respectively. The monitor subcommand specifies the probability of discard for packets that overflow the rate-control window.&lt;/p&gt;
&lt;dt id=&#34;restrict&#34;&gt;&lt;tt&gt;restrict _address_ [mask _mask_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; argument expressed in dotted-quad form is the address of a host or network. Alternatively, the &lt;tt&gt;address&lt;/tt&gt; argument can be a valid host DNS name. The &lt;tt&gt;mask&lt;/tt&gt; argument expressed in dotted-quad form defaults to &lt;tt&gt;255.255.255.255&lt;/tt&gt;, meaning that the &lt;tt&gt;address&lt;/tt&gt; is treated as the address of an individual host. A default entry (address &lt;tt&gt;0.0.0.0&lt;/tt&gt;, mask &lt;tt&gt;0.0.0.0&lt;/tt&gt;) is always included and is always the first entry in the list. Note that text string &lt;tt&gt;default&lt;/tt&gt;, with no mask option, may be used to indicate the default entry.&lt;/p&gt;
&lt;p&gt;In the current implementation, &lt;tt&gt;flag&lt;/tt&gt; always restricts access, i.e., an entry with no flags indicates that free access to the server is to be given. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags can generally be classed into two catagories, those which restrict time service and those which restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ignore&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets of all kinds, including &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;kod&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â If this flag is set when an access violation occurs, a kiss-o&#39;-death (KoD) packet is sent. KoD packets are rate limited to no more than one per second. If another KoD packet occurs within one second after the last one, the packet is dropped .&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;limited&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny service if the packet spacing violates the lower limits specified in the &lt;tt&gt;discard&lt;/tt&gt; command. A history of clients is kept using the monitoring capability of &lt;tt&gt;ntpd&lt;/tt&gt;. Thus, monitoring is always active as long as there is a restriction entry with the &lt;tt&gt;limited&lt;/tt&gt; flag.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;lowpriotrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nomodify&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries which attempt to modify the state of the server (i.e., run time reconfiguration). Queries which return information are permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noquery&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries. Time service is not affected.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nopeer&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets which would result in mobilizing a new association.  This includes broadcast, symmetric-active and manycast client packets when a configured association does not exist.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noserve&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny all packets except &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the &lt;tt&gt;ntpdc&lt;/tt&gt; control message protocol which is intended for use by remote event logging programs.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrust&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets unless the packet is cryptographically authenticated.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;non-ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both &lt;tt&gt;ntpport&lt;/tt&gt; and &lt;tt&gt;non-ntpport&lt;/tt&gt; may be specified. The &lt;tt&gt;ntpport&lt;/tt&gt; is considered more specific and is sorted later in the list.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;version&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets that do not match the current NTP version.&lt;/p&gt;
&lt;p&gt;Default restriction list entries with the flags &lt;tt&gt;ignore, interface, ntpport&lt;/tt&gt;, for each of the local host&amp;rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Access Control Options</title>
      <link>/archives/4.2.6-series/accopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.6-series/accopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/pogo6.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Pogo&lt;/em&gt;, Walt Kelly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The skunk watches for intruders and sprays.&lt;/p&gt;
&lt;p&gt;Last update: 30-Sep-2009 17:16 UTC&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/accopt/#access-control-support&#34;&gt;Access Control Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/accopt/#access-control-commands&#34;&gt;Access Control Commands&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;access-control-support&#34;&gt;Access Control Support&lt;/h4&gt;
&lt;p&gt;The &lt;tt&gt;ntpd&lt;/tt&gt; daemon implements a general purpose access control list (ACL) containing address/match entries sorted first by increasing address values and then by increasing mask values. A match occurs when the bitwise AND of the mask and the packet source address is equal to the bitwise AND of the mask and address in the list. The list is searched in order with the last match found defining the restriction flags associated with the entry.&lt;/p&gt;
&lt;p&gt;An example may clarify how it works. Our campus has two class-B networks, 128.4 for the ECE and CIS departments and 128.175 for the rest of campus. Let&amp;rsquo;s assume (not true!) that subnet 128.4.1 homes critical services like class rosters and spread sheets. A suitable ACL might be&lt;/p&gt;
&lt;pre&gt;restrict default nopeer				# deny new associations
restrict 128.175.0.0 mask 255.255.0.0 		# allow campus access
restrict 128.4.0.0 mask 255.255.0.0 none	# allow ECE and CIS access
restrict 128.4.1.0 mask 255.255.255.0 notrust # require authentication on subnet 1
restrict time.nist.gov				# allow access
&lt;/pre&gt;
&lt;p&gt;While this facility may be useful for keeping unwanted, broken or malicious clients from congesting innocent servers, it should not be considered an alternative to the NTP authentication facilities. Source address based restrictions are easily circumvented by a determined cracker.&lt;/p&gt;
&lt;h4 id=&#34;access-control-commands&#34;&gt;Access Control Commands&lt;/h4&gt;
&lt;dt id=&#34;discard&#34;&gt;&lt;tt&gt;discard [ average _avg_ ][ minimum _min_ ] [ monitor _prob_ ]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Set the parameters of the rate control facility which protects the server from client abuse. If the &lt;tt&gt;limited&lt;/tt&gt; flag is present in the ACL, packets that violate these limits are discarded. If in addition the &lt;tt&gt;kod&lt;/tt&gt; restriction is present, a kiss-o&#39;-death packet is returned.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;average &lt;em&gt;avg&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specify the minimum average interpacket spacing (minimum average headway time) in log&lt;sub&gt;2&lt;/sub&gt; s with default 3.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;minimum &lt;em&gt;min&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specify the minimum interpacket spacing (guard time) in log&lt;sub&gt;2&lt;/sub&gt; s with default 1.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;monitor&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specify the probability of discard for packets that overflow the rate-control window. This is a performance optimization for servers with aggregate arrivals of 1000 packets per second or more.&lt;/p&gt;
&lt;dt id=&#34;restrict&#34;&gt;&lt;tt&gt;restrict _address_ [mask _mask_] [_flag_][...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; argument expressed in dotted-quad form is the address of a host or network. Alternatively, the &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; argument can be a valid host DNS name. The &lt;tt&gt;&lt;em&gt;mask&lt;/em&gt;&lt;/tt&gt; argument expressed in dotted-quad form defaults to 255.255.255.255, meaning that the &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; is treated as the address of an individual host. A default entry (address 0.0.0.0, mask 0.0.0.0) is always included and is always the first entry in the list. Note that the text string &lt;tt&gt;default&lt;/tt&gt;, with no mask option, may be used to indicate the default entry.&lt;/p&gt;
&lt;p&gt;Some flags have the effect to deny service, some have the effect to enable service and some are conditioned by other flags. The flags. are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags that deny service are classed in two categories, those that restrict time service and those that restrict informational queries and attempts to do run-time reconfiguration of the server. One or more of the following flags may be specified:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;flake&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Discard received NTP packets with probability 0.1; that is, on average drop one packet in ten. This is for testing and amusement. The name comes from Bob Braden&amp;rsquo;s &lt;em&gt;flakeway&lt;/em&gt;, which once did a similar thing for early Internet testing.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ignore&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets of all kinds, including &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;kod&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Send a kiss-o&#39;-death (KoD) packet if the &lt;tt&gt;limited&lt;/tt&gt; flag is present and a packet violates the rate limits established by the &lt;tt&gt;discard&lt;/tt&gt; command. KoD packets are themselves rate limited for each source address separately. If this flag is not present, packets that violate the rate limits are discarded.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;limited&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny time service if the packet violates the rate limits established by the &lt;tt&gt;discard&lt;/tt&gt; command. This does not apply to &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;lowpriotrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Declare traps set by matching hosts to be low priority. The number of traps a server can maintain is limited (the current limit is 3). Traps are usually assigned on a first come, first served basis, with later trap requestors being denied service. This flag modifies the assignment algorithm by allowing low priority traps to be overridden by later requests for normal priority traps.&lt;/p&gt;
&lt;p&gt;Â Â Â Â mssntp&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Enable Microsoft Windows MS-SNTP authentication using Active Directory services. &lt;strong&gt;Note: Potential users should be aware that these services involve a TCP connection to another process that could potentially block, denying services to other users. Therefore, this flag should be used only for a dedicated server with no clients other than MS-SNTP&lt;/strong&gt;.&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nomodify&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries which attempt to modify the state of the server (i.e., run time reconfiguration). Queries which return information are permitted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noquery&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries. Time service is not affected.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;nopeer&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets that might mobilize an association unless authenticated. This includes broadcast, symmetric-active and manycast server packets when a configured association does not exist. Note that this flag does not apply to packets that do not attempt to mobilize an association.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;noserve&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny all packets except &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; queries.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrap&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Decline to provide mode 6 control message trap service to matching hosts. The trap service is a subsystem of the &lt;tt&gt;ntpdc&lt;/tt&gt; control message protocol which is intended for use by remote event logging programs.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;notrust&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets that are not cryptographically authenticated. Note carefully how this flag interacts with the &lt;tt&gt;auth&lt;/tt&gt; option of the &lt;tt&gt;enable&lt;/tt&gt; and &lt;tt&gt;disable&lt;/tt&gt; commands. If &lt;tt&gt;auth&lt;/tt&gt; is enabled, which is the default, authentication is required for all packets that might mobilize an association. If &lt;tt&gt;auth&lt;/tt&gt; is disabled, but the &lt;tt&gt;notrust&lt;/tt&gt; flag is not present, an association can be mobilized whether or not authenticated. If &lt;tt&gt;auth&lt;/tt&gt; is disabled, but the &lt;tt&gt;notrust&lt;/tt&gt; flag is present, authentication is required only for the specified address/mask range.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;non-ntpport&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â This is actually a match algorithm modifier, rather than a restriction flag. Its presence causes the restriction entry to be matched only if the source port in the packet is the standard NTP UDP port (123). Both &lt;tt&gt;ntpport&lt;/tt&gt; and &lt;tt&gt;non-ntpport&lt;/tt&gt; may be specified. The &lt;tt&gt;ntpport&lt;/tt&gt; is considered more specific and is sorted later in the list.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;version&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Deny packets that do not match the current NTP version.&lt;/p&gt;
&lt;p&gt;Default restriction list entries with the flags &lt;tt&gt;ignore, ntpport&lt;/tt&gt;, for each of the local host&amp;rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Access Control Support</title>
      <link>/archives/4.2.8-series/access/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.8-series/access/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/pogo6.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Pogo&lt;/em&gt;, Walt Kelly&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The skunk watches for intruders and sprays.&lt;/p&gt;
&lt;p&gt;Last update: 26-Jul-2017 20:10 UTC&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;The &lt;tt&gt;ntpd&lt;/tt&gt; daemon implements a general purpose access control list (ACL) containing address/match entries sorted first by increasing address values and then by increasing mask values. A match occurs when the bitwise AND of the mask and the packet source address is equal to the bitwise AND of the mask and address in the list. The list is searched in order with the last match found defining the restriction flags associated with the entry.&lt;/p&gt;
&lt;p&gt;The ACL is specified as a list of &lt;tt&gt;restrict&lt;/tt&gt; commands in the following format:&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;restrict &lt;em&gt;address&lt;/em&gt; [mask &lt;em&gt;mask&lt;/em&gt;] [&lt;em&gt;flag&lt;/em&gt;][&amp;hellip;]&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; argument expressed in dotted-quad form is the address of a host or network. Alternatively, the &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; argument can be a valid host DNS name. The &lt;tt&gt;&lt;em&gt;mask&lt;/em&gt;&lt;/tt&gt; argument expressed in IPv4 or IPv6 numeric address form defaults to all mask bits on, meaning that the &lt;tt&gt;&lt;em&gt;address&lt;/em&gt;&lt;/tt&gt; is treated as the address of an individual host. A default entry (address 0.0.0.0, mask 0.0.0.0 for IPv4 and address :: mask :: for IPv6) is always the first entry in the list. &lt;tt&gt;restrict default&lt;/tt&gt;, with no mask option, modifies both IPv4 and IPv6 default entries. &lt;tt&gt;restrict source&lt;/tt&gt; configures a template restriction automatically added at runtime for each association, whether configured, ephemeral, or preemptable, and removed when the association is demobilized.&lt;/p&gt;
&lt;p&gt;Some flags have the effect to deny service, some have the effect to enable service and some are conditioned by other flags. The flags are not orthogonal, in that more restrictive flags will often make less restrictive ones redundant. The flags that deny service are classed in two categories, those that restrict time service and those that restrict informational queries and attempts to do run-time reconfiguration of the server.&lt;/p&gt;
&lt;p&gt;An example may clarify how it works. Our campus has two class-B networks, 128.4 for the ECE and CIS departments and 128.175 for the rest of campus. Let&amp;rsquo;s assume (not true!) that subnet 128.4.1 homes critical services like class rosters and spread sheets. A suitable ACL might look like this:&lt;/p&gt;
&lt;pre&gt;restrict default nopeer			# deny new associations
restrict 128.175.0.0 mask 255.255.0.0 		# allow campus access
restrict 128.4.0.0 mask 255.255.0.0 none	# allow ECE and CIS access
restrict 128.4.1.0 mask 255.255.255.0 notrust   # require authentication on subnet 1
restrict time.nist.gov				# allow access
&lt;/pre&gt;
&lt;p&gt;While this facility may be useful for keeping unwanted, broken or malicious clients from congesting innocent servers, it should not be considered an alternative to the NTP authentication facilities. Source address based restrictions are easily circumvented by a determined cracker.&lt;/p&gt;
&lt;p&gt;Default restriction list entries with the flags &lt;tt&gt;ignore, ntpport&lt;/tt&gt;, for each of the local host&amp;rsquo;s interface addresses are inserted into the table at startup to prevent the server from attempting to synchronize to its own time. A default entry is also always present, though if it is otherwise unconfigured; no flags are associated with the default entry (i.e., everything besides your own NTP server is unrestricted).&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: AIX Hints</title>
      <link>/archives/hints/aix/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/hints/aix/</guid>
      <description>
        
        
        &lt;div id=&#34;body&#34;&gt;
&lt;pre&gt;Problem with recent ANSI compilers

On some systems, including AIX, the compiler quits on the ntp_refclock.c
file when processing the refclock_report() routine. The problem, which
is eithre a feature or a bug, has to do with an unwanted promotion of
the u_char argument to an int and a failure of the compiler to recognize
the preceding prototype. A workaround is to use ANSI syntax to delare
the arguments. Since ANSI compilers are not universally available, this
syntax can&#39;t be used in the stock distribution.

(Message # 60: 2884 bytes, New)
Date: Sat, 19 Aug 1995 13:20:50 -0400
From: &#34;R. Bernstein&#34; &lt;rocky@panix.com&gt;Newsgroups: comp.protocols.time.ntp
to: mills@udel.edu
return-receipt-to: rocky@panix.com
Subject: time and AIX 3.2.5 raw tty bug

This posting isn&#39;t strictly about NTP, any program that may stop the
clock or set the clock backwards is subject to the AIX 3.2.5 bug.

On AIX 3.2.5, there is a bug in the tty driver for a raw device which
may crash the box under certain conditions: basically a read() on a
raw tty in effect, a character was read but not as many as specified
by VMIN when a read timeout occurred. VTIME specifies the timeout. See
the AIX manual page on termios.h or that include file. for Information
on VMIN (or MIN) VTIME (or TIME).

A remedy other than to not use raw tty&#39;s is to apply patch U435110.

Details of the problem report follow.

&gt; ABSTRACT:
&gt; IX43779: TRAP IN PSX_TIMEO
&gt;
&gt; ORIGINATING DETAILS:
&gt; Stacktrace shows:
&gt; IAR:      01460214   posixdd:psx_timeo  + 8bf4: ti 4,r12,0x0
&gt; *LR:      014601a0   posixdd:psx_timeo  + 8b80
&gt; 00212c60: 014604f4   posixdd:psx_timer  + 8ed4
&gt; 00212cc0: 0144b74c   ttydd:tty_do_offlevel  + 4284
&gt; 00212d20: 000216fc  .i_offlevel + 8c
&gt; 00212d70: 00021d78  .i_softint + c8
&gt; 00001004: 00008714  .finish_interrupt + 80
&gt;
&gt; RESPONDER SUMMARY:
&gt; AIX asserted in psx_timeo(). Reason for the assert was that
&gt; the current time was behind psx_ctime. Since this state
&gt; can occur when the current time is changed after a character
&gt; is received but before the VTIME interbyte timer pops, we
&gt; should not assert on this.
&gt;
&gt; RESPONDER CONCLUSION:
&gt; Removed the requirement that current time &gt; psx_ctime by
&gt; adding a new L_ntimersub macro that is used instead of the
&gt; ntimersub macro in time.h. Also added a test for (current
&gt; time - psx_ctime) being negative, in that case we do not
&gt; adjust the new timeout.
&gt;
&gt; Reported to Correct a PTF in Error:     NO
&gt; Reported as a Highly pervasive problem: NO
&gt;
&gt; PE Apar?:       NoPE
&gt; Hiper Apar?:    NoHiper
&gt; Status:         CLOSED  PER
&gt; Component Name: AIX V3 FOR RS/6
&gt; Version:        320
&gt; Component ID:   575603001
&gt; Submitted:      94/05/03
&gt; Closed:         94/05/05
&gt; ChangeTeam:     TX2527
&gt;
&gt; APAR FIXED BY:  U431696  U432151  U432844  U432870  U432979
&gt; U433049  U433081  U433459  U433876  U433906  U434598  U434453
&gt; U434672  U434737  U435110&lt;/rocky@panix.com&gt; &lt;/pre&gt;
&lt;/div&gt;

      </description>
    </item>
    
    <item>
      <title>Reflib: Analysis and Simulation of the NTP On-Wire Protocols</title>
      <link>/reflib/onwire/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reflib/onwire/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/pogo3a.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;from &lt;a href=&#34;/reflib/pictures&#34;&gt;&lt;em&gt;Pogo&lt;/em&gt;&lt;/a&gt;, Walt Kelly&lt;/p&gt;
&lt;p&gt;If it walks like a duck&amp;hellip;&lt;/p&gt;
&lt;p&gt;Last update: 12-May-2012&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#abstract&#34;&gt;Abstract&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#introduction&#34;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#preliminaries&#34;&gt;Preliminaries&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#basic-symmetric-mode&#34;&gt;Basic Symmetric Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#interleaved-symmetric-mode&#34;&gt;Interleaved Symmetric Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#interleaved-broadcast-mode&#34;&gt;Interleaved Broadcast Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#error-detection-and-recovery&#34;&gt;Error Detection and Recovery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#measured-performance&#34;&gt;Measured Performance&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#appendix-a-ntp-protocol-state-machines&#34;&gt;Appendix A. NTP Protocol State Machines&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#appendix-b-the-ntp-simulator-program-ttxlevctt&#34;&gt;Appendix B. The NTP Simulator Program &lt;tt&gt;xlev.c&lt;/tt&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/reflib/onwire/#command-line-options&#34;&gt;Command Line Options&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;abstract&#34;&gt;Abstract&lt;/h4&gt;
&lt;p&gt;This document presents a detailed analysis of the NTP on-wire protocols, including basic and interleaved, symmetric and broadcast modes. The interleaved modes provide enhanced accuracy over the basic modes by timestamping in the driver, rather than in the application layer code. A comprehensive simulation is presented which quantifies the overall error rate subject to random message errors, duplications and omissions.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;introduction&#34;&gt;Introduction&lt;/h4&gt;
&lt;p&gt;The NTP protocol operations in client/server, symmetric and broadcast modes are described in the protocol specification RFC 5905. As pointed out in that document, the highest accuracy obtainable requires the use of timestamps captured as close to the media as possible; however, this requires intervention in the kernel driver or hardware device.&lt;/p&gt;
&lt;p&gt;This document describes two new modes, &lt;em&gt;interleaved symmetric&lt;/em&gt; and &lt;em&gt;interleaved broadcast&lt;/em&gt;, which can improve accuracy by avoiding output queuing and transmission delays. In the reference implementation the receive timestamp or &lt;em&gt;drivestamp&lt;/em&gt; is captured shortly after the input device interrupt and before adding the buffer to the input queue. This avoids delays due to queuing and buffering operations. The transmit timestamp or &lt;em&gt;softstamp&lt;/em&gt; is captured before the message digest is computed and before adding the buffer to the output queue. If nothing further were done, there would be additional delays due to the message digest, queuing, buffering and transmission operations.&lt;/p&gt;
&lt;p&gt;The output delays can be avoided by capturing a transmit drivestamp after the output device interrupt and sending it as the transmit timestamp in the following packet. This is especially important in the case of slow network links such as DSL cable and satellite data links. With the state machine and protocol described in this document, operation is automatic and transparent to other clients with and without interleaved capabilities.&lt;/p&gt;
&lt;p&gt;Interleaved symmetric mode is an extension of basic symmetric mode, while interleaved broadcast mode is an extension of basic broadcast mode. The interleaved modes require servers and peers to retain state, so these modes do not support client/server mode. Mode selection can be determined by a configuration option or automatically by the protocol. In all modes the protocol can detect duplicate, unsynchronized and bogus packets and, in addition, can detect packets that violate the interleaving rules.&lt;/p&gt;
&lt;p&gt;The interleaved modes described in this document have been implemented and tested in the NTP reference implementation. In the present implementation, drivestamps are captured upon return from the I/O routines. They are more accurate than the softstamps used by the original basic modes, but not as accurate as those captured by the hardware (hardstamps), as in the IEEE 1588 Precision Time Protocol (PTP).&lt;/p&gt;
&lt;p&gt;The plan for this document is first to consider general principles of correctness, error scenarios and protocol vulnerabilities. Then for each mode it describes the protocol state machine, its state variables, state transition rules and means for error detection and recovery. This is followed by a detailed description of each mode and an example. Finally, an example is presented that shows how the protocol automatically reverts to basic mode when confronted with an NTPv4 implementation that does not support interleaved modes. &lt;a href=&#34;/reflib/onwire/#appendix-a-ntp-protocol-state-machines&#34;&gt;Appendix A&lt;/a&gt; contains a set of flow charts accompanied by a short description of each.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;/reflib/onwire/#appendix-a-ntp-protocol-state-machines&#34;&gt;Appendix A&lt;/a&gt; contains a detailed description of the state machines in the NTPv4 reference implementation. &lt;a href=&#34;/reflib/onwire/#appendix-b-the-ntp-simulator-program-ttxlevctt&#34;&gt;Appendix B&lt;/a&gt; describes a simulation program used to verify correct operation and to confirm reliable recovery from packet loss, duplicate packet, protocol restart and packets crossing in flight.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;preliminaries&#34;&gt;Preliminaries&lt;/h4&gt;
&lt;p&gt;The symmetric modes operate using a sequence of rounds, each consisting of a transmit packet followed by a receive packet, but either of both of these packets could be lost. A round is correct if both packets are correctly received. In order to verify correctness of the protocol, it is necessary to prove a liveness assertion; that is, the protocol always yields a correct round even if after an indefinite number of incorrect rounds.&lt;/p&gt;
&lt;p&gt;Let &lt;em&gt;P&lt;/em&gt; be the probability of a correct round and &lt;em&gt;Q&lt;/em&gt; = 1 - &lt;em&gt;P&lt;/em&gt;. Then, the probability of a correct round at the _k_th round is&lt;/p&gt;
&lt;p&gt;&lt;code&gt;correct(_k_) = _PQ&amp;lt;sup&amp;gt;k&amp;lt;/sup&amp;gt;_, (_k_ = 0, 1, ...), (1)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;so the overall success probability is the sum of (1) as &lt;em&gt;k&lt;/em&gt; approaches infinity. Representing the sum as a McLaurin series yields&lt;/p&gt;
&lt;p&gt;&lt;code&gt;P[correct] = _P_ / (1 - _Q_). (2)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Let &lt;em&gt;p&lt;/em&gt; be the probability that a packet is correctly received, then &lt;em&gt;P&lt;/em&gt; = &lt;em&gt;p&lt;/em&gt;&lt;sup&gt;2&lt;/sup&gt; and &lt;em&gt;Q&lt;/em&gt; = 1 - &lt;em&gt;p&lt;/em&gt;&lt;sup&gt;2&lt;/sup&gt;. Substituting in (2) we see that the limit approaches 1, which confirms the liveness assertion.&lt;/p&gt;
&lt;p&gt;In the on-wire protocol there are no retransmission&amp;rsquo;s; every packet carries at least one state variable which changes for every packet sent. Timestamps derived from the system clock are guaranteed to be monotone-definite increasing, as long as packets are sent at intervals much longer than the system clock tick. In this protocol the transmit timestamp is used as a nonce, which cannot be predicted. This is insured by inserting a random fuzz in the non-significant bits of the system clock as read. In principle, a violation of monotonicity could occur if the clock was intentionally set backwards. In addition, a packet can be dropped by the network due to congestion or a transmission error.&lt;/p&gt;
&lt;p&gt;By the nature of the protocol, packets are highly unlikely to arrive out of order. They can be duplicated by the network due to collisions or link-level timeouts, or replayed by an intruder. Even if not authenticated, using the transmit timestamp as a nonce makes it highly unlikely that an intruder can manufacture a packet that results in a correct round.&lt;/p&gt;
&lt;p&gt;The use of authentication is optional; but, if it is used, it is highly unlikely an intruder can replay a modified packet or manufacture a new packet acceptable to the receiver. Whether or not authenticated, an intruder can archive old packets and replay them in an attempt to disrupt the state machine. We assume that a replay can never arrive before the original packet and that it is highly unlikely that the original packet is lost to the intended receiver but not to the intruder.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;basic-symmetric-mode&#34;&gt;Basic Symmetric Mode&lt;/h4&gt;
&lt;p&gt;Basic symmetric mode represents the current NTPv4 specification RFC 5905 supported by the reference implementation. Following is an example that illustrates typical operation in this mode starting from an unsynchronized condition.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/xlev5.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Figure 1. Basic Symmetric Mode&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Figure 1 illustrates the most general case where symmetric peers A and B independently measure the offset and delay relative to the other. Each packet transmitted is shown as an arrow with the receive timestamp at the head and the transmit timestamp at the tail. The timestamps shown are after arrival or departure of a packet and may overwrite earlier values. The shaded boxes hold timestamps captured from the system clock. The other boxes hold values copied from them, other state variables or packet headers. Those timestamps with asterisks (*) are softstamps; those without are drivestamps.&lt;/p&gt;
&lt;p&gt;The figure shows three packet header variables, &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt;, and three state variables &lt;em&gt;org&lt;/em&gt;, &lt;em&gt;rec&lt;/em&gt; and &lt;em&gt;aorg&lt;/em&gt;. By convention, timestamps are shown in upper case, while state variables are shown in lower case. The state machine operates as follows. When a packet arrives, the transmit softstamp &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt; is copied to &lt;em&gt;rec&lt;/em&gt; and the receive drivestamp to &lt;em&gt;dst&lt;/em&gt;. When a packet departs, &lt;em&gt;rec&lt;/em&gt; is copied to &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;dst&lt;/em&gt; to &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt; and the transmit softstamp to &lt;em&gt;org&lt;/em&gt; and &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;.&lt;/em&gt; After the state variables have been updated, the timestamps are &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt; = &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt; &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt; = &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt; = &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; = &lt;em&gt;dst&lt;/em&gt;. Thus,&lt;/p&gt;
&lt;p&gt;&lt;code&gt;offset = [(_T_&amp;lt;sub&amp;gt;2&amp;lt;/sub&amp;gt; - _T_&amp;lt;sub&amp;gt;1&amp;lt;/sub&amp;gt;) + (_T_&amp;lt;sub&amp;gt;3&amp;lt;/sub&amp;gt; - _T_&amp;lt;sub&amp;gt;4&amp;lt;/sub&amp;gt;)] / 2&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;delay = (_T_&amp;lt;sub&amp;gt;4&amp;lt;/sub&amp;gt; - _T_&amp;lt;sub&amp;gt;1&amp;lt;/sub&amp;gt;) - (_T_&amp;lt;sub&amp;gt;3&amp;lt;/sub&amp;gt; - _T_&amp;lt;sub&amp;gt;2&amp;lt;/sub&amp;gt;)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;(Note that in these equations &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt; through &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; represent bound variables and not the timestamps in Figure 1 and others below.)&lt;/p&gt;
&lt;p&gt;Figure 1 applies also to client/server mode in which the server immediately returns a packet according to the above rules, but retains no state. Thus, if A is the client and B the server, the &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt; timestamp follows shortly after &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt; and the &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;7&lt;/sub&gt; timestamp follows shortly after &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;6&lt;/sub&gt;.&lt;/p&gt;
&lt;p&gt;In the following descriptions, the packet contents are given in the form (&lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt;). To begin the round at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt;, peer A sends (0, 0, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt;) to B. Later, B sends (&lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt;) to A. At &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; the timestamps &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt; and the &lt;em&gt;dst&lt;/em&gt; variable &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; are available to compute the offset and delay of B relative to A. In a similar fashion at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;6&lt;/sub&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt;, &lt;em&gt;t&lt;/em&gt;&lt;sub&gt;5&lt;/sub&gt; and &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;6&lt;/sub&gt; are available to compute the offset and delay of A relative to B. The protocol is synchronized when both A and B have computed the offset and delay, in this case at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;6&lt;/sub&gt;.&lt;/p&gt;
&lt;p&gt;In symmetric modes each peer independently polls the other peer, but not necessarily at identical intervals. Thus, one or the other peer might receive none, one or more than one packets between polls. This can result in lost packets and even cases where packets cross each other in flight. A peer is synchronized only when all four timestamps are available. The protocol is synchronized only when both peers are synchronized.&lt;/p&gt;
&lt;p&gt;There are three exception conditions designed to deflect invalid, duplicate, unsynchronized or bogus packets.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A packet is invalid if (a) the packet is authenticated and the message authentication code (MAC) is invalid, (b) the packet header values violate the protocol specification, (c) the packet is a replay of the packet most recently received. In these cases the packet is discarded without updating the state variables.&lt;/li&gt;
&lt;li&gt;A packet is unsynchronized if some header timestamps have not been initialized. In this case the state variables are updated, but the timestamps are not used to calculate offset and delay.&lt;/li&gt;
&lt;li&gt;A packet is bogus ifthe packet origin timestamp &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt; does not equal the origin state variable &lt;em&gt;org&lt;/em&gt;; i.e., the packet does not belong to the current round. In this case the state variables are updated, but the values are not used to compute offset and delay.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;After the state variables have been updated, &lt;em&gt;org&lt;/em&gt; is set to zero. Thus, all further packets, whether replays or not, will be considered bogus until the next poll is sent. As described in &lt;a href=&#34;/reflib/onwire/#appendix-a-ntp-protocol-state-machines&#34;&gt;Appendix A&lt;/a&gt;, the bogus test detects both dropped packet and old duplicates; that is, replays of packets other than the one most recent received.&lt;/p&gt;
&lt;p&gt;An intruder can attempt to manufacture spurious packets with unrelated timestamps; however, a successful attack is not possible if the packets are authenticated. Even if not authenticated, the intruder cannot predict a valid &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;, so the best it can do is disrupt the state machine without producing valid offset and delay values. If this is repeated sufficiently often, it amounts to a successful denial-of-service attack. If authentication is used, no attack of this type can succeed. So, the best the intruder can do is to replay old packets.&lt;/p&gt;
&lt;p&gt;In basic symmetric mode, a replay of packet &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt;â†’_T_&lt;sub&gt;2&lt;/sub&gt; will be discarded by peer B as a duplicate, but in client/server mode it will cause B to send a spurious packet _T_&lt;sub&gt;3&lt;/sub&gt;â†’_T_&lt;sub&gt;4&lt;/sub&gt; to A with invalid _T_&lt;sub&gt;3&lt;/sub&gt;. However, as the original _T_&lt;sub&gt;3&lt;/sub&gt;â†’_T_&lt;sub&gt;4&lt;/sub&gt; has already arrived at A and set _org_ to zero, the replay will be discarded as bogus. In basic symmetric mode, a replay of some prior _T_&lt;sub&gt;1&lt;/sub&gt;â†’_T_&lt;sub&gt;2&lt;/sub&gt; would be detected as bogus by B, while in client/server mode the resulting _T_&lt;sub&gt;3&lt;/sub&gt;â†’_T_&lt;sub&gt;4&lt;/sub&gt; will be discarded as bogus by A.&lt;/p&gt;
&lt;p&gt;Furthermore, consider what happens if packet &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt;â†’_T_&lt;sub&gt;4&lt;/sub&gt; is lost. Peer A loses a round, but later transmits _T_&lt;sub&gt;5&lt;/sub&gt;â†’_T_&lt;sub&gt;6&lt;/sub&gt; and completes the round at _T_&lt;sub&gt;8&lt;/sub&gt;. On the other hand, peer B detects a bogus packet _T_&lt;sub&gt;5&lt;/sub&gt;â†’_T_&lt;sub&gt;6&lt;/sub&gt; and loses a round, but completes the next round. As a general rule, the loss of a single packet causes both peers to miss a round, but otherwise results in correct offset and delay values.&lt;/p&gt;
&lt;p&gt;Finally, assume that packets &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt;â†’_T_&lt;sub&gt;4&lt;/sub&gt; and _T_&lt;sub&gt;5&lt;/sub&gt;â†’_T_&lt;sub&gt;6&lt;/sub&gt; overlap in flight. In such a case both peers detect these as bogus and continue in the next round. If it happens that both peers use the same poll interval and continue in this phase, this would violate the liveness assertion. For this reason, the reference implementation continually adjusts the phase of each peer so that each transmission is approximately midway between transmissions of the other peer. Additional details are in &lt;a href=&#34;/reflib/onwire/#appendix-a-ntp-protocol-state-machines&#34;&gt;Appendix A&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;interleaved-symmetric-mode&#34;&gt;Interleaved Symmetric Mode&lt;/h4&gt;
&lt;p&gt;In interleaved modes the transmit timestamp, here called a drivestamp, is captured after the packet has been sent, so it cannot be sent in the same packet. A solution for this is the two-step or interleaved protocol described in this section. In this variant the transmit drivestamp for one packet is actually transmitted in the immediately following packet. The trick, however, is to implement the interleaved protocol without changing the NTP packet header format, without compromising backwards compatibility and without compromising the error recovery properties. Following is a typical example of operation starting from an unsynchronized condition.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/xlev6.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Figure 2. Interleaved Symmetric Mode&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Figure 2 illustrates a typical scenario involving peers A and B. Note that the receive (even-numbered) drivestamps are available immediately after the packet has been received, but the transmit (odd-numbered) drivestamps are available only after the packet has been sent.&lt;/p&gt;
&lt;p&gt;In contrast to the basic protocol, which requires one round to calculate offset and delay, the interleaved protocol requires two rounds. The round that begins at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt; is not complete until &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;8&lt;/sub&gt; and the round that begins at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;5&lt;/sub&gt; is not complete until &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;12&lt;/sub&gt;. However, the rate of offset/delay calculations is the same as the basic protocol. The NTP packet header fields are the same in the interleaved protocol as in the basic protocol, but carry different values.&lt;/p&gt;
&lt;p&gt;The figure shows three packet header variables, &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt;, and four state variables, &lt;em&gt;rec&lt;/em&gt;, &lt;em&gt;dst&lt;/em&gt;, &lt;em&gt;aorg&lt;/em&gt; and &lt;em&gt;borg&lt;/em&gt;. An additional state variable not shown is &lt;em&gt;xmt&lt;/em&gt;, which is used only for duplicate detection and as a sanity check. There are two integer state variables not shown: &lt;em&gt;x&lt;/em&gt;, which alternates between +1 and -1 for each packet sent, and &lt;em&gt;f&lt;/em&gt;, which is used as a synchronization indicator. It is convenient to interpret the value &lt;em&gt;x&lt;/em&gt; = 0 as an instance of the basic mode protocol when both basic and interleaved modes are available.&lt;/p&gt;
&lt;p&gt;When a packet is transmitted, &lt;em&gt;rec&lt;/em&gt; is copied to &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;dst&lt;/em&gt; to &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt;. If &lt;em&gt;x&lt;/em&gt; = +1, the transmit drivestamp is copied to &lt;em&gt;aorg&lt;/em&gt; and &lt;em&gt;borg&lt;/em&gt; is copied to &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt;. If &lt;em&gt;x&lt;/em&gt; = -1, the transmit drivestamp is copied to &lt;em&gt;borg&lt;/em&gt; and &lt;em&gt;aorg&lt;/em&gt; is copied to &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt;. When a packet is received, the timestamps in (1) are &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt; = &lt;em&gt;rec&lt;/em&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt; = &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt;, and &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; = &lt;em&gt;dst&lt;/em&gt;. If &lt;em&gt;x&lt;/em&gt; = +1, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt; = &lt;em&gt;aorg&lt;/em&gt;; if &lt;em&gt;x&lt;/em&gt; = -1, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt; = &lt;em&gt;borg&lt;/em&gt;. After this, &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt; is copied to &lt;em&gt;rec&lt;/em&gt; and the receive drivestamp to &lt;em&gt;dst&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;The protocol must be synchronized before carrying valid timestamps. This is done when each peer transmits a synchronization packet to the other peer which sets its &lt;em&gt;f&lt;/em&gt; variable to 1. A detected error initiates a protocol restart which sets all state variables to 0, including the &lt;em&gt;f&lt;/em&gt; variable, but without affecting the &lt;em&gt;x&lt;/em&gt; variable.&lt;/p&gt;
&lt;p&gt;There are four exception conditions designed to deflect invalid, duplicate, unsynchronized, or bogus packets, but they are slightly different than in the basic symmetric mode.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A packet is invalid if (a) the packet is authenticated and the message authentication code (MAC) is invalid, (b) the packet header values violate the protocol specification, (c) the packet is a replay of the packet most recently received. In these cases the packet is discarded without updating the state variables.&lt;/li&gt;
&lt;li&gt;If any packet other than a synchronization packet is received while the &lt;em&gt;f&lt;/em&gt; variable is 0, the peer restarts the protocol and sends a synchronization packet.&lt;/li&gt;
&lt;li&gt;A packet is unsynchronized if some header timestamps have not been initialized. In this case the state variables are updated, but the timestamps are not used to calculate offset and delay.&lt;/li&gt;
&lt;li&gt;A packet is bogus if &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt; does not match &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt;; i.e., the packet does not belong to the current round. In this case the peer restarts the protocol and sends a synchronization packet.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In Figure 2, &lt;em&gt;T&lt;sub&gt;8&lt;/sub&gt;&lt;/em&gt; is the end of the interleaved round that begins at &lt;em&gt;T&lt;sub&gt;1&lt;/sub&gt;&lt;/em&gt;. After the state variables have been updated, the four timestamps &lt;em&gt;T&lt;sub&gt;1&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;T&lt;sub&gt;2&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;T&lt;sub&gt;3&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;T&lt;sub&gt;4&lt;/sub&gt;&lt;/em&gt; are available to determine the offset and delay of B relative to A. The reader can verify the four timestamps &lt;em&gt;T&lt;sub&gt;3&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;T&lt;sub&gt;4&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;T&lt;sub&gt;5&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;T&lt;sub&gt;6&lt;/sub&gt;&lt;/em&gt; are available at &lt;em&gt;T&lt;sub&gt;10&lt;/sub&gt;&lt;/em&gt; to determine the offset and delay of A relative to B.&lt;/p&gt;
&lt;p&gt;While replayed and bogus packets are detected and discarded as in basic symmetric mode, recovery generally requires two rounds, instead of one, in order to resynchronize the state variables. Additional details are in &lt;a href=&#34;/reflib/onwire/#appendix-a-ntp-protocol-state-machines&#34;&gt;Appendix A&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;interleaved-broadcast-mode&#34;&gt;Interleaved Broadcast Mode&lt;/h4&gt;
&lt;p&gt;In broadcast mode the client responds to the first broadcast received by executing one round of the client/server protocol in order to calibrate the roundtrip delay. This round may be repeated at intervals as necessary. In addition, this round can be used to calibrate the difference between the time delivered via the broadcast spanning tree and the time delivered by the unicast spanning tree. This is most useful in large multicast systems using distance-vector multicasst protocol (DVMRP) or protocol-independent multicast (PIM) technology.&lt;/p&gt;
&lt;p&gt;The IEEE 1588 Precision Time Protocol (PTP) master broadcasts a &lt;tt&gt;Sync&lt;/tt&gt; message to the slaves, which capture the receive timestamp &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt;. Immediately thereafter the master broadcasts a &lt;tt&gt;Follow_up&lt;/tt&gt; message including the transmit timestamp of the &lt;tt&gt;Sync&lt;/tt&gt; message &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt;. Some time later each client separately sends a &lt;tt&gt;Delay_req&lt;/tt&gt; message to the master and captures the transmit timestamp &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt;. The master returns a &lt;tt&gt;Delay_resp&lt;/tt&gt; message containing the receive timestamp &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; for the &lt;tt&gt;Delay_req&lt;/tt&gt; message. The clients collect these fourtimestamps to calculate the offset and delay as in the NTP client/server protocol (1) with the offset sign inverted.&lt;/p&gt;
&lt;p&gt;The principal difference between the interleaved broadcast protocol and PTP is that the broadcast transmit drivestamp &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt; is actually sent in the following broadcast message and the remaining timestamps are obtained by the same stateless protocol used in NTP client/server modes, although slightly modified.&lt;/p&gt;
&lt;p&gt;The interleaved protocol uses the same packet header format as the basic protocol, but includes the transmit drivestamp captured in the previous packet. While softstamps are not used in the interleaved protocol, they are included to support both basic and interleaved modes with the same packet stream, as well as to detect errors in the interleaved mode. When interleaved broadcast mode is not supported, the &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt; header fields are unused and ordinarily set to zero. When interleaved broadcast mode is supported, the clients will note that &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt; is nonzero and switch to interleaved mode.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/xlev7.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Figure 3. Interleaved Broadcast Mode&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Figure 3 shows a typical scenario where the clock is updated as each broadcast packet arrives at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;12&lt;/sub&gt; and &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;14&lt;/sub&gt;. . Note that the server B alternates between_aorg_ and _borg_ only in order to simplify the implementation when supporting the multiple modes described in this document, but otherwise this distinction is unimportant.&lt;/p&gt;
&lt;p&gt;The figure shows three packet header variables, &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt;, and four state variables, &lt;em&gt;rec&lt;/em&gt;, &lt;em&gt;dst&lt;/em&gt;, &lt;em&gt;aorg&lt;/em&gt; and &lt;em&gt;borg&lt;/em&gt;. Although not shown, an additional state variable &lt;em&gt;b&lt;/em&gt; is used as a switch and an additional state variable &lt;em&gt;d&lt;/em&gt; is used as the computed roundtrip delay. As in previous descriptions, state variable &lt;em&gt;xmt&lt;/em&gt; is used to detect duplicates, but not shown.&lt;/p&gt;
&lt;p&gt;The calibration round is similar to the basic client/server round. It begins when the client sends a packet to the server at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;5&lt;/sub&gt; in the figure. When the stateless server replies at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;8&lt;/sub&gt;, &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt; is copied to &lt;em&gt;rec&lt;/em&gt; and state variable &lt;em&gt;b&lt;/em&gt; is set to one. It could be that either or both packets are lost, in which case the round is tried again at the next opportunity. If Autokey is in use, it may take several rounds during which the Autokey dance verifies the server; however, &lt;em&gt;b&lt;/em&gt; should be set only when the dance is complete.&lt;/p&gt;
&lt;p&gt;Upon arrival of the next broadcast packet at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;12&lt;/sub&gt; and &lt;em&gt;b&lt;/em&gt; is set, the timestamps &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt; = &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt; = &lt;em&gt;borg&lt;/em&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt; = &lt;em&gt;aorg&lt;/em&gt;, and &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; = &lt;em&gt;rec,&lt;/em&gt; are used as in (1) to calculated the offset and delay &lt;em&gt;d&lt;/em&gt;. When &lt;em&gt;d&lt;/em&gt; has been initialized, &lt;em&gt;b&lt;/em&gt; is set to zero. However, note that the sign of the offset is reversed as in PTP. The client keeps the delay to use as later broadcast packets arrive.&lt;/p&gt;
&lt;p&gt;For subsequent broadcast packets, the offset is&lt;/p&gt;
&lt;p&gt;&lt;code&gt;offset = (_t&amp;lt;sub&amp;gt;org&amp;lt;/sub&amp;gt;_+ _d_ / 2) - _dst_&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;An exceptional case occurs when a broadcast packet is received after the client packet at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;5&lt;/sub&gt; and before the server packet when &lt;em&gt;b&lt;/em&gt; is set. In this case the calculated delay has a negative sign, but is otherwise valid. In this case the actual delay is the calculated delay with positive sign.&lt;/p&gt;
&lt;p&gt;There are three exception conditions designed to deflect invalid, duplicate, unsynchronized, or bogus packets.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A packet is invalid if (a) the packet is authenticated and the message authentication code (MAC) is invalid, (b) the packet header values violate the protocol specification, (c) the packet is a replay of the packet most recently received. In these cases the packet is discarded without updating the state variables.&lt;/li&gt;
&lt;li&gt;A packet is unsynchronized if some header timestamps have not been initialized. In this case the state variables are updated, but the timestamps are not used to calculate offset.&lt;/li&gt;
&lt;li&gt;Note that the difference between the transmit drivestamp &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; and corresponding softstamp &lt;em&gt;rec&lt;/em&gt; (before &lt;em&gt;rec&lt;/em&gt; is updated) represents the output message digest and queuing delay. If this quantity is less than zero or greater than a maximum possible digest and queuing delay, the packet is bogus and not used to calculate offset.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In contrast to the basic and interleaved symmetric modes, interleaved broadcast mode is vulnerable to old duplicates, which can produce erroneous offset calculations. However, the result would ordinarily be considered spurious and discarded by the popcorn spike suppressor or clock state machine used in the reference implementation. This is the same means for defense used in the basic modes Additional details are in &lt;a href=&#34;/reflib/onwire/#appendix-a-ntp-protocol-state-machines&#34;&gt;Appendix A&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;error-detection-and-recovery&#34;&gt;Error Detection and Recovery&lt;/h4&gt;
&lt;p&gt;In the scheme of things, error packets are rare, especially in fast LANs where propagation delays are very small and poll intervals are in the order of many seconds. However, there is one instance where this can be useful. It occurs when a peer is initially configured to operate in interleaved mode and is presented with a client capable only of basic mode.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/xlev8.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Figure 4. Error Recovery in Basic Symmetric Mode&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In Figure 4, peer A can operate only in basic interleaved mode, but peer B is initially configured in interleaved symmetric mode. When A begins operations, B stumbles along until failing the bogus test at &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;10&lt;/sub&gt;. It then checks for a bogus packet in basic interleaved mode by comparing &lt;em&gt;aorg&lt;/em&gt; to &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;. If they match, the packet is legitimate in basic symmetric mode, so B continues in this mode. If they do not match, the packet is bogus in interleaved symmetric mode, so B continues in this mode. After synchronizing again, both peers clank happily along in the same mode. In principle, the reverse case is possible, but not considered here.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;measured-performance&#34;&gt;Measured Performance&lt;/h4&gt;
&lt;p&gt;The interleaved modes have been implemented and tested in the reference implementation. However, a code surveyor might find it difficult to follow the code flow, as it is intertwined with the authentication and rate management systems. There is, however, a comprehensive test and simulation program described in the in the appendices called &lt;a href=&#34;/reflib/software/xlev.c&#34;&gt;xlev.c&lt;/a&gt; with header file &lt;a href=&#34;/reflib/software/xlev.h&#34;&gt;xlev.h&lt;/a&gt;. It can be used to simulate all modes described in this document, as well as common error scenarios, including lost or duplicate packets, and protocol restarts. These can be controlled using a set of probability thresholds that can be specified as program options.&lt;/p&gt;
&lt;p&gt;In a convincing test the simulator was run for about a million packets in interleaved symmetric mode. with the error probabilities set to about .05 for each of duplicates, old duplicates, dropped, protocol restarts and packet crosses in flight. The results for 1,035,714 packets sent found 793,704 successful packets, 45,643 duplicate packets, 181,161 bogus packets, 54,938 protocol restarts and 56,423 dropped packets for an overall throughput of 0.77. Even in this extreme case there were no undetected errors.&lt;/p&gt;
&lt;p&gt;In interleaved modes the reference implementation uses timestamps captured at or near the device interrupt time (drivestamps). The receive drivestamp is captured upon return from the receive-packet interrupt routine and routine before the receive buffer is queued for later processing. The transmit drivestamp is captured upon return from the send-packet interrupt routine. Both timestamps are probably as accurate as possible without driver or hardware intervention.&lt;/p&gt;
&lt;p&gt;The reference implementation also captures a softstamp before the message digest routine, as well as the drivestamp captured after the send-packet routine. The difference, called the interleaved or output delay, varies from 16 Î¼s for a dual-core, 2.8 GHz Pentium 4 running FreeBSD 6.1 to 1100 Î¼s for a Sun Blade 1500 running Solaris 10. In the following scenarios the network is a switched Ethernet operating at 100 Mb and the NTP packet is about 1000 bits or 10 Î¼s.&lt;/p&gt;
&lt;p&gt;On two identical Pentium 4 machines in symmetric mode, the measured output delay is 16 Î¼s and remaining one-way delay components 45-150 Î¼s. Two LAN segments account for 20 Î¼s, which leaves 25-130 Î¼s for input delay. The RMS jitter is 30-50 Î¼s measured by the clock filter.&lt;/p&gt;
&lt;p&gt;On two identical UltraSPARC machines running Solaris 10 in symmetric mode, the measured output delay is 160 Î¼s and remaining one-way delay components 195 Î¼s. Two LAN segments account for 20 Î¼s, which leaves 175 Î¼s for input delay. The RMS jitter is 40-60 Î¼s measured by the clock filter. A natural conclusion is that the output delay is in general quite stable and most of the jitter is contributed by the network and input delays.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;appendix-a-ntp-protocol-state-machines&#34;&gt;Appendix A. NTP Protocol State Machines&lt;/h4&gt;
&lt;p&gt;This appendix presents an overview of the protocol state machines used in the reference implementation to support the protocol modes described in this document. Simplified representations of these machines have been implemented in the NTP simulator described in &lt;a href=&#34;/reflib/onwire/#appendix-b-the-ntp-simulator-program-ttxlevctt&#34;&gt;Appendix B&lt;/a&gt;. The figures in this appendix are derived almost intact from this program.&lt;/p&gt;
&lt;p&gt;A single pair of state machines is used to support both basic and interleaved protocol modes. One of the machines is for the transmit process, which runs for each transmit packet; the other is for the receive process, which runs for each receive packet. The processes can run in one of five modes: client/server, basic symmetric, interleaved symmetric, basic broadcast and interleaved broadcast. In the description here, the transmit and receive state machines run in the same mode. There is no provision to automatically switch modes. In the broadcast modes there is no provision for the initial client/server volley to calibrate the delay.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Variable&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;mode&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Association Mode&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Origin Timestamp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Receive Timestamp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Transmit Timestamp&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Table A.1 Packet Header Variables&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Variable&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;rec&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Receive Timestamp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;xmt&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Transmit Timestamp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;dst&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Destination Timestamp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;aorg&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;A Origin Timestamp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;borg&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;B Origin Timestamp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;x&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Interleaved Switch&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;f&lt;/em&gt;&lt;/td&gt;
&lt;td&gt;Synchronization Switch&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Table A.2 State Variables&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Tables A.1 and A.2 show the variables of interest in the following. They include three timestamp variables: &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;__, t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt;, which are included in the NTP packet header, five timestamp state variables &lt;em&gt;xmt&lt;/em&gt;, &lt;em&gt;rec&lt;/em&gt;, &lt;em&gt;dst&lt;/em&gt;, &lt;em&gt;aorg&lt;/em&gt;, &lt;em&gt;borg&lt;/em&gt;, and two integer state variables _x_and &lt;em&gt;f&lt;/em&gt;. Some state variables are not used in some modes. By convention in the following, the pseudo-state variable &lt;em&gt;clock&lt;/em&gt; designates the system clock at the time of reading.&lt;/p&gt;
&lt;p&gt;There are in general four exceptions that can occur in the following diagrams:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Dropped - a transmitted packet is lost in the network due to congestion or data error.&lt;/li&gt;
&lt;li&gt;Duplicate - a packet is received as a duplicate of the last packet sent.&lt;/li&gt;
&lt;li&gt;Old duplicate - a packet is received as a duplicate of an earlier packet sent.&lt;/li&gt;
&lt;li&gt;Restart - the protocol state machine has restarted with fresh state variables.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Depending on the mode, detection of these conditions can cause the loss of a packet, loss of a round or loss of two rounds.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/fig_1.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Figure A.1. Transmit Process&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Figure A.1 shows the operations of the transmit process in all five modes. Note that &lt;em&gt;x&lt;/em&gt; serves both as a switch to indicate basic mode (&lt;em&gt;x&lt;/em&gt; = 0) or interleaved mode (&lt;em&gt;x&lt;/em&gt; = Â±1) to alternate the transmit timestamp between &lt;em&gt;aorg&lt;/em&gt; and &lt;em&gt;borg&lt;/em&gt;. It is set at configuration time to 0 for basic mode or +1 for interleaved mode.&lt;/p&gt;
&lt;p&gt;While presented for simplicity in the figure, the clock is actually read twice. Before calling the output packet routine, the clock is read and saved as the &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt; softstamp sent in the packet. Upon return from the output interrupt routine, the clock is read again and saved as the &lt;em&gt;borg&lt;/em&gt; drivestamp to be sent in the next packet.&lt;/p&gt;
&lt;p&gt;Note that in interleaved broadcast mode &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;, ordinarily zero in previous NTP versions, is hijacked to hold the previous transmit drivestamp. This is how a broadcast client recognizes whether basic or interleaved mode is in use. Clients conforming to the NTPv4 specification ignore &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;T&lt;/em&gt;_&lt;sub&gt;rec&lt;/sub&gt;_.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/fig_2.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Figure A.2. Receive Process - Broadcast Mode&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The function of the receive process is to determine the timestamps used to calculate offset and delay. Figures A.2, A.3, A.4 and A.5 show the receive process in all modes and how the various modes are determined. Note that these figures represent segments of one routine consisting of three if/else clauses. The clause is selected by the &lt;em&gt;mode&lt;/em&gt; variable in the NTP packet header and the &lt;em&gt;x&lt;/em&gt; state variable. If &lt;em&gt;x&lt;/em&gt; is zero, the mode is either client/server, basic symmetric or basic broadcast. If not, the mode is interleaved symmetric, since the broadcast modes, whether basic or interleaved, are determine from a packet header timestamp. In addition, an internal variable &lt;em&gt;err&lt;/em&gt; is used to convey status information for later use in the sanity checks. A variable called &lt;em&gt;f&lt;/em&gt; is set to 1 upon completion of an initial synchronization sequence. A routine called reset(), not shown, clears all state variables to zero with the exception of &lt;em&gt;x&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;In interleaved broadcast and interleaved symmetric modes, some errors are detected by a bounds check on a delay or offset statistic. The parameter MAX is assumed somewhat less than half the poll interval, but somewhat greater than the maximum roundtrip delay.&lt;/p&gt;
&lt;p&gt;In broadcast modes only two timestamps, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt; and &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt;, are required to compute offset, since the delay is computed during the client/server calibration volley. In other modes four timestamps, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt;, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt; and &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt;, are required to compute offset and delay.&lt;/p&gt;
&lt;p&gt;In basic broadcast mode, &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt; is zero, so the &lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt; softstamp and &lt;em&gt;dst&lt;/em&gt; receive drivestamps are used to calculate offset. In interleaved broadcast mode, &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt; is hijacked to hold the previous transmit drivestamp. This is how a broadcast client recognizes whether basic or interleaved mode. Clients conforming to the NTPv4 specification ignore &lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt; and &lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;There are three exception conditions. At the beginning of the receive routine duplicate packets are discarded immediately without affecting the state machine. SYNC occurs when the broadcast client restarts, while DELY occurs when the first packet following a dropped packet is received. In this case the time computed from the previous transmit softstamp to the previous transmit hardstamp exceeds a credible queuing delay. In either case the timestamps are not used and only one packet is skipped. However, an old duplicate must be detected by means other than the state machine.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/fig_3.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Figure A.3. Receive Process - Basic Symmetric Mode&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Figure A.3 shows the receive process operations in client and basic symmetric modes where &lt;em&gt;x&lt;/em&gt; is 0. There are three exception conditions. SYNC occurs at protocol restart, ERRR occurs as the result of a protocol error, while BOGS occurs when the packet violates the loopback test. ERRR occurs only in case of a program error or a massive barrage of multiple unrelated errors, while BOGS occurs when the origin softstamp in the packet does not match the origin softstamp for the round. This usually occurs when a packet is dropped or when packets cross in flight.&lt;/p&gt;
&lt;p&gt;If any of these conditions occur, the timestamps are not used and one or more packets are skipped. A dropped packet results in a bogus exception at the next received packet and a delay of one packet, while a protocol restart by either peer results in a delay of one packet. The other exceptions result in a delay of one round (two packets). There are no ambiguous conditions that are not detected by the state machine.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/fig_4.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Figure A.4. Receive process - Interleaved Symmetric Mode&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Figure A.4 shows the operations of the receive process in interleaved symmetric mode. The &lt;em&gt;x&lt;/em&gt; variable determines which of the two origin drivestamps &lt;em&gt;aorg&lt;/em&gt; or &lt;em&gt;borg&lt;/em&gt;, is used. Ordinarily, it follows the same variable used a the transmit process, but if a packet is lost or the protocol is restarted, the peers will be out of phase, resulting in a bogus packet and protocol restart.&lt;/p&gt;
&lt;p&gt;There are five intricately designed exceptions. SYNC occurs in two cases when the protocol is restarted in either or both peers. HOLD occurs when one peer is waiting for the other to complete the synchronization process. As in basic symmetric mode, ERRR occurs as the result of a protocol error, while BOGS occurs when a bogus packet is received as a result of a dropped packet or crossed packets in flight. The reset() routine is called when an exception is found by peer A, for example. It sets all state variables, including &lt;em&gt;f&lt;/em&gt;, to 0 without changing the &lt;em&gt;x&lt;/em&gt; variable. This causes peer A to send a reset packet consisting of three zero timestamps to peer B, causing it to send a reset packet to A. When each peer receives the reset packet, it sets the &lt;em&gt;f&lt;/em&gt; variable to 1. If for some reason peer B does not respond to the reset sequence, peer A continues to send the reset sequence until B does respond. When both peers have set the &lt;em&gt;f&lt;/em&gt; variable to 1, operation continues normally.&lt;/p&gt;
&lt;p&gt;If any of these conditions occur, the timestamps are not used and one or more packets are skipped. A protocol restart results in a delay of three packets, or when each peer has completed one round. Packets crossed in flight result in a delay of one round, where each peer detects a bogus packet from the other. Other exceptions result in a delay of two rounds (four packets). There are no ambiguous conditions that are not detected by the state machine.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/fig_5.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Figure A.5. Timestamp Order Detection&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;When the three receive process segments have complete operations, variable &lt;em&gt;err&lt;/em&gt; contains the completion code. Figure A.5 shows the subsequent operations. If this code is not OK, an error has occurred and operation continues in the next round. However, even if OK there may still be errors due to invalid timestamp ordering. Especially if the frequency of lost packets and packet crosses in flight are uncomfortably high, like ten percent. This can result in some rather messy conditions where restarts occur during restarts or packet crosses in flight. These cases are detected by two rules:&lt;/p&gt;
&lt;p&gt;As long as the clocks are never set backwards, &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; must be later than &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt; and &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; must be later than &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt;. This is called the valid test. In the delay computation all packets must be from the same round. If packets are from different rounds, the computed delay will be less than zero or greater than one poll interval. This is called the delay test.&lt;/p&gt;
&lt;p&gt;Both tests are down for all modes, although T1 and T2 are not significant in broadcast mode.&lt;/p&gt;
&lt;p&gt;if not OK If OK, a final sanity check is performed to detect what may seem a bizarre condition when two packets in a row have been lost. If so, either &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt; is less than &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt; or &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt; is less than &lt;em&gt;T&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt;. This cannot happen with a monotone-definite increasing clock, so in this case operation continues in the next round. If this and all other sanity checks are passed, the offset and delay are computed and operation continues in the next round.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;appendix-b-the-ntp-simulator-program-ttxlevctt&#34;&gt;Appendix B. The NTP Simulator Program &lt;tt&gt;xlev.c&lt;/tt&gt;&lt;/h4&gt;
&lt;p&gt;The NTP simulation program file &lt;a href=&#34;/reflib/software/xlev.c&#34;&gt;&lt;tt&gt;xlev.c&lt;/tt&gt;&lt;/a&gt; and header file &lt;a href=&#34;/reflib/software/xlev.h&#34;&gt;&lt;tt&gt;xlev.h&lt;/tt&gt;&lt;/a&gt; are designed to exhaustively test the protocol state machine under conditions of random packet drops, random packet duplicates, random protocol restarts and occasions where packets cross in flight. To build, install both files and compile with &lt;tt&gt;gcc&lt;/tt&gt;. A list of command line options is given below.&lt;/p&gt;
&lt;p&gt;The program supports all NTP modes, including client/server mode, basic and interleaved symmetric modes, and basic and interleaved broadcast modes, although not all random functions are supported in client/server mode. It supports two peers A and B using the state machines described in &lt;a href=&#34;/reflib/onwire/#appendix-a-ntp-protocol-state-machines&#34;&gt;Appendix A&lt;/a&gt;. In symmetric modes, peer A sends a packet to peer B, then B sends a packet to A. In broadcast modes, server A sends a packet to client B, but B sends no packets. Operation continues in this way for a specified number of rounds. When complete the program displays the number of packets sent, number of correct rounds and number of error rounds. An error round indicates that a the protocol state machine detected a condition where the offset/delay could not be reliably determined..&lt;/p&gt;
&lt;p&gt;The program can produce a trace with one line after each received packet event. The format of this line is:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;nnnnn c pkt dd dd dd st dd dd dd dd dd f ts dd dd dd dd code&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;where &lt;em&gt;&lt;tt&gt;nnnnn&lt;/tt&gt;&lt;/em&gt; shows the simulated time for the event, in seconds, while &lt;em&gt;&lt;tt&gt;c&lt;/tt&gt;&lt;/em&gt; designates which peer receiving the event, A or B. In all but broadcast client mode, the trace lines alternate between A and B. The three decimal fields following &lt;tt&gt;pkt&lt;/tt&gt; are the packet header fields in the order origin (&lt;em&gt;t&lt;sub&gt;org&lt;/sub&gt;&lt;/em&gt;), receive (&lt;em&gt;t&lt;sub&gt;rec&lt;/sub&gt;&lt;/em&gt;) and transmit (&lt;em&gt;t&lt;sub&gt;xmt&lt;/sub&gt;&lt;/em&gt;). The five decimal fields following &lt;tt&gt;st&lt;/tt&gt; are the state variables in the order receive (&lt;em&gt;rec&lt;/em&gt;) , transmit (&lt;em&gt;xmt&lt;/em&gt;), destination (&lt;em&gt;dst&lt;/em&gt;), a-origin (&lt;em&gt;aorg&lt;/em&gt;) and b-origin (&lt;em&gt;borg&lt;/em&gt;). The single letter &lt;em&gt;&lt;tt&gt;f&lt;/tt&gt;&lt;/em&gt; shows the flags variable in hex. See the &lt;tt&gt;xlev.h&lt;/tt&gt; file for decoding. The four decimal fields following &lt;tt&gt;ts&lt;/tt&gt; are the timestamps in the order origin (&lt;em&gt;t&lt;/em&gt;&lt;sub&gt;1&lt;/sub&gt;), receiver (&lt;em&gt;t&lt;/em&gt;&lt;sub&gt;2&lt;/sub&gt;), transmit (&lt;em&gt;t&lt;/em&gt;&lt;sub&gt;3&lt;/sub&gt;) and destination (&lt;em&gt;t&lt;/em&gt;&lt;sub&gt;4&lt;/sub&gt;). The &lt;em&gt;&lt;tt&gt;code&lt;/tt&gt;&lt;/em&gt; string specifies the disposition of the packet with values:&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;ok&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The timestamps are valid and in the correct order.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;duplicate&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The packet is a duplicate of the immediately preceding packet sent to the same peer.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;bogus&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The packet failed the loopback test.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;sync&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The protocol has not yet synchronized.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;holdoff&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The protocol is in a temporary hold-off state.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;dropped&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The packet has been dropped.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;not ready&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;A packet is received by this peer before the first packet has been sent.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;invalid&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The timestamp sequence order is incorrect; i.e., the destination timestamp is received later than the origin timestamp. This can happen in some modes when two successive packets are dropped.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;delay&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The calculated delay is less than zero or greater than the maximum anticipated roundtrip time.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;offset&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The magnitude of the calculated offset is greater than the poll interval.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;error&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;All sanity checks have been passed, but the timestamp sequence order is incorrect. This should never happen, as it indicated a failure of the design.&lt;/p&gt;
&lt;p&gt;In all except the &lt;tt&gt;ok&lt;/tt&gt; case, the packet is dropped before the timestamps are used for offset/delay calculation.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;command-line-options&#34;&gt;Command Line Options&lt;/h4&gt;
&lt;p&gt;The following options can be used on the command line. Probabilities are specified as a fraction in the range 0 to 1, with default 0. The poll intervals default to 8 s. An occasional instance of a packet crossing in flight can be created by specifying poll intervals that are relatively prime. The &lt;tt&gt;-d&lt;/tt&gt;, &lt;tt&gt;-p&lt;/tt&gt; and &lt;tt&gt;-r&lt;/tt&gt; options are not mutually exclusive and can be present on the same line.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;-a&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specify the poll interval for the A peer.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;-b&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specify the poll interval for the B peer.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;-d&lt;/tt&gt; &lt;_prob_&gt;&lt;/dt&gt;
&lt;p&gt;Specify he probability that the last packet sent will by duplicated.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;-m&lt;/tt&gt; &lt;_mode_&gt;&lt;/dt&gt;
&lt;p&gt;Specify the modes of A and B. Mode c is client/server, where A is the client and B the server; mode s is symmetric, where A and B are peers; mode b is broadcast, where A is the client and B the server. The default is s.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;-o&lt;/tt&gt; &lt;_prob_&gt;&lt;/dt&gt;
&lt;p&gt;Specify the probability that the packet before the last one sent will be duplicated.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;-p&lt;/tt&gt; &lt;_prob_&gt;&lt;/dt&gt;
&lt;p&gt;Specify the probability that a packet will be dropped.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;-r&lt;/tt&gt; &lt;_prob_&gt;&lt;/dt&gt;
&lt;p&gt;Specify the probability that the protocol will be restarted.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;-s&lt;/tt&gt; &lt;_maxsim_&gt;&lt;/dt&gt;
&lt;p&gt;Specify the maximum number of rounds in the simulation. The default is 40.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;-t&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Enable packet trace. The default is disable.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;-x&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Enable interleaved mode. The default is basic mode.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Reflib: Anatomy of a Hollerith Card</title>
      <link>/reflib/gallery/gallery9/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/reflib/gallery/gallery9/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/ibmcarda.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;/archives/pic/ibmcard.jpg&#34;&gt;A Hollerith Card&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;In 1896 Herman Hollerith organized the Tabulating Machines Company, which grew in subsequent mergers to become the IBM of today. The Hollerith punched card was the principal means for recording, accounting and archiving functions, not to mention the US census, until recently. In the early 1960&amp;rsquo;s Hollerith cards were the only practical means to input programs for a IBM mainframe, but today these cards are seldom seen.&lt;/p&gt;
&lt;p&gt;Hollerith cards have 12 rows and 80 columns. Decimal digits are encoded in rows 0-9, one per column as shown above. Other characters are encoded using these rows plus rows 11-12 above row 0. Programmers prepared input using the IBM 407 Printing Calculator and IBM 026 Card Punch, which were entirely mechanical. The 026 produced copious amounts of rectangular chad which we used in place of rice at weddings.&lt;/p&gt;
&lt;p&gt;Coinciding with the rise and decline of Hollerith input was the Fortran scientific programming language. A few of us old hands still prefer Fortran over languages with sissy single-character names. The card above is preprinted with the fields used in preparing Fortran input. So far, this discourse is pretty boring; but, the real secrets lost to the younger generation is why the card has this format and why the Fortran fields are as they are. Read on.&lt;/p&gt;
&lt;p&gt;The first scientific computer larger than a Volkswagen and capable of floating-point arithmetic was the IBM 704, which used vacuum tubes and magnetic core memory. It had a cycle time of 2.1 microseconds, a memory of 32,768 36-bit words, two 36-bit arithmetic registers and three 15-bit index registers. Fortran and a raft of other early programming languages were born from that womb.&lt;/p&gt;
&lt;p&gt;The early designers were faced with the problem of adapting the Hollerith card to the 36-bit word used by the 704, especially how to bootstrap the machine with the punched-card loader program. The 704 online card reader was a most primitive device. It read cards by row starting from row 9. For each row the machine read bits from column 1 through 36 into one word, then bits from column 37 through 72 into the next. Machine operators knew this as 9-left format, but casual programmers had no idea what it meant. The same reader was used in the later 709 and its transistorized brother 709T; oops, I mean 7090.&lt;/p&gt;
&lt;p&gt;As a young grad student, I had personal use of the 7090 on Sundays when the computing center was shut down. I arrived one Sunday morning and found the online card reader refused to budge. In fear for my dearly cherished machine time, I searched for a way to fix the thing. Looking inside for fuses, etc., I came upon a real live crank, just like for a Model T. Sure enough, I was able to spin the crank, ignite the bootstrap and light up the machine. Hollerith would approve.&lt;/p&gt;
&lt;p&gt;Back to our story. Why were early Fortran program variable names limited to six characters? Well, the 704 packed six 6-bit Binary Coded Decimal (BCD) characters in one 36-bit word. Why were statement numbers limited to five digits? They were held in 15-bit index registers. Why does the business end of the card have 72 columns with an 8-character card identifier/sequence number at the end? Remember the online card reader? 9-left, 9-right, 8-left, 8-right,&amp;hellip;&lt;/p&gt;
&lt;p&gt;Eventually, the online card reader was supplanted by an offline IBM 1401 machine that was only smart enough to transcribe cards to magnetic tape for input and tape to printer for output. This machine had a much faster, more rugged card reader. However, it read the cards by column, not by row, so the 9-left card became obsolete. However, by this time the 9-left format had become embedded in library programs and a program was needed to transcribe this format to column-binary (aka Chinese Binary) format.&lt;/p&gt;
&lt;p&gt;Writing that library program was my first paid programming job. Now you know why this page is here.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Arbiter 1088A/B GPS Receiver</title>
      <link>/archives/3-5.93e/driver11/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/3-5.93e/driver11/</guid>
      <description>
        
        
        &lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver11/#synopsis&#34;&gt;Synopsis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver11/#description&#34;&gt;Description&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver11/#monitor-data&#34;&gt;Monitor Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver11/#fudge-factors&#34;&gt;Fudge Factors&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver11/#additional-information&#34;&gt;Additional Information&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;synopsis&#34;&gt;Synopsis&lt;/h4&gt;
&lt;p&gt;Address: 127.127.11.&lt;em&gt;u&lt;/em&gt;&lt;br&gt;
Reference ID: &lt;tt&gt;GPS&lt;/tt&gt;&lt;br&gt;
Driver ID: &lt;tt&gt;GPS_ARBITER&lt;/tt&gt;&lt;br&gt;
Serial Port: &lt;tt&gt;/dev/gps_u_&lt;/tt&gt;; 9600 baud, 8-bits, no parity&lt;br&gt;
Features: &lt;tt&gt;tty_clk&lt;/tt&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;description&#34;&gt;Description&lt;/h4&gt;
&lt;p&gt;This driver supports the Arbiter 1088A/B Satellite Controlled Clock. The claimed accuracy of this clock is 100 ns relative to the PPS output when receiving four or more satellites.&lt;/p&gt;
&lt;p&gt;The receiver should be configured before starting the NTP daemon, in order to establish reliable position and operating conditions. It does not initiate surveying or hold mode. For use with NTP, the daylight savings time feature should be disables (&lt;tt&gt;D0&lt;/tt&gt; command) and the broadcast mode set to operate in UTC (&lt;tt&gt;BU&lt;/tt&gt; command).&lt;/p&gt;
&lt;p&gt;The timecode format supported by this driver is selected by the poll sequence &lt;tt&gt;B5&lt;/tt&gt;, which initiates a line in the following format to be repeated once per second until turned off by the &lt;tt&gt;B0&lt;/tt&gt; command.&lt;/p&gt;
&lt;p&gt;Format &lt;tt&gt;B5&lt;/tt&gt; (24 ASCII printing characters):&lt;/p&gt;
&lt;pre&gt;
&amp;lsaquo;cr&amp;rsaquo;&amp;lsaquo;lf&amp;rsaquo;i yy ddd hh:mm:ss.000bbb
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;on-time&lt;/code&gt; = â€¹crâ€º&lt;/p&gt;
&lt;p&gt;&lt;code&gt;i&lt;/code&gt; = synchronization flag (&lt;code&gt;&#39; &#39;&lt;/code&gt; = locked, &lt;code&gt;?&lt;/code&gt; = unlocked)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;yy&lt;/code&gt; = year of century&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ddd&lt;/code&gt; = day of year&lt;/p&gt;
&lt;p&gt;&lt;code&gt;hh:mm:ss&lt;/code&gt; = hours, minutes, seconds&lt;/p&gt;
&lt;p&gt;&lt;code&gt;.000&lt;/code&gt; = fraction of second (not used)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bbb&lt;/code&gt; = tailing spaces for fill&lt;/p&gt;
&lt;p&gt;The alarm condition is indicated by a &lt;code&gt;?&lt;/code&gt; at &lt;code&gt;i&lt;/code&gt;, which indicates the receiver is not synchronized. In normal operation, a line consisting of the timecode followed by the time quality character &lt;code&gt;TQ&lt;/code&gt; followed by the receiver status string &lt;code&gt;SR&lt;/code&gt; is written to the clockstats file.&lt;/p&gt;
&lt;p&gt;The time quality character is encoded in IEEE P1344 standard:&lt;/p&gt;
&lt;p&gt;Format &lt;tt&gt;TQ&lt;/tt&gt; (IEEE P1344 estimated worst-case time quality)&lt;/p&gt;
&lt;pre&gt;0       clock locked, maximum accuracy
F       clock failure, time not reliable
4       clock unlocked, accuracy &lt; 1 us
5       clock unlocked, accuracy &lt; 10 us
6       clock unlocked, accuracy &lt; 100 us
7       clock unlocked, accuracy &lt; 1 ms
8       clock unlocked, accuracy &lt; 10 ms
9       clock unlocked, accuracy &lt; 100 ms
A       clock unlocked, accuracy &lt; 1 s
B       clock unlocked, accuracy &lt; 10 s&lt;/pre&gt;
&lt;p&gt;The status string is encoded as follows:&lt;/p&gt;
&lt;p&gt;Format &lt;tt&gt;SR&lt;/tt&gt; (25 ASCII printing characters)&lt;/p&gt;
&lt;pre&gt;V=vv S=ss T=t P=pdop E=ee&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;vv&lt;/code&gt; = satellites visible&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ss&lt;/code&gt; = relative signal strength&lt;/p&gt;
&lt;p&gt;&lt;code&gt;t&lt;/code&gt; = satellites tracked&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pdop&lt;/code&gt; = position dilution of precision (meters)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ee&lt;/code&gt; = hardware errors&lt;/p&gt;
&lt;p&gt;A three-stage median filter is used to reduce jitter and provide a dispersion measure. The driver makes no attempt to correct for the intrinsic jitter of the radio itself.&lt;/p&gt;
&lt;h4 id=&#34;monitor-data&#34;&gt;Monitor Data&lt;/h4&gt;
&lt;p&gt;The driver writes each timecode as received to the &lt;tt&gt;clockstats&lt;/tt&gt; file. When enabled by the &lt;tt&gt;flag4&lt;/tt&gt; fudge flag, an additional line containing the latitude, longitude, elevation and optional deviation data is written to the &lt;tt&gt;clockstats&lt;/tt&gt; file. The deviation data operates with an external pulse-per-second (PPS) input, such as a cesium oscillator or another radio clock. The PPS input should be connected to the B event channel and the radio initialized for deviation data on that channel. The deviation data consists of the mean offset and standard deviation of the external PPS signal relative the GPS signal, both in microseconds over the last 16 seconds.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;fudge-factors&#34;&gt;Fudge Factors&lt;/h4&gt;
&lt;dt&gt;&lt;tt&gt;time1 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the time offset calibration factor, in seconds and fraction, with default 0.0. For a calibrated Sun IPC, the correct value is about .0065.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;time2 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Not used by this driver.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;stratum _number_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the driver stratum, in decimal from 0 to 15, with default 0.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;refid _string_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the driver reference identifier, an ASCII string from one to four characters, with default &lt;tt&gt;GPS&lt;/tt&gt;.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag1 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Not used by this driver.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag2 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Not used by this driver.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag3 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Enable &lt;tt&gt;ppsclock&lt;/tt&gt; line discipline/streams module if set.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag4 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Enable extended &lt;tt&gt;clockstats&lt;/tt&gt; recording if set.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;additional-information&#34;&gt;Additional Information&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;/archives/3-5.93e/refclock&#34;&gt;Reference Clock Drivers&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Arbiter 1088A/B GPS Receiver</title>
      <link>/archives/drivers/driver11/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/drivers/driver11/</guid>
      <description>
        
        
        &lt;p&gt;Author: David L. Mills (&lt;a href=&#34;mailto:mills@udel.edu&#34;&gt;mills@udel.edu&lt;/a&gt;)&lt;br&gt;
Last update: 11-Sep-2010 05:56 UTC&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver11/#synopsis&#34;&gt;Synopsis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver11/#description&#34;&gt;Description&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver11/#fudge-factors&#34;&gt;Fudge Factors&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver11/#additional-information&#34;&gt;Additional Information&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;synopsis&#34;&gt;Synopsis&lt;/h4&gt;
&lt;p&gt;Address: 127.127.11.&lt;em&gt;u&lt;/em&gt;&lt;br&gt;
Reference ID: &lt;tt&gt;GPS&lt;/tt&gt;&lt;br&gt;
Driver ID: &lt;tt&gt;GPS_ARBITER&lt;/tt&gt;&lt;br&gt;
Serial Port: &lt;tt&gt;/dev/gps_u_&lt;/tt&gt;; 9600 baud, 8-bits, no parity&lt;br&gt;
Features: &lt;tt&gt;tty_clk&lt;/tt&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;description&#34;&gt;Description&lt;/h4&gt;
&lt;p&gt;This driver supports the Arbiter 1088A/B Satellite Controlled Clock. The claimed accuracy of this clock is 100 ns relative to the PPS output when receiving four or more satellites.&lt;/p&gt;
&lt;p&gt;The receiver should be configured before starting the NTP daemon, in order to establish reliable position and operating conditions. It does not initiate surveying or hold mode. For use with NTP, the daylight savings time feature should be disables (&lt;tt&gt;D0&lt;/tt&gt; command) and the broadcast mode set to operate in UTC (&lt;tt&gt;BU&lt;/tt&gt; command).&lt;/p&gt;
&lt;p&gt;The timecode format supported by this driver is selected by the poll sequence &lt;tt&gt;B5&lt;/tt&gt;, which initiates a line in the following format to be repeated once per second until turned off by the &lt;tt&gt;B0&lt;/tt&gt; command.&lt;/p&gt;
&lt;p&gt;Format &lt;tt&gt;B5&lt;/tt&gt; (24 ASCII printing characters):&lt;/p&gt;
&lt;pre&gt;
&amp;lsaquo;cr&amp;rsaquo;&amp;lsaquo;lf&amp;rsaquo;i yy ddd hh:mm:ss.000bbb
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;on-time&lt;/code&gt; = â€¹crâ€º&lt;/p&gt;
&lt;p&gt;&lt;code&gt;i&lt;/code&gt; = synchronization flag (&lt;code&gt;&#39; &#39;&lt;/code&gt; = locked, &lt;code&gt;?&lt;/code&gt; = unlocked)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;yy&lt;/code&gt; = year of century&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ddd&lt;/code&gt; = day of year&lt;/p&gt;
&lt;p&gt;&lt;code&gt;hh:mm:ss&lt;/code&gt; = hours, minutes, seconds&lt;/p&gt;
&lt;p&gt;&lt;code&gt;.000&lt;/code&gt; = fraction of second (not used)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bbb&lt;/code&gt; = tailing spaces for fill&lt;/p&gt;
&lt;p&gt;The alarm condition is indicated by a &lt;code&gt;?&lt;/code&gt; at &lt;code&gt;i&lt;/code&gt;, which indicates the receiver is not synchronized. In normal operation, a line consisting of the timecode followed by the time quality character &lt;code&gt;TQ&lt;/code&gt; followed by the receiver status string &lt;code&gt;SR&lt;/code&gt; is written to the clockstats file.&lt;/p&gt;
&lt;p&gt;The time quality character is encoded in IEEE P1344 standard:&lt;/p&gt;
&lt;p&gt;Format &lt;tt&gt;TQ&lt;/tt&gt; (IEEE P1344 estimated worst-case time quality)&lt;/p&gt;
&lt;pre&gt;0       clock locked, maximum accuracy
F       clock failure, time not reliable
4       clock unlocked, accuracy &lt; 1 us
5       clock unlocked, accuracy &lt; 10 us
6       clock unlocked, accuracy &lt; 100 us
7       clock unlocked, accuracy &lt; 1 ms
8       clock unlocked, accuracy &lt; 10 ms
9       clock unlocked, accuracy &lt; 100 ms
A       clock unlocked, accuracy &lt; 1 s
B       clock unlocked, accuracy &lt; 10 s&lt;/pre&gt;
&lt;p&gt;The status string is encoded as follows:&lt;/p&gt;
&lt;p&gt;Format &lt;tt&gt;SR&lt;/tt&gt; (25 ASCII printing characters)&lt;/p&gt;
&lt;pre&gt;V=vv S=ss T=t P=pdop E=ee&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;vv&lt;/code&gt; = satellites visible&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ss&lt;/code&gt; = relative signal strength&lt;/p&gt;
&lt;p&gt;&lt;code&gt;t&lt;/code&gt; = satellites tracked&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pdop&lt;/code&gt; = position dilution of precision (meters)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ee&lt;/code&gt; = hardware errors&lt;/p&gt;
&lt;p&gt;A three-stage median filter is used to reduce jitter and provide a dispersion measure. The driver makes no attempt to correct for the intrinsic jitter of the radio itself.&lt;/p&gt;
&lt;h4 id=&#34;monitor-data&#34;&gt;Monitor Data&lt;/h4&gt;
&lt;p&gt;When enabled by the &lt;tt&gt;flag4&lt;/tt&gt; fudge flag, an additional line containing the latitude, longitude, elevation and optional deviation data is written to the &lt;tt&gt;clockstats&lt;/tt&gt; file. The deviation data operates with an external pulse-per-second (PPS) input, such as a cesium oscillator or another radio clock. The PPS input should be connected to the B event channel and the radio initialized for deviation data on that channel. The deviation data consists of the mean offset and standard deviation of the external PPS signal relative the GPS signal, both in microseconds over the last 16 seconds.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;fudge-factors&#34;&gt;Fudge Factors&lt;/h4&gt;
&lt;dl&gt;
&lt;dt&gt;&lt;tt&gt;time1 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Specifies the time offset calibration factor, in seconds and fraction, with default 0.0.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;time2 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Not used by this driver.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;stratum _number_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Specifies the driver stratum, in decimal from 0 to 15, with default 0.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;refid _string_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Specifies the driver reference identifier, an ASCII string from one to four characters, with default &lt;tt&gt;GPS&lt;/tt&gt;.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag1 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Not used by this driver.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag2 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Not used by this driver.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag3 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Not used by this driver.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag4 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Enable verbose &lt;tt&gt;clockstats&lt;/tt&gt; recording if set.&lt;/dd&gt;
&lt;/dl&gt;
&lt;hr&gt;
&lt;h4 id=&#34;additional-information&#34;&gt;Additional Information&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;/archives/4.2.8-series/refclock&#34;&gt;Reference Clock Drivers&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Arcron MSF Receiver</title>
      <link>/archives/3-5.93e/driver27/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/3-5.93e/driver27/</guid>
      <description>
        
        
        &lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver27/#synopsis&#34;&gt;Synopsis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver27/#description&#34;&gt;Description&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver27/#monitor-data&#34;&gt;Monitor Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver27/#fudge-factors&#34;&gt;Fudge Factors&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver27/#additional-information&#34;&gt;Additional Information&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;synopsis&#34;&gt;Synopsis&lt;/h4&gt;
&lt;p&gt;Address: 127.127.27.&lt;em&gt;u&lt;/em&gt;&lt;br&gt;
Reference ID: &lt;tt&gt;MSF&lt;/tt&gt;&lt;br&gt;
Driver ID: &lt;tt&gt;ARCRON_MSF&lt;/tt&gt;&lt;br&gt;
Serial Port: &lt;tt&gt;/dev/arc_u_&lt;/tt&gt;; 300 baud, 8-bits, 2-stop, no parity&lt;br&gt;
Features: &lt;tt&gt;tty_clk&lt;/tt&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;description&#34;&gt;Description&lt;/h4&gt;
&lt;p&gt;This driver supports the Arcron MSF receiver, and would probably also support the DCF77 variant of the same clock. The clock reports its ID as &amp;ldquo;&lt;tt&gt;MSFa&lt;/tt&gt;&#39;&#39; to indicate MSF as a source and the use of the ARCRON driver.&lt;/p&gt;
&lt;p&gt;This documentation describes version V1.1 (1997/06/23) of the source and has been tested (amongst others) against xntpd3-5.90 on Solaris-1 (SunOS 4.1.3_U1 on an SS1 serving as a router and firewall) and against xntpd3-5.90 on Solaris-2.5 (on a SS1+ and TurboSPARC 170MHz). This code will probably work, and show increased stability, reduced jitter and more efficiency (fewer context switches) with the &lt;tt&gt;tty_clk&lt;/tt&gt; discipline/STREAMS module installed, but this has not been tested. For a to-do list see the comments at the start of the code.&lt;/p&gt;
&lt;p&gt;This code has been significantly slimmed down since the V1.0 version, roughly halving the memory footprint of its code and data.&lt;/p&gt;
&lt;p&gt;This driver is designed to allow the unit to run from batteries as designed, for something approaching the 2.5 years expected in the usual stand-alone mode, but no battery-life measurements have been taken.&lt;/p&gt;
&lt;p&gt;Much of this code is originally from the other refclock driver files with thanks. The code was originally made to work with the clock by &lt;a href=&#34;mailto:derek@toybox.demon.co.uk&#34;&gt;Derek Mulcahy&lt;/a&gt;, with modifications by &lt;a href=&#34;mailto:d@hd.org&#34;&gt;Damon Hart-Davis&lt;/a&gt;. Thanks also to &lt;a href=&#34;mailto:lyndond@sentinet.co.uk&#34;&gt;Lyndon David&lt;/a&gt; for some of the specifications of the clock.&lt;/p&gt;
&lt;p&gt;There is support for a Tcl/Tk monitor written by Derek Mulcahy that examines the output stats; see the &lt;a href=&#34;http://www2.exnet.com/NTP/ARC/ARC.html&#34;&gt;ARC Rugby MSF Receiver&lt;/a&gt; page for more details and the code.&lt;/p&gt;
&lt;p&gt;Look at the notes at the start of the code for further information; some of the more important details follow.&lt;/p&gt;
&lt;p&gt;The driver interrogates the clock at each poll (ie every 64s by default) for a timestamp. The clock responds at the start of the next second (with the start bit of the first byte being on-time). The time is in &amp;lsquo;local&amp;rsquo; format, including the daylight savings adjustment when it is in effect. The driver code converts the time back to UTC.&lt;/p&gt;
&lt;p&gt;The clock claims to be accurate to within about 20ms of the MSF-broadcast time, and given the low data transmission speed from clock to host, and the fact that the clock is not in continuous sync with MSF, it seems sensible to set the `precision&#39; of this clock to -5 or -4, -4 being used in this code, which builds in a reported dispersion of over 63ms (ie says &amp;ldquo;This clock is not very good.&amp;quot;). You can improve the reported precision to -4 (and thus reduce the base dispersion to about 31ms) by setting the fudge &lt;tt&gt;flag3&lt;/tt&gt; to &lt;tt&gt;1&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Even a busy and slow IP link can yield lower dispersions than this from polls of primary time servers on the Internet, which reinforces the idea that this clock should be used as a backup in case of problems with such an IP link, or in the unfortunate event of failure of more accurate sources such as GPS.&lt;/p&gt;
&lt;p&gt;By default this clock reports itself to be at stratum 2 rather than the usual stratum 0 for a refclock, because it is not really suited to be used as other than a backup source. The stratum reported can be changed with the &lt;tt&gt;stratum&lt;/tt&gt; directive to be whatever you like. After careful monitoring of your clock, and appropriate choice of the &lt;tt&gt;time1&lt;/tt&gt; fudge factor to remove systematic errors in the clock&amp;rsquo;s reported time, you might fudge the clock to stratum 1 to allow a stratum-2 secondary server to sync to it.&lt;/p&gt;
&lt;p&gt;The driver code arranges to resync the clock to MSF at intervals of a little less than an hour (deliberately avoiding the same time each hour to avoid any systematic problems with the signal or host). Whilst resyncing, the driver supplements the normal polls for time from the clock with polls for the reception signal quality reported by the clock. If the signal quality is too low (0&amp;ndash;2 out of a range of 0&amp;ndash;5), we chose not to trust the clock until the next resync (which we bring forward by about half an hour). If we don&amp;rsquo;t catch the resync, and so don&amp;rsquo;t know the signal quality, we do trust the clock (because this would generally be when the signal is very good and a resync happens quickly), but we still bring the next resync forward and reduce the reported precision (and thus increase reported dispersion).&lt;/p&gt;
&lt;p&gt;If we force resyncs to MSF too often we will needlessly exhaust the batteries the unit runs from. During clock resync this driver tries to take enough time samples to avoid &lt;tt&gt;xntpd&lt;/tt&gt; losing sync in case this clock is the current peer. By default the clock would only resync to MSF about once per day, which would almost certainly not be acceptable for NTP purposes.&lt;/p&gt;
&lt;p&gt;The driver does not force an immediate resync of the clock to MSF when it starts up to avoid excessive battery drain in case &lt;tt&gt;xntpd&lt;/tt&gt; is going to be repeatedly restarted for any reason, and also to allow enough samples of the clock to be taken for &lt;tt&gt;xntpd&lt;/tt&gt; to sync immediately to this clock (and not remain unsynchronised or to sync briefly to another configured peer, only to hop back in a few poll times, causing unnecessary disturbance). This behaviour should not cause problems because the driver will not accept the timestamps from the clock if the status flag delivered with the time code indicates that the last resync attempt was unsuccessful, so the initial timestamps will be close to reality, even if with up to a day&amp;rsquo;s clock drift in the worst case (the clock by default resyncs to MSF once per day).&lt;/p&gt;
&lt;p&gt;The clock has a peculiar RS232 arrangement where the transmit lines are powered from the receive lines, presumably to minimise battery drain. This arrangement has two consequences:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Your RS232 interface must drive both +ve and -ve&lt;/li&gt;
&lt;li&gt;You must (in theory) wait for an echo and a further 10ms between characters&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This driver, running on standard Sun ahardware, seems to work fine; note the use of the &lt;tt&gt;send_slow()&lt;/tt&gt; routine to queue up command characters to be sent once every two seconds.&lt;/p&gt;
&lt;p&gt;Three commands are sent to the clock by this driver. Each command consists of a single letter (of which only the bottom four bits are significant), followed by a CR (ASCII 13). Each character sent to the clock should be followed by a delay to allow the unit to echo the character, and then by a further 10ms. Following the echo of the command string, there may be a response (ie in the case of the &lt;tt&gt;g&lt;/tt&gt; and &lt;tt&gt;o&lt;/tt&gt; commands below), which in the case of the &lt;tt&gt;o&lt;/tt&gt; command may be delayed by up to 1 second so as the start bit of the first byte of the response can arrive on time. The commands and their responses are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;tt&gt;g&lt;/tt&gt; CR&lt;/strong&gt;
Request for signal quality. Answer only valid during (late part of) resync to MSF signal. The response consists of two characters as follows:&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;First Bit Number&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;th&gt;Second Bit Number&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;parity&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;parity&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;td&gt;2&amp;ndash;0&lt;/td&gt;
&lt;td&gt;reception signal quality in the range 0&amp;ndash;5 (very poor to very good); if in the range 0&amp;ndash;2 no successful reception is to be expected. The reported value drops to zero when not resyncing, ie when first returned byte is not &lt;code&gt;3&lt;/code&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0 if no reception attempt at the moment; 1 if reception attempt (ie resync) in progress&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;tt&gt;h&lt;/tt&gt; CR&lt;/strong&gt;
Request to resync to MSF. Can take up from about 30s to 360s. Drains batteries so should not be used excessively. After this the clock time and date should be correct and the phase within 20ms of time as transmitted from Rugby MSF (remember to allow for propagation time). By default the clock resyncs once per day shortly after 2am (presumably to catch transitions to/from daylight saving time quickly). With this driver code we resync at least once per hour to minimise clock wander.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;tt&gt;o&lt;/tt&gt; CR&lt;/strong&gt;
Request timestamp. Start bit of first byte of response is on-time, so may be delayed up to 1 second.  Note that when the BST mode is in effect the time is GMT/UTC +0100, ie an hour ahead of UTC to reflect local time in the UK. The response data is as follows:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;hours tens (hours range from 00 to 23)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hours units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;minutes tens (minutes range from 00 to 59)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;minutes units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;seconds tens (seconds presumed to range from 00 to 60 to allow for leap second)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;seconds units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;day of week 1 (Monday) to 7 (Sunday)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;day of month tens (day ranges from 01 to 31)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;day of month units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;month tens (months range from 01 to 12)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;month units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;year tens (years range from 00 to 99)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;year units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;BST/UTC status&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Bit Number&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;parity&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;1 if UTC is in effect (reverse of bit 1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1 if BST is in effect (reverse of bit 2)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;1 if BST/UTC change pending&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ol start=&#34;15&#34;&gt;
&lt;li&gt;clock status&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Bit Number&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;parity&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1&lt;/code&gt; if low battery is detected&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1&lt;/code&gt; if last resync failed (though officially undefined for the MSF clock)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1&lt;/code&gt; if at least one reception attempt since 0230 for the MSF clock was successful (0300 for the DCF77 clock)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1&lt;/code&gt; if the clock has valid time&amp;mdash;reset to zero when clock is reset (eg at power-up), and set to 1 after first successful resync attempt.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The driver only accepts time from the clock if the bottom three bits of the status byte are &lt;tt&gt;011&lt;/tt&gt;. The leap-year logic for computing day-in-year is only valid until 2099, and the clock will ignore stamps from the clock that claim BST is in effect in the first hour of each year. If the UK parliament decides to move us to +0100/+0200 time as opposed to the current +0000/+0100 time, it is not clear what effect that will have on the time broadcast by MSF, and therefore on this driver&amp;rsquo;s usefulness.&lt;/p&gt;
&lt;p&gt;A typical &lt;tt&gt;ntp.conf&lt;/tt&gt; configuration file for this driver might be:&lt;/p&gt;
&lt;pre&gt;# hostname(n) means we expect (n) to be the stratum at which hostname runs.

#------------------------------------------------------------------------------
# SYNCHRONISATION PARTNERS
# ========================

# Our betters...
server 127.127.27.0 # ARCRON MSF radio clock
# Fudge stratum and other features as required.
# ADJUST time1 VALUE FOR YOUR HOST, CLOCK AND LOCATION!
fudge 127.127.27.0 stratum 1 time1 0.016 flag3 1 flags 4 1

peer 11.22.33.9 # tick(1--2).
peer 11.22.33.4 # tock(3), boot/NFS server.

# This shouldn&#39;t get swept away unless left untouched for a long time.
driftfile /var/tmp/ntp.drift

#------------------------------------------------------------------------------
# RESTRICTIONS
# ============

# By default, don&#39;t trust and don&#39;t allow modifications.  Ignore in fact.
restrict default ignore notrust nomodify

# Allow others in our subnet to check us out...
restrict 11.22.33.0 mask 255.255.255.0 nomodify notrust

# Trust our peers for time.  Don&#39;t trust others in case they are insane.
restrict 127.127.27.0 nomodify
restrict 11.22.33.4 nomodify
restrict 11.22.33.9 nomodify

# Allow anything from the local host.
restrict 127.0.0.1&lt;/pre&gt;
&lt;p&gt;There are a few &lt;tt&gt;#define&lt;/tt&gt;s in the code that you might wish to play with:&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;ARCRON_KEEN&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;With this defined, the code is relatively trusting of the clock, and assumes that you will have the clock as one of a few time sources, so will bend over backwards to use the time from the clock when available and avoid &lt;tt&gt;xntpd&lt;/tt&gt; dropping sync from the clock where possible. You may wish to undefine this, especially if you have better sources of time or your reception is ropey. However, there are many checks built in even with this flag defined.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;ARCRON_OWN_FILTER&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;When defined, the code uses its own median-filter code rather than that available in &lt;tt&gt;ntp_refclock.c&lt;/tt&gt; since the latter seems to have a minor bug, at least in version 3-5.90. If this bug goes away this flag should be turned off to avoid duplication of code. (The bug, if that&amp;rsquo;s what it is, causes the last raw offset to be used rather than the median offset.)&lt;/p&gt;
&lt;p&gt;Without this defined (and without &lt;tt&gt;ARCRON_MULTIPLE_SAMPLES&lt;/tt&gt; below) a typical set of offsets reported and used to drive the clock-filter algorithm is (oldest last):&lt;/p&gt;
&lt;p&gt;&lt;code&gt;filtoffset=  -4.32  -34.82   -0.78    0.89    2.76    4.58   -3.92   -2.17&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Look at that spike!&lt;/p&gt;
&lt;p&gt;With this defined a typical set of offsets is:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;filtoffset=  -7.06   -7.06   -2.91   -2.91   -2.91   -1.27   -9.54   -6.70&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;with the repeated values being some evidence of outlyers being discarded.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;ARCRON_MULTIPLE_SAMPLES&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;When is defined, we regard each character in the returned timecode as at a known delay from the start of the second, and use the smallest (most negative) offset implied by any such character, ie with the smallest kernel-induced display, and use that. This helps to reduce jitter and spikes.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;ARCRON_LEAPSECOND_KEEN&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;When is defined, we try to do a resync to MSF as soon as possible in the first hour of the morning of the first day of the first and seventh months, ie just after a leap-second insertion or deletion would happen if it is going to. This should help compensate for the fact that this clock does not continuously sample MSF, which compounds the fact that MSF itself gives no warning of an impending leap-second event. This code did not seem functional at the leap-second insertion of 30th June 1997 so is by default disabled.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;PRECISION&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Currently set to &lt;tt&gt;-4&lt;/tt&gt;, but you may wish to set it to &lt;tt&gt;-5&lt;/tt&gt; if you are more conservative, or to &lt;tt&gt;-6&lt;/tt&gt; if you have particularly good experience with the clock and you live on the edge. Note that the &lt;tt&gt;flag3&lt;/tt&gt; fudge value will improve the reported dispersion one notch if clock signal quality is known good. So maybe just leave this alone.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;NSAMPLES&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Should be at least 3 to help smooth out sampling jitters. Can be more, but if made too long can make &lt;tt&gt;xntpd&lt;/tt&gt; overshoot on clock corrections and can hold onto bad samples longer than you would like. With this set to 4 and &lt;tt&gt;NKEEP&lt;/tt&gt; set to 3 this allows the occasional bad sample (in my experience less than 1 value in 10) to be dropped. (Note that there seems to be some sort of &amp;lsquo;beat&amp;rsquo; effect in the offset with a periodicity of about 7 samples as of this writing (1997/05/11) still under investigation; a filter of approximately this length should be able to almost completely suppress this effect.) Note that if the fudge-factor &lt;tt&gt;flag3&lt;/tt&gt; is set to 1, a larger &lt;tt&gt;NSAMPLES&lt;/tt&gt; is used.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;monitor-data&#34;&gt;Monitor Data&lt;/h4&gt;
&lt;p&gt;Each timecode is written to the &lt;tt&gt;clockstats&lt;/tt&gt; file with a signal quality value appended (&lt;code&gt;0&lt;/code&gt;-&lt;code&gt;5&lt;/code&gt; as reported by the clock, or &lt;code&gt;6&lt;/code&gt; for unknown).&lt;/p&gt;
&lt;p&gt;Each resync and result (plus gaining or losing MSF sync) is logged to the system log at level &lt;tt&gt;LOG_NOTICE&lt;/tt&gt;; note that each resync drains the unit&amp;rsquo;s batteries, so the syslog entry seems justified.&lt;/p&gt;
&lt;p&gt;Syslog entries are of the form:&lt;/p&gt;
&lt;pre&gt;May 10 10:15:24 oolong xntpd[615]: ARCRON: unit 0: sending resync command
May 10 10:17:32 oolong xntpd[615]: ARCRON: sync finished, signal quality 5: OK, will use clock
May 10 11:13:01 oolong xntpd[615]: ARCRON: unit 0: sending resync command
May 10 11:14:06 oolong xntpd[615]: ARCRON: sync finished, signal quality -1: UNKNOWN, will use clock anyway
May 10 11:41:49 oolong xntpd[615]: ARCRON: unit 0: sending resync command
May 10 11:43:57 oolong xntpd[615]: ARCRON: sync finished, signal quality 5: OK, will use clock
May 10 12:39:26 oolong xntpd[615]: ARCRON: unit 0: sending resync command
May 10 12:41:34 oolong xntpd[615]: ARCRON: sync finished, signal quality 3: OK, will use clock&lt;/pre&gt;
&lt;hr&gt;
&lt;h4 id=&#34;fudge-factors&#34;&gt;Fudge Factors&lt;/h4&gt;
&lt;dt&gt;&lt;tt&gt;time1 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the time offset calibration factor, in seconds and fraction, with default 0.0. On a Sun SparcStation 1 running SunOS 4.1.3_U1, with the receiver in London, a value of 0.020 (20ms) seems to be appropriate.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;time2 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Not currently used by this driver.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;stratum _number_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the driver stratum, in decimal from 0 to 15, with default 0. It is suggested that the clock be fudged to stratum 1 so that it is used as a backup time source rather than a primary when more accurate sources are available.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;refid _string_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the driver reference identifier, an ASCII string from one to four characters, with default &lt;tt&gt;MSFa&lt;/tt&gt;.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag1 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;(Modes 1-3) Not currently used by this driver.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag2 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Not currently used by this driver.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag3 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;If set to 1, better precision is reported (and thus lower dispersion) while clock&amp;rsquo;s received signal quality is known to be good.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag4 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;If set to 1, a longer-than-normal (8-stage rather than 4-stage) median filter is used, to provide some extra smoothing of clock output and reduction in jitter, at the cost of extra clock overshoot. Probably not advisable unless the server using this clock has other sources it can use to help mitigate the overshoot.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;additional-information&#34;&gt;Additional Information&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;/archives/3-5.93e/refclock&#34;&gt;Reference Clock Drivers&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://www2.exnet.com/NTP/ARC/ARC.html&#34;&gt;ARC Rugby MSF Receiver&lt;/a&gt; page&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Arcron MSF Receiver</title>
      <link>/archives/drivers/driver27/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/drivers/driver27/</guid>
      <description>
        
        
        &lt;p&gt;Last update: 21-Oct-2010 23:44 UTC&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver27/#synopsis&#34;&gt;Synopsis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver27/#description&#34;&gt;Description&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver27/#monitor-data&#34;&gt;Monitor Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver27/#fudge-factors&#34;&gt;Fudge Factors&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver27/#additional-information&#34;&gt;Additional Information&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;synopsis&#34;&gt;Synopsis&lt;/h4&gt;
&lt;p&gt;Address: 127.127.27.&lt;em&gt;u&lt;/em&gt;&lt;br&gt;
Reference ID: &lt;tt&gt;MSFa&lt;/tt&gt; / &lt;tt&gt;MSF&lt;/tt&gt; / &lt;tt&gt;DCF&lt;/tt&gt; / &lt;tt&gt;WWVB&lt;/tt&gt;&lt;br&gt;
Driver ID: &lt;tt&gt;MSF_ARCRON&lt;/tt&gt;&lt;br&gt;
Serial Port: &lt;tt&gt;/dev/arc_u_&lt;/tt&gt;; 300 baud, 8-bits, 2-stop, no parity&lt;br&gt;
Features: &lt;tt&gt;tty_clk&lt;/tt&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;description&#34;&gt;Description&lt;/h4&gt;
&lt;p&gt;This driver supports the Arcron MSF, DCF and WWVB receivers. The clock reports its ID as &amp;ldquo;&lt;tt&gt;MSFa&lt;/tt&gt;&#39;&#39;, &amp;ldquo;&lt;tt&gt;MSF&lt;/tt&gt;&#39;&#39;, &amp;ldquo;&lt;tt&gt;DCF&lt;/tt&gt;&#39;&#39; or &amp;ldquo;&lt;tt&gt;WWVB&lt;/tt&gt;&#39;&#39; to indicate the time source.&lt;/p&gt;
&lt;p&gt;This documentation describes v1.3 (2003/2/21) of the source and has been tested against ntpd 4.1.0 on linux x86. Changes from v1.1 and v1.2 include patches to work with the new ntp-4 code, clock support for DCF and WWVB configurable via mode flag, an option to ignore resync request (for those of us at the fringes of the WWVB signal, for instance), averaging of the signal quality poll and several bug fixes, code cleanup and standardizations. In all other respects, the driver works as per v1.1 if a mode is not specified.&lt;/p&gt;
&lt;p&gt;To use the alternate modes, the mode flag must be specified. If the mode flag is 0, or unspecified, the original MSF version is assumed. This should assure backwards compatibility and should not break existing setups.&lt;/p&gt;
&lt;p&gt;The previous documentation described version V1.1 (1997/06/23) of the source and had been tested (amongst others) against ntpd3-5.90 on Solaris-1 (SunOS 4.1.3_U1 on an SS1 serving as a router and firewall) and against ntpd3-5.90 on Solaris-2.5 (on a SS1+ and TurboSPARC 170MHz). That code will claimed increased stability, reduced jitter and more efficiency (fewer context switches) with the &lt;tt&gt;tty_clk&lt;/tt&gt; discipline/STREAMS module installed, but this has not been tested. For a to-do list see the comments at the start of the code.&lt;/p&gt;
&lt;p&gt;This code has been significantly slimmed down since the V1.0 version, roughly halving the memory footprint of its code and data.&lt;/p&gt;
&lt;p&gt;This driver is designed to allow the unit to run from batteries as designed, for something approaching the 2.5 years expected in the usual stand-alone mode, but no battery-life measurements have been taken.&lt;/p&gt;
&lt;p&gt;Much of this code is originally from the other refclock driver files with thanks. The code was originally made to work with the clock by &lt;a href=&#34;mailto:derek@toybox.demon.co.uk&#34;&gt;Derek Mulcahy&lt;/a&gt;, with modifications by &lt;a href=&#34;mailto:d@hd.org&#34;&gt;Damon Hart-Davis&lt;/a&gt;. Thanks also to &lt;a href=&#34;mailto:lyndond@sentinet.co.uk&#34;&gt;Lyndon David&lt;/a&gt; for some of the specifications of the clock. &lt;a href=&#34;mailto:palfille@partners.org&#34;&gt;Paul Alfille&lt;/a&gt; added support for the WWVB clock. &lt;a href=&#34;mailto:cprice@cs-home.com&#34;&gt;Christopher Price&lt;/a&gt; added enhanced support for the MSF, DCF and WWVB clocks.&lt;/p&gt;
&lt;p&gt;There is support for a Tcl/Tk monitor written by Derek Mulcahy that examines the output stats; see the &lt;a href=&#34;http://www2.exnet.com/NTP/ARC/ARC.html&#34;&gt;ARC Rugby MSF Receiver&lt;/a&gt; page for more details and the code.&lt;/p&gt;
&lt;p&gt;Look at the notes at the start of the code for further information; some of the more important details follow.&lt;/p&gt;
&lt;p&gt;The driver interrogates the clock at each poll (ie every 64s by default) for a timestamp. The clock responds at the start of the next second (with the start bit of the first byte being on-time). In the default or original MSF mode, the time is in `local&#39; format, including the daylight savings adjustment when it is in effect. The driver code converts the time back to UTC. In modes 1-3 the driver can be configured for UTC or local time depending on the setting of flag1.&lt;/p&gt;
&lt;p&gt;The clock claims to be accurate to within about 20ms of the broadcast time, and given the low data transmission speed from clock to host, and the fact that the clock is not in continuous sync with MSF, it seems sensible to set the `precision&#39; of this clock to -5 or -4, -4 being used in this code, which builds in a reported dispersion of over 63ms (ie says ``This clock is not very good.&#39;&#39;). You can improve the reported precision to -4 (and thus reduce the base dispersion to about 31ms) by setting the fudge &lt;tt&gt;flag3&lt;/tt&gt; to &lt;tt&gt;1&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Even a busy and slow IP link can yield lower dispersions than this from polls of primary time servers on the Internet, which reinforces the idea that this clock should be used as a backup in case of problems with such an IP link, or in the unfortunate event of failure of more accurate sources such as GPS.&lt;/p&gt;
&lt;p&gt;By default this clock reports itself to be at stratum 2 rather than the usual stratum 0 for a refclock, because it is not really suited to be used as other than a backup source. The stratum reported can be changed with the &lt;tt&gt;stratum&lt;/tt&gt; directive to be whatever you like. After careful monitoring of your clock, and appropriate choice of the &lt;tt&gt;time1&lt;/tt&gt; fudge factor to remove systematic errors in the clock&amp;rsquo;s reported time, you might fudge the clock to stratum 1 to allow a stratum-2 secondary server to sync to it.&lt;/p&gt;
&lt;p&gt;In default mode, the driver code arranges to resync the clock to MSF at intervals of a little less than an hour (deliberately avoiding the same time each hour to avoid any systematic problems with the signal or host). Whilst resyncing, the driver supplements the normal polls for time from the clock with polls for the reception signal quality reported by the clock. If the signal quality is too low (0&amp;ndash;2 out of a range of 0&amp;ndash;5), we chose not to trust the clock until the next resync (which we bring forward by about half an hour). If we don&amp;rsquo;t catch the resync, and so don&amp;rsquo;t know the signal quality, we do trust the clock (because this would generally be when the signal is very good and a resync happens quickly), but we still bring the next resync forward and reduce the reported precision (and thus increase reported dispersion).&lt;/p&gt;
&lt;p&gt;If we force resyncs to MSF too often we will needlessly exhaust the batteries the unit runs from. During clock resync this driver tries to take enough time samples to avoid &lt;tt&gt;ntpd&lt;/tt&gt; losing sync in case this clock is the current peer. By default the clock would only resync to MSF about once per day, which would almost certainly not be acceptable for NTP purposes.&lt;/p&gt;
&lt;p&gt;The driver does not force an immediate resync of the clock to MSF when it starts up to avoid excessive battery drain in case &lt;tt&gt;ntpd&lt;/tt&gt; is going to be repeatedly restarted for any reason, and also to allow enough samples of the clock to be taken for &lt;tt&gt;ntpd&lt;/tt&gt; to sync immediately to this clock (and not remain unsynchronised or to sync briefly to another configured peer, only to hop back in a few poll times, causing unnecessary disturbance). This behaviour should not cause problems because the driver will not accept the timestamps from the clock if the status flag delivered with the time code indicates that the last resync attempt was unsuccessful, so the initial timestamps will be close to reality, even if with up to a day&amp;rsquo;s clock drift in the worst case (the clock by default resyncs to MSF once per day).&lt;/p&gt;
&lt;p&gt;When alternate modes 1-3 are selected, the driver can be configured to ignore the resync requests by setting &lt;tt&gt;flag2&lt;/tt&gt; to 1. This allows clocks at the fringe of the signal to resync at night when signals are stronger.&lt;/p&gt;
&lt;p&gt;The clock has a peculiar RS232 arrangement where the transmit lines are powered from the receive lines, presumably to minimise battery drain. This arrangement has two consequences:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Your RS232 interface must drive both +ve and -ve&lt;/li&gt;
&lt;li&gt;You must (in theory) wait for an echo and a further 10ms between characters&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This driver, running on standard Sun and x86 hardware, seems to work fine; note the use of the &lt;tt&gt;send_slow()&lt;/tt&gt; routine to queue up command characters to be sent once every two seconds.&lt;/p&gt;
&lt;p&gt;Three commands are sent to the clock by this driver. Each command consists of a single letter (of which only the bottom four bits are significant), followed by a CR (ASCII 13). Each character sent to the clock should be followed by a delay to allow the unit to echo the character, and then by a further 10ms. Following the echo of the command string, there may be a response (ie in the case of the &lt;tt&gt;g&lt;/tt&gt; and &lt;tt&gt;o&lt;/tt&gt; commands below), which in the case of the &lt;tt&gt;o&lt;/tt&gt; command may be delayed by up to 1 second so as the start bit of the first byte of the response can arrive on time. The commands and their responses are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;tt&gt;g&lt;/tt&gt; CR&lt;/strong&gt;
Request for signal quality. Answer only valid during (late part of) resync to MSF signal. The response consists of two characters as follows:&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;First Bit Number&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;th&gt;Second Bit Number&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;parity&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;parity&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;td&gt;2&amp;ndash;0&lt;/td&gt;
&lt;td&gt;reception signal quality in the range 0&amp;ndash;5 (very poor to very good); if in the range 0&amp;ndash;2 no successful reception is to be expected. The reported value drops to zero when not resyncing, ie when first returned byte is not &lt;code&gt;3&lt;/code&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0 if no reception attempt at the moment; 1 if reception attempt (ie resync) in progress&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;tt&gt;h&lt;/tt&gt; CR&lt;/strong&gt;
Request to resync to signal. Can take up from about 30s to 360s. Drains batteries so should not be used excessively. After this the clock time and date should be correct and the phase within 20ms of time as transmitted from the source signal (remember to allow for propagation time). By default the clock resyncs once per day in the late evening/early morning (presumably to catch transitions to/from daylight saving time quickly). This driver code, by default, resyncs at least once per hour to minimise clock wander.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;tt&gt;o&lt;/tt&gt; CR&lt;/strong&gt;
Request timestamp. Start bit of first byte of response is on-time, so may be delayed up to 1 second. Note that the driver will convert time to GMT, if required. The response data is as follows:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;hours tens (hours range from 00 to 23)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;hours units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;minutes tens (minutes range from 00 to 59)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;minutes units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;seconds tens (seconds presumed to range from 00 to 60 to allow for leap second)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;seconds units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;day of week 1 (Monday) to 7 (Sunday)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;day of month tens (day ranges from 01 to 31)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;day of month units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;month tens (months range from 01 to 12)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;month units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;year tens (years range from 00 to 99)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;year units&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;BST/UTC status (Ignored in WWVB version)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Bit Number&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;parity&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;MSF: always 0&lt;br&gt; WWVB: Leap year indicator bit&lt;br&gt; 0 = non-leap year&lt;br&gt; 1 = leap year&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;MSF: 1 if UTC is in effect (reverse of bit 1)&lt;br&gt; WWVB: Leap second warning bit&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;MSF: 1 if BST is in effect (reverse of bit 2)&lt;br&gt; WWVB: 0 if ST is in effect&lt;br&gt; 1 if DST is in effect&lt;br&gt; 1 if transition from ST with bit 0 is set to 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;MSF: 1 if BST/UTC change pending&lt;br&gt; WWVB: 0 if ST is in effect&lt;br&gt; 1 if DST is in effect&lt;br&gt; 0 if transition from DST with bit 1 is set to 0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ol start=&#34;15&#34;&gt;
&lt;li&gt;clock status&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Bit Number&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;parity&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;always 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;always 1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1&lt;/code&gt; if low battery is detected&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1&lt;/code&gt; if last resync failed (though officially undefined for the MSF clock, officially defined for WWVB)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1&lt;/code&gt; if at least one reception attempt was successful&lt;br&gt; MSF: since 0230&lt;br&gt; DCF: since 0300&lt;br&gt; WWVB: resets if not successful between 0300-0400&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;&lt;code&gt;1&lt;/code&gt; if the clock has valid time&amp;mdash;reset to zero when clock is reset (eg at power-up), and set to 1 after first successful resync attempt.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The driver only accepts time from the clock if the bottom three bits of the status byte are &lt;tt&gt;011&lt;/tt&gt; or &lt;tt&gt;flag2&lt;/tt&gt; is set to 1 to ignore resync requests. For the MSF clock, if the UK parliament decides to move us to +0100/+0200 time as opposed to the current +0000/+0100 time, it is not clear what effect that will have on the time broadcast by MSF, and therefore on this driver&amp;rsquo;s usefulness.&lt;/p&gt;
&lt;p&gt;A typical &lt;tt&gt;ntp.conf&lt;/tt&gt; configuration file for this driver might be:&lt;/p&gt;
&lt;pre&gt;# hostname(n) means we expect (n) to be the stratum at which hostname runs.

#------------------------------------------------------------------------------
# SYNCHRONISATION PARTNERS
# ========================

# Default configuration (Original MSF mode)s...
server 127.127.27.0 mode 333 # ARCRON MSF radio clock
# Fudge stratum and other features as required.
# ADJUST time1 VALUE FOR YOUR HOST, CLOCK AND LOCATION!
fudge 127.127.27.0 stratum 1 time1 0.016 flag3 1
# WWVB users should change that line to:
server 127.127.27.0 mode 3 # ARCRON WWVB radio clock
fudge 127.127.27.0 stratum 1 time1 0.030 flag1 1 flag3 1

peer 11.22.33.9 # tick(1--2).
peer 11.22.33.4 # tock(3), boot/NFS server.

# This shouldn&#39;t get swept away unless left untouched for a long time.
driftfile /var/tmp/ntp.drift

#------------------------------------------------------------------------------
# RESTRICTIONS
# ============

# By default, don&#39;t trust and don&#39;t allow modifications.  Ignore in fact.
restrict default ignore notrust nomodify

# Allow others in our subnet to check us out...
restrict 11.22.33.0 mask 255.255.255.0 nomodify notrust

# Trust our peers for time.  Don&#39;t trust others in case they are insane.
restrict 127.127.27.0 nomodify
restrict 11.22.33.4 nomodify
restrict 11.22.33.9 nomodify

# Allow anything from the local host.
restrict 127.0.0.1&lt;/pre&gt;
&lt;p&gt;There are a few &lt;tt&gt;#define&lt;/tt&gt;s in the code that you might wish to play with:&lt;/p&gt;
&lt;dl&gt;
&lt;dt&gt;&lt;tt&gt;ARCRON_KEEN&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;With this defined, the code is relatively trusting of the clock, and assumes that you will have the clock as one of a few time sources, so will bend over backwards to use the time from the clock when available and avoid &lt;tt&gt;ntpd&lt;/tt&gt; dropping sync from the clock where possible. You may wish to undefine this, especially if you have better sources of time or your reception is ropey. However, there are many checks built in even with this flag defined.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;ARCRON_MULTIPLE_SAMPLES&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;When is defined, we regard each character in the returned timecode as at a known delay from the start of the second, and use the smallest (most negative) offset implied by any such character, ie with the smallest kernel-induced display, and use that. This helps to reduce jitter and spikes.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;ARCRON_LEAPSECOND_KEEN&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;When is defined, we try to do a resync to MSF as soon as possible in the first hour of the morning of the first day of the first and seventh months, ie just after a leap-second insertion or deletion would happen if it is going to. This should help compensate for the fact that this clock does not continuously sample MSF, which compounds the fact that MSF itself gives no warning of an impending leap-second event. This code did not seem functional at the leap-second insertion of 30th June 1997 so is by default disabled.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;PRECISION&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Currently set to &lt;tt&gt;-4&lt;/tt&gt;, but you may wish to set it to &lt;tt&gt;-5&lt;/tt&gt; if you are more conservative, or to &lt;tt&gt;-6&lt;/tt&gt; if you have particularly good experience with the clock and you live on the edge. Note that the &lt;tt&gt;flag3&lt;/tt&gt; fudge value will improve the reported dispersion one notch if clock signal quality is known good. So maybe just leave this alone.&lt;/dd&gt;
&lt;/dl&gt;
&lt;hr&gt;
&lt;h4 id=&#34;monitor-data&#34;&gt;Monitor Data&lt;/h4&gt;
&lt;p&gt;Each timecode is written to the &lt;tt&gt;clockstats&lt;/tt&gt; file with a signal quality value appended (&lt;code&gt;0&lt;/code&gt;-&lt;code&gt;5&lt;/code&gt; as reported by the clock, or &lt;code&gt;6&lt;/code&gt; for unknown).&lt;/p&gt;
&lt;p&gt;Each resync and result (plus gaining or losing MSF sync) is logged to the system log at level &lt;tt&gt;LOG_NOTICE&lt;/tt&gt;; note that each resync drains the unit&amp;rsquo;s batteries, so the syslog entry seems justified.&lt;/p&gt;
&lt;p&gt;Syslog entries are of the form:&lt;/p&gt;
&lt;pre&gt;May 10 10:15:24 oolong ntpd[615]: ARCRON: unit 0: sending resync command
May 10 10:17:32 oolong ntpd[615]: ARCRON: sync finished, signal quality 5: OK, will use clock
May 10 11:13:01 oolong ntpd[615]: ARCRON: unit 0: sending resync command
May 10 11:14:06 oolong ntpd[615]: ARCRON: sync finished, signal quality -1: UNKNOWN, will use clock anyway
May 10 11:41:49 oolong ntpd[615]: ARCRON: unit 0: sending resync command
May 10 11:43:57 oolong ntpd[615]: ARCRON: sync finished, signal quality 5: OK, will use clock
May 10 12:39:26 oolong ntpd[615]: ARCRON: unit 0: sending resync command
May 10 12:41:34 oolong ntpd[615]: ARCRON: sync finished, signal quality 3: OK, will use clock&lt;/pre&gt;
&lt;hr&gt;
&lt;h4 id=&#34;fudge-factors&#34;&gt;Fudge Factors&lt;/h4&gt;
&lt;dl&gt;
&lt;dt&gt;&lt;tt&gt;mode 0 | 1 | 2 | 3&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Specifies the clock hardware model. This parameter is optional, it defaults to the original mode of operation.&lt;/dd&gt;
&lt;dd&gt;Supported modes of operation:&lt;/dd&gt;
&lt;dd&gt;0 - Default, Original MSF&lt;/dd&gt;
&lt;dd&gt;1 - Updated MSF&lt;/dd&gt;
&lt;dd&gt;2 - New DCF77&lt;/dd&gt;
&lt;dd&gt;3 - New WWVB&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;time1 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Specifies the time offset calibration factor, in seconds and fraction, with default 0.0. On a Sun SparcStation 1 running SunOS 4.1.3_U1, with the receiver in London, a value of 0.020 (20ms) seems to be appropriate.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;time2 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Not currently used by this driver.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;stratum _number_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Specifies the driver stratum, in decimal from 0 to 15, with default 2. It is suggested that the clock be not be fudged higher than stratum 1 so that it is used a backup time source rather than a primary when more accurate sources are available.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;refid _string_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Specifies the driver reference identifier, an ASCII string from one to four characters, with default &lt;tt&gt;MSFa&lt;/tt&gt;. When used in modes 1-3, the driver will report either &lt;tt&gt;MSF&lt;/tt&gt;, &lt;tt&gt;DCF&lt;/tt&gt;, or &lt;tt&gt;WWVB&lt;/tt&gt; respectively.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag1 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;(Modes 1-3) If set to 0 (the default), the clock is set to UTC time. If set to 1, the clock is set to localtime.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag2 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;(Modes 1-3) If set to 0 (the default), the clock will be forced to resync approximately every hour. If set to 1, the clock will resync per normal operations (approximately midnight).&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag3 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;If set to 1, better precision is reported (and thus lower dispersion) while clock&#39;s received signal quality is known to be good.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag4 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Not used by this driver.&lt;/dd&gt;
&lt;/dl&gt;
&lt;hr&gt;
&lt;h4 id=&#34;additional-information&#34;&gt;Additional Information&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;/archives/4.2.8-series/refclock&#34;&gt;Reference Clock Drivers&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;http://www2.exnet.com/NTP/ARC/ARC.html&#34;&gt;ARC Rugby MSF Receiver&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Association Management</title>
      <link>/archives/4.1.0/assoc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.0/assoc/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice51.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Make sure who your friends are.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/assoc/#association-modes&#34;&gt;Association Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/assoc/#clientserver-mode&#34;&gt;Client/Server Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/assoc/#symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/assoc/#broadcast-mode&#34;&gt;Broadcast Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/assoc/#ip-multicast-support&#34;&gt;IP Multicast Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/assoc/#multicasting&#34;&gt;Multicasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/assoc/#manycasting&#34;&gt;Manycasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/assoc/#burst-modes&#34;&gt;Burst Modes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;association-modes&#34;&gt;Association Modes&lt;/h4&gt;
&lt;p&gt;NTP Version 4 (NTPv4) incorporates new features and refinements to the NTP Version 3 (NTPv3) algorithms; however, it continues the tradition of backwards compatibility with older versions. A number of new operating modes for automatic server discovery and improved accuracy in occasionally connected networks are provided. Following is an overview of the new features; additional information is available on the &lt;a href=&#34;/archives/4.1.0/confopt&#34;&gt;Configuration Options&lt;/a&gt; and &lt;a href=&#34;/archives/4.1.0/authopt&#34;&gt;Authentication Options&lt;/a&gt; pages and in the papers, reports, memoranda and briefings at &lt;a href=&#34;http://www.ntp.org&#34;&gt;www.ntp.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are two types of associations: persistent associations, which result from configuration file commands, and ephemeral associations, which result from protocol operations described below. A persistent association is never demobilized, although it may become dormant when the associated server becomes unreachable. An ephemeral association is mobilized when a message arrives from a server; for instance, a symmetric passive association is mobilized upon arrival of a symmetric active message. A broadcast client association is mobilized upon arrival of a broadcast server message, while a manycast client association is mobilized upon arrival of a manycast server message.&lt;/p&gt;
&lt;p&gt;Ordinarily, successful mobilization of an ephemeral association requires the server to be cryptographically authenticated to the dependent client. This can be done using either symmetric-key or public-key cryptography, as described in the &lt;a href=&#34;/archives/4.1.0/authopt&#34;&gt;Authentication Options&lt;/a&gt; page. The cryptographic means insure an unbroken chain of trust between the dependent client and the primary servers at the root of the synchronization subnet. We call this chain the &lt;em&gt;provenance&lt;/em&gt; of the client and define new vocabulary as to proventicate a client or provide proventic credentials. Once mobilized, ephemeral associations are demobilized when either (a) the server becomes unreachable or (b) the server refreshes the key media without notifying the client.&lt;/p&gt;
&lt;p&gt;There are three principal modes of operation: client/server, symmetric active/passive and broadcast. In addition, there are two modes using IP multicast support: multicast and manycast. These modes are selected based on the scope of service, intended flow of time and proventic values and means of configuration. Following is a summary of the operations in each mode.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;clientserver-mode&#34;&gt;Client/Server Mode&lt;/h4&gt;
&lt;p&gt;Client/server mode is probably the most common configuration in the Internet today. It operates in the classic remote-procedure-call (RPC) paradigm with stateless servers. In this mode a client sends a request to the server and expects a reply at some future time. In some contexts this would be described as a &amp;ldquo;pull&amp;rdquo; operation, in that the client pulls the time and proventic values from the server. A client is configured in client mode using the &lt;tt&gt;server&lt;/tt&gt; (sic) command and specifying the server IPv4 or IPv6 DNS name or address; the server requires no prior configuration. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme. In addition, two burst modes described below can be used in appropriate cases.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/h4&gt;
&lt;p&gt;Symmetric active/passive mode is intended for configurations where a clique of low-stratum peers operate as mutual backups for each other. Each peer operates with one or more primary reference sources, such as a radio clock, or a subset of secondary servers known to be reliable and proventicated. Should one of the peers lose all reference sources or simply cease operation, the other peers will automatically reconfigure so that time and proventication values can flow from the surviving peers to all the others in the clique. In some contexts this would be described as a &amp;ldquo;push-pull&amp;rdquo; operation, in that the peer either pulls or pushes the time and proventic values depending on the particular configuration.&lt;/p&gt;
&lt;p&gt;Symmetric peers operate with their sources in some NTP mode and with each other in symmetric mode. A peer is configured in symmetric active mode using the &lt;tt&gt;peer&lt;/tt&gt; command and specifying the other peer DNS name or address. The other peer can also be configured in symmetric active mode in a similar way. However, if the other peer is not specifically configured in this way, a symmetric passive association is mobilized upon arrival of a symmetric active message. Since an intruder can impersonate a symmetric active peer and inject false time values, symmetric mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;broadcast-mode&#34;&gt;Broadcast Mode&lt;/h4&gt;
&lt;p&gt;Broadcast mode is intended for configurations involving one or a few servers and a possibly very large client population. A broadcast server is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command and a local subnet address. A broadcast client is configured using the &lt;tt&gt;broadcastclient&lt;/tt&gt; command, in which case it responds to broadcast messages received on any interface. Since an intruder can impersonate a broadcast server and inject false time values, this mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;p&gt;The server generates broadcast messages continuously at intervals specified by the &lt;tt&gt;minpoll&lt;/tt&gt; keyword and with a time-to-live span specified by the &lt;tt&gt;ttl&lt;/tt&gt; keyword. A NTPv4 broadcast client responds to the first proventicated message received by waiting a short interval randomized over the &lt;tt&gt;minpoll&lt;/tt&gt; interval, in order to avoid implosion at the server. Then, the client polls the server in burst mode in order to reliably set the host clock and validate the source. This normally results in a volley of eight client/server cycles over a 30-s interval during which both the synchronization and cryptographic protocols run concurrently. When the next broadcast message is received after the volley, the client computes the offset between the apparent broadcast time and the (unicast) client time. This offset is used to compensate for the propagation time between the broadcast server and client. Once the offset is computed, the server continues as before and the client sends no further messages.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;ip-multicast-support&#34;&gt;IP Multicast Support&lt;/h4&gt;
&lt;p&gt;Broadcast mode in both NTPv3 and NTPv4 is limited to directly connected subnets such as Ethernets which support broadcast technology. Ordinarily, this technology does not operate beyond the first hop router or gateway. Where service is intended beyond the local subnet, IP multicasting can be used where supported by the operating system and the routers support the Internet Group Management Protocol (IGMP). Most current kernels and available routers do support IP multicast technology, although service providers are sometimes reluctant to deploy it.&lt;/p&gt;
&lt;p&gt;A general discussion of IP multicast technology is beyond the scope here. In simple terms a host or router sending to a IP multicast group (class D) address expects all hosts or routers listening on this address to receive the message. There is no intrinsic limit on the number of senders or receivers and senders can be receivers and vice versa. The IANA has assigned multicast group address 224.0.1.1 to NTP, but this address should be used only where the multicast span can be reliably constrained to protect neighbor networks. In general, administratively scoped group addresses should be used, as described in RFC-2365, or GLOP group addresses, as described in RFC-2770.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;multicasting&#34;&gt;Multicasting&lt;/h4&gt;
&lt;p&gt;IP multicasting can be used to extend the scope of a timekeeping subnet in two ways: multicasting and manycasting. A multicast client is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command, but with a multicast group (class D) address instead of a local subnet broadcast address. However, there is a subtle difference between broadcasting and multicasting. Broadcasting is specific to each interface and local subnet address. If more than one interface is attached to a machine, a separate &lt;tt&gt;broadcast&lt;/tt&gt; command applies to each one separately. This provides a way to limit exposure in a firewall, for example.&lt;/p&gt;
&lt;p&gt;IP multicasting is a different paradigm. A multicast message has the same format as a broadcast message and is configured with the same &lt;tt&gt;broadcast&lt;/tt&gt; command, but with a multicast group address instead of a local subnet address. By design, multicast messages travel from the sender via a shortest-path or shared tree to the receivers, which may require these messages emit from one or all interfaces, but carry a common source address. However, it is possible to configure multiple multicast group addresses using multiple &lt;tt&gt;broadcast&lt;/tt&gt; commands. Other than these particulars, multicast messages are processed just like broadcast messages. Note that the calibration feature in broadcast mode is extremely important, since IP multicast messages can travel far different paths through the IP routing fabric than ordinary IP unicast messages.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;manycasting&#34;&gt;Manycasting&lt;/h4&gt;
&lt;p&gt;Manycasting is a automatic discovery and configuration paradigm new to NTPv4. It is intended as a means for a multicast client to troll the nearby network neighborhood to find cooperating manycast servers, validate them using cryptographic means and evaluate their time values with respect to other servers that might be lurking in the vicinity. The intended result is that each manycast client mobilizes client associations with the &amp;ldquo;best&amp;rdquo; three of the available manycast servers, yet automatically reconfigures to sustain this number of servers should one or another fail.&lt;/p&gt;
&lt;p&gt;Note that the manycasting paradigm does not coincide with the anycasting paradigm described in RFC-1546, which is designed to find a single server from a clique of servers providing the same service. The manycasting paradigm is designed to find a plurality of redundant servers, in this case willing NTP servers.&lt;/p&gt;
&lt;p&gt;A persistent manycast client association is configured using the &lt;tt&gt;server&lt;/tt&gt; command, but with a multicast (class D) group address instead of an ordinary IP (class A, B, C) address. It sends client mode messages to this address at the maximum feasible poll interval and minimum feasible time-to-live hops, depending on how many servers have already been found. There can be as many manycast client associations as different group addresses, each one serving as a template for a future ephemeral client/server mode association.&lt;/p&gt;
&lt;p&gt;Manycast servers configured with the &lt;tt&gt;manycastserver&lt;/tt&gt; command listen on the specified group address for manycast client messages. Note the distinction between manycast client, which is configured with a &lt;tt&gt;server&lt;/tt&gt; command, and manycast server, which is configured with a &lt;tt&gt;manycastserver&lt;/tt&gt; command. If a manycast server is in range of the current time-to-live and is itself synchronized to a valid source and operating at a stratum level equal to or lower than the manycast client, it replies to the manycast client message with an ordinary server mode message.&lt;/p&gt;
&lt;p&gt;The manycast client receiving this message mobilizes an ephemeral client association as in ordinary client/server mode according to the matching manycast client template. Then, the client polls the server at its unicast address in burst mode in order to reliably set the host clock and validate the source. This normally results in a volley of eight client/server cycles over a 30-s interval during which both the synchronization and cryptographic protocols run concurrently. Following the volley, the client runs the NTP intersection and clustering algorithms, which act to discard all but the best three associations. The surviving associations then continue in ordinary client/server mode.&lt;/p&gt;
&lt;p&gt;The manycast client polling program is designed to reduce as much as possible the volume of messages and the effects of implosion due to near-simultaneous arrival of manycast server messages. The program uses a poll interval eight times the system poll interval, which starts out at the &lt;tt&gt;minpoll&lt;/tt&gt; value and under normal circumstances increases gradually to the &lt;tt&gt;maxpolll&lt;/tt&gt; value. Initially, the time-to-live is set at one hop. At each retransmission the time-to-live is incremented by one until at least three manycast servers are found. Further retransmissions use the same time-to-live value.&lt;/p&gt;
&lt;p&gt;If less than three servers are found when the time-to-live has reached the maximum specified by the &lt;tt&gt;ttl&lt;/tt&gt; keyword, the poll interval is doubled. For each transmission after that, the poll interval is doubled again until reaching the maximum of eight times the value specified by the &lt;tt&gt;maxpoll&lt;/tt&gt; keyword. Further transmissions use the same poll interval and time-to-live values.&lt;/p&gt;
&lt;p&gt;The above scenario happens for each manycast client message, which repeats at the designated poll interval. However, once the ephemeral client association is mobilized, subsequent manycast server replies are discarded, since they will fail the message digest test. If during a poll interval the number of client associations falls below three, all manycast client prototype associations are reset to the initial poll interval and time-to-live values and operation resumes from the beginning. It is important in manycast mode to avoid frequent manycast client messages, since each one requires all manycast servers in range to respond. The result could well be an implosion, either minor or major, depending on the number of servers in range. The recommended value for &lt;tt&gt;maxpoll&lt;/tt&gt; is 12 (4,096 s) and for &lt;tt&gt;ttl&lt;/tt&gt; is 7.&lt;/p&gt;
&lt;p&gt;It is possible and frequently useful to configure a host as both a manycast client and manycast server. A number of hosts configured this way and sharing a common group address will automatically organize themselves in an optimum configuration based on the smallest synchronization distance computed by the NTP mitigation algorithms. For example, consider an NTP subnet of two primary servers and maybe a dozen dependent clients. All servers and clients are configured as both multicast client and multicast server with multicast group address 239.1.1.1. In addition, the primary servers are configured for a primary reference source such as a GPS receiver. Once operations have stabilized in this scenario, the primary servers will affiliate with the primary reference source and each other, since they both operate at the same stratum (1), but not with any client, since clients operate at a higher stratum. The clients will find both primary servers and in addition, one of their own at the minimum synchronization distance. If one of the primary servers loses its GPS receiver, it will continue to operate as a client and other clients will time out the corresponding association and re-associate accordingly.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;burst-modes&#34;&gt;Burst Modes&lt;/h4&gt;
&lt;p&gt;There are two burst modes that can be enabled in client/server mode using the &lt;tt&gt;iburst&lt;/tt&gt; and &lt;tt&gt;burst&lt;/tt&gt; keywords. In either mode a single poll initiates a burst of eight client messages at intervals randomized over the range 1-4 s. However, the interval between the first and second messages is increased to about 16 s in order for a dialup modem to complete a call, if necessary. Received server messages update the NTPv4 clock filter, which selects the best (most accurate) time values. When the last client message in the burst is sent, the next received server message updates the system variables and sets the system clock in the usual manner, as if only a single client/server cycle had occurred. The result is not only a rapid and reliable setting of the system clock, but a considerable reduction in network jitter.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;iburst&lt;/tt&gt; keyword can be configured for cases where it is important to set the clock quickly when an association is first mobilized or first becomes reachable or when the network attachment requires an initial calling or training procedure. The burst is initiated only when the server first becomes reachable and results in good accuracy with intermittent connections typical of PPP and ISDN services. Outlyers due to initial dial-up delays, etc., are avoided and the client sets the clock within 30 s after the first message.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;burst&lt;/tt&gt; keyword can be configured in cases of excessive network jitter or when the network attachment requires an initial calling or training procedure. The burst is initiated at each poll interval when the server is reachable. The burst does produce additional network overhead and can cause trouble if used indiscriminately. It should only be used where the poll interval is expected to settle to values at or above 1024 s.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Association Management</title>
      <link>/archives/4.1.1/assoc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.1/assoc/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice51.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Make sure who your friends are.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/assoc/#association-modes&#34;&gt;Association Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/assoc/#clientserver-mode&#34;&gt;Client/Server Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/assoc/#symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/assoc/#broadcast-mode&#34;&gt;Broadcast Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/assoc/#ip-multicast-support&#34;&gt;IP Multicast Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/assoc/#multicasting&#34;&gt;Multicasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/assoc/#manycasting&#34;&gt;Manycasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/assoc/#burst-modes&#34;&gt;Burst Modes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;association-modes&#34;&gt;Association Modes&lt;/h4&gt;
&lt;p&gt;NTP Version 4 (NTPv4) incorporates new features and refinements to the NTP Version 3 (NTPv3) algorithms; however, it continues the tradition of backwards compatibility with older versions. A number of new operating modes for automatic server discovery and improved accuracy in occasionally connected networks are provided. Following is an overview of the new features; additional information is available on the &lt;a href=&#34;/archives/4.1.1/confopt&#34;&gt;Configuration Options&lt;/a&gt; and &lt;a href=&#34;/archives/4.1.1/authopt&#34;&gt;Authentication Options&lt;/a&gt; pages and in the papers, reports, memoranda and briefings at &lt;a href=&#34;http://www.ntp.org&#34;&gt;www.ntp.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are two types of associations: persistent associations, which result from configuration file commands, and ephemeral associations, which result from protocol operations described below. A persistent association is never demobilized, although it may become dormant when the associated server becomes unreachable. An ephemeral association is mobilized when a message arrives from a server; for instance, a symmetric passive association is mobilized upon arrival of a symmetric active message. A broadcast client association is mobilized upon arrival of a broadcast server message, while a manycast client association is mobilized upon arrival of a manycast server message.&lt;/p&gt;
&lt;p&gt;Ordinarily, successful mobilization of an ephemeral association requires the server to be cryptographically authenticated to the dependent client. This can be done using either symmetric-key or public-key cryptography, as described in the &lt;a href=&#34;/archives/4.1.1/authopt&#34;&gt;Authentication Options&lt;/a&gt; page. The cryptographic means insure an unbroken chain of trust between the dependent client and the primary servers at the root of the synchronization subnet. We call this chain the &lt;em&gt;provenance&lt;/em&gt; of the client and define new vocabulary as to proventicate a client or provide proventic credentials. Once mobilized, ephemeral associations are demobilized when either (a) the server becomes unreachable or (b) the server refreshes the key media without notifying the client.&lt;/p&gt;
&lt;p&gt;There are three principal modes of operation: client/server, symmetric active/passive and broadcast. In addition, there are two modes using IP multicast support: multicast and manycast. These modes are selected based on the scope of service, intended flow of time and proventic values and means of configuration. Following is a summary of the operations in each mode.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;clientserver-mode&#34;&gt;Client/Server Mode&lt;/h4&gt;
&lt;p&gt;Client/server mode is probably the most common configuration in the Internet today. It operates in the classic remote-procedure-call (RPC) paradigm with stateless servers. In this mode a client sends a request to the server and expects a reply at some future time. In some contexts this would be described as a &amp;ldquo;pull&amp;rdquo; operation, in that the client pulls the time and proventic values from the server. A client is configured in client mode using the &lt;tt&gt;server&lt;/tt&gt; (sic) command and specifying the server IPv4 or IPv6 DNS name or address; the server requires no prior configuration. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme. In addition, two burst modes described below can be used in appropriate cases.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/h4&gt;
&lt;p&gt;Symmetric active/passive mode is intended for configurations where a clique of low-stratum peers operate as mutual backups for each other. Each peer operates with one or more primary reference sources, such as a radio clock, or a subset of secondary servers known to be reliable and proventicated. Should one of the peers lose all reference sources or simply cease operation, the other peers will automatically reconfigure so that time and proventication values can flow from the surviving peers to all the others in the clique. In some contexts this would be described as a &amp;ldquo;push-pull&amp;rdquo; operation, in that the peer either pulls or pushes the time and proventic values depending on the particular configuration.&lt;/p&gt;
&lt;p&gt;Symmetric peers operate with their sources in some NTP mode and with each other in symmetric mode. A peer is configured in symmetric active mode using the &lt;tt&gt;peer&lt;/tt&gt; command and specifying the other peer DNS name or address. The other peer can also be configured in symmetric active mode in a similar way. However, if the other peer is not specifically configured in this way, a symmetric passive association is mobilized upon arrival of a symmetric active message. Since an intruder can impersonate a symmetric active peer and inject false time values, symmetric mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;broadcast-mode&#34;&gt;Broadcast Mode&lt;/h4&gt;
&lt;p&gt;Broadcast mode is intended for configurations involving one or a few servers and a possibly very large client population. A broadcast server is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command and a local subnet address. A broadcast client is configured using the &lt;tt&gt;broadcastclient&lt;/tt&gt; command, in which case it responds to broadcast messages received on any interface. Since an intruder can impersonate a broadcast server and inject false time values, this mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;p&gt;The server generates broadcast messages continuously at intervals specified by the &lt;tt&gt;minpoll&lt;/tt&gt; keyword and with a time-to-live span specified by the &lt;tt&gt;ttl&lt;/tt&gt; keyword. A NTPv4 broadcast client responds to the first proventicated message received by waiting a short interval randomized over the &lt;tt&gt;minpoll&lt;/tt&gt; interval, in order to avoid implosion at the server. Then, the client polls the server in burst mode in order to reliably set the host clock and validate the source. This normally results in a volley of eight client/server cycles over a 30-s interval during which both the synchronization and cryptographic protocols run concurrently. When the next broadcast message is received after the volley, the client computes the offset between the apparent broadcast time and the (unicast) client time. This offset is used to compensate for the propagation time between the broadcast server and client. Once the offset is computed, the server continues as before and the client sends no further messages.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;ip-multicast-support&#34;&gt;IP Multicast Support&lt;/h4&gt;
&lt;p&gt;Broadcast mode in both NTPv3 and NTPv4 is limited to directly connected subnets such as Ethernets which support broadcast technology. Ordinarily, this technology does not operate beyond the first hop router or gateway. Where service is intended beyond the local subnet, IP multicasting can be used where supported by the operating system and the routers support the Internet Group Management Protocol (IGMP). Most current kernels and available routers do support IP multicast technology, although service providers are sometimes reluctant to deploy it.&lt;/p&gt;
&lt;p&gt;A general discussion of IP multicast technology is beyond the scope here. In simple terms a host or router sending to a IP multicast group (class D) address expects all hosts or routers listening on this address to receive the message. There is no intrinsic limit on the number of senders or receivers and senders can be receivers and vice versa. The IANA has assigned multicast group address 224.0.1.1 to NTP, but this address should be used only where the multicast span can be reliably constrained to protect neighbor networks. In general, administratively scoped group addresses should be used, as described in RFC-2365, or GLOP group addresses, as described in RFC-2770.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;multicasting&#34;&gt;Multicasting&lt;/h4&gt;
&lt;p&gt;IP multicasting can be used to extend the scope of a timekeeping subnet in two ways: multicasting and manycasting. A multicast client is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command, but with a multicast group (class D) address instead of a local subnet broadcast address. However, there is a subtle difference between broadcasting and multicasting. Broadcasting is specific to each interface and local subnet address. If more than one interface is attached to a machine, a separate &lt;tt&gt;broadcast&lt;/tt&gt; command applies to each one separately. This provides a way to limit exposure in a firewall, for example.&lt;/p&gt;
&lt;p&gt;IP multicasting is a different paradigm. A multicast message has the same format as a broadcast message and is configured with the same &lt;tt&gt;broadcast&lt;/tt&gt; command, but with a multicast group address instead of a local subnet address. By design, multicast messages travel from the sender via a shortest-path or shared tree to the receivers, which may require these messages emit from one or all interfaces, but carry a common source address. However, it is possible to configure multiple multicast group addresses using multiple &lt;tt&gt;broadcast&lt;/tt&gt; commands. Other than these particulars, multicast messages are processed just like broadcast messages. Note that the calibration feature in broadcast mode is extremely important, since IP multicast messages can travel far different paths through the IP routing fabric than ordinary IP unicast messages.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;manycasting&#34;&gt;Manycasting&lt;/h4&gt;
&lt;p&gt;Manycasting is a automatic discovery and configuration paradigm new to NTPv4. It is intended as a means for a multicast client to troll the nearby network neighborhood to find cooperating manycast servers, validate them using cryptographic means and evaluate their time values with respect to other servers that might be lurking in the vicinity. The intended result is that each manycast client mobilizes client associations with the &amp;ldquo;best&amp;rdquo; three of the available manycast servers, yet automatically reconfigures to sustain this number of servers should one or another fail.&lt;/p&gt;
&lt;p&gt;Note that the manycasting paradigm does not coincide with the anycasting paradigm described in RFC-1546, which is designed to find a single server from a clique of servers providing the same service. The manycasting paradigm is designed to find a plurality of redundant servers, in this case willing NTP servers.&lt;/p&gt;
&lt;p&gt;A persistent manycast client association is configured using the &lt;tt&gt;server&lt;/tt&gt; command, but with a multicast (class D) group address instead of an ordinary IP (class A, B, C) address. It sends client mode messages to this address at the maximum feasible poll interval and minimum feasible time-to-live hops, depending on how many servers have already been found. There can be as many manycast client associations as different group addresses, each one serving as a template for a future ephemeral client/server mode association.&lt;/p&gt;
&lt;p&gt;Manycast servers configured with the &lt;tt&gt;manycastserver&lt;/tt&gt; command listen on the specified group address for manycast client messages. Note the distinction between manycast client, which is configured with a &lt;tt&gt;server&lt;/tt&gt; command, and manycast server, which is configured with a &lt;tt&gt;manycastserver&lt;/tt&gt; command. If a manycast server is in range of the current time-to-live and is itself synchronized to a valid source and operating at a stratum level equal to or lower than the manycast client, it replies to the manycast client message with an ordinary server mode message.&lt;/p&gt;
&lt;p&gt;The manycast client receiving this message mobilizes an ephemeral client association as in ordinary client/server mode according to the matching manycast client template. Then, the client polls the server at its unicast address in burst mode in order to reliably set the host clock and validate the source. This normally results in a volley of eight client/server cycles over a 30-s interval during which both the synchronization and cryptographic protocols run concurrently. Following the volley, the client runs the NTP intersection and clustering algorithms, which act to discard all but the best three associations. The surviving associations then continue in ordinary client/server mode.&lt;/p&gt;
&lt;p&gt;The manycast client polling program is designed to reduce as much as possible the volume of messages and the effects of implosion due to near-simultaneous arrival of manycast server messages. The program uses a poll interval eight times the system poll interval, which starts out at the &lt;tt&gt;minpoll&lt;/tt&gt; value and under normal circumstances increases gradually to the &lt;tt&gt;maxpolll&lt;/tt&gt; value. Initially, the time-to-live is set at one hop. At each retransmission the time-to-live is incremented by one until at least three manycast servers are found. Further retransmissions use the same time-to-live value.&lt;/p&gt;
&lt;p&gt;If less than three servers are found when the time-to-live has reached the maximum specified by the &lt;tt&gt;ttl&lt;/tt&gt; keyword, the poll interval is doubled. For each transmission after that, the poll interval is doubled again until reaching the maximum of eight times the value specified by the &lt;tt&gt;maxpoll&lt;/tt&gt; keyword. Further transmissions use the same poll interval and time-to-live values.&lt;/p&gt;
&lt;p&gt;The above scenario happens for each manycast client message, which repeats at the designated poll interval. However, once the ephemeral client association is mobilized, subsequent manycast server replies are discarded, since they will fail the message digest test. If during a poll interval the number of client associations falls below three, all manycast client prototype associations are reset to the initial poll interval and time-to-live values and operation resumes from the beginning. It is important in manycast mode to avoid frequent manycast client messages, since each one requires all manycast servers in range to respond. The result could well be an implosion, either minor or major, depending on the number of servers in range. The recommended value for &lt;tt&gt;maxpoll&lt;/tt&gt; is 12 (4,096 s) and for &lt;tt&gt;ttl&lt;/tt&gt; is 7.&lt;/p&gt;
&lt;p&gt;It is possible and frequently useful to configure a host as both a manycast client and manycast server. A number of hosts configured this way and sharing a common group address will automatically organize themselves in an optimum configuration based on the smallest synchronization distance computed by the NTP mitigation algorithms. For example, consider an NTP subnet of two primary servers and maybe a dozen dependent clients. All servers and clients are configured as both multicast client and multicast server with multicast group address 239.1.1.1. In addition, the primary servers are configured for a primary reference source such as a GPS receiver. Once operations have stabilized in this scenario, the primary servers will affiliate with the primary reference source and each other, since they both operate at the same stratum (1), but not with any client, since clients operate at a higher stratum. The clients will find both primary servers and in addition, one of their own at the minimum synchronization distance. If one of the primary servers loses its GPS receiver, it will continue to operate as a client and other clients will time out the corresponding association and re-associate accordingly.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;burst-modes&#34;&gt;Burst Modes&lt;/h4&gt;
&lt;p&gt;There are two burst modes that can be enabled in client/server mode using the &lt;tt&gt;iburst&lt;/tt&gt; and &lt;tt&gt;burst&lt;/tt&gt; keywords. In either mode a single poll initiates a burst of eight client messages at intervals randomized over the range 1-4 s. However, the interval between the first and second messages is increased to about 16 s in order for a dialup modem to complete a call, if necessary. Received server messages update the NTPv4 clock filter, which selects the best (most accurate) time values. When the last client message in the burst is sent, the next received server message updates the system variables and sets the system clock in the usual manner, as if only a single client/server cycle had occurred. The result is not only a rapid and reliable setting of the system clock, but a considerable reduction in network jitter.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;iburst&lt;/tt&gt; keyword can be configured for cases where it is important to set the clock quickly when an association is first mobilized or first becomes reachable or when the network attachment requires an initial calling or training procedure. The burst is initiated only when the server first becomes reachable and results in good accuracy with intermittent connections typical of PPP and ISDN services. Outlyers due to initial dial-up delays, etc., are avoided and the client sets the clock within 30 s after the first message.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;burst&lt;/tt&gt; keyword can be configured in cases of excessive network jitter or when the network attachment requires an initial calling or training procedure. The burst is initiated at each poll interval when the server is reachable. The burst does produce additional network overhead and can cause trouble if used indiscriminately. It should only be used where the poll interval is expected to settle to values at or above 1024 s.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Association Management</title>
      <link>/archives/4.1.2/assoc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.2/assoc/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice51.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Make sure who your friends are.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/assoc/#association-modes&#34;&gt;Association Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/assoc/#clientserver-mode&#34;&gt;Client/Server Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/assoc/#symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/assoc/#broadcast-mode&#34;&gt;Broadcast Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/assoc/#ip-multicast-support&#34;&gt;IP Multicast Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/assoc/#multicasting&#34;&gt;Multicasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/assoc/#manycasting&#34;&gt;Manycasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/assoc/#burst-modes&#34;&gt;Burst Modes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;association-modes&#34;&gt;Association Modes&lt;/h4&gt;
&lt;p&gt;NTP Version 4 (NTPv4) incorporates new features and refinements to the NTP Version 3 (NTPv3) algorithms; however, it continues the tradition of backwards compatibility with older versions. A number of new operating modes for automatic server discovery and improved accuracy in occasionally connected networks are provided. Following is an overview of the new features; additional information is available on the &lt;a href=&#34;/archives/4.1.2/confopt&#34;&gt;Configuration Options&lt;/a&gt; and &lt;a href=&#34;/archives/4.1.2/authopt&#34;&gt;Authentication Options&lt;/a&gt; pages and in the papers, reports, memoranda and briefings at &lt;a href=&#34;http://www.ntp.org&#34;&gt;www.ntp.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are two types of associations: persistent associations, which result from configuration file commands, and ephemeral associations, which result from protocol operations described below. A persistent association is never demobilized, although it may become dormant when the associated server becomes unreachable. An ephemeral association is mobilized when a message arrives from a server; for instance, a symmetric passive association is mobilized upon arrival of a symmetric active message. A broadcast client association is mobilized upon arrival of a broadcast server message, while a manycast client association is mobilized upon arrival of a manycast server message.&lt;/p&gt;
&lt;p&gt;Ordinarily, successful mobilization of an ephemeral association requires the server to be cryptographically authenticated to the dependent client. This can be done using either symmetric-key or public-key cryptography, as described in the &lt;a href=&#34;/archives/4.1.2/authopt&#34;&gt;Authentication Options&lt;/a&gt; page. The cryptographic means insure an unbroken chain of trust between the dependent client and the primary servers at the root of the synchronization subnet. We call this chain the &lt;em&gt;provenance&lt;/em&gt; of the client and define new vocabulary as to proventicate a client or provide proventic credentials. Once mobilized, ephemeral associations are demobilized when either (a) the server becomes unreachable or (b) the server refreshes the key media without notifying the client.&lt;/p&gt;
&lt;p&gt;There are three principal modes of operation: client/server, symmetric active/passive and broadcast. In addition, there are two modes using IP multicast support: multicast and manycast. These modes are selected based on the scope of service, intended flow of time and proventic values and means of configuration. Following is a summary of the operations in each mode.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;clientserver-mode&#34;&gt;Client/Server Mode&lt;/h4&gt;
&lt;p&gt;Client/server mode is probably the most common configuration in the Internet today. It operates in the classic remote-procedure-call (RPC) paradigm with stateless servers. In this mode a client sends a request to the server and expects a reply at some future time. In some contexts this would be described as a &amp;ldquo;pull&amp;rdquo; operation, in that the client pulls the time and proventic values from the server. A client is configured in client mode using the &lt;tt&gt;server&lt;/tt&gt; (sic) command and specifying the server IPv4 or IPv6 DNS name or address; the server requires no prior configuration. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme. In addition, two burst modes described below can be used in appropriate cases.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/h4&gt;
&lt;p&gt;Symmetric active/passive mode is intended for configurations where a clique of low-stratum peers operate as mutual backups for each other. Each peer operates with one or more primary reference sources, such as a radio clock, or a subset of secondary servers known to be reliable and proventicated. Should one of the peers lose all reference sources or simply cease operation, the other peers will automatically reconfigure so that time and proventication values can flow from the surviving peers to all the others in the clique. In some contexts this would be described as a &amp;ldquo;push-pull&amp;rdquo; operation, in that the peer either pulls or pushes the time and proventic values depending on the particular configuration.&lt;/p&gt;
&lt;p&gt;Symmetric peers operate with their sources in some NTP mode and with each other in symmetric mode. A peer is configured in symmetric active mode using the &lt;tt&gt;peer&lt;/tt&gt; command and specifying the other peer DNS name or address. The other peer can also be configured in symmetric active mode in a similar way. However, if the other peer is not specifically configured in this way, a symmetric passive association is mobilized upon arrival of a symmetric active message. Since an intruder can impersonate a symmetric active peer and inject false time values, symmetric mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;broadcast-mode&#34;&gt;Broadcast Mode&lt;/h4&gt;
&lt;p&gt;Broadcast mode is intended for configurations involving one or a few servers and a possibly very large client population. A broadcast server is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command and a local subnet address. A broadcast client is configured using the &lt;tt&gt;broadcastclient&lt;/tt&gt; command, in which case it responds to broadcast messages received on any interface. Since an intruder can impersonate a broadcast server and inject false time values, this mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;p&gt;The server generates broadcast messages continuously at intervals specified by the &lt;tt&gt;minpoll&lt;/tt&gt; keyword and with a time-to-live span specified by the &lt;tt&gt;ttl&lt;/tt&gt; keyword. A NTPv4 broadcast client responds to the first proventicated message received by waiting a short interval randomized over the &lt;tt&gt;minpoll&lt;/tt&gt; interval, in order to avoid implosion at the server. Then, the client polls the server in burst mode in order to reliably set the host clock and validate the source. This normally results in a volley of eight client/server cycles over a 30-s interval during which both the synchronization and cryptographic protocols run concurrently. When the next broadcast message is received after the volley, the client computes the offset between the apparent broadcast time and the (unicast) client time. This offset is used to compensate for the propagation time between the broadcast server and client. Once the offset is computed, the server continues as before and the client sends no further messages.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;ip-multicast-support&#34;&gt;IP Multicast Support&lt;/h4&gt;
&lt;p&gt;Broadcast mode in both NTPv3 and NTPv4 is limited to directly connected subnets such as Ethernets which support broadcast technology. Ordinarily, this technology does not operate beyond the first hop router or gateway. Where service is intended beyond the local subnet, IP multicasting can be used where supported by the operating system and the routers support the Internet Group Management Protocol (IGMP). Most current kernels and available routers do support IP multicast technology, although service providers are sometimes reluctant to deploy it.&lt;/p&gt;
&lt;p&gt;A general discussion of IP multicast technology is beyond the scope here. In simple terms a host or router sending to a IP multicast group (class D) address expects all hosts or routers listening on this address to receive the message. There is no intrinsic limit on the number of senders or receivers and senders can be receivers and vice versa. The IANA has assigned multicast group address 224.0.1.1 to NTP, but this address should be used only where the multicast span can be reliably constrained to protect neighbor networks. In general, administratively scoped group addresses should be used, as described in RFC-2365, or GLOP group addresses, as described in RFC-2770.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;multicasting&#34;&gt;Multicasting&lt;/h4&gt;
&lt;p&gt;IP multicasting can be used to extend the scope of a timekeeping subnet in two ways: multicasting and manycasting. A multicast client is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command, but with a multicast group (class D) address instead of a local subnet broadcast address. However, there is a subtle difference between broadcasting and multicasting. Broadcasting is specific to each interface and local subnet address. If more than one interface is attached to a machine, a separate &lt;tt&gt;broadcast&lt;/tt&gt; command applies to each one separately. This provides a way to limit exposure in a firewall, for example.&lt;/p&gt;
&lt;p&gt;IP multicasting is a different paradigm. A multicast message has the same format as a broadcast message and is configured with the same &lt;tt&gt;broadcast&lt;/tt&gt; command, but with a multicast group address instead of a local subnet address. By design, multicast messages travel from the sender via a shortest-path or shared tree to the receivers, which may require these messages emit from one or all interfaces, but carry a common source address. However, it is possible to configure multiple multicast group addresses using multiple &lt;tt&gt;broadcast&lt;/tt&gt; commands. Other than these particulars, multicast messages are processed just like broadcast messages. Note that the calibration feature in broadcast mode is extremely important, since IP multicast messages can travel far different paths through the IP routing fabric than ordinary IP unicast messages.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;manycasting&#34;&gt;Manycasting&lt;/h4&gt;
&lt;p&gt;Manycasting is a automatic discovery and configuration paradigm new to NTPv4. It is intended as a means for a multicast client to troll the nearby network neighborhood to find cooperating manycast servers, validate them using cryptographic means and evaluate their time values with respect to other servers that might be lurking in the vicinity. The intended result is that each manycast client mobilizes client associations with the &amp;ldquo;best&amp;rdquo; three of the available manycast servers, yet automatically reconfigures to sustain this number of servers should one or another fail.&lt;/p&gt;
&lt;p&gt;Note that the manycasting paradigm does not coincide with the anycasting paradigm described in RFC-1546, which is designed to find a single server from a clique of servers providing the same service. The manycasting paradigm is designed to find a plurality of redundant servers, in this case willing NTP servers.&lt;/p&gt;
&lt;p&gt;A persistent manycast client association is configured using the &lt;tt&gt;server&lt;/tt&gt; command, but with a multicast (class D) group address instead of an ordinary IP (class A, B, C) address. It sends client mode messages to this address at the maximum feasible poll interval and minimum feasible time-to-live hops, depending on how many servers have already been found. There can be as many manycast client associations as different group addresses, each one serving as a template for a future ephemeral client/server mode association.&lt;/p&gt;
&lt;p&gt;Manycast servers configured with the &lt;tt&gt;manycastserver&lt;/tt&gt; command listen on the specified group address for manycast client messages. Note the distinction between manycast client, which is configured with a &lt;tt&gt;server&lt;/tt&gt; command, and manycast server, which is configured with a &lt;tt&gt;manycastserver&lt;/tt&gt; command. If a manycast server is in range of the current time-to-live and is itself synchronized to a valid source and operating at a stratum level equal to or lower than the manycast client, it replies to the manycast client message with an ordinary server mode message.&lt;/p&gt;
&lt;p&gt;The manycast client receiving this message mobilizes an ephemeral client association as in ordinary client/server mode according to the matching manycast client template. Then, the client polls the server at its unicast address in burst mode in order to reliably set the host clock and validate the source. This normally results in a volley of eight client/server cycles over a 30-s interval during which both the synchronization and cryptographic protocols run concurrently. Following the volley, the client runs the NTP intersection and clustering algorithms, which act to discard all but the best three associations. The surviving associations then continue in ordinary client/server mode.&lt;/p&gt;
&lt;p&gt;The manycast client polling program is designed to reduce as much as possible the volume of messages and the effects of implosion due to near-simultaneous arrival of manycast server messages. The program uses a poll interval eight times the system poll interval, which starts out at the &lt;tt&gt;minpoll&lt;/tt&gt; value and under normal circumstances increases gradually to the &lt;tt&gt;maxpolll&lt;/tt&gt; value. Initially, the time-to-live is set at one hop. At each retransmission the time-to-live is incremented by one until at least three manycast servers are found. Further retransmissions use the same time-to-live value.&lt;/p&gt;
&lt;p&gt;If less than three servers are found when the time-to-live has reached the maximum specified by the &lt;tt&gt;ttl&lt;/tt&gt; keyword, the poll interval is doubled. For each transmission after that, the poll interval is doubled again until reaching the maximum of eight times the value specified by the &lt;tt&gt;maxpoll&lt;/tt&gt; keyword. Further transmissions use the same poll interval and time-to-live values.&lt;/p&gt;
&lt;p&gt;The above scenario happens for each manycast client message, which repeats at the designated poll interval. However, once the ephemeral client association is mobilized, subsequent manycast server replies are discarded, since they will fail the message digest test. If during a poll interval the number of client associations falls below three, all manycast client prototype associations are reset to the initial poll interval and time-to-live values and operation resumes from the beginning. It is important in manycast mode to avoid frequent manycast client messages, since each one requires all manycast servers in range to respond. The result could well be an implosion, either minor or major, depending on the number of servers in range. The recommended value for &lt;tt&gt;maxpoll&lt;/tt&gt; is 12 (4,096 s) and for &lt;tt&gt;ttl&lt;/tt&gt; is 7.&lt;/p&gt;
&lt;p&gt;It is possible and frequently useful to configure a host as both a manycast client and manycast server. A number of hosts configured this way and sharing a common group address will automatically organize themselves in an optimum configuration based on the smallest synchronization distance computed by the NTP mitigation algorithms. For example, consider an NTP subnet of two primary servers and maybe a dozen dependent clients. All servers and clients are configured as both multicast client and multicast server with multicast group address 239.1.1.1. In addition, the primary servers are configured for a primary reference source such as a GPS receiver. Once operations have stabilized in this scenario, the primary servers will affiliate with the primary reference source and each other, since they both operate at the same stratum (1), but not with any client, since clients operate at a higher stratum. The clients will find both primary servers and in addition, one of their own at the minimum synchronization distance. If one of the primary servers loses its GPS receiver, it will continue to operate as a client and other clients will time out the corresponding association and re-associate accordingly.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;burst-modes&#34;&gt;Burst Modes&lt;/h4&gt;
&lt;p&gt;There are two burst modes that can be enabled in client/server mode using the &lt;tt&gt;iburst&lt;/tt&gt; and &lt;tt&gt;burst&lt;/tt&gt; keywords. In either mode a single poll initiates a burst of eight client messages at intervals randomized over the range 1-4 s. However, the interval between the first and second messages is increased to about 16 s in order for a dialup modem to complete a call, if necessary. Received server messages update the NTPv4 clock filter, which selects the best (most accurate) time values. When the last client message in the burst is sent, the next received server message updates the system variables and sets the system clock in the usual manner, as if only a single client/server cycle had occurred. The result is not only a rapid and reliable setting of the system clock, but a considerable reduction in network jitter.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;iburst&lt;/tt&gt; keyword can be configured for cases where it is important to set the clock quickly when an association is first mobilized or first becomes reachable or when the network attachment requires an initial calling or training procedure. The burst is initiated only when the server first becomes reachable and results in good accuracy with intermittent connections typical of PPP and ISDN services. Outlyers due to initial dial-up delays, etc., are avoided and the client sets the clock within 30 s after the first message.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;burst&lt;/tt&gt; keyword can be configured in cases of excessive network jitter or when the network attachment requires an initial calling or training procedure. The burst is initiated at each poll interval when the server is reachable. The burst does produce additional network overhead and can cause trouble if used indiscriminately. It should only be used where the poll interval is expected to settle to values at or above 1024 s.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Association Management</title>
      <link>/archives/4.2.0/assoc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.0/assoc/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice51.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Make sure who your friends are.&lt;/p&gt;
&lt;p&gt;Last update: 03:03 AM UTC Monday, October 13, 2003&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/assoc/#association-modes&#34;&gt;Association Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/assoc/#clientserver-mode&#34;&gt;Client/Server Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/assoc/#symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/assoc/#broadcastmulticast-modes&#34;&gt;Broadcast/Multicast Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/assoc/#multicasting&#34;&gt;Multicasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/assoc/#manycasting&#34;&gt;Manycasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/assoc/#burst-modes&#34;&gt;Burst Modes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;association-modes&#34;&gt;Association Modes&lt;/h4&gt;
&lt;p&gt;NTP Version 4 (NTPv4) incorporates new features and refinements to the NTP Version 3 (NTPv3) algorithms; however, it continues the tradition of backwards compatibility with older versions. A number of new operating modes for automatic server discovery and improved accuracy in occasionally connected networks are provided. Following is an overview of the new features; additional information is available on the &lt;a href=&#34;/archives/4.2.0/confopt&#34;&gt;Configuration Options&lt;/a&gt; and &lt;a href=&#34;/archives/4.2.0/authopt&#34;&gt;Authentication Options&lt;/a&gt; pages and in the papers, reports, memoranda and briefings at &lt;a href=&#34;http://www.ntp.org&#34;&gt;www.ntp.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are two types of associations: persistent associations, which result from configuration file commands, and ephemeral associations, which result from protocol operations described below. A persistent association is never demobilized, although it may become dormant when the associated server becomes unreachable. An ephemeral association is mobilized when a message arrives from a server; for instance, a symmetric passive association is mobilized upon arrival of a symmetric active message. A broadcast client association is mobilized upon arrival of a broadcast server message, while a Manycast client association is mobilized upon arrival of a Manycast server message.&lt;/p&gt;
&lt;p&gt;Ordinarily, successful mobilization of an ephemeral association requires the server to be cryptographically authenticated to the dependent client. This can be done using either symmetric-key or public-key cryptography, as described in the &lt;a href=&#34;/archives/4.2.0/authopt&#34;&gt;Authentication Options&lt;/a&gt; page. The cryptographic means insure an unbroken chain of trust between the dependent client and the primary servers at the root of the synchronization subnet. We call this chain the &lt;em&gt;provenance&lt;/em&gt; of the client and define new vocabulary as to proventicate a client or provide proventic credentials. Once mobilized, ephemeral associations are demobilized when either (a) the server becomes unreachable or (b) the server refreshes the key media without notifying the client.&lt;/p&gt;
&lt;p&gt;There are three principal modes of operation: client/server, symmetric active/passive and broadcast. In addition, there are two modes using IP multicast support: multicast and manycast. These modes are selected based on the scope of service, intended flow of time and proventic values and means of configuration. Following is a summary of the operations in each mode.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;clientserver-mode&#34;&gt;Client/Server Mode&lt;/h4&gt;
&lt;p&gt;Client/server mode is probably the most common configuration in the Internet today. It operates in the classic remote-procedure-call (RPC) paradigm with stateless servers. In this mode a client sends a request to the server and expects a reply at some future time. In some contexts this would be described as a &amp;ldquo;pull&amp;rdquo; operation, in that the client pulls the time and proventic values from the server. A client is configured in client mode using the &lt;tt&gt;server&lt;/tt&gt; (sic) command and specifying the server IPv4 or IPv6 DNS name or address; the server requires no prior configuration. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme. In addition, two burst modes described below can be used in appropriate cases.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/h4&gt;
&lt;p&gt;Symmetric active/passive mode is intended for configurations where a clique of low-stratum peers operate as mutual backups for each other. Each peer operates with one or more primary reference sources, such as a radio clock, or a subset of secondary servers known to be reliable and proventicated. Should one of the peers lose all reference sources or simply cease operation, the other peers will automatically reconfigure so that time and proventication values can flow from the surviving peers to all the others in the clique. In some contexts this would be described as a &amp;ldquo;push-pull&amp;rdquo; operation, in that the peer either pulls or pushes the time and proventic values depending on the particular configuration.&lt;/p&gt;
&lt;p&gt;Symmetric peers operate with their sources in some NTP mode and with each other in symmetric mode. A peer is configured in symmetric active mode using the &lt;tt&gt;peer&lt;/tt&gt; command and specifying the other peer IPv4 or IPv6 DNS name or address. The other peer can also be configured in symmetric active mode in a similar way. However, if the other peer is not specifically configured in this way, a symmetric passive association is mobilized upon arrival of a symmetric active message. Since an intruder can impersonate a symmetric active peer and inject false time values, symmetric mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;broadcastmulticast-modes&#34;&gt;Broadcast/Multicast Modes&lt;/h4&gt;
&lt;p&gt;IPv4 broadcast mode in both NTPv3 and NTPv4 is limited to directly connected subnets such as Ethernets which support broadcast technology. Ordinarily, this technology does not operate beyond the first hop router or gateway. In IPv6 and where service is intended beyond the local subnet, IP multicasting can be used where supported by the operating system and the routers support the Internet Group Management Protocol (IGMP). Most current kernels and available routers do support IP multicast technology, although service providers are sometimes reluctant to deploy it.&lt;/p&gt;
&lt;p&gt;IPv4 broadcast mode is intended for configurations involving one or a few servers and a possibly very large client population on the same subnet. A broadcast server is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command and a IPv4 local subnet broadcast address. A broadcast client is configured using the &lt;tt&gt;broadcastclient&lt;/tt&gt; command, in which case it responds to broadcast messages received on any interface. Since an intruder can impersonate a broadcast server and inject false time values, this mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;p&gt;The server generates broadcast messages continuously at intervals specified by the &lt;tt&gt;minpoll&lt;/tt&gt; keyword and with a time-to-live span specified by the &lt;tt&gt;ttl&lt;/tt&gt; keyword. A broadcast client responds to the first message received by waiting a short interval to avoid implosion at the server. Then, the client polls the server in burst mode in order to quickly set the host clock and validate the source. This normally results in a volley of eight client/server cycles at 2-s intervals during which both the synchronization and cryptographic protocols run concurrently. Following the volley, the client computes the offset between the apparent broadcast time and the (unicast) client time. This offset is used to compensate for the propagation time between the broadcast server and client. Once the offset is computed, the server continues as before and the client sends no further messages. If for some reason the broadcast server does not respond to client messages, the client will time out the volley and continue in listen-only mode with a default propagation delay.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;multicasting&#34;&gt;Multicasting&lt;/h4&gt;
&lt;p&gt;Multicasting can be used to extend the scope of a timekeeping subnet in two ways: multicasting and manycasting. A general discussion of IP multicast technology is beyond the scope of this page. In simple terms a host or router sending to a IPv4 or IPv6 multicast group address expects all hosts or routers listening on this address to receive the message. There is no intrinsic limit on the number of senders or receivers and senders can be receivers and vice versa. The IANA has assigned multicast group address IPv4 224.0.1.1 and IPv6 FF05::101 (site local) to NTP, but these addresses should be used only where the multicast span can be reliably constrained to protect neighbor networks. In general, administratively scoped IPv4 group addresses should be used, as described in RFC-2365, or GLOP group addresses, as described in RFC-2770.&lt;/p&gt;
&lt;p&gt;A multicast server is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command, but with a multicast group address instead of a broadcast address. A multicast client is configured using the &lt;tt&gt;multicastclient&lt;/tt&gt; command with a multicast group address. However, there is a subtle difference between IPv4 broadcasting and multicasting. IPv4 broadcasting is specific to each interface and local subnet address. If more than one interface is attached to a machine, a separate &lt;tt&gt;broadcast&lt;/tt&gt; command applies to each one separately. This provides a way to limit exposure in a firewall, for example. For IPv6 the same distinction can be made using link-local prefix FF02 for each interface and site-local FF05 for all interfaces.&lt;/p&gt;
&lt;p&gt;IP multicasting is a different paradigm. By design, multicast messages travel from the sender via a shortest-path or shared tree to the receivers, which may require these messages emit from one or all interfaces, but carry a common source address. However, it is possible to configure multiple multicast group addresses using multiple &lt;tt&gt;broadcast&lt;/tt&gt; or &lt;tt&gt;multicastclient&lt;/tt&gt; commands. Other than these particulars, multicast messages are processed just like broadcast messages. Note that the calibration feature in broadcast mode is extremely important, since IP multicast messages can travel far different paths through the IP routing fabric than ordinary IP unicast messages.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;manycasting&#34;&gt;Manycasting&lt;/h4&gt;
&lt;p&gt;Manycasting is a automatic discovery and configuration paradigm new to NTPv4. It is intended as a means for a multicast client to troll the nearby network neighborhood to find cooperating manycast servers, validate them using cryptographic means and evaluate their time values with respect to other servers that might be lurking in the vicinity. The intended result is that each manycast client mobilizes client associations with some number of the &amp;ldquo;best&amp;rdquo; of the nearby anycast servers, yet automatically reconfigures to sustain this number of servers should one or another fail. Additional information is on the &lt;a href=&#34;/archives/4.2.0/manyopt&#34;&gt;Automatic NTP Configuration Options&lt;/a&gt; page.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;burst-modes&#34;&gt;Burst Modes&lt;/h4&gt;
&lt;p&gt;There are two burst modes where a single poll event triggers a burst of eight packets at 2-s intervals instead of the usual one. The &lt;tt&gt;burst&lt;/tt&gt; mode sends a burst when the server is reachable, while the &lt;tt&gt;iburst&lt;/tt&gt; mode sends a burst when the server is unreachable. Each mode is independently of the other and both can be used if necessary. The &lt;tt&gt;calldelay&lt;/tt&gt; command can be used to increase the interval between the first and second packets in the burst in order to allow a modem to complete a call. Received server packets update the clock filter, which selects the best (most accurate) time values. When the last packet in the burst is sent, the next received packet updates the system variables and sets the system clock in the usual manner, as if only a single client/server cycle had occurred. The result is not only a rapid and reliable setting of the system clock, but a considerable reduction in network jitter.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;iburst&lt;/tt&gt; keyword is used where it is important to set the clock quickly when an association is first mobilized or first becomes reachable or when the network attachment requires an initial calling or training procedure. The burst is initiated only when the server first becomes reachable and results in good accuracy with intermittent connections typical of PPP and ISDN services. Outlyers due to initial dial-up delays, etc., are avoided and the client sets the clock within a few seconds after the first message.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;burst&lt;/tt&gt; keyword can be configured in cases of excessive network jitter or when the network attachment requires an initial calling or training procedure. The burst is initiated at each poll interval when the server is reachable. The burst does produce additional network overhead and can cause trouble if used indiscriminately. It should only be used where the poll interval is expected to settle to values at or above 1024 s.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Association Management</title>
      <link>/archives/4.2.2-series/assoc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.2-series/assoc/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice51.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Make sure who your friends are.&lt;/p&gt;
&lt;p&gt;Last update: 18:35 UTC Thursday, July 28, 2005&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/assoc/#association-modes&#34;&gt;Association Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/assoc/#clientserver-mode&#34;&gt;Client/Server Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/assoc/#symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/assoc/#broadcastmulticast-modes&#34;&gt;Broadcast/Multicast Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/assoc/#multicasting&#34;&gt;Multicasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/assoc/#manycasting&#34;&gt;Manycasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/assoc/#burst-modes&#34;&gt;Burst Modes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;association-modes&#34;&gt;Association Modes&lt;/h4&gt;
&lt;p&gt;NTP Version 4 (NTPv4) incorporates new features and refinements to the NTP Version 3 (NTPv3) algorithms; however, it continues the tradition of backwards compatibility with older versions. A number of new operating modes for automatic server discovery and improved accuracy in occasionally connected networks are provided. Following is an overview of the new features; additional information is available on the &lt;a href=&#34;/archives/4.2.2-series/confopt&#34;&gt;Configuration Options&lt;/a&gt; and &lt;a href=&#34;/archives/4.2.2-series/authopt&#34;&gt;Authentication Options&lt;/a&gt; pages and in the papers, reports, memoranda and briefings at &lt;a href=&#34;http://www.ntp.org&#34;&gt;www.ntp.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are two types of associations: persistent associations, which result from configuration file commands, and ephemeral associations, which result from protocol operations described below. A persistent association is never demobilized, although it may become dormant when the associated server becomes unreachable. An ephemeral association is mobilized when a message arrives from a server; for instance, a symmetric passive association is mobilized upon arrival of a symmetric active message. A broadcast client association is mobilized upon arrival of a broadcast server message, while a Manycast client association is mobilized upon arrival of a Manycast server message.&lt;/p&gt;
&lt;p&gt;Ordinarily, successful mobilization of an ephemeral association requires the server to be cryptographically authenticated to the dependent client. This can be done using either symmetric-key or public-key cryptography, as described in the &lt;a href=&#34;/archives/4.2.2-series/authopt&#34;&gt;Authentication Options&lt;/a&gt; page. The cryptographic means insure an unbroken chain of trust between the dependent client and the primary servers at the root of the synchronization subnet. We call this chain the &lt;em&gt;provenance&lt;/em&gt; of the client and define new vocabulary as to proventicate a client or provide proventic credentials. Once mobilized, ephemeral associations are demobilized when either (a) the server becomes unreachable or (b) the server refreshes the key media without notifying the client.&lt;/p&gt;
&lt;p&gt;There are three principal modes of operation: client/server, symmetric active/passive and broadcast. In addition, there are two modes using IP multicast support: multicast and manycast. These modes are selected based on the scope of service, intended flow of time and proventic values and means of configuration. Following is a summary of the operations in each mode.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;clientserver-mode&#34;&gt;Client/Server Mode&lt;/h4&gt;
&lt;p&gt;Client/server mode is probably the most common configuration in the Internet today. It operates in the classic remote-procedure-call (RPC) paradigm with stateless servers. In this mode a client sends a request to the server and expects a reply at some future time. In some contexts this would be described as a &amp;ldquo;pull&amp;rdquo; operation, in that the client pulls the time and proventic values from the server. A client is configured in client mode using the &lt;tt&gt;server&lt;/tt&gt; (sic) command and specifying the server IPv4 or IPv6 DNS name or address; the server requires no prior configuration. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme. In addition, two burst modes described below can be used in appropriate cases.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/h4&gt;
&lt;p&gt;Symmetric active/passive mode is intended for configurations were a clique of low-stratum peers operate as mutual backups for each other. Each peer operates with one or more primary reference sources, such as a radio clock, or a subset of secondary servers known to be reliable and proventicated. Should one of the peers lose all reference sources or simply cease operation, the other peers will automatically reconfigure so that time and proventication values can flow from the surviving peers to all the others in the clique. In some contexts this would be described as a &amp;ldquo;push-pull&amp;rdquo; operation, in that the peer either pulls or pushes the time and proventic values depending on the particular configuration.&lt;/p&gt;
&lt;p&gt;Symmetric peers operate with their sources in some NTP mode and with each other in symmetric mode. A peer is configured in symmetric active mode using the &lt;tt&gt;peer&lt;/tt&gt; command and specifying the other peer IPv4 or IPv6 DNS name or address. The other peer can also be configured in symmetric active mode in a similar way. However, if the other peer is not specifically configured in this way, a symmetric passive association is mobilized upon arrival of a symmetric active message. Since an intruder can impersonate a symmetric active peer and inject false time values, symmetric mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;broadcastmulticast-modes&#34;&gt;Broadcast/Multicast Modes&lt;/h4&gt;
&lt;p&gt;IPv4 broadcast mode in both NTPv3 and NTPv4 is limited to directly connected subnets such as Ethernets which support broadcast technology. Ordinarily, this technology does not operate beyond the first hop router or gateway. In IPv6 and where service is intended beyond the local subnet, IP multicasting can be used where supported by the operating system and the routers support the Internet Group Management Protocol (IGMP). Most current kernels and available routers do support IP multicast technology, although service providers are sometimes reluctant to deploy it.&lt;/p&gt;
&lt;p&gt;IPv4 broadcast mode is intended for configurations involving one or a few servers and a possibly very large client population on the same subnet. A broadcast server is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command and a IPv4 local subnet broadcast address. A broadcast client is configured using the &lt;tt&gt;broadcastclient&lt;/tt&gt; command, in which case it responds to broadcast messages received on any interface. Since an intruder can impersonate a broadcast server and inject false time values, this mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;p&gt;The server generates broadcast messages continuously at intervals specified by the &lt;tt&gt;minpoll&lt;/tt&gt; keyword and with a time-to-live span specified by the &lt;tt&gt;ttl&lt;/tt&gt; keyword. A broadcast client responds to the first message received by waiting a short interval to avoid implosion at the server. Then, the client polls the server in burst mode in order to quickly set the host clock and validate the source. This normally results in a volley of eight client/server cycles at 2-s intervals during which both the synchronization and cryptographic protocols run concurrently. Following the volley, the client computes the offset between the apparent broadcast time and the (unicast) client time. This offset is used to compensate for the propagation time between the broadcast server and client. Once the offset is computed, the server continues as before and the client sends no further messages. If for some reason the broadcast server does not respond to client messages, the client will time out the volley and continue in listen-only mode with a default propagation delay.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;multicasting&#34;&gt;Multicasting&lt;/h4&gt;
&lt;p&gt;Multicasting can be used to extend the scope of a timekeeping subnet in two ways: multicasting and manycasting. A general discussion of IP multicast technology is beyond the scope of this page. In simple terms a host or router sending to a IPv4 or IPv6 multicast group address expects all hosts or routers listening on this address to receive the message. There is no intrinsic limit on the number of senders or receivers and senders can be receivers and vice versa. The IANA has assigned multicast group address IPv4 224.0.1.1 and IPv6 FF05::101 (site local) to NTP, but these addresses should be used only where the multicast span can be reliably constrained to protect neighbor networks. In general, administratively scoped IPv4 group addresses should be used, as described in RFC-2365, or GLOP group addresses, as described in RFC-2770.&lt;/p&gt;
&lt;p&gt;A multicast server is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command, but with a multicast group address instead of a broadcast address. A multicast client is configured using the &lt;tt&gt;multicastclient&lt;/tt&gt; command with a multicast group address. However, there is a subtle difference between IPv4 broadcasting and multicasting. IPv4 broadcasting is specific to each interface and local subnet address. If more than one interface is attached to a machine, a separate &lt;tt&gt;broadcast&lt;/tt&gt; command applies to each one separately. This provides a way to limit exposure in a firewall, for example. For IPv6 the same distinction can be made using link-local prefix FF02 for each interface and site-local FF05 for all interfacesl.&lt;/p&gt;
&lt;p&gt;IP multicasting is a different paradigm. By design, multicast messages travel from the sender via a shortest-path or shared tree to the receivers, which may require these messages emit from one or all interfaces, but carry a common source address. However, it is possible to configure multiple multicast group addresses using multiple &lt;tt&gt;broadcast&lt;/tt&gt; or &lt;tt&gt;multicastclient&lt;/tt&gt; commands. Other than these particulars, multicast messages are processed just like broadcast messages. Note that the calibration feature in broadcast mode is extremely important, since IP multicast messages can travel far different paths through the IP routing fabric than ordinary IP unicast messages.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;manycasting&#34;&gt;Manycasting&lt;/h4&gt;
&lt;p&gt;Manycasting is a automatic discovery and configuration paradigm new to NTPv4. It is intended as a means for a multicast client to troll the nearby network neighborhood to find cooperating manycast servers, validate them using cryptographic means and evaluate their time values with respect to other servers that might be lurking in the vicinity. The intended result is that each manycast client mobilizes client associations with some number of the &amp;ldquo;best&amp;rdquo; of the nearby anycast servers, yet automatically reconfigures to sustain this number of servers should one or another fail. Additional information is on the &lt;a href=&#34;/archives/4.2.2-series/manyopt&#34;&gt;Automatic NTP Configuration Options&lt;/a&gt; page.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;burst-modes&#34;&gt;Burst Modes&lt;/h4&gt;
&lt;p&gt;There are two burst modes where a single poll event triggers a burst of eight packets at 2-s intervals instead of the usual one. The &lt;tt&gt;burst&lt;/tt&gt; mode sends a burst when the server is reachable, while the &lt;tt&gt;iburst&lt;/tt&gt; mode sends a burst when the server is unreachable. Each mode is independently of the other and both can be used if necessary. The &lt;tt&gt;calldelay&lt;/tt&gt; command can be used to increase the interval between the first and second packets in the burst in order to allow a modem to complete a call. Received server packets update the clock filter, which selects the best (most accurate) time values. When the last packet in the burst is sent, the next received packet updates the system variables and sets the system clock in the usual manner, as if only a single client/server cycle had occurred. The result is not only a rapid and reliable setting of the system clock, but a considerable reduction in network jitter.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;iburst&lt;/tt&gt; keyword is used where it is important to set the clock quickly when an association is first mobilized or first becomes reachable or when the network attachment requires an initial calling or training procedure. The burst is initiated only when the server first becomes reachable and results in good accuracy with intermittent connections typical of PPP and ISDN services. Outlyers due to initial dial-up delays, etc., are avoided and the client sets the clock within a few seconds after the first message.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;burst&lt;/tt&gt; keyword can be configured in cases of excessive network jitter or when the network attachment requires an initial calling or training procedure. The burst is initiated at each poll interval when the server is reachable. The burst does produce additional network overhead and can cause trouble if used indiscriminately. It should only be used where the poll interval is expected to settle to values at or above 1024 s.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Association Management</title>
      <link>/archives/4.2.4-series/assoc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.4-series/assoc/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice51.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Make sure who your friends are.&lt;/p&gt;
&lt;p&gt;Last update: 18:35 UTC Thursday, July 28, 2005&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/assoc/#association-modes&#34;&gt;Association Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/assoc/#clientserver-mode&#34;&gt;Client/Server Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/assoc/#symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/assoc/#broadcastmulticast-modes&#34;&gt;Broadcast/Multicast Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/assoc/#multicasting&#34;&gt;Multicasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/assoc/#manycasting&#34;&gt;Manycasting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/assoc/#burst-modes&#34;&gt;Burst Modes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;association-modes&#34;&gt;Association Modes&lt;/h4&gt;
&lt;p&gt;NTP Version 4 (NTPv4) incorporates new features and refinements to the NTP Version 3 (NTPv3) algorithms; however, it continues the tradition of backwards compatibility with older versions. A number of new operating modes for automatic server discovery and improved accuracy in occasionally connected networks are provided. Following is an overview of the new features; additional information is available on the &lt;a href=&#34;/archives/4.2.4-series/confopt&#34;&gt;Configuration Options&lt;/a&gt; and &lt;a href=&#34;/archives/4.2.4-series/authopt&#34;&gt;Authentication Options&lt;/a&gt; pages and in the papers, reports, memoranda and briefings at &lt;a href=&#34;http://www.ntp.org&#34;&gt;www.ntp.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are two types of associations: persistent associations, which result from configuration file commands, and ephemeral associations, which result from protocol operations described below. A persistent association is never demobilized, although it may become dormant when the associated server becomes unreachable. An ephemeral association is mobilized when a message arrives from a server; for instance, a symmetric passive association is mobilized upon arrival of a symmetric active message. A broadcast client association is mobilized upon arrival of a broadcast server message, while a Manycast client association is mobilized upon arrival of a Manycast server message.&lt;/p&gt;
&lt;p&gt;Ordinarily, successful mobilization of an ephemeral association requires the server to be cryptographically authenticated to the dependent client. This can be done using either symmetric-key or public-key cryptography, as described in the &lt;a href=&#34;/archives/4.2.4-series/authopt&#34;&gt;Authentication Options&lt;/a&gt; page. The cryptographic means insure an unbroken chain of trust between the dependent client and the primary servers at the root of the synchronization subnet. We call this chain the &lt;em&gt;provenance&lt;/em&gt; of the client and define new vocabulary as to proventicate a client or provide proventic credentials. Once mobilized, ephemeral associations are demobilized when either (a) the server becomes unreachable or (b) the server refreshes the key media without notifying the client.&lt;/p&gt;
&lt;p&gt;There are three principal modes of operation: client/server, symmetric active/passive and broadcast. In addition, there are two modes using IP multicast support: multicast and manycast. These modes are selected based on the scope of service, intended flow of time and proventic values and means of configuration. Following is a summary of the operations in each mode.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;clientserver-mode&#34;&gt;Client/Server Mode&lt;/h4&gt;
&lt;p&gt;Client/server mode is probably the most common configuration in the Internet today. It operates in the classic remote-procedure-call (RPC) paradigm with stateless servers. In this mode a client sends a request to the server and expects a reply at some future time. In some contexts this would be described as a &amp;ldquo;pull&amp;rdquo; operation, in that the client pulls the time and proventic values from the server. A client is configured in client mode using the &lt;tt&gt;server&lt;/tt&gt; (sic) command and specifying the server IPv4 or IPv6 DNS name or address; the server requires no prior configuration. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme. In addition, two burst modes described below can be used in appropriate cases.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/h4&gt;
&lt;p&gt;Symmetric active/passive mode is intended for configurations were a clique of low-stratum peers operate as mutual backups for each other. Each peer operates with one or more primary reference sources, such as a radio clock, or a subset of secondary servers known to be reliable and proventicated. Should one of the peers lose all reference sources or simply cease operation, the other peers will automatically reconfigure so that time and proventication values can flow from the surviving peers to all the others in the clique. In some contexts this would be described as a &amp;ldquo;push-pull&amp;rdquo; operation, in that the peer either pulls or pushes the time and proventic values depending on the particular configuration.&lt;/p&gt;
&lt;p&gt;Symmetric peers operate with their sources in some NTP mode and with each other in symmetric mode. A peer is configured in symmetric active mode using the &lt;tt&gt;peer&lt;/tt&gt; command and specifying the other peer IPv4 or IPv6 DNS name or address. The other peer can also be configured in symmetric active mode in a similar way. However, if the other peer is not specifically configured in this way, a symmetric passive association is mobilized upon arrival of a symmetric active message. Since an intruder can impersonate a symmetric active peer and inject false time values, symmetric mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;broadcastmulticast-modes&#34;&gt;Broadcast/Multicast Modes&lt;/h4&gt;
&lt;p&gt;IPv4 broadcast mode in both NTPv3 and NTPv4 is limited to directly connected subnets such as Ethernets which support broadcast technology. Ordinarily, this technology does not operate beyond the first hop router or gateway. In IPv6 and where service is intended beyond the local subnet, IP multicasting can be used where supported by the operating system and the routers support the Internet Group Management Protocol (IGMP). Most current kernels and available routers do support IP multicast technology, although service providers are sometimes reluctant to deploy it.&lt;/p&gt;
&lt;p&gt;IPv4 broadcast mode is intended for configurations involving one or a few servers and a possibly very large client population on the same subnet. A broadcast server is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command and a IPv4 local subnet broadcast address. A broadcast client is configured using the &lt;tt&gt;broadcastclient&lt;/tt&gt; command, in which case it responds to broadcast messages received on any interface. Since an intruder can impersonate a broadcast server and inject false time values, this mode should always be cryptographically validated. The original NTPv3 authentication scheme is applicable in this mode, as well as the new NTPv4 Autokey proventication scheme.&lt;/p&gt;
&lt;p&gt;The server generates broadcast messages continuously at intervals specified by the &lt;tt&gt;minpoll&lt;/tt&gt; keyword and with a time-to-live span specified by the &lt;tt&gt;ttl&lt;/tt&gt; keyword. A broadcast client responds to the first message received by waiting a short interval to avoid implosion at the server. Then, the client polls the server in burst mode in order to quickly set the host clock and validate the source. This normally results in a volley of eight client/server cycles at 2-s intervals during which both the synchronization and cryptographic protocols run concurrently. Following the volley, the client computes the offset between the apparent broadcast time and the (unicast) client time. This offset is used to compensate for the propagation time between the broadcast server and client. Once the offset is computed, the server continues as before and the client sends no further messages. If for some reason the broadcast server does not respond to client messages, the client will time out the volley and continue in listen-only mode with a default propagation delay.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;multicasting&#34;&gt;Multicasting&lt;/h4&gt;
&lt;p&gt;Multicasting can be used to extend the scope of a timekeeping subnet in two ways: multicasting and manycasting. A general discussion of IP multicast technology is beyond the scope of this page. In simple terms a host or router sending to a IPv4 or IPv6 multicast group address expects all hosts or routers listening on this address to receive the message. There is no intrinsic limit on the number of senders or receivers and senders can be receivers and vice versa. The IANA has assigned multicast group address IPv4 224.0.1.1 and IPv6 FF05::101 (site local) to NTP, but these addresses should be used only where the multicast span can be reliably constrained to protect neighbor networks. In general, administratively scoped IPv4 group addresses should be used, as described in RFC-2365, or GLOP group addresses, as described in RFC-2770.&lt;/p&gt;
&lt;p&gt;A multicast server is configured using the &lt;tt&gt;broadcast&lt;/tt&gt; command, but with a multicast group address instead of a broadcast address. A multicast client is configured using the &lt;tt&gt;multicastclient&lt;/tt&gt; command with a multicast group address. However, there is a subtle difference between IPv4 broadcasting and multicasting. IPv4 broadcasting is specific to each interface and local subnet address. If more than one interface is attached to a machine, a separate &lt;tt&gt;broadcast&lt;/tt&gt; command applies to each one separately. This provides a way to limit exposure in a firewall, for example. For IPv6 the same distinction can be made using link-local prefix FF02 for each interface and site-local FF05 for all interfacesl.&lt;/p&gt;
&lt;p&gt;IP multicasting is a different paradigm. By design, multicast messages travel from the sender via a shortest-path or shared tree to the receivers, which may require these messages emit from one or all interfaces, but carry a common source address. However, it is possible to configure multiple multicast group addresses using multiple &lt;tt&gt;broadcast&lt;/tt&gt; or &lt;tt&gt;multicastclient&lt;/tt&gt; commands. Other than these particulars, multicast messages are processed just like broadcast messages. Note that the calibration feature in broadcast mode is extremely important, since IP multicast messages can travel far different paths through the IP routing fabric than ordinary IP unicast messages.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;manycasting&#34;&gt;Manycasting&lt;/h4&gt;
&lt;p&gt;Manycasting is a automatic discovery and configuration paradigm new to NTPv4. It is intended as a means for a multicast client to troll the nearby network neighborhood to find cooperating manycast servers, validate them using cryptographic means and evaluate their time values with respect to other servers that might be lurking in the vicinity. The intended result is that each manycast client mobilizes client associations with some number of the &amp;ldquo;best&amp;rdquo; of the nearby anycast servers, yet automatically reconfigures to sustain this number of servers should one or another fail. Additional information is on the &lt;a href=&#34;/archives/4.2.4-series/manyopt&#34;&gt;Automatic NTP Configuration Options&lt;/a&gt; page.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;burst-modes&#34;&gt;Burst Modes&lt;/h4&gt;
&lt;p&gt;There are two burst modes where a single poll event triggers a burst of eight packets at 2-s intervals instead of the usual one. The &lt;tt&gt;burst&lt;/tt&gt; mode sends a burst when the server is reachable, while the &lt;tt&gt;iburst&lt;/tt&gt; mode sends a burst when the server is unreachable. Each mode is independently of the other and both can be used if necessary. The &lt;tt&gt;calldelay&lt;/tt&gt; command can be used to increase the interval between the first and second packets in the burst in order to allow a modem to complete a call. Received server packets update the clock filter, which selects the best (most accurate) time values. When the last packet in the burst is sent, the next received packet updates the system variables and sets the system clock in the usual manner, as if only a single client/server cycle had occurred. The result is not only a rapid and reliable setting of the system clock, but a considerable reduction in network jitter.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;iburst&lt;/tt&gt; keyword is used where it is important to set the clock quickly when an association is first mobilized or first becomes reachable or when the network attachment requires an initial calling or training procedure. The burst is initiated only when the server first becomes reachable and results in good accuracy with intermittent connections typical of PPP and ISDN services. Outlyers due to initial dial-up delays, etc., are avoided and the client sets the clock within a few seconds after the first message.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;burst&lt;/tt&gt; keyword can be configured in cases of excessive network jitter or when the network attachment requires an initial calling or training procedure. The burst is initiated at each poll interval when the server is reachable. The burst does produce additional network overhead and can cause trouble if used indiscriminately. It should only be used where the poll interval is expected to settle to values at or above 1024 s.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Association Management</title>
      <link>/archives/4.2.6-series/assoc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.6-series/assoc/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice51.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Make sure who your friends are.&lt;/p&gt;
&lt;p&gt;Last update: 21:56 UTC Friday, December 28, 2007&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/assoc/#association-modes&#34;&gt;Association Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/assoc/#clientserver-mode&#34;&gt;Client/Server Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/assoc/#symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/assoc/#broadcastmulticast-modes&#34;&gt;Broadcast/Multicast Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/assoc/#manycast-mode&#34;&gt;Manycast Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/assoc/#orphan-mode&#34;&gt;Orphan Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/assoc/#burst-options&#34;&gt;Burst Options&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;association-modes&#34;&gt;Association Modes&lt;/h4&gt;
&lt;p&gt;This page describes the various modes of operation provided in NTPv4. Details about the configuration commands and options are given on the &lt;a href=&#34;/archives/4.2.6-series/confopt&#34;&gt;Configuration Options&lt;/a&gt; page. Details about the cryptographic authentication schemes are given on the &lt;a href=&#34;/archives/4.2.6-series/authopt&#34;&gt;Authentication Options&lt;/a&gt; page. Details about the automatic server discovery schemes are described on the &lt;a href=&#34;/archives/4.2.6-series/manyopt&#34;&gt;Automatic Server Discovery Schemes&lt;/a&gt; page. Additional information is available in the papers, reports, memoranda and briefings on the &lt;a href=&#34;http://www.eecis.udel.edu/~mills/ntp.html&#34;&gt;NTP Project&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;There are three types of associations in NTP: persistent, preemptable and ephemeral. Persistent associations are mobilized by a configuration command and never demobilized. Preemptable associations, which are new to NTPv4, are mobilized by a configuration command which includes the prempt option and are demobilized by a &amp;ldquo;better&amp;rdquo; server or by timeout, but only if the number of survivors exceeds the threshold set by the tos maxclock configuration command. Ephemeral associations are mobilized upon arrival of designated messages and demobilized by timeout.&lt;/p&gt;
&lt;p&gt;Ordinarily, successful mobilization of ephemeral associations requires the server to be cryptographically authenticated to the client. This can be done using either symmetric key or Autokey public key cryptography, as described in the &lt;a href=&#34;/archives/4.2.6-series/authopt&#34;&gt;Authentication Options&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;There are three principal modes of operation in NTP: client/server, symmetric active/passive and broadcast/multicast. There are three automatic server discovery schemes in NTP: broadcast/multicast, manycast and pool described on the &lt;a href=&#34;/archives/4.2.6-series/manyopt&#34;&gt;Automatic Server Discovery Schemes&lt;/a&gt; page. In addition, the orphan mode and burst options described on this page can be used in appropriate cases.&lt;/p&gt;
&lt;p&gt;Following is a summary of the operations in each mode. Note that reference to option applies to the commands described on the &lt;a href=&#34;/archives/4.2.6-series/confopt&#34;&gt;Configuration Options&lt;/a&gt; page. See that page for applicability and defaults.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;clientserver-mode&#34;&gt;Client/Server Mode&lt;/h4&gt;
&lt;p&gt;Client/server mode is the most common configuration in the Internet today. It operates in the classic remote-procedure-call (RPC) paradigm with stateless servers and stateful clients. In this mode a host sends a client (mode 3) request to the specified server and expects a server (mode 4) reply at some future time. In some contexts this would be described as a &amp;ldquo;pull&amp;rdquo; operation, in that the host pulls the time and related values from the server.&lt;/p&gt;
&lt;p&gt;A host is configured in client mode using the &lt;tt&gt;server&lt;/tt&gt; (sic) command and specifying the server DNS name or IPv4 or IPv6 address; the server requires no prior configuration. The &lt;tt&gt;iburst&lt;/tt&gt; option described later on this page is recommended for clients, as this speeds up initial synchronization from several minutes to several seconds. The &lt;tt&gt;burst&lt;/tt&gt; option described later on this page can be useful to reduce jitter on very noisy dial-up or ISDN network links.&lt;/p&gt;
&lt;p&gt;Ordinarily, the program automatically manages the poll interval between the default minimum and maximum values. The &lt;tt&gt;minpoll&lt;/tt&gt; and &lt;tt&gt;maxpoll&lt;/tt&gt; options can be used to bracket the range. Unless noted otherwise, these options should not be used with reference clock drivers.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/h4&gt;
&lt;p&gt;Symmetric active/passive mode is intended for configurations were a clique of low-stratum peers operate as mutual backups for each other. Each peer operates with one or more primary reference sources, such as a radio clock, or a set of secondary (stratum, 2) servers known to be reliable and authentic. Should one of the peers lose all reference sources or simply cease operation, the other peers will automatically reconfigure so that time and related values can flow from the surviving peers to all hosts in the subnet. In some contexts this would be described as a &amp;ldquo;push-pull&amp;rdquo; operation, in that the peer either pulls or pushes the time and related values depending on the particular configuration.&lt;/p&gt;
&lt;p&gt;In symmetric active mode a peer symmetric active (mode 1) message to a designated peer. If a matching configured symmetric active association is found, the designated peer returns a symmetric active message. If no matching association is found, the designated peer mobilizes a ephemeral symmetric passive association and returns a symmetric passive (mode 2) message. Since an intruder can impersonate a symmetric active peer and cause a spurious symmetric passive association to be mobilized, symmetric passive mode should always be cryptographically validated.&lt;/p&gt;
&lt;p&gt;A peer is configured in symmetric active mode using the &lt;tt&gt;peer&lt;/tt&gt; command and specifying the other peer DNS name or IPv4 or IPv6 address. The &lt;tt&gt;burst&lt;/tt&gt; and &lt;tt&gt;iburst&lt;/tt&gt; options should not be used in symmetric modes, as this can upset the intended symmetry of the protocol and result in spurious duplicate or dropped messages.&lt;/p&gt;
&lt;p&gt;As symmetric modes are most often used as root servers for moderate to large subnets where rapid response is required, it is generally best to set the minimum and maximum poll intervals of each root server to the same value using the &lt;tt&gt;minpoll&lt;/tt&gt; and &lt;tt&gt;maxpoll&lt;/tt&gt; options.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;broadcastmulticast-modes&#34;&gt;Broadcast/Multicast Modes&lt;/h4&gt;
&lt;p&gt;NTP broadcast and multicast modes are intended for configurations involving one or a few servers and a possibly very large client population. Broadcast mode can be used with Ethernet, FDDI and WiFi spans interconnected by hubs or switches. Ordinarily, broadcast packets do not extend beyond a level-3 router. Where service is intended beyond a level-3 router, multicast mode can be used. Additional information is on the &lt;a href=&#34;/archives/4.2.6-series/manyopt&#34;&gt;Automatic NTP Configuration Options&lt;/a&gt; page.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;manycast-mode&#34;&gt;Manycast Mode&lt;/h4&gt;
&lt;p&gt;Manycast mode is a automatic discovery and configuration paradigm new to NTPv4. It is intended as a means for a multicast client to troll the nearby network neighborhood to find cooperating manycast servers, validate them using cryptographic means and evaluate their time values with respect to other servers that might be lurking in the vicinity. The intended result is that each manycast client mobilizes ephemeral client associations with some number of the &amp;ldquo;best&amp;rdquo; of the nearby manycast servers, yet automatically reconfigures to sustain this number of servers should one or another fail. Additional information is on the &lt;a href=&#34;/archives/4.2.6-series/manyopt&#34;&gt;Automatic NTP Configuration Options&lt;/a&gt; page.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;orphan-mode&#34;&gt;Orphan Mode&lt;/h4&gt;
&lt;p&gt;Sometimes an NTP subnet becomes isolated from all UTC sources such as local reference clocks or Internet time servers. In such cases it may be necessary that the subnet servers and clients remain synchronized to a common timescale, not necessarily the UTC timescale. Previously, this function was provided by the local clock driver to simulate a UTC source. A server with this driver could be used to synchronize other hosts in the subnet directly or indirectly.&lt;/p&gt;
&lt;p&gt;There are many disadvantages using the local clock driver, primarily that the subnet is vulnerable to single-point failures and multiple server redundancy is not possible. Orphan mode is intended to replace the local clock driver. It provides a single simulated UTC source with multiple servers and provides seamless switching as servers fail and recover.&lt;/p&gt;
&lt;p&gt;A common configuration for private networks includes one or more core servers operating at the lowest stratum. Good practice is to configure each of these servers as backup for the others using symmetric or broadcast modes. As long as at least one core server can reach a UTC source, the entire subnet can synchronize to it.&lt;/p&gt;
&lt;p&gt;If no UTC sources are available to any core server, one of them can provide a simulated UTC source for all other hosts in the subnet. However, only one core server can simulate the UTC source and all direct dependents, called orphan children, must select the same one, called the orphan parent.&lt;/p&gt;
&lt;p&gt;A host is enabled for orphan mode using the &lt;tt&gt;tos orphan &lt;em&gt;stratum&lt;/em&gt;&lt;/tt&gt; command, where &lt;tt&gt;&lt;em&gt;stratum&lt;/em&gt;&lt;/tt&gt; is some stratum less than 16 and greater than any anticipated stratum that might occur with configured Internet time servers. However, sufficient headroom should remain so every subnet host dependent on the orphan children has stratum less than 16. Where no associations for other servers or reference clocks are configured, the orphan stratum can be set to 1. These are the same considerations that guide the local clock driver stratum selection.&lt;/p&gt;
&lt;p&gt;A orphan parent with no sources shows reference ID &lt;code&gt;LOOP&lt;/code&gt; if operating at stratum 1 and 127.0.0.1 (Unix loopback address) otherwise. While ordinary NTP clients use a selection metric based on delay and dispersion, orphan children use a metric computed from the IP address of each core server. Each orphan child chooses the orphan parent as the root server with the smallest metric.&lt;/p&gt;
&lt;p&gt;For orphan mode to work well, each core server with available sources should operate at the same stratum. All core servers and orphan children should include the same &lt;code&gt;tos&lt;/code&gt; command in the configuration file. Each orphan child should include in the configuration file all root servers.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/peer.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;For example, consider the peer network configuration above, where two or more campus primary or secondary (stratum 2) servers are configured with reference clocks or public Internet primary servers and with each other using symmetric modes. With this configuration a server that loses all sources continues to discipline the system clock using the other servers as backup. Only the core servers and orphan children need to be enabled for orphan mode.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/archives/pic/broad.gif&#34; alt=&#34;gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;For broadcast networks each core server is configured in both broadcast server and broadcast client modes as shown above. Orphan children operate as broadcast clients of all core servers. As in peer networks, the core servers back up each other and only they and the orphan children need to be enabled for orphan mode.&lt;/p&gt;
&lt;p&gt;In normal operation subnet hosts operate below stratum 5, so the subnet is automatically configured as described in the NTP specification. If all UTC sources are lost, all core servers become orphans and the orphan children will select the same root server to become the orphan parent.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;burst-options&#34;&gt;Burst Options&lt;/h4&gt;
&lt;p&gt;There are two burst options where a single poll event triggers a burst of eight packets at 2-s intervals instead of the normal one packet. They should be used only with the &lt;tt&gt;server&lt;/tt&gt; and &lt;tt&gt;pool&lt;/tt&gt; commands, but not with reference clock drivers nor symmetric peers. The &lt;tt&gt;burst&lt;/tt&gt; option sends a burst when the server is reachable, while the &lt;tt&gt;iburst&lt;/tt&gt; option sends a burst when the server is unreachable. Each mode is independently of the other and both can be used at the same time. In either mode the client sends one packet, waits for the reply, then sends the remaining packets in the burst. This may be useful to allow a modem to complete a call.&lt;/p&gt;
&lt;p&gt;In both modes received server packets update the clock filter, which selects the best (most accurate) time values. When the last packet in the burst is sent, the next received packet updates the system variables and adjusts the system clock as if only a single packet exchange had occurred.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;iburst&lt;/tt&gt; option is useful where the system clock must be set quickly or when the network attachment requires an initial calling or training sequence. The burst is initiated only when the server first becomes reachable. This improves accuracy with intermittent connections typical of PPP and ISDN services. Outliers due to initial dial-up delays, etc., are avoided and the client sets the clock within a few seconds after the first received packet.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;burst&lt;/tt&gt; option can be configured in cases of excessive network jitter or when the network attachment requires an initial calling or training sequence. The burst is initiated at each poll interval when the server is reachable. The number of packets in the burst is determined by the poll interval so that the average interval between packets is no less than 16. At a poll interval of 16 s, only one packet is sent in the burst; at 32 s, two packets are sent and so forth until at 128 s and above eight packets are sent.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Association Management</title>
      <link>/archives/4.2.8-series/assoc/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.8-series/assoc/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice51.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/~mills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Make sure who your friends are.&lt;/p&gt;
&lt;p&gt;Last update: 31-Jan-2014 06:54 UTC&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.8-series/assoc/#association-modes&#34;&gt;Association Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.8-series/assoc/#clientserver-mode&#34;&gt;Client/Server Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.8-series/assoc/#symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.8-series/assoc/#broadcastmulticast-modes&#34;&gt;Broadcast/Multicast Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.8-series/assoc/#manycast-and-pool-modes&#34;&gt;Manycast and Pool Modes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.8-series/assoc/#poll-interval-management&#34;&gt;Poll Interval Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.8-series/assoc/#burst-options&#34;&gt;Burst Options&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;association-modes&#34;&gt;Association Modes&lt;/h4&gt;
&lt;p&gt;This page describes the various modes of operation provided in NTPv4. There are three types of associations in NTP: &lt;em&gt;persistent&lt;/em&gt;, &lt;em&gt;preemptable&lt;/em&gt; and &lt;em&gt;ephemeral&lt;/em&gt;. Persistent associations are mobilized by a configuration command and never demobilized. Preemptable associations, which are new to NTPv4, are mobilized by a configuration command which includes the &lt;tt&gt;preempt&lt;/tt&gt; option or upon arrival of an automatic server discovery packet. They are demobilized by timeout or when preempted by a &amp;ldquo;better&amp;rdquo; server, as described on the &lt;a href=&#34;/archives/4.2.8-series/discover&#34;&gt;Automatic Server Discovery Schemes&lt;/a&gt; page. Ephemeral associations are mobilized upon arrival of broadcast or multicast server packets and demobilized by timeout.&lt;/p&gt;
&lt;p&gt;Ordinarily, successful mobilization of ephemeral associations requires the server to be cryptographically authenticated to the client. This can be done using either symmetric key or Autokey public key cryptography, as described on the &lt;a href=&#34;/archives/4.2.8-series/authentic&#34;&gt;Authentication Support&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;There are three principal modes of operation in NTP: client/server, symmetric active/passive and broadcast/multicast. There are three automatic server discovery schemes in NTP: broadcast/multicast, manycast and pool described on the &lt;a href=&#34;/archives/4.2.8-series/discover&#34;&gt;Automatic Server Discovery Schemes&lt;/a&gt; page. In addition, the &lt;a href=&#34;/archives/4.2.8-series/assoc/#burst-options&#34;&gt;burst options&lt;/a&gt; and &lt;a href=&#34;/archives/4.2.8-series/orphan&#34;&gt;orphan mode&lt;/a&gt; can be used in appropriate cases.&lt;/p&gt;
&lt;p&gt;Following is a summary of the operations in each mode. Note that reference to option applies to the commands described on the &lt;a href=&#34;/archives/4.2.8-series/confopt&#34;&gt;Server Commands and Options&lt;/a&gt; page. See that page for applicability and defaults.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;clientserver-mode&#34;&gt;Client/Server Mode&lt;/h4&gt;
&lt;p&gt;Client/server mode is the most common configuration in the Internet today. It operates in the classic remote-procedure-call (RPC) paradigm with stateless servers and stateful clients. In this mode a host sends a client (mode 3) request to the specified server and expects a server (mode 4) reply at some future time. In some contexts this would be described as a &amp;ldquo;pull&amp;rdquo; operation, in that the host pulls the time and related values from the server.&lt;/p&gt;
&lt;p&gt;A host is configured in client mode using the &lt;tt&gt;server&lt;/tt&gt; (sic) command and specifying the server DNS name or IPv4 or IPv6 address; the server requires no prior configuration. The &lt;tt&gt;iburst&lt;/tt&gt; option described later on this page is recommended for clients, as this speeds up initial synchronization from several minutes to several seconds. The &lt;tt&gt;burst&lt;/tt&gt; option described later on this page can be useful to reduce jitter on very noisy dial-up or ISDN network links.&lt;/p&gt;
&lt;p&gt;Ordinarily, the program automatically manages the poll interval between the default minimum and maximum values. The &lt;tt&gt;minpoll&lt;/tt&gt; and &lt;tt&gt;maxpoll&lt;/tt&gt; options can be used to bracket the range. Unless noted otherwise, these options should not be used with reference clock drivers.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-activepassive-mode&#34;&gt;Symmetric Active/Passive Mode&lt;/h4&gt;
&lt;p&gt;Symmetric active/passive mode is intended for configurations where a clique of low-stratum peers operate as mutual backups for each other. Each peer operates with one or more primary reference sources, such as a reference clock, or a set of secondary (stratum, 2) servers known to be reliable and authentic. Should one of the peers lose all reference sources or simply cease operation, the other peers will automatically reconfigure so that time and related values can flow from the surviving peers to all hosts in the subnet. In some contexts this would be described as a &amp;ldquo;push-pull&amp;rdquo; operation, in that the peer either pulls or pushes the time and related values depending on the particular configuration.&lt;/p&gt;
&lt;p&gt;A symmetric active peer sends a symmetric active (mode 1) message to a designated peer. If a matching configured symmetric active association is found, the designated peer returns a symmetric active message. If no matching association is found, the designated peer mobilizes a ephemeral symmetric passive association and returns a symmetric passive (mode 2) message. Since an intruder can impersonate a symmetric active peer and cause a spurious symmetric passive association to be mobilized, symmetric passive mode should always be cryptographically validated.&lt;/p&gt;
&lt;p&gt;A peer is configured in symmetric active mode using the &lt;tt&gt;peer&lt;/tt&gt; command and specifying the other peer DNS name or IPv4 or IPv6 address. The &lt;tt&gt;burst&lt;/tt&gt; and &lt;tt&gt;iburst&lt;/tt&gt; options should not be used in symmetric modes, as this can upset the intended symmetry of the protocol and result in spurious duplicate or dropped messages.&lt;/p&gt;
&lt;p&gt;As symmetric modes are most often used as root servers for moderate to large subnets where rapid response is required, it is generally best to set the minimum and maximum poll intervals of each root server to the same value using the &lt;tt&gt;minpoll&lt;/tt&gt; and &lt;tt&gt;maxpoll&lt;/tt&gt; options.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;broadcastmulticast-modes&#34;&gt;Broadcast/Multicast Modes&lt;/h4&gt;
&lt;p&gt;NTP broadcast and multicast modes are intended for configurations involving one or a few servers and a possibly very large client population. Broadcast mode can be used with Ethernet, FDDI and WiFi spans interconnected by hubs or switches. Ordinarily, broadcast packets do not extend beyond a level-3 router. Where service is intended beyond a level-3 router, multicast mode can be used. Additional information is on the &lt;a href=&#34;/archives/4.2.8-series/discover&#34;&gt;Automatic NTP Configuration Options&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;A server is configured to send broadcast or multicast messages using the &lt;tt&gt;broadcast&lt;/tt&gt; command and specifying the subnet address for broadcast or the multicast group address for multicast. A broadcast client is enabled using the &lt;a href=&#34;/archives/4.2.8-series/confopt/#auxiliary-commands&#34;&gt;&lt;tt&gt;broadcastclient&lt;/tt&gt;&lt;/a&gt; command, while a multicast client is enabled using the &lt;a href=&#34;/archives/4.2.8-series/confopt/#auxiliary-commands&#34;&gt;&lt;tt&gt;multicastclient&lt;/tt&gt;&lt;/a&gt; command and specifying the multicast group address. Multiple commands of either type can be used. However, the association is not mobilized until the first broadcast or multicast message is actually received.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;manycast-and-pool-modes&#34;&gt;Manycast and Pool Modes&lt;/h4&gt;
&lt;p&gt;Manycast and pool modes are automatic discovery and configuration paradigms new to NTPv4. They are intended as a means for a client to troll the nearby network neighborhood to find cooperating willing servers, validate them using cryptographic means and evaluate their time values with respect to other servers that might be lurking in the vicinity. The intended result is that each client mobilizes ephemeral client associations with some number of the &amp;ldquo;best&amp;rdquo; of the nearby servers, yet automatically reconfigures to sustain this number of servers should one or another fail. Additional information is on the &lt;a href=&#34;/archives/4.2.8-series/discover&#34;&gt;Automatic Server Discovery Schemes&lt;/a&gt; page.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;poll-interval-management&#34;&gt;Poll Interval Management&lt;/h4&gt;
&lt;p&gt;NTP uses an intricate heuristic algorithm to automatically control the poll interval for maximum accuracy consistent with minimum network overhead. The algorithm measures the incidental offset and jitter to determine the best poll interval. When &lt;tt&gt;ntpd&lt;/tt&gt; starts, the interval is the default minimum 64 s. Under normal conditions when the clock discipline has stabilized, the interval increases in steps to the default maximum 1024 s. In addition, should a server become unreachable after some time, the interval increases in steps to the maximum in order to reduce network overhead. Additional information about the algorithm is on the &lt;a href=&#34;/archives/4.2.8-series/poll&#34;&gt;Poll Program&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The default poll interval range is suitable for most conditions, but can be changed using options on the &lt;a href=&#34;/archives/4.2.8-series/confopt&#34;&gt;Server Commands and Options&lt;/a&gt; and &lt;a href=&#34;/archives/4.2.8-series/miscopt&#34;&gt;Miscellaneous Options&lt;/a&gt; pages. However, when using maximum intervals much larger than the default, the residual clock frequency error must be small enough for the discipline loop to capture and correct. The capture range is 500 PPM with a 64-s interval decreasing by a factor of two for each interval doubling. At a 36-hr interval, for example, the capture range is only 0.24 PPM.&lt;/p&gt;
&lt;p&gt;In the NTPv4 specification and reference implementation, the poll interval is expressed in log&lt;sub&gt;2&lt;/sub&gt; units, properly called the &lt;em&gt;poll exponent.&lt;/em&gt; It is constrained by the lower limit &lt;tt&gt;minpoll&lt;/tt&gt; and upper limit &lt;tt&gt;maxpoll&lt;/tt&gt; options of the &lt;a href=&#34;/archives/4.2.8-series/confopt/#server-command-options&#34;&gt;&lt;tt&gt;server&lt;/tt&gt;&lt;/a&gt; command. The limits default to 6 (64 s) and 10 (1024 s), respectively, which are appropriate for the vast majority of cases.&lt;/p&gt;
&lt;p&gt;As a rule of thumb, the expected errors increase by a factor of two as the poll interval increases by a factor of four. The poll interval algorithm slowly increases the poll interval when jitter dominates the error budget, but quickly reduces the interval when wander dominates it. More information about this algorithm is on the &lt;a href=&#34;/archives/4.2.8-series/warp&#34;&gt;How NTP Works&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;There is normally no need to change the poll limits, as the poll interval is managed automatically as a function of prevailing jitter and wander. The most common exceptions are the following.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;With fast, lightly loaded LANs and modern processors, the nominal Allan intercept is about 500 s. In these cases the expected errors can be further reduced using a poll exponent of 4 (16 s). In the case of the pulse-per-second (PPS) driver, this is the recommended value.&lt;/li&gt;
&lt;li&gt;With symmetric modes the most stable behavior results when both peers are configured in symmetric active mode with matching poll intervals of 6 (64 s).&lt;/li&gt;
&lt;li&gt;The poll interval should not be modified for reference clocks, with the single exception the ACTS telephone modem driver. In this case the recommended minimum and maximum intervals are 12 (1.1 hr) and 17 (36 hr), respectively.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;burst-options&#34;&gt;Burst Options&lt;/h4&gt;
&lt;p&gt;Occasionally it is necessary to send packets temporarily at intervals less than the poll interval. For instance, with the &lt;tt&gt;burst&lt;/tt&gt; and &lt;tt&gt;iburst&lt;/tt&gt; options of the &lt;a href=&#34;/archives/4.2.8-series/confopt/#server-command-options&#34;&gt;&lt;tt&gt;server&lt;/tt&gt;&lt;/a&gt; command, the poll program sends a burst of several packets at 2-s intervals. In either case the poll program avoids sending needless packets if the server is not responding. The client begins a burst with a single packet. When the first packet is received from the server, the client continues with the remaining packets in the burst. If the first packet is not received within 64 s, it will be sent again for two additional retries before beginning backoff. The result is to minimize network load if the server is not responding. Additional details are on the &lt;a href=&#34;/archives/4.2.8-series/poll&#34;&gt;Poll Program&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;There are two burst options where a single poll event triggers a burst. They should be used only with the &lt;tt&gt;server&lt;/tt&gt; and &lt;tt&gt;pool&lt;/tt&gt; commands, but not with reference clock drivers nor symmetric mode peers. In both modes, received server packets update the clock filter, which selects the best (most accurate) time values. When the last packet in the burst is sent, the next received packet updates the system variables and adjusts the system clock as if only a single packet exchange had occurred.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;iburst&lt;/tt&gt; option is useful where the system clock must be set quickly or when the network attachment requires an initial calling or training sequence, as in PPP or ISDN services. In general, this option is recommended for &lt;tt&gt;server&lt;/tt&gt; and &lt;tt&gt;pool&lt;/tt&gt; commands. A burst is sent only when the server is unreachable; in particular, when first starting up. Ordinarily, the clock is set within a few seconds after the first received packet. See the &lt;a href=&#34;/archives/4.2.8-series/clock&#34;&gt;Clock State Machine&lt;/a&gt; page for further details about the startup behavior.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;burst&lt;/tt&gt; option is useful in cases of severe network jitter or when the network attachment requires an initial calling or training sequence. This option is recommended when the minimum poll exponent is larger than 10 (1024 s). A burst is sent only when the server is reachable. The number of packets in the burst is determined by the poll interval so that the average interval between packets (headway) is no less than the minimum poll interval for the association.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Austron 2200A/2201A GPS Receivers</title>
      <link>/archives/3-5.93e/driver10/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/3-5.93e/driver10/</guid>
      <description>
        
        
        &lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver10/#synopsis&#34;&gt;Synopsis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver10/#description&#34;&gt;Description&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver10/#monitor-data&#34;&gt;Monitor Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver10/#fudge-factors&#34;&gt;Fudge Factors&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/driver10/#additional-information&#34;&gt;Additional Information&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;synopsis&#34;&gt;Synopsis&lt;/h4&gt;
&lt;p&gt;Address: 127.127.10.&lt;em&gt;u&lt;/em&gt;&lt;br&gt;
Reference ID: &lt;tt&gt;GPS&lt;/tt&gt;&lt;br&gt;
Driver ID: &lt;tt&gt;GPS_AS2201&lt;/tt&gt;&lt;br&gt;
Serial Port: &lt;tt&gt;/dev/gps_u_&lt;/tt&gt;; 9600 baud, 8-bits, no parity&lt;br&gt;
Features: &lt;tt&gt;tty_clk&lt;/tt&gt;, &lt;tt&gt;ppsclock&lt;/tt&gt; (required)&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;description&#34;&gt;Description&lt;/h4&gt;
&lt;p&gt;This driver supports the Austron 2200A/2201A GPS/LORAN Synchronized Clock and Timing Receiver connected via a serial port. It supports several special features of the clock, including the Input Buffer Module, Output Buffer Module, IRIG-B Interface Module and LORAN Assist Module. It requires the RS232 Serial Interface module for communication with the driver. It requires the &lt;code&gt;ppsclock&lt;/code&gt; streams module described in the &lt;a href=&#34;/archives/3-5.93e/ldisc&#34;&gt;Line Disciplines and Streams Drivers&lt;/a&gt; page. It also requires a gadget box and 1-PPS level converter, such as described in the &lt;a href=&#34;/archives/3-5.93e/pps&#34;&gt;Pulse-per-second (PPS) Signal Interfacing&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;This receiver is capable of a comprehensive and large volume of statistics and operational data. The specific data collection commands and attributes are embedded in the driver source code; however, the collection process can be enabled or disabled using the flag4 flag. If set, collection is enabled; if not, which is the default, it is disabled. A comprehensive suite of data reduction and summary scripts is in the ./scripts/stats directory of the xntp3 distribution.&lt;/p&gt;
&lt;p&gt;To achieve the high accuracy this device provides, it is necessary to use the &lt;tt&gt;ppsclock&lt;/tt&gt; feature of the xntp3 program distribution or, alternatively, to install the kernel modifications described in the README.kern. The clock can be wired to provide time to a single CPU or bussed in parallel to several CPUs, with one CPU controlling the receiver and the others just listening. Fair accuracy can be achieved in the single-CPU configuration without use of the 1-pps signal, but in multiple CPU configurations accuracy is severely degraded without it.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;monitor-data&#34;&gt;Monitor Data&lt;/h4&gt;
&lt;p&gt;When enabled by the &lt;tt&gt;flag4&lt;/tt&gt; fudge flag, every received timecode is written as-is to the &lt;tt&gt;clockstats&lt;/tt&gt; file.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;fudge-factors&#34;&gt;Fudge Factors&lt;/h4&gt;
&lt;dt&gt;&lt;tt&gt;time1 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the time offset calibration factor, in seconds and fraction, with default 0.0.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;time2 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Not used by this driver.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;stratum _number_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the driver stratum, in decimal from 0 to 15, with default 0.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;refid _string_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the driver reference identifier, an ASCII string from one to four characters, with default &lt;tt&gt;GPS&lt;/tt&gt;.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag1 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Not used by this driver.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag2 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Not used by this driver.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag3 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Enable &lt;tt&gt;ppsclock&lt;/tt&gt; line discipline/streams module if set.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;flag4 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Enable &lt;tt&gt;clockstats&lt;/tt&gt; recording if set.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;additional-information&#34;&gt;Additional Information&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;/archives/3-5.93e/refclock&#34;&gt;Reference Clock Drivers&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Austron 2200A/2201A GPS Receivers</title>
      <link>/archives/drivers/driver10/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/drivers/driver10/</guid>
      <description>
        
        
        &lt;p&gt;Author: David L. Mills (&lt;a href=&#34;mailto:mills@udel.edu&#34;&gt;mills@udel.edu&lt;/a&gt;)&lt;br&gt;
Last update: 11-Sep-2010 05:56 UTC&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver10/#synopsis&#34;&gt;Synopsis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver10/#description&#34;&gt;Description&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver10/#monitor-data&#34;&gt;Monitor Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver10/#fudge-factors&#34;&gt;Fudge Factors&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/drivers/driver10/#additional-information&#34;&gt;Additional Information&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;synopsis&#34;&gt;Synopsis&lt;/h4&gt;
&lt;p&gt;Address: 127.127.10.&lt;em&gt;u&lt;/em&gt;&lt;br&gt;
Reference ID: &lt;tt&gt;GPS&lt;/tt&gt;&lt;br&gt;
Driver ID: &lt;tt&gt;GPS_AS2201&lt;/tt&gt;&lt;br&gt;
Serial Port: &lt;tt&gt;/dev/gps_u_&lt;/tt&gt;; 9600 baud, 8-bits, no parity&lt;br&gt;
Features: &lt;tt&gt;tty_clk&lt;/tt&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;description&#34;&gt;Description&lt;/h4&gt;
&lt;p&gt;This driver supports the Austron 2200A/2201A GPS/LORAN Synchronized Clock and Timing Receiver connected via a serial port. It supports several special features of the clock, including the Input Buffer Module, Output Buffer Module, IRIG-B Interface Module and LORAN Assist Module. It requires the RS232 Buffered Serial Interface module for communication with the driver.&lt;/p&gt;
&lt;p&gt;For use with a single computer, the receiver can be connected directly to the receiver. For use with multiple computers, one of them is connected directly to the receiver and generates the polling messages. The other computers just listen to the receiver output directly or through a buffer amplifier. For computers that just listen, &lt;tt&gt;fudge flag2&lt;/tt&gt; must be set and the &lt;tt&gt;ppsclock&lt;/tt&gt; streams module configured on each of them.&lt;/p&gt;
&lt;p&gt;This receiver is capable of a comprehensive and large volume of statistics and operational data. The specific data collection commands and attributes are embedded in the driver source code; however, the collection process can be enabled or disabled using the flag4 flag. If set, collection is enabled; if not, which is the default, it is disabled. A comprehensive suite of data reduction and summary scripts is in the ./scripts/stats directory of the ntp3 distribution.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;monitor-data&#34;&gt;Monitor Data&lt;/h4&gt;
&lt;p&gt;When enabled by the &lt;tt&gt;flag4&lt;/tt&gt; fudge flag, every received timecode is written as-is to the &lt;tt&gt;clockstats&lt;/tt&gt; file.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;fudge-factors&#34;&gt;Fudge Factors&lt;/h4&gt;
&lt;dl&gt;
&lt;dt&gt;&lt;tt&gt;time1 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Specifies the time offset calibration factor, in seconds and fraction, with default 0.0.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;time2 _time_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Not used by this driver.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;stratum _number_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Specifies the driver stratum, in decimal from 0 to 15, with default 0.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;refid _string_&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Specifies the driver reference identifier, an ASCII string from one to four characters, with default &lt;tt&gt;GPS&lt;/tt&gt;.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag1 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Not used by this driver.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag2 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Set for computers that listen-only.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag3 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Not used by this driver.&lt;/dd&gt;
&lt;dt&gt;&lt;tt&gt;flag4 0 | 1&lt;/tt&gt;&lt;/dt&gt;
&lt;dd&gt;Enable verbose &lt;tt&gt;clockstats&lt;/tt&gt; recording if set.&lt;/dd&gt;
&lt;/dl&gt;
&lt;hr&gt;
&lt;h4 id=&#34;additional-information&#34;&gt;Additional Information&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;/archives/4.2.8-series/refclock&#34;&gt;Reference Clock Drivers&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: authcert - DES validation program</title>
      <link>/archives/3-5.93e/authcert/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/3-5.93e/authcert/</guid>
      <description>
        
        
        &lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/authcert/#synopsis&#34;&gt;Synopsis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/authcert/#description&#34;&gt;Description&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/authcert/#files&#34;&gt;Files&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;synopsis&#34;&gt;Synopsis&lt;/h4&gt;
&lt;p&gt;&lt;tt&gt;authcert&lt;/tt&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;description&#34;&gt;Description&lt;/h4&gt;
&lt;p&gt;This program verifies whether the DES encryption algorithm is operating correctly in the particular architecture. The program reads a line from the standard input containing a key, plaintext block and the corresponding encrypted ciphertext block, respectively, as in the following&lt;/p&gt;
&lt;pre&gt;0000000000000000 0000000000000000 8CA64DE9C1B123A7
FFFFFFFFFFFFFFFF FFFFFFFFFFFFFFFF 7359B2163E4EDC58
3000000000000000 1000000000000001 958E6E627A05557B
1111111111111111 1111111111111111 F40379AB9E0EC533
0123456789ABCDEF 1111111111111111 17668DFC7292532D
1111111111111111 0123456789ABCDEF 8A5AE1F81AB8F2DD
0000000000000000 0000000000000000 8CA64DE9C1B123A7
FEDCBA9876543210 0123456789ABCDEF ED39D950FA74BCC4
7CA110454A1A6E57 01A1D6D039776742 690F5B0D9A26939B
&lt;/pre&gt;
&lt;p&gt;and generates output as in the following&lt;/p&gt;
&lt;pre&gt; K: 0000000000000000 P: 0000000000000000 C: 8ca64de9c1b123a7 OK
 K: ffffffffffffffff P: ffffffffffffffff C: 7359b2163e4edc58 OK
 K: 3000000000000000 P: 1000000000000001 C: 958e6e627a05557b OK
 K: 1111111111111111 P: 1111111111111111 C: f40379ab9e0ec533 OK
 K: 0123456789abcdef P: 1111111111111111 C: 17668dfc7292532d OK
 K: 1111111111111111 P: 0123456789abcdef C: 8a5ae1f81ab8f2dd OK
 K: 0000000000000000 P: 0000000000000000 C: 8ca64de9c1b123a7 OK
 K: fedcba9876543210 P: 0123456789abcdef C: ed39d950fa74bcc4 OK
 K: 7ca110454a1a6e57 P: 01a1d6d039776742 C: 690f5b0d9a26939b OK
&lt;/pre&gt;
&lt;hr&gt;
&lt;h4 id=&#34;files&#34;&gt;Files&lt;/h4&gt;
&lt;p&gt;&lt;tt&gt;./authstuff/certdata&lt;/tt&gt; - a representative test file&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Authentication Commands and Options</title>
      <link>/archives/4.2.8-series/authopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.8-series/authopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice44.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/%7emills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Our resident cryptographer; now you see him, now you don&amp;rsquo;t.&lt;/p&gt;
&lt;p&gt;Last update: 24-Jul-2018 07:27 UTC&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;commands-and-options&#34;&gt;Commands and Options&lt;/h4&gt;
&lt;p&gt;Unless noted otherwise, further information about these commands is on the &lt;a href=&#34;/archives/4.2.8-series/authentic&#34;&gt;Authentication Support&lt;/a&gt; page.&lt;/p&gt;
&lt;dt id=&#34;automax&#34;&gt;&lt;tt&gt;automax [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between regenerations of the session key list used with the Autokey protocol, as a power of 2 in seconds. Note that the size of the key list for each association depends on this interval and the current poll interval. The default interval is 12 (about 1.1 hr). For poll intervals above the specified interval, a session key list with a single entry will be regenerated for every message sent. See the &lt;a href=&#34;/archives/4.2.8-series/autokey&#34;&gt;Autokey Public Key Authentication&lt;/a&gt; page for further information.&lt;/p&gt;
&lt;dt id=&#34;controlkey&#34;&gt;&lt;tt&gt;controlkey _keyid_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key ID for the &lt;a href=&#34;/archives/4.2.8-series/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; utility, which uses the standard protocol defined in RFC-1305. The &lt;tt&gt;&lt;em&gt;keyid&lt;/em&gt;&lt;/tt&gt; argument is the key ID for a &lt;a href=&#34;/archives/4.2.8-series/authopt/#trustedkey&#34;&gt;trusted key&lt;/a&gt;, where the value can be in the range 1 to 65535, inclusive.&lt;/p&gt;
&lt;dt id=&#34;crypto&#34;&gt;&lt;tt&gt;crypto [digest _digest_] [host _name_] [ident _name_] [pw _password_] [randfile _file_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command activates the Autokey public key cryptography and loads the required host keys and certificate. If one or more files are unspecified, the default names are used. Unless the complete path and name of the file are specified, the location of a file is relative to the keys directory specified in the &lt;tt&gt;keysdir&lt;/tt&gt; configuration command with default &lt;tt&gt;/usr/local/etc&lt;/tt&gt;. See the &lt;a href=&#34;/archives/4.2.8-series/autokey&#34;&gt;Autokey Public Key Authentication&lt;/a&gt; page for further information. Following are the options.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;digest&lt;/tt&gt; _digest_&lt;/dt&gt;
&lt;p&gt;Specify the message digest algorithm, with default MD5. If the OpenSSL library is installed, &lt;tt&gt;&lt;em&gt;digest&lt;/em&gt;&lt;/tt&gt; can be any message digest algorithm supported by the library. The current selections are: &lt;tt&gt;MD2&lt;/tt&gt;, &lt;tt&gt;MD4&lt;/tt&gt;, &lt;tt&gt;MD5,&lt;/tt&gt; &lt;tt&gt;MDC2&lt;/tt&gt;, &lt;tt&gt;RIPEMD160&lt;/tt&gt;, &lt;tt&gt;SHA&lt;/tt&gt; and &lt;tt&gt;SHA1&lt;/tt&gt;. All participants in an Autokey subnet must use the same algorithm. The Autokey message digest algorithm is separate and distinct from the symmetric key message digest algorithm. Note: If compliance with FIPS 140-2 is required, the algorithm must be ether &lt;tt&gt;SHA&lt;/tt&gt; or &lt;tt&gt;SHA1&lt;/tt&gt;.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;host _name_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specify the cryptographic media names for the host, sign and certificate files. If this option is not specified, the default name is the string returned by the Unix &lt;tt&gt;gethostname()&lt;/tt&gt; routine.&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;style1&#34;&gt;Note: In the latest Autokey version, this option has no effect other than to change the cryptographic media file names.&lt;/span&gt;&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;ident _group_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specify the cryptographic media names for the identity scheme files. If this option is not specified, the default name is the string returned by the Unix &lt;tt&gt;gethostname()&lt;/tt&gt; routine.&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;style1&#34;&gt;Note: In the latest Autokey version, this option has no effect other than to change the cryptographic media file names.&lt;/span&gt;&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;pw _password_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the password to decrypt files previously encrypted by the &lt;tt&gt;ntp-keygen&lt;/tt&gt; program with the &lt;tt&gt;-p&lt;/tt&gt; option. If this option is not specified, the default password is the string returned by the Unix &lt;tt&gt;gethostname()&lt;/tt&gt; routine.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;randfile _file_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the location of the random seed file used by the OpenSSL library. The defaults are described on the &lt;a href=&#34;/archives/4.2.8-series/keygen&#34;&gt;&lt;tt&gt;ntp-keygen&lt;/tt&gt; page&lt;/a&gt;.&lt;/p&gt;
&lt;dt id=&#34;ident&#34;&gt;&lt;tt&gt;ident _group_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the group name for ephemeral associations mobilized by broadcast and symmetric passive modes. See the &lt;a href=&#34;/archives/4.2.8-series/autokey&#34;&gt;Autokey Public-Key Authentication&lt;/a&gt; page for further information.&lt;/p&gt;
&lt;dt id=&#34;keys&#34;&gt;&lt;tt&gt;keys _path_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the complete directory path for the key file containing the key IDs, key types and keys used by &lt;tt&gt;ntpd&lt;/tt&gt;, &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; when operating with symmetric key cryptography. The format of the keyfile is described on the &lt;a href=&#34;/archives/4.2.8-series/keygen&#34;&gt;&lt;tt&gt;ntp-keygen&lt;/tt&gt; page&lt;/a&gt;. This is the same operation as the &lt;tt&gt;-k&lt;/tt&gt; command line option. Note that the directory path for Autokey cryptographic media is specified by the &lt;tt&gt;keysdir&lt;/tt&gt; command.&lt;/p&gt;
&lt;dt id=&#34;keysdir&#34;&gt;&lt;tt&gt;keysdir _path_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the complete directory path for the Autokey cryptographic keys, parameters and certificates. The default is &lt;tt&gt;/usr/local/etc/&lt;/tt&gt;. Note that the path for the symmetric keys file is specified by the &lt;tt&gt;keys&lt;/tt&gt; command.&lt;/p&gt;
&lt;dt id=&#34;requestkey&#34;&gt;&lt;tt&gt;requestkey _keyid_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key ID for the &lt;a href=&#34;/archives/4.2.8-series/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; utility program, which uses a proprietary protocol specific to this implementation of &lt;tt&gt;ntpd&lt;/tt&gt;. The &lt;tt&gt;&lt;em&gt;keyid&lt;/em&gt;&lt;/tt&gt; argument is a key ID for a &lt;a href=&#34;/archives/4.2.8-series/authopt/#trustedkey&#34;&gt;trusted key&lt;/a&gt;, in the range 1 to 65535, inclusive.&lt;/p&gt;
&lt;dt id=&#34;revoke&#34;&gt;&lt;tt&gt;revoke [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between re-randomization of certain cryptographic values used by the Autokey scheme, as a power of 2 in seconds, with default 17 (36 hr). See the &lt;a href=&#34;/archives/4.2.8-series/autokey&#34;&gt;Autokey Public-Key Authentication&lt;/a&gt; page for further information.&lt;/p&gt;
&lt;dt id=&#34;trustedkey&#34;&gt;&lt;tt&gt;trustedkey [_keyid_ | (_lowid_ ... _highid_)] [...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key ID(s) which are trusted for the purposes of authenticating peers with symmetric key cryptography. Key IDs used to authenticate &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; operations must be listed here and additionally be enabled with &lt;a href=&#34;/archives/4.2.8-series/authopt/#controlkey&#34;&gt;controlkey&lt;/a&gt; and/or &lt;a href=&#34;/archives/4.2.8-series/authopt/#requestkey&#34;&gt;requestkey&lt;/a&gt;. The authentication procedure for time transfer requires that both the local and remote NTP servers employ the same key ID and secret for this purpose, although different keys IDs may be used with different servers. Ranges of trusted key IDs may be specified: &lt;tt&gt;trustedkey (1 &amp;hellip; 19) 1000 (100 &amp;hellip; 199)&lt;/tt&gt; enables the lowest 120 key IDs which start with the digit 1. The spaces surrounding the ellipsis are required when specifying a range.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Authentication Options</title>
      <link>/archives/3-5.93e/authopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/3-5.93e/authopt/</guid>
      <description>
        
        
        &lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/authopt/#authentication-support&#34;&gt;Authentication Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/authopt/#authentication-commands&#34;&gt;Authentication Commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/3-5.93e/authopt/#authentication-key-file-format&#34;&gt;Authentication Key File Format&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-support&#34;&gt;Authentication Support&lt;/h4&gt;
&lt;p&gt;The NTP standard specifies an extension which provides cryptographic authentication of received NTP packets. This is implemented in &lt;tt&gt;xntpd&lt;/tt&gt; using the DES or MD5 algorithms to compute a digital signature, or message digest. The specification allows any one of possibly 4 billion keys, numbered with 32-bit key identifiers, to be used to authenticate an association. The servers involved in an association must agree on the key and key identifier used to authenticate their messages.&lt;/p&gt;
&lt;p&gt;Keys and related information are specified in a key file, which should be exchanged and stored using secure procedures beyond the scope of the protocol. There are three classes of keys involved in the current implementation. One class is used for ordinary NTP associations, another for the &lt;a href=&#34;/archives/3-5.93e/ntpq&#34;&gt;ntpq&lt;/a&gt; utility program and the third for the &lt;a href=&#34;/archives/3-5.93e/xntpdc&#34;&gt;xntpdc&lt;/a&gt; utility program.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-commands&#34;&gt;Authentication Commands&lt;/h4&gt;
&lt;dt id=&#34;keys&#34;&gt;&lt;tt&gt;keys _keyfile_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the file name containing the encryption keys and key identifiers used by &lt;tt&gt;xntpd&lt;/tt&gt;, &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;xntpdc&lt;/tt&gt; when operating in authenticated mode. The format of this file is described later in this document.&lt;/p&gt;
&lt;dt id=&#34;trustedkey&#34;&gt;&lt;tt&gt;trustedkey [_key_] [...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the encryption key identifiers which are trusted for the purposes of authenticating peers suitable for synchronization. The authentication procedures require that both the local and remote servers share the same key and key identifier for this purpose, although different keys can be used with different servers. The &lt;tt&gt;key&lt;/tt&gt; arguments are 32-bit unsigned integers. Note that NTP key 0 is fixed and globally known. If meaningful authentication is to be performed the 0 key should not be trusted.&lt;/p&gt;
&lt;dt id=&#34;requestkey&#34;&gt;&lt;tt&gt;requestkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/3-5.93e/xntpdc&#34;&gt;&lt;tt&gt;xntpdc&lt;/tt&gt;&lt;/a&gt; program, which uses a proprietary protocol specific to this implementation of &lt;tt&gt;xntpd&lt;/tt&gt;. This program is useful to diagnose and repair problems that affect &lt;tt&gt;xntpd&lt;/tt&gt; operation. The key argument to this command is a 32-bit unsigned integer. If no &lt;tt&gt;requestkey&lt;/tt&gt; command is included in the configuration file, or if the keys don&amp;rsquo;t match, such requests will be ignored.&lt;/p&gt;
&lt;dt id=&#34;controlkey&#34;&gt;&lt;tt&gt;controlkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/3-5.93e/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; utility, which uses the standard protocol defined in RFC-1305. This program is useful to diagnose and repair problems that affect &lt;tt&gt;xntpd&lt;/tt&gt; operation. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument to this command is a 32-bit unsigned integer. If no &lt;tt&gt;requestkey&lt;/tt&gt; command is included in the configuration file, or if the keys don&amp;rsquo;t match, such requests will be ignored.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-key-file-format&#34;&gt;Authentication Key File Format&lt;/h4&gt;
&lt;p&gt;In the case of DES, the keys are 56 bits long with, depending on type, a parity check on each byte. In the case of MD5, the keys are 64 bits (8 bytes). &lt;tt&gt;xntpd&lt;/tt&gt; reads its keys from a file specified using the &lt;tt&gt;-k&lt;/tt&gt; command line option or the &lt;tt&gt;keys&lt;/tt&gt; statement in the configuration file. While key number 0 is fixed by the NTP standard (as 56 zero bits) and may not be changed, one or more of the keys numbered 1 through 15 may be arbitrarily set in the keys file.&lt;/p&gt;
&lt;p&gt;The key file uses the same comment conventions as the configuration file. Key entries use a fixed format of the form&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;&lt;em&gt;keyno type key&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;where &lt;tt&gt;&lt;em&gt;keyno&lt;/em&gt;&lt;/tt&gt; is a positive integer, &lt;tt&gt;&lt;em&gt;type&lt;/em&gt;&lt;/tt&gt; is a single character which defines the key format, and &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; is the key itself.&lt;/p&gt;
&lt;p&gt;The key may be given in one of three different formats, controlled by the &lt;tt&gt;&lt;em&gt;type&lt;/em&gt;&lt;/tt&gt; character. The three key types, and corresponding formats, are listed following.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;S&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The key is a 64-bit hexadecimal number in the format specified in the DES specification; that is, the high order seven bits of each octet are used to form the 56-bit key while the low order bit of each octet is given a value such that odd parity is maintained for the octet. Leading zeroes must be specified (i.e., the key must be exactly 16 hex digits long) and odd parity must be maintained. Hence a zero key, in standard format, would be given as &lt;tt&gt;0101010101010101&lt;/tt&gt;.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;N&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The key is a 64-bit hexadecimal number in the format specified in the NTP standard. This is the same as the DES format, except the bits in each octet have been rotated one bit right so that the parity bit is now the high order bit of the octet. Leading zeroes must be specified and odd parity must be maintained. A zero key in NTP format would be specified as &lt;tt&gt;8080808080808080&lt;/tt&gt;.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;A&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The key is a 1-to-8 character ASCII string. A key is formed from this by using the low order 7 bits of each ASCII character in the string, with zeroes added on the right when necessary to form a full width 56-bit key, in the same way that encryption keys are formed from Unix passwords.&lt;/p&gt;
&lt;dt&gt;&lt;tt&gt;M&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;The key is a 1-to-8 character ASCII string, using the MD5 authentication scheme. Note that both the keys and the authentication schemes (DES or MD5) must be identical between a set of peers sharing the same key number.&lt;/p&gt;
&lt;p&gt;Note that the keys used by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;xntpdc&lt;/tt&gt; programs are checked against passwords requested by the programs and entered by hand, so it is generally appropriate to specify these keys in ASCII format.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Authentication Options</title>
      <link>/archives/4.1.0/authopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.0/authopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice44.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/%7emills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Our resident cryptographer; now you see him, now you don&amp;rsquo;t.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/authopt/#authentication-support&#34;&gt;Authentication Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/authopt/#symmetric-key-scheme&#34;&gt;Symmetric Key Scheme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/authopt/#public-key-scheme&#34;&gt;Public Key Scheme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/authopt/#leapseconds-table&#34;&gt;Leapseconds Table&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/authopt/#key-management&#34;&gt;Key Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/authopt/#authentication-commands&#34;&gt;Authentication Commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/authopt/#files&#34;&gt;Files&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.0/authopt/#bugs&#34;&gt;Bugs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-support&#34;&gt;Authentication Support&lt;/h4&gt;
&lt;p&gt;Authentication support allows the NTP client to verify that the server is in fact known and trusted and not an intruder intending accidentally or on purpose to masquerade as that server. The NTPv3 specification RFC-1305 defines an scheme which provides cryptographic authentication of received NTP packets. Originally, this was done using the Data Encryption Standard (DES) algorithm operating in Cipher Block Chaining (CBC) mode, commonly called
DES-CBC. Subsequently, this was augmented by the RSA Message Digest 5 (MD5) algorithm using a private key, commonly called keyed-MD5. Either algorithm computes a message digest, or one-way hash, which can be used to verify the server has the correct private key and key identifier.&lt;/p&gt;
&lt;p&gt;NTPv4 retains the NTPv3 schemes, properly described as symmetric-key cryptography and, in addition, provides a new Autokey scheme based on public-key cryptography. Public-key cryptography is generally considered more secure than symmetric-key cryptography, since the security is based on a private value which is generated by each server and never revealed. With Autokey all key distribution and management functions involve only public values, which considerably simplifies key distribution and storage.&lt;/p&gt;
&lt;p&gt;Authentication is configured separately for each association using the &lt;tt&gt;key&lt;/tt&gt; or &lt;tt&gt;autokey&lt;/tt&gt; subcommands on the &lt;tt&gt;peer&lt;/tt&gt;, &lt;tt&gt;server&lt;/tt&gt;, &lt;tt&gt;broadcast&lt;/tt&gt; and &lt;tt&gt;manycastclient&lt;/tt&gt; commands as described in the &lt;a href=&#34;/archives/4.1.0/config&#34;&gt;Configuration Options&lt;/a&gt; page. The authentication
options described below specify the suite of keys, select the key for each configured association and manage the configuration operations.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;auth&lt;/tt&gt; flag controls whether new associations or remote configuration commands require cryptographic authentication. This flag can be set or reset by the &lt;tt&gt;enable&lt;/tt&gt; and &lt;tt&gt;disable&lt;/tt&gt; configuration commands and also by remote configuration commands sent by a &lt;tt&gt;ntpdc&lt;/tt&gt; program running in another machine. If this flag is enabled, which is the default case, new broadcast client and symmetric passive associations and remote configuration commands must be cryptographically authenticated using either symmetric-key or public-key schemes. If this flag is disabled, these operations are effective even if not cryptographic authenticated. It should be understood that operating in the latter mode invites a significant vulnerability where a rogue hacker can seriously disrupt client timekeeping.&lt;/p&gt;
&lt;p&gt;In networks with firewalls and large numbers of broadcast clients it may be acceptable to disable authentication, since that avoids key distribution and simplifies network maintenance. However, when the configuration file contains host names, or when a server or client is configured remotely, host names are resolved using the DNS and a separate name resolution process. In order to protect against bogus name server messages, name resolution messages are authenticated using an internally generated key which is normally invisible to the user. However, if cryptographic support is disabled, the name resolution process will fail. This can be avoided either by specifying IP addresses instead of host names, which is generally inadvisable, or by enabling the flag for
name resolution and disabled it once the name resolution process is complete.&lt;/p&gt;
&lt;p&gt;An attractive alternative where multicast support is available is manycast mode, in which clients periodically troll for servers. Cryptographic authentication in this mode uses public-key schemes as described below. The principle advantage of this manycast mode is that potential servers need not be configured in advance, since the client finds them during regular operation, and the configuration files for all clients can be identical.&lt;/p&gt;
&lt;p&gt;In addition to the default symmetric-key cryptographic support, support for public-key cryptography is available if the requisite &lt;tt&gt;rsaref20&lt;/tt&gt; software distribution has been installed before building the distribution. Public-key cryptography provides secure authentication of servers without compromising accuracy and stability. The security model and protocol schemes for both symmetric-key and public-key cryptography are described below.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-key-scheme&#34;&gt;Symmetric Key Scheme&lt;/h4&gt;
&lt;p&gt;The original RFC-1305 specification allows any one of possibly 65,534 keys, each distinguished by a 32-bit key identifier, to authenticate an association. The servers and clients involved must agree on the key and key identifier to authenticate NTP packets. Keys and related information are specified in a key file, usually called &lt;tt&gt;ntp.keys&lt;/tt&gt;, which must be distributed and stored using secure means beyond the scope of the NTP protocol itself. Besides the keys used for ordinary NTP associations, additional keys can be used as passwords for the &lt;a href=&#34;/archives/4.1.0/ntpq&#34;&gt;ntpq&lt;/a&gt; and &lt;a href=&#34;/archives/4.1.0/ntpdc&#34;&gt;ntpdc&lt;/a&gt; utility programs.&lt;/p&gt;
&lt;p&gt;When &lt;tt&gt;ntpd&lt;/tt&gt; is first started, it reads the key file specified in the &lt;tt&gt;keys&lt;/tt&gt; configuration command and installs the keys in the key cache. However, individual keys must be activated with the &lt;tt&gt;trustedkey&lt;/tt&gt; command before use. This allows, for instance, the installation of possibly several batches of keys and then activating or deactivating each batch remotely using &lt;tt&gt;ntpdc&lt;/tt&gt;. This also provides a revocation capability that can be used if a key becomes compromised. The &lt;tt&gt;requestkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpdc&lt;/tt&gt; utility, while the &lt;tt&gt;controlkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpq&lt;/tt&gt; utility.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;public-key-scheme&#34;&gt;Public Key Scheme&lt;/h4&gt;
&lt;p&gt;The original NTPv3 authentication scheme described in RFC-1305 continues to be supported; however, in NTPv4 an additional authentication scheme called Autokey is available. It uses MD5 message digest, RSA public-key signature and Diffie-Hellman key agreement algorithms available from several sources, but not included in the NTPv4 software distribution. In order to be effective, the &lt;tt&gt;rsaref20&lt;/tt&gt; package must be installed as described in the &lt;tt&gt;README.rsa&lt;/tt&gt; file. Once installed, the configure and build process automatically detects it and compiles the routines required. The Autokey scheme has several modes of operation corresponding to the various NTP modes supported. RSA signatures with timestamps are used in all modes to verify the source of cryptographic values. All modes use a special cookie which can be computed independently by the client and server. In symmetric modes the cookie is constructed using the Diffie-Hellman key agreement algorithm. In other modes the cookie is constructed from the IP addresses and a private value known only to the server. All modes use in addition a variant of the S-KEY scheme, in which a pseudo-random key list is generated and used in reverse order. These schemes are described along with an executive summary, current status, briefing slides and reading list, on the &lt;a href=&#34;http://www.eecis.udel.edu/~mills/autokey.html&#34;&gt;Autonomous Authentication&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The cryptographic values used by the Autokey scheme are incorporated as a set of files generated by the &lt;a href=&#34;/archives/4.1.0/genkeys&#34;&gt;&lt;tt&gt;ntp-genkeys&lt;/tt&gt;&lt;/a&gt; program, including the symmetric private keys, public/private key pair, and the agreement parameters. See the &lt;tt&gt;ntp-genkeys&lt;/tt&gt; page for a description of the formats of these files. They contain cryptographic values generated by the algorithms of the &lt;tt&gt;rsaref20&lt;/tt&gt; package and are in printable ASCII format. All file names include the timestamp, in NTP seconds, following the default names given below. Since the file data are derived from random values seeded by the system clock and the file name includes the timestamp, every generation produces a different file and different file name.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;ntp.keys&lt;/tt&gt; file contains the DES/MD5 private keys. It must be distributed by secure means to other servers and clients sharing the same security compartment and made visible only to root. While this file is not used with the Autokey scheme, it is needed to authenticate some remote configuration commands used by the &lt;a href=&#34;/archives/4.1.0/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; and &lt;a href=&#34;/archives/4.1.0/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; utilities. The &lt;tt&gt;ntpkey&lt;/tt&gt; file contains the RSA private key. It is useful only to the machine that generated it and never shared with any other daemon or application program, so must be made visible only to root.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;ntp_dh&lt;/tt&gt; file contains the agreement parameters, which are used only in symmetric (active and passive) modes. It is necessary that both peers beginning a symmetric-mode association share the same parameters, but it does not matter which &lt;tt&gt;ntp_dh&lt;/tt&gt; file generates them. If one of the peers contains the parameters, the other peer obtains them using the Autokey protocol. If both peers contain the parameters, the most recent copy is used by both peers. If a peer does not have the parameters, they will be requested by all associations, either configured or not; but, none of the associations can proceed until one of them has received the parameters. Once loaded, the parameters can be provided on request to other clients and servers. The &lt;tt&gt;ntp_dh&lt;/tt&gt; file can also be distributed using insecure means, since the data are public values.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;ntpkey__host_&lt;/tt&gt; file contains the RSA public key, where &lt;tt&gt;_host_&lt;/tt&gt; is the name of the host. Each host must have its own &lt;tt&gt;ntpkey__host_&lt;/tt&gt; file, which is normally provided to other hosts using the Autokey protocol Each &lt;tt&gt;server&lt;/tt&gt; or &lt;tt&gt;peer&lt;/tt&gt; association requires the public key associated with the particular server or peer to be loaded either directly from a local file or indirectly from the server using the Autokey protocol. These files can be widely distributed and stored using insecure means, since the data are public values.&lt;/p&gt;
&lt;p&gt;The optional &lt;tt&gt;ntpkey_certif__host_&lt;/tt&gt; file contains the PKI certificate for the host. This provides a binding between the host hame and RSA public key. In the current implementation the certificate is obtained by a client, if present, but the contents are ignored.&lt;/p&gt;
&lt;p&gt;Due to the widespread use of interface-specific naming, the host names used in configured and mobilized associations are determined by the Unix &lt;tt&gt;gethostname()&lt;/tt&gt; library routine. Both the &lt;tt&gt;ntp-genkeys&lt;/tt&gt; program and the Autokey protocol derive the name of the public key file using the name returned by this routine. While every server and client is required to load their own public and private keys, the public keys for each client or peer association can be obtained from the server or peer using the Autokey protocol. Note however, that at the current stage of development the authenticity of the server or peer and the cryptographic binding of the server name, address and public key is not yet established by a certificate authority or web of trust.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;leapseconds-table&#34;&gt;Leapseconds Table&lt;/h4&gt;
&lt;p&gt;The NIST provides a table showing the epoch for all historic occasions of leap second insertion since 1972. The leapsecond table shows each epoch of insertion along with the offset of International Atomic Time (TAI) with respect to Coordinated Universtal Time (UTC), as disseminated by NTP. The table can be obtained directly from NIST national time servers using &lt;tt&gt;ftp&lt;/tt&gt; as the ASCII file &lt;tt&gt;pub/leap-seconds&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;While not strictly a security function, the Autokey protocol provides means to securely retrieve the leapsecond table from a server or peer. Servers load the leapsecond table directly from the file specified in the &lt;tt&gt;crypto&lt;/tt&gt; command, while clients can obtain the table indirectly from the servers using the Autokey protocol. Once loaded, the table can be provided on request to other clients and servers.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;key-management&#34;&gt;Key Management&lt;/h4&gt;
&lt;p&gt;All key files are installed by default in &lt;tt&gt;/usr/local/etc&lt;/tt&gt;, which is normally in a shared filesystem in NFS-mounted networks and avoids installing them in each machine separately. The default can be overridden by the &lt;tt&gt;keysdir&lt;/tt&gt; configuration command. However, this is not a good place to install the private key file, since each machine needs its own file. A suitable place to install it is in &lt;tt&gt;/etc&lt;/tt&gt;, which is normally not in a shared filesystem.&lt;/p&gt;
&lt;p&gt;The recommended practice is to keep the timestamp extensions when installing a file and to install a link from the default name (without the timestamp extension) to the actual file. This allows new file generations to be activated simply by changing the link. However, &lt;tt&gt;ntpd&lt;/tt&gt; parses the link name when present to extract the extension value and sends it along with the public key and host name when requested. This allows clients to verify that the file and generation time are always current. However, the actual location of each file can be overridden by the &lt;tt&gt;crypto&lt;/tt&gt; configuration command.&lt;/p&gt;
&lt;p&gt;All cryptographic keys and related parameters should be regenerated on a periodic and automatic basis, like once per month. The &lt;tt&gt;ntp-genkeys&lt;/tt&gt; program uses the same timestamp extension for all files generated at one time, so each generation is distinct and can be readily recognized in monitoring data. While a public/private key pair must be generated by every server and client, the public keys and agreement parameters do not need to be explicitly copied to all machines in the same security compartment, since they can be obtained automatically using the Autokey protocol. However, it is necessary that all primary servers have the same agreement parameter file. The recommended way to do this is for one of the primary servers to generate that file and then copy it to the other primary servers in the same compartment using the Unix &lt;tt&gt;rdist&lt;/tt&gt; command. Future versions of the Autokey protocol are to contain provisions for an agreement protocol to do this automatically.&lt;/p&gt;
&lt;p&gt;Servers and clients can make a new generation in the following way. All machines have loaded the old generation at startup and are operating normally. At designated intervals, each machine generates a new public/private key pair and makes links from the default file names to the new file names. The &lt;tt&gt;ntpd&lt;/tt&gt; is then restarted and loads the new generation, with result clients no longer can authenticate correctly. The Autokey protocol is designed so that after a few minutes the clients time out and restart the protocol from the beginning, with result the new generation is loaded and operation continues as before. A similar procedure can be used for the agreement parameter file, but in this case precautions must be take to be sure that all machines with this file have the same copy.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-commands&#34;&gt;Authentication Commands&lt;/h4&gt;
&lt;dt&gt;&lt;tt&gt;autokey [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between regenerations of the session key list used with the Autokey protocol. Note that the size of the key list for each association depends on this interval and the current poll interval. The default interval is 12 (4096 s or about 1.1 hours). For poll intervals above the specified interval, a session key list with a single entry will be regenerated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;controlkey&#34;&gt;&lt;tt&gt;controlkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.1.0/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; utility, which uses the standard protocol defined in RFC-1305. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is the key identifier for a trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;crypto&#34;&gt;&lt;tt&gt;[flags _flags_] [privatekey _file_] [publickey _file_] [dhparms _file_] [leap _file_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command requires the NTP daemon build process be configured with the RSA library. This command activates public-key cryptography and loads the required RSA private and public key files and the optional Diffie-Hellman agreement parameter file, if present. If one or more files are left unspecified, the default names are used as described below. Following are the subcommands:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;privatekey &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the RSA private key file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;publickey &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the RSA public key file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey_host_&lt;/tt&gt;, where host is the name of the generating machine.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;dhparms &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;Â Â Â Â &lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the Diffie-Hellman parameters file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey_dh&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;leap &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the leapsecond table file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey_leap&lt;/tt&gt;.&lt;/p&gt;
&lt;dt id=&#34;keys&#34;&gt;&lt;tt&gt;keys _keyfile_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the location of the DES/MD5 private key file containing the keys and key identifiers used by &lt;tt&gt;ntpd&lt;/tt&gt;, &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; when operating with symmetric-key mode.&lt;/p&gt;
&lt;dt id=&#34;keysdir&#34;&gt;&lt;tt&gt;keysdir _path_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command requires the NTP daemon build process be configured with the RSA library. It specifies the default directory path for the private key file, agreement parameters file and one or more public key files. The default when this command does not appear in the configuration file is &lt;tt&gt;/usr/local/etc/&lt;/tt&gt;.&lt;/p&gt;
&lt;dt id=&#34;requestkey&#34;&gt;&lt;tt&gt;requestkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.1.0/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; program, which uses a proprietary protocol specific to this implementation of &lt;tt&gt;ntpd&lt;/tt&gt;. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is a key identifier for the trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;revoke&#34;&gt;&lt;tt&gt;revoke [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between re-randomization of certain cryptographic values used by the Autokey scheme, as a power of 2 in seconds. These values need to be updated frequently in order to deflect brute-force attacks on the algorithms of the scheme; however, updating some values is a relatively expensive operation. The default interval is 16 (65,536 s or about 18 hours). For poll intervals above the specified interval, the values will be updated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;trustedkey&#34;&gt;&lt;tt&gt;trustedkey [_key_] [...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifiers which are trusted for the purposes of authenticating peers with symmetric-key cryptography, as well as keys used by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; programs. The authentication procedures require that both the local and remote servers share the same key and key identifier for this purpose, although different keys can be used with different servers. The &lt;tt&gt;key&lt;/tt&gt; arguments are 32-bit unsigned integers with values from 1 to 65,534.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;files&#34;&gt;Files&lt;/h4&gt;
&lt;p&gt;&lt;tt&gt;ntp.keys&lt;/tt&gt; private MD5 keys&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntpkey&lt;/tt&gt; RSA private key&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntpkey_&lt;i&gt;host&lt;/i&gt;&lt;/tt&gt; RSA public key&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntp_dh&lt;/tt&gt; Diffie-Hellman agreement parameters&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;bugs&#34;&gt;Bugs&lt;/h4&gt;
&lt;p&gt;The &lt;tt&gt;ntpkey_&lt;i&gt;host&lt;/i&gt;&lt;/tt&gt; files are really digital certificates. These should be obtained via secure directory services when they become universally available.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Authentication Options</title>
      <link>/archives/4.1.1/authopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.1/authopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice44.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/%7emills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Our resident cryptographer; now you see him, now you don&amp;rsquo;t.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/authopt/#authentication-support&#34;&gt;Authentication Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/authopt/#symmetric-key-scheme&#34;&gt;Symmetric Key Scheme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/authopt/#public-key-scheme&#34;&gt;Public Key Scheme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/authopt/#leapseconds-table&#34;&gt;Leapseconds Table&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/authopt/#key-management&#34;&gt;Key Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/authopt/#authentication-commands&#34;&gt;Authentication Commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/authopt/#files&#34;&gt;Files&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.1/authopt/#bugs&#34;&gt;Bugs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-support&#34;&gt;Authentication Support&lt;/h4&gt;
&lt;p&gt;Authentication support allows the NTP client to verify that the server is in fact known and trusted and not an intruder intending accidentally or on purpose to masquerade as that server. The NTPv3 specification RFC-1305 defines an scheme which provides cryptographic authentication of received NTP packets. Originally, this was done using the Data Encryption Standard (DES) algorithm operating in Cipher Block Chaining (CBC) mode, commonly called
DES-CBC. Subsequently, this was augmented by the RSA Message Digest 5 (MD5) algorithm using a private key, commonly called keyed-MD5. Either algorithm computes a message digest, or one-way hash, which can be used to verify the server has the correct private key and key identifier.&lt;/p&gt;
&lt;p&gt;NTPv4 retains the NTPv3 schemes, properly described as symmetric-key cryptography and, in addition, provides a new Autokey scheme based on public-key cryptography. Public-key cryptography is generally considered more secure than symmetric-key cryptography, since the security is based on a private value which is generated by each server and never revealed. With Autokey all key distribution and management functions involve only public values, which considerably simplifies key distribution and storage.&lt;/p&gt;
&lt;p&gt;Authentication is configured separately for each association using the &lt;tt&gt;key&lt;/tt&gt; or &lt;tt&gt;autokey&lt;/tt&gt; subcommands on the &lt;tt&gt;peer&lt;/tt&gt;, &lt;tt&gt;server&lt;/tt&gt;, &lt;tt&gt;broadcast&lt;/tt&gt; and &lt;tt&gt;manycastclient&lt;/tt&gt; commands as described in the &lt;a href=&#34;/archives/4.1.1/config&#34;&gt;Configuration Options&lt;/a&gt; page. The authentication
options described below specify the suite of keys, select the key for each configured association and manage the configuration operations.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;auth&lt;/tt&gt; flag controls whether new associations or remote configuration commands require cryptographic authentication. This flag can be set or reset by the &lt;tt&gt;enable&lt;/tt&gt; and &lt;tt&gt;disable&lt;/tt&gt; configuration commands and also by remote configuration commands sent by a &lt;tt&gt;ntpdc&lt;/tt&gt; program running in another machine. If this flag is enabled, which is the default case, new broadcast client and symmetric passive associations and remote configuration commands must be cryptographically authenticated using either symmetric-key or public-key schemes. If this flag is disabled, these operations are effective even if not cryptographic authenticated. It should be understood that operating in the latter mode invites a significant vulnerability where a rogue hacker can seriously disrupt client timekeeping.&lt;/p&gt;
&lt;p&gt;In networks with firewalls and large numbers of broadcast clients it may be acceptable to disable authentication, since that avoids key distribution and simplifies network maintenance. However, when the configuration file contains host names, or when a server or client is configured remotely, host names are resolved using the DNS and a separate name resolution process. In order to protect against bogus name server messages, name resolution messages are authenticated using an internally generated key which is normally invisible to the user. However, if cryptographic support is disabled, the name resolution process will fail. This can be avoided either by specifying IP addresses instead of host names, which is generally inadvisable, or by enabling the flag for
name resolution and disabled it once the name resolution process is complete.&lt;/p&gt;
&lt;p&gt;An attractive alternative where multicast support is available is manycast mode, in which clients periodically troll for servers. Cryptographic authentication in this mode uses public-key schemes as described below. The principle advantage of this manycast mode is that potential servers need not be configured in advance, since the client finds them during regular operation, and the configuration files for all clients can be identical.&lt;/p&gt;
&lt;p&gt;In addition to the default symmetric-key cryptographic support, support for public-key cryptography is available if the requisite &lt;tt&gt;rsaref20&lt;/tt&gt; software distribution has been installed before building the distribution. Public-key cryptography provides secure authentication of servers without compromising accuracy and stability. The security model and protocol schemes for both symmetric-key and public-key cryptography are described below.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-key-scheme&#34;&gt;Symmetric Key Scheme&lt;/h4&gt;
&lt;p&gt;The original RFC-1305 specification allows any one of possibly 65,534 keys, each distinguished by a 32-bit key identifier, to authenticate an association. The servers and clients involved must agree on the key and key identifier to authenticate NTP packets. Keys and related information are specified in a key file, usually called &lt;tt&gt;ntp.keys&lt;/tt&gt;, which must be distributed and stored using secure means beyond the scope of the NTP protocol itself. Besides the keys used for ordinary NTP associations, additional keys can be used as passwords for the &lt;a href=&#34;/archives/4.1.1/ntpq&#34;&gt;ntpq&lt;/a&gt; and &lt;a href=&#34;/archives/4.1.1/ntpdc&#34;&gt;ntpdc&lt;/a&gt; utility programs.&lt;/p&gt;
&lt;p&gt;When &lt;tt&gt;ntpd&lt;/tt&gt; is first started, it reads the key file specified in the &lt;tt&gt;keys&lt;/tt&gt; configuration command and installs the keys in the key cache. However, individual keys must be activated with the &lt;tt&gt;trustedkey&lt;/tt&gt; command before use. This allows, for instance, the installation of possibly several batches of keys and then activating or deactivating each batch remotely using &lt;tt&gt;ntpdc&lt;/tt&gt;. This also provides a revocation capability that can be used if a key becomes compromised. The &lt;tt&gt;requestkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpdc&lt;/tt&gt; utility, while the &lt;tt&gt;controlkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpq&lt;/tt&gt; utility.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;public-key-scheme&#34;&gt;Public Key Scheme&lt;/h4&gt;
&lt;p&gt;The original NTPv3 authentication scheme described in RFC-1305 continues to be supported; however, in NTPv4 an additional authentication scheme called Autokey is available. It uses MD5 message digest, RSA public-key signature and Diffie-Hellman key agreement algorithms available from several sources, but not included in the NTPv4 software distribution. In order to be effective, the &lt;tt&gt;rsaref20&lt;/tt&gt; package must be installed as described in the &lt;tt&gt;README.rsa&lt;/tt&gt; file. Once installed, the configure and build process automatically detects it and compiles the routines required. The Autokey scheme has several modes of operation corresponding to the various NTP modes supported. RSA signatures with timestamps are used in all modes to verify the source of cryptographic values. All modes use a special cookie which can be computed independently by the client and server. In symmetric modes the cookie is constructed using the Diffie-Hellman key agreement algorithm. In other modes the cookie is constructed from the IP addresses and a private value known only to the server. All modes use in addition a variant of the S-KEY scheme, in which a pseudo-random key list is generated and used in reverse order. These schemes are described along with an executive summary, current status, briefing slides and reading list, on the &lt;a href=&#34;http://www.eecis.udel.edu/~mills/autokey.html&#34;&gt;Autonomous Authentication&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The cryptographic values used by the Autokey scheme are incorporated as a set of files generated by the &lt;a href=&#34;/archives/4.1.1/genkeys&#34;&gt;&lt;tt&gt;ntp-genkeys&lt;/tt&gt;&lt;/a&gt; program, including the symmetric private keys, public/private key pair, and the agreement parameters. See the &lt;tt&gt;ntp-genkeys&lt;/tt&gt; page for a description of the formats of these files. They contain cryptographic values generated by the algorithms of the &lt;tt&gt;rsaref20&lt;/tt&gt; package and are in printable ASCII format. All file names include the timestamp, in NTP seconds, following the default names given below. Since the file data are derived from random values seeded by the system clock and the file name includes the timestamp, every generation produces a different file and different file name.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;ntp.keys&lt;/tt&gt; file contains the DES/MD5 private keys. It must be distributed by secure means to other servers and clients sharing the same security compartment and made visible only to root. While this file is not used with the Autokey scheme, it is needed to authenticate some remote configuration commands used by the &lt;a href=&#34;/archives/4.1.1/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; and &lt;a href=&#34;/archives/4.1.1/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; utilities. The &lt;tt&gt;ntpkey&lt;/tt&gt; file contains the RSA private key. It is useful only to the machine that generated it and never shared with any other daemon or application program, so must be made visible only to root.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;ntp_dh&lt;/tt&gt; file contains the agreement parameters, which are used only in symmetric (active and passive) modes. It is necessary that both peers beginning a symmetric-mode association share the same parameters, but it does not matter which &lt;tt&gt;ntp_dh&lt;/tt&gt; file generates them. If one of the peers contains the parameters, the other peer obtains them using the Autokey protocol. If both peers contain the parameters, the most recent copy is used by both peers. If a peer does not have the parameters, they will be requested by all associations, either configured or not; but, none of the associations can proceed until one of them has received the parameters. Once loaded, the parameters can be provided on request to other clients and servers. The &lt;tt&gt;ntp_dh&lt;/tt&gt; file can also be distributed using insecure means, since the data are public values.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;ntpkey__host_&lt;/tt&gt; file contains the RSA public key, where &lt;tt&gt;_host_&lt;/tt&gt; is the name of the host. Each host must have its own &lt;tt&gt;ntpkey__host_&lt;/tt&gt; file, which is normally provided to other hosts using the Autokey protocol Each &lt;tt&gt;server&lt;/tt&gt; or &lt;tt&gt;peer&lt;/tt&gt; association requires the public key associated with the particular server or peer to be loaded either directly from a local file or indirectly from the server using the Autokey protocol. These files can be widely distributed and stored using insecure means, since the data are public values.&lt;/p&gt;
&lt;p&gt;The optional &lt;tt&gt;ntpkey_certif__host_&lt;/tt&gt; file contains the PKI certificate for the host. This provides a binding between the host hame and RSA public key. In the current implementation the certificate is obtained by a client, if present, but the contents are ignored.&lt;/p&gt;
&lt;p&gt;Due to the widespread use of interface-specific naming, the host names used in configured and mobilized associations are determined by the Unix &lt;tt&gt;gethostname()&lt;/tt&gt; library routine. Both the &lt;tt&gt;ntp-genkeys&lt;/tt&gt; program and the Autokey protocol derive the name of the public key file using the name returned by this routine. While every server and client is required to load their own public and private keys, the public keys for each client or peer association can be obtained from the server or peer using the Autokey protocol. Note however, that at the current stage of development the authenticity of the server or peer and the cryptographic binding of the server name, address and public key is not yet established by a certificate authority or web of trust.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;leapseconds-table&#34;&gt;Leapseconds Table&lt;/h4&gt;
&lt;p&gt;The NIST provides a table showing the epoch for all historic occasions of leap second insertion since 1972. The leapsecond table shows each epoch of insertion along with the offset of International Atomic Time (TAI) with respect to Coordinated Universtal Time (UTC), as disseminated by NTP. The table can be obtained directly from NIST national time servers using &lt;tt&gt;ftp&lt;/tt&gt; as the ASCII file &lt;tt&gt;pub/leap-seconds&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;While not strictly a security function, the Autokey protocol provides means to securely retrieve the leapsecond table from a server or peer. Servers load the leapsecond table directly from the file specified in the &lt;tt&gt;crypto&lt;/tt&gt; command, while clients can obtain the table indirectly from the servers using the Autokey protocol. Once loaded, the table can be provided on request to other clients and servers.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;key-management&#34;&gt;Key Management&lt;/h4&gt;
&lt;p&gt;All key files are installed by default in &lt;tt&gt;/usr/local/etc&lt;/tt&gt;, which is normally in a shared filesystem in NFS-mounted networks and avoids installing them in each machine separately. The default can be overridden by the &lt;tt&gt;keysdir&lt;/tt&gt; configuration command. However, this is not a good place to install the private key file, since each machine needs its own file. A suitable place to install it is in &lt;tt&gt;/etc&lt;/tt&gt;, which is normally not in a shared filesystem.&lt;/p&gt;
&lt;p&gt;The recommended practice is to keep the timestamp extensions when installing a file and to install a link from the default name (without the timestamp extension) to the actual file. This allows new file generations to be activated simply by changing the link. However, &lt;tt&gt;ntpd&lt;/tt&gt; parses the link name when present to extract the extension value and sends it along with the public key and host name when requested. This allows clients to verify that the file and generation time are always current. However, the actual location of each file can be overridden by the &lt;tt&gt;crypto&lt;/tt&gt; configuration command.&lt;/p&gt;
&lt;p&gt;All cryptographic keys and related parameters should be regenerated on a periodic and automatic basis, like once per month. The &lt;tt&gt;ntp-genkeys&lt;/tt&gt; program uses the same timestamp extension for all files generated at one time, so each generation is distinct and can be readily recognized in monitoring data. While a public/private key pair must be generated by every server and client, the public keys and agreement parameters do not need to be explicitly copied to all machines in the same security compartment, since they can be obtained automatically using the Autokey protocol. However, it is necessary that all primary servers have the same agreement parameter file. The recommended way to do this is for one of the primary servers to generate that file and then copy it to the other primary servers in the same compartment using the Unix &lt;tt&gt;rdist&lt;/tt&gt; command. Future versions of the Autokey protocol are to contain provisions for an agreement protocol to do this automatically.&lt;/p&gt;
&lt;p&gt;Servers and clients can make a new generation in the following way. All machines have loaded the old generation at startup and are operating normally. At designated intervals, each machine generates a new public/private key pair and makes links from the default file names to the new file names. The &lt;tt&gt;ntpd&lt;/tt&gt; is then restarted and loads the new generation, with result clients no longer can authenticate correctly. The Autokey protocol is designed so that after a few minutes the clients time out and restart the protocol from the beginning, with result the new generation is loaded and operation continues as before. A similar procedure can be used for the agreement parameter file, but in this case precautions must be take to be sure that all machines with this file have the same copy.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-commands&#34;&gt;Authentication Commands&lt;/h4&gt;
&lt;dt&gt;&lt;tt&gt;autokey [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between regenerations of the session key list used with the Autokey protocol. Note that the size of the key list for each association depends on this interval and the current poll interval. The default interval is 12 (4096 s or about 1.1 hours). For poll intervals above the specified interval, a session key list with a single entry will be regenerated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;controlkey&#34;&gt;&lt;tt&gt;controlkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.1.1/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; utility, which uses the standard protocol defined in RFC-1305. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is the key identifier for a trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;crypto&#34;&gt;&lt;tt&gt;[flags _flags_] [privatekey _file_] [publickey _file_] [dhparms _file_] [leap _file_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command requires the NTP daemon build process be configured with the RSA library. This command activates public-key cryptography and loads the required RSA private and public key files and the optional Diffie-Hellman agreement parameter file, if present. If one or more files are left unspecified, the default names are used as described below. Following are the subcommands:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;privatekey &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the RSA private key file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;publickey &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the RSA public key file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey_host_&lt;/tt&gt;, where host is the name of the generating machine.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;dhparms &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;Â Â Â Â &lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the Diffie-Hellman parameters file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey_dh&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;leap &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the leapsecond table file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey_leap&lt;/tt&gt;.&lt;/p&gt;
&lt;dt id=&#34;keys&#34;&gt;&lt;tt&gt;keys _keyfile_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the location of the DES/MD5 private key file containing the keys and key identifiers used by &lt;tt&gt;ntpd&lt;/tt&gt;, &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; when operating with symmetric-key mode.&lt;/p&gt;
&lt;dt id=&#34;keysdir&#34;&gt;&lt;tt&gt;keysdir _path_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command requires the NTP daemon build process be configured with the RSA library. It specifies the default directory path for the private key file, agreement parameters file and one or more public key files. The default when this command does not appear in the configuration file is &lt;tt&gt;/usr/local/etc/&lt;/tt&gt;.&lt;/p&gt;
&lt;dt id=&#34;requestkey&#34;&gt;&lt;tt&gt;requestkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.1.1/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; program, which uses a proprietary protocol specific to this implementation of &lt;tt&gt;ntpd&lt;/tt&gt;. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is a key identifier for the trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;revoke&#34;&gt;&lt;tt&gt;revoke [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between re-randomization of certain cryptographic values used by the Autokey scheme, as a power of 2 in seconds. These values need to be updated frequently in order to deflect brute-force attacks on the algorithms of the scheme; however, updating some values is a relatively expensive operation. The default interval is 16 (65,536 s or about 18 hours). For poll intervals above the specified interval, the values will be updated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;trustedkey&#34;&gt;&lt;tt&gt;trustedkey [_key_] [...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifiers which are trusted for the purposes of authenticating peers with symmetric-key cryptography, as well as keys used by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; programs. The authentication procedures require that both the local and remote servers share the same key and key identifier for this purpose, although different keys can be used with different servers. The &lt;tt&gt;key&lt;/tt&gt; arguments are 32-bit unsigned integers with values from 1 to 65,534.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;files&#34;&gt;Files&lt;/h4&gt;
&lt;p&gt;&lt;tt&gt;ntp.keys&lt;/tt&gt; private MD5 keys&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntpkey&lt;/tt&gt; RSA private key&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntpkey_&lt;i&gt;host&lt;/i&gt;&lt;/tt&gt; RSA public key&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntp_dh&lt;/tt&gt; Diffie-Hellman agreement parameters&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;bugs&#34;&gt;Bugs&lt;/h4&gt;
&lt;p&gt;The &lt;tt&gt;ntpkey_&lt;i&gt;host&lt;/i&gt;&lt;/tt&gt; files are really digital certificates. These should be obtained via secure directory services when they become universally available.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Authentication Options</title>
      <link>/archives/4.1.2/authopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.1.2/authopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice44.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/%7emills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Our resident cryptographer; now you see him, now you don&amp;rsquo;t.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/authopt/#authentication-support&#34;&gt;Authentication Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/authopt/#symmetric-key-scheme&#34;&gt;Symmetric Key Scheme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/authopt/#public-key-scheme&#34;&gt;Public Key Scheme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/authopt/#leapseconds-table&#34;&gt;Leapseconds Table&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/authopt/#key-management&#34;&gt;Key Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/authopt/#authentication-commands&#34;&gt;Authentication Commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/authopt/#files&#34;&gt;Files&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.1.2/authopt/#bugs&#34;&gt;Bugs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-support&#34;&gt;Authentication Support&lt;/h4&gt;
&lt;p&gt;Authentication support allows the NTP client to verify that the server is in fact known and trusted and not an intruder intending accidentally or on purpose to masquerade as that server. The NTPv3 specification RFC-1305 defines an scheme which provides cryptographic authentication of received NTP packets. Originally, this was done using the Data Encryption Standard (DES) algorithm operating in Cipher Block Chaining (CBC) mode, commonly called
DES-CBC. Subsequently, this was augmented by the RSA Message Digest 5 (MD5) algorithm using a private key, commonly called keyed-MD5. Either algorithm computes a message digest, or one-way hash, which can be used to verify the server has the correct private key and key identifier.&lt;/p&gt;
&lt;p&gt;NTPv4 retains the NTPv3 schemes, properly described as symmetric-key cryptography and, in addition, provides a new Autokey scheme based on public-key cryptography. Public-key cryptography is generally considered more secure than symmetric-key cryptography, since the security is based on a private value which is generated by each server and never revealed. With Autokey all key distribution and management functions involve only public values, which considerably simplifies key distribution and storage.&lt;/p&gt;
&lt;p&gt;Authentication is configured separately for each association using the &lt;tt&gt;key&lt;/tt&gt; or &lt;tt&gt;autokey&lt;/tt&gt; subcommands on the &lt;tt&gt;peer&lt;/tt&gt;, &lt;tt&gt;server&lt;/tt&gt;, &lt;tt&gt;broadcast&lt;/tt&gt; and &lt;tt&gt;manycastclient&lt;/tt&gt; commands as described in the &lt;a href=&#34;/archives/4.1.2/config&#34;&gt;Configuration Options&lt;/a&gt; page. The authentication
options described below specify the suite of keys, select the key for each configured association and manage the configuration operations.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;auth&lt;/tt&gt; flag controls whether new associations or remote configuration commands require cryptographic authentication. This flag can be set or reset by the &lt;tt&gt;enable&lt;/tt&gt; and &lt;tt&gt;disable&lt;/tt&gt; configuration commands and also by remote configuration commands sent by a &lt;tt&gt;ntpdc&lt;/tt&gt; program running in another machine. If this flag is enabled, which is the default case, new broadcast client and symmetric passive associations and remote configuration commands must be cryptographically authenticated using either symmetric-key or public-key schemes. If this flag is disabled, these operations are effective even if not cryptographic authenticated. It should be understood that operating in the latter mode invites a significant vulnerability where a rogue hacker can seriously disrupt client timekeeping.&lt;/p&gt;
&lt;p&gt;In networks with firewalls and large numbers of broadcast clients it may be acceptable to disable authentication, since that avoids key distribution and simplifies network maintenance. However, when the configuration file contains host names, or when a server or client is configured remotely, host names are resolved using the DNS and a separate name resolution process. In order to protect against bogus name server messages, name resolution messages are authenticated using an internally generated key which is normally invisible to the user. However, if cryptographic support is disabled, the name resolution process will fail. This can be avoided either by specifying IP addresses instead of host names, which is generally inadvisable, or by enabling the flag for
name resolution and disabled it once the name resolution process is complete.&lt;/p&gt;
&lt;p&gt;An attractive alternative where multicast support is available is manycast mode, in which clients periodically troll for servers. Cryptographic authentication in this mode uses public-key schemes as described below. The principle advantage of this manycast mode is that potential servers need not be configured in advance, since the client finds them during regular operation, and the configuration files for all clients can be identical.&lt;/p&gt;
&lt;p&gt;In addition to the default symmetric-key cryptographic support, support for public-key cryptography is available if the requisite &lt;tt&gt;rsaref20&lt;/tt&gt; software distribution has been installed before building the distribution. Public-key cryptography provides secure authentication of servers without compromising accuracy and stability. The security model and protocol schemes for both symmetric-key and public-key cryptography are described below.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-key-scheme&#34;&gt;Symmetric Key Scheme&lt;/h4&gt;
&lt;p&gt;The original RFC-1305 specification allows any one of possibly 65,534 keys, each distinguished by a 32-bit key identifier, to authenticate an association. The servers and clients involved must agree on the key and key identifier to authenticate NTP packets. Keys and related information are specified in a key file, usually called &lt;tt&gt;ntp.keys&lt;/tt&gt;, which must be distributed and stored using secure means beyond the scope of the NTP protocol itself. Besides the keys used for ordinary NTP associations, additional keys can be used as passwords for the &lt;a href=&#34;/archives/4.1.2/ntpq&#34;&gt;ntpq&lt;/a&gt; and &lt;a href=&#34;/archives/4.1.2/ntpdc&#34;&gt;ntpdc&lt;/a&gt; utility programs.&lt;/p&gt;
&lt;p&gt;When &lt;tt&gt;ntpd&lt;/tt&gt; is first started, it reads the key file specified in the &lt;tt&gt;keys&lt;/tt&gt; configuration command and installs the keys in the key cache. However, individual keys must be activated with the &lt;tt&gt;trustedkey&lt;/tt&gt; command before use. This allows, for instance, the installation of possibly several batches of keys and then activating or deactivating each batch remotely using &lt;tt&gt;ntpdc&lt;/tt&gt;. This also provides a revocation capability that can be used if a key becomes compromised. The &lt;tt&gt;requestkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpdc&lt;/tt&gt; utility, while the &lt;tt&gt;controlkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpq&lt;/tt&gt; utility.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;public-key-scheme&#34;&gt;Public Key Scheme&lt;/h4&gt;
&lt;p&gt;The original NTPv3 authentication scheme described in RFC-1305 continues to be supported; however, in NTPv4 an additional authentication scheme called Autokey is available. It uses MD5 message digest, RSA public-key signature and Diffie-Hellman key agreement algorithms available from several sources, but not included in the NTPv4 software distribution. In order to be effective, the &lt;tt&gt;rsaref20&lt;/tt&gt; package must be installed as described in the &lt;tt&gt;README.rsa&lt;/tt&gt; file. Once installed, the configure and build process automatically detects it and compiles the routines required. The Autokey scheme has several modes of operation corresponding to the various NTP modes supported. RSA signatures with timestamps are used in all modes to verify the source of cryptographic values. All modes use a special cookie which can be computed independently by the client and server. In symmetric modes the cookie is constructed using the Diffie-Hellman key agreement algorithm. In other modes the cookie is constructed from the IP addresses and a private value known only to the server. All modes use in addition a variant of the S-KEY scheme, in which a pseudo-random key list is generated and used in reverse order. These schemes are described along with an executive summary, current status, briefing slides and reading list, on the &lt;a href=&#34;http://www.eecis.udel.edu/~mills/autokey.html&#34;&gt;Autonomous Authentication&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The cryptographic values used by the Autokey scheme are incorporated as a set of files generated by the &lt;a href=&#34;/archives/4.1.2/genkeys&#34;&gt;&lt;tt&gt;ntp-genkeys&lt;/tt&gt;&lt;/a&gt; program, including the symmetric private keys, public/private key pair, and the agreement parameters. See the &lt;tt&gt;ntp-genkeys&lt;/tt&gt; page for a description of the formats of these files. They contain cryptographic values generated by the algorithms of the &lt;tt&gt;rsaref20&lt;/tt&gt; package and are in printable ASCII format. All file names include the timestamp, in NTP seconds, following the default names given below. Since the file data are derived from random values seeded by the system clock and the file name includes the timestamp, every generation produces a different file and different file name.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;ntp.keys&lt;/tt&gt; file contains the DES/MD5 private keys. It must be distributed by secure means to other servers and clients sharing the same security compartment and made visible only to root. While this file is not used with the Autokey scheme, it is needed to authenticate some remote configuration commands used by the &lt;a href=&#34;/archives/4.1.2/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; and &lt;a href=&#34;/archives/4.1.2/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; utilities. The &lt;tt&gt;ntpkey&lt;/tt&gt; file contains the RSA private key. It is useful only to the machine that generated it and never shared with any other daemon or application program, so must be made visible only to root.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;ntp_dh&lt;/tt&gt; file contains the agreement parameters, which are used only in symmetric (active and passive) modes. It is necessary that both peers beginning a symmetric-mode association share the same parameters, but it does not matter which &lt;tt&gt;ntp_dh&lt;/tt&gt; file generates them. If one of the peers contains the parameters, the other peer obtains them using the Autokey protocol. If both peers contain the parameters, the most recent copy is used by both peers. If a peer does not have the parameters, they will be requested by all associations, either configured or not; but, none of the associations can proceed until one of them has received the parameters. Once loaded, the parameters can be provided on request to other clients and servers. The &lt;tt&gt;ntp_dh&lt;/tt&gt; file can also be distributed using insecure means, since the data are public values.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;ntpkey__host_&lt;/tt&gt; file contains the RSA public key, where &lt;tt&gt;_host_&lt;/tt&gt; is the name of the host. Each host must have its own &lt;tt&gt;ntpkey__host_&lt;/tt&gt; file, which is normally provided to other hosts using the Autokey protocol Each &lt;tt&gt;server&lt;/tt&gt; or &lt;tt&gt;peer&lt;/tt&gt; association requires the public key associated with the particular server or peer to be loaded either directly from a local file or indirectly from the server using the Autokey protocol. These files can be widely distributed and stored using insecure means, since the data are public values.&lt;/p&gt;
&lt;p&gt;The optional &lt;tt&gt;ntpkey_certif__host_&lt;/tt&gt; file contains the PKI certificate for the host. This provides a binding between the host hame and RSA public key. In the current implementation the certificate is obtained by a client, if present, but the contents are ignored.&lt;/p&gt;
&lt;p&gt;Due to the widespread use of interface-specific naming, the host names used in configured and mobilized associations are determined by the Unix &lt;tt&gt;gethostname()&lt;/tt&gt; library routine. Both the &lt;tt&gt;ntp-genkeys&lt;/tt&gt; program and the Autokey protocol derive the name of the public key file using the name returned by this routine. While every server and client is required to load their own public and private keys, the public keys for each client or peer association can be obtained from the server or peer using the Autokey protocol. Note however, that at the current stage of development the authenticity of the server or peer and the cryptographic binding of the server name, address and public key is not yet established by a certificate authority or web of trust.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;leapseconds-table&#34;&gt;Leapseconds Table&lt;/h4&gt;
&lt;p&gt;The NIST provides a table showing the epoch for all historic occasions of leap second insertion since 1972. The leapsecond table shows each epoch of insertion along with the offset of International Atomic Time (TAI) with respect to Coordinated Universtal Time (UTC), as disseminated by NTP. The table can be obtained directly from NIST national time servers using &lt;tt&gt;ftp&lt;/tt&gt; as the ASCII file &lt;tt&gt;pub/leap-seconds&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;While not strictly a security function, the Autokey protocol provides means to securely retrieve the leapsecond table from a server or peer. Servers load the leapsecond table directly from the file specified in the &lt;tt&gt;crypto&lt;/tt&gt; command, while clients can obtain the table indirectly from the servers using the Autokey protocol. Once loaded, the table can be provided on request to other clients and servers.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;key-management&#34;&gt;Key Management&lt;/h4&gt;
&lt;p&gt;All key files are installed by default in &lt;tt&gt;/usr/local/etc&lt;/tt&gt;, which is normally in a shared filesystem in NFS-mounted networks and avoids installing them in each machine separately. The default can be overridden by the &lt;tt&gt;keysdir&lt;/tt&gt; configuration command. However, this is not a good place to install the private key file, since each machine needs its own file. A suitable place to install it is in &lt;tt&gt;/etc&lt;/tt&gt;, which is normally not in a shared filesystem.&lt;/p&gt;
&lt;p&gt;The recommended practice is to keep the timestamp extensions when installing a file and to install a link from the default name (without the timestamp extension) to the actual file. This allows new file generations to be activated simply by changing the link. However, &lt;tt&gt;ntpd&lt;/tt&gt; parses the link name when present to extract the extension value and sends it along with the public key and host name when requested. This allows clients to verify that the file and generation time are always current. However, the actual location of each file can be overridden by the &lt;tt&gt;crypto&lt;/tt&gt; configuration command.&lt;/p&gt;
&lt;p&gt;All cryptographic keys and related parameters should be regenerated on a periodic and automatic basis, like once per month. The &lt;tt&gt;ntp-genkeys&lt;/tt&gt; program uses the same timestamp extension for all files generated at one time, so each generation is distinct and can be readily recognized in monitoring data. While a public/private key pair must be generated by every server and client, the public keys and agreement parameters do not need to be explicitly copied to all machines in the same security compartment, since they can be obtained automatically using the Autokey protocol. However, it is necessary that all primary servers have the same agreement parameter file. The recommended way to do this is for one of the primary servers to generate that file and then copy it to the other primary servers in the same compartment using the Unix &lt;tt&gt;rdist&lt;/tt&gt; command. Future versions of the Autokey protocol are to contain provisions for an agreement protocol to do this automatically.&lt;/p&gt;
&lt;p&gt;Servers and clients can make a new generation in the following way. All machines have loaded the old generation at startup and are operating normally. At designated intervals, each machine generates a new public/private key pair and makes links from the default file names to the new file names. The &lt;tt&gt;ntpd&lt;/tt&gt; is then restarted and loads the new generation, with result clients no longer can authenticate correctly. The Autokey protocol is designed so that after a few minutes the clients time out and restart the protocol from the beginning, with result the new generation is loaded and operation continues as before. A similar procedure can be used for the agreement parameter file, but in this case precautions must be take to be sure that all machines with this file have the same copy.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-commands&#34;&gt;Authentication Commands&lt;/h4&gt;
&lt;dt&gt;&lt;tt&gt;autokey [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between regenerations of the session key list used with the Autokey protocol. Note that the size of the key list for each association depends on this interval and the current poll interval. The default interval is 12 (4096 s or about 1.1 hours). For poll intervals above the specified interval, a session key list with a single entry will be regenerated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;controlkey&#34;&gt;&lt;tt&gt;controlkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.1.2/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; utility, which uses the standard protocol defined in RFC-1305. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is the key identifier for a trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;crypto&#34;&gt;&lt;tt&gt;[flags _flags_] [privatekey _file_] [publickey _file_] [dhparms _file_] [leap _file_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command requires the NTP daemon build process be configured with the RSA library. This command activates public-key cryptography and loads the required RSA private and public key files and the optional Diffie-Hellman agreement parameter file, if present. If one or more files are left unspecified, the default names are used as described below. Following are the subcommands:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;privatekey &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the RSA private key file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;publickey &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the RSA public key file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey_host_&lt;/tt&gt;, where host is the name of the generating machine.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;dhparms &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;Â Â Â Â &lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the Diffie-Hellman parameters file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey_dh&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;leap &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the leapsecond table file, which otherwise defaults to &lt;tt&gt;/usr/local/etc/ntpkey_leap&lt;/tt&gt;.&lt;/p&gt;
&lt;dt id=&#34;keys&#34;&gt;&lt;tt&gt;keys _keyfile_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the location of the DES/MD5 private key file containing the keys and key identifiers used by &lt;tt&gt;ntpd&lt;/tt&gt;, &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; when operating with symmetric-key mode.&lt;/p&gt;
&lt;dt id=&#34;keysdir&#34;&gt;&lt;tt&gt;keysdir _path_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command requires the NTP daemon build process be configured with the RSA library. It specifies the default directory path for the private key file, agreement parameters file and one or more public key files. The default when this command does not appear in the configuration file is &lt;tt&gt;/usr/local/etc/&lt;/tt&gt;.&lt;/p&gt;
&lt;dt id=&#34;requestkey&#34;&gt;&lt;tt&gt;requestkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.1.2/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; program, which uses a proprietary protocol specific to this implementation of &lt;tt&gt;ntpd&lt;/tt&gt;. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is a key identifier for the trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;revoke&#34;&gt;&lt;tt&gt;revoke [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between re-randomization of certain cryptographic values used by the Autokey scheme, as a power of 2 in seconds. These values need to be updated frequently in order to deflect brute-force attacks on the algorithms of the scheme; however, updating some values is a relatively expensive operation. The default interval is 16 (65,536 s or about 18 hours). For poll intervals above the specified interval, the values will be updated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;trustedkey&#34;&gt;&lt;tt&gt;trustedkey [_key_] [...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifiers which are trusted for the purposes of authenticating peers with symmetric-key cryptography, as well as keys used by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; programs. The authentication procedures require that both the local and remote servers share the same key and key identifier for this purpose, although different keys can be used with different servers. The &lt;tt&gt;key&lt;/tt&gt; arguments are 32-bit unsigned integers with values from 1 to 65,534.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;files&#34;&gt;Files&lt;/h4&gt;
&lt;p&gt;&lt;tt&gt;ntp.keys&lt;/tt&gt; private MD5 keys&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntpkey&lt;/tt&gt; RSA private key&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntpkey_&lt;i&gt;host&lt;/i&gt;&lt;/tt&gt; RSA public key&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntp_dh&lt;/tt&gt; Diffie-Hellman agreement parameters&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;bugs&#34;&gt;Bugs&lt;/h4&gt;
&lt;p&gt;The &lt;tt&gt;ntpkey_&lt;i&gt;host&lt;/i&gt;&lt;/tt&gt; files are really digital certificates. These should be obtained via secure directory
services when they become universally available.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Authentication Options</title>
      <link>/archives/4.2.0/authopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.0/authopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice44.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/%7emills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Our resident cryptographer; now you see him, now you don&amp;rsquo;t.&lt;/p&gt;
&lt;p&gt;Last update: 	03:05 AM UTC Monday, October 13, 2003&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/authopt/#authentication-support&#34;&gt;Authentication Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/authopt/#symmetric-key-cryptography&#34;&gt;Symmetric Key Cryptography&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/authopt/#public-key-cryptography&#34;&gt;Public Key Cryptography&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/authopt/#operation&#34;&gt;Operation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/authopt/#key-management&#34;&gt;Key Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/authopt/#authentication-commands&#34;&gt;Authentication Commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/authopt/#error-codes&#34;&gt;Error Codes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/authopt/#files&#34;&gt;Files&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.0/authopt/#leapseconds-table&#34;&gt;Leapseconds Table&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-support&#34;&gt;Authentication Support&lt;/h4&gt;
&lt;p&gt;Authentication support allows the NTP client to verify that the server is in fact known and trusted and not an intruder intending accidentally or on purpose to masquerade as that server. The NTPv3 specification RFC-1305 defines a scheme which provides cryptographic authentication of received NTP packets. Originally, this was done using the Data Encryption Standard (DES) algorithm operating in Cipher Block Chaining (CBC) mode, commonly called DES-CBC. Subsequently, this was replaced by the RSA Message Digest 5 (MD5) algorithm using a private key, commonly called keyed-MD5. Either algorithm computes a message digest, or one-way hash, which can be used to verify the server has the correct private key and key identifier.&lt;/p&gt;
&lt;p&gt;NTPv4 retains the NTPv3 scheme, properly described as symmetric key cryptography, and, in addition, provides a new Autokey scheme based on public key cryptography. Public key cryptography is generally considered more secure than symmetric key cryptography, since the security is based on a private value which is generated by each host and never revealed. With the exception of the group key described later, all key distribution and management functions involve only public values, which considerably simplifies key distribution and storage. Public key management is based on X.509 certificates, which can be provided by commercial services or produced by utility programs in the OpenSSL software library or the NTPv4 distribution.&lt;/p&gt;
&lt;p&gt;While the algorithms for symmetric key cryptography are included in the NTPv4 distribution, public key cryptography requires the OpenSSL software library to be installed before building the NTP distribution. Directions for doing that are on the &lt;a href=&#34;/archives/4.2.0/build&#34;&gt;Building and Installing the Distribution&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;Authentication is configured separately for each association using the &lt;tt&gt;key&lt;/tt&gt; or &lt;tt&gt;autokey&lt;/tt&gt; subcommand on the &lt;tt&gt;peer&lt;/tt&gt;, &lt;tt&gt;server&lt;/tt&gt;, &lt;tt&gt;broadcast&lt;/tt&gt; and &lt;tt&gt;manycastclient&lt;/tt&gt; configuration commands as described in the &lt;a href=&#34;/archives/4.2.0/confopt&#34;&gt;Configuration Options&lt;/a&gt; page. The authentication options described below specify the locations of the key files, if other than default, which symmetric keys are trusted and the interval between various operations, if other than default.&lt;/p&gt;
&lt;p&gt;Authentication is always enabled, although ineffective if not configured as described below. If a NTP packet arrives including a message authentication code (MAC), it is accepted only if it passes all cryptographic checks. The checks require correct key ID, key value and message digest. If the packet has been modified in any way or replayed by an intruder, it will fail one or more of these checks and be discarded. Furthermore, the Autokey scheme requires a preliminary protocol exchange to obtain the server certificate, verify its credentials and initialize the protocol.&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;auth&lt;/tt&gt; flag controls whether new associations or remote configuration commands require cryptographic authentication. This flag can be set or reset by the &lt;tt&gt;enable&lt;/tt&gt; and &lt;tt&gt;disable&lt;/tt&gt; commands and also by remote configuration commands sent by a &lt;tt&gt;ntpdc&lt;/tt&gt; program running on another machine. If this flag is enabled, which is the default case, new broadcast/manycast client and symmetric passive associations and remote configuration commands must be cryptographically authenticated using either symmetric key or public key cryptography. If this flag is disabled, these operations are effective even if not cryptographic authenticated. It should be understood that operating with the &lt;tt&gt;auth&lt;/tt&gt; flag disabled invites a significant vulnerability where a rogue hacker can masquerade as a truechimer and seriously disrupt system timekeeping. It is important to note that this flag has no purpose other than to allow or disallow a new association in response to new broadcast and symmetric active messages and remote configuration commands and, in particular, the flag has no effect on the authentication process itself.&lt;/p&gt;
&lt;p&gt;An attractive alternative where multicast support is available is manycast mode, in which clients periodically troll for servers as described in the &lt;a href=&#34;/archives/4.2.0/manyopt&#34;&gt;Automatic NTP Configuration Options&lt;/a&gt; page. Either symmetric key or public key cryptographic authentication can be used in this mode. The principle advantage of manycast mode is that potential servers need not be configured in advance, since the client finds them during regular operation, and the configuration files for all clients can be identical.&lt;/p&gt;
&lt;p&gt;The security model and protocol schemes for both symmetric key and public key cryptography are summarized below; further details are in the briefings, papers and reports at the NTP project page linked from &lt;a href=&#34;http://www.ntp.org&#34;&gt;www.ntp.org&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-key-cryptography&#34;&gt;Symmetric Key Cryptography&lt;/h4&gt;
&lt;p&gt;The original RFC-1305 specification allows any one of possibly 65,534 keys, each distinguished by a 32-bit key identifier, to authenticate an association. The servers and clients involved must agree on the key and key identifier to authenticate NTP packets. Keys and related information are specified in a key file, usually called &lt;tt&gt;ntp.keys&lt;/tt&gt;, which must be distributed and stored using secure means beyond the scope of the NTP protocol itself. Besides the keys used for ordinary NTP associations, additional keys can be used as passwords for the &lt;a href=&#34;/archives/4.2.0/ntpq&#34;&gt;ntpq&lt;/a&gt; and &lt;a href=&#34;/archives/4.2.0/ntpdc&#34;&gt;ntpdc&lt;/a&gt; utility programs.&lt;/p&gt;
&lt;p&gt;When &lt;tt&gt;ntpd&lt;/tt&gt; is first started, it reads the key file specified in the &lt;tt&gt;keys&lt;/tt&gt; configuration command and installs the keys in the key cache. However, individual keys must be activated with the &lt;tt&gt;trustedkey&lt;/tt&gt; command before use. This allows, for instance, the installation of possibly several batches of keys and then activating or deactivating each batch remotely using &lt;tt&gt;ntpdc&lt;/tt&gt;. This also provides a revocation capability that can be used if a key becomes compromised. The &lt;tt&gt;requestkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpdc&lt;/tt&gt; utility, while the &lt;tt&gt;controlkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpq&lt;/tt&gt; utility.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;public-key-cryptography&#34;&gt;Public Key Cryptography&lt;/h4&gt;
&lt;p&gt;NTPv4 supports the original NTPv3 symmetric key scheme described in RFC-1305 and in addition the Autokey protocol, which is based on public key cryptography. The Autokey Version 2 protocol described on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/proto.html&#34;&gt;Autokey Protocol&lt;/a&gt; page verifies packet integrity using MD5 message digests and verifies the source with digital signatures and any of several digest/signature schemes. Optional identity schemes described on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/ident.html&#34;&gt;Identity Schemes&lt;/a&gt; page and based on cryptographic challenge/response algorithms are also available. Using these schemes provides strong security against replay with or without modification, spoofing, masquerade and most forms of clogging attacks.&lt;/p&gt;
&lt;p&gt;The cryptographic means necessary for all Autokey operations is provided by the OpenSSL software library. This library is available from &lt;a href=&#34;https://www.openssl.org&#34;&gt;https://www.openssl.org&lt;/a&gt; and can be installed using the procedures outlined in the &lt;a href=&#34;/archives/4.2.0/build&#34;&gt;Building and Installing the Distribution&lt;/a&gt; page. Once installed, the configure and build process automatically detects the library and links the library routines required.&lt;/p&gt;
&lt;p&gt;The Autokey protocol has several modes of operation corresponding to the various NTP modes supported. Most modes use a special cookie which can be computed independently by the client and server, but encrypted in transmission. All modes use in addition a variant of the S-KEY scheme, in which a pseudo-random key list is generated and used in reverse order. These schemes are described along with an executive summary, current status, briefing slides and reading list on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/autokey.html&#34;&gt;Autonomous Authentication&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The specific cryptographic environment used by Autokey servers and clients is determined by a set of files and soft links generated by the &lt;a href=&#34;/archives/4.2.0/keygen&#34;&gt;ntp-keygen&lt;/a&gt; program. This includes a required host key file, required host certificate file and optional sign key file, leapsecond file and identity scheme files. The digest/signature scheme is specified in the X.509 certificate along with the matching sign key. There are several schemes available in the OpenSSL software library, each identified by a specific string such as &lt;tt&gt;md5WithRSAEncryption&lt;/tt&gt;, which stands for the MD5 message digest with RSA encryption scheme. The current NTP distribution supports all the schemes in the OpenSSL library, including those based on RSA and DSA digital signatures.&lt;/p&gt;
&lt;p&gt;NTP secure groups can be used to define cryptographic compartments and security hierarchies. It is important that every host in the group be able to construct a certificate trail to one or more trusted hosts in the same group. Each group host runs the Autokey protocol to obtain the certificates for all hosts along the trail to one or more trusted hosts. This requires the configuration file in all hosts to be engineered so that, even under anticipated failure conditions, the NTP subnet will form such that every group host can find a trail to at least one trusted host.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;naming-and-addressing&#34;&gt;Naming and Addressing&lt;/h4&gt;
&lt;p&gt;It is important to note that Autokey does not use DNS to resolve addresses, since DNS can&amp;rsquo;t be completely trusted until the name servers have synchronized clocks. The cryptographic name used by Autokey to bind the host identity credentials and cryptographic values must be independent of interface, network and any other naming convention. The name appears in the host certificate in either or both the subject and issuer fields, so protection against DNS compromise is essential.&lt;/p&gt;
&lt;p&gt;By convention, the name of an Autokey host is the name returned by the Unix &lt;tt&gt;gethostname()&lt;/tt&gt; system call or equivalent in other systems. By the system design model, there are no provisions to allow alternate names or aliases. However, this is not to say that DNS aliases, different names for each interface, etc., are constrained in any way.&lt;/p&gt;
&lt;p&gt;It is also important to note that Autokey verifies authenticity using the host name, network address and public keys, all of which are bound together by the protocol specifically to deflect masquerade attacks. For this reason Autokey includes the source and destination IP addresses in message digest computations and so the same addresses must be available at both the server and client. For this reason operation with network address translation schemes is not possible. This reflects the intended robust security model where government and corporate NTP servers are operated outside firewall perimeters.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;operation&#34;&gt;Operation&lt;/h4&gt;
&lt;p&gt;A specific combination of authentication scheme (none, symmetric key, public key) and identity scheme is called a cryptotype, although not all combinations are compatible. There may be management configurations where the clients, servers and peers may not all support the same cryptotypes. A secure NTPv4 subnet can be configured in many ways while keeping in mind the principles explained above and in this section. Note however that some cryptotype combinations may successfully interoperate with each other, but may not represent good security practice.&lt;/p&gt;
&lt;p&gt;The cryptotype of an association is determined at the time of mobilization, either at configuration time or some time later when a message of appropriate cryptotype arrives. When mobilized by a &lt;tt&gt;server&lt;/tt&gt; or &lt;tt&gt;peer&lt;/tt&gt; configuration command and no &lt;tt&gt;key&lt;/tt&gt; or &lt;tt&gt;autokey&lt;/tt&gt; subcommands are present, the association is not authenticated; if the &lt;tt&gt;key&lt;/tt&gt; subcommand is present, the association is authenticated using the symmetric key ID specified; if the &lt;tt&gt;autokey&lt;/tt&gt; subcommand is present, the association is authenticated using Autokey.&lt;/p&gt;
&lt;p&gt;When multiple identity schemes are supported in the Autokey protocol, the first message exchange determines which one is used. The client request message contains bits corresponding to which schemes it has available. The server response message contains bits corresponding to which schemes it has available. Both server and client match the received bits with their own and select a common scheme.&lt;/p&gt;
&lt;p&gt;Following the principle that time is a public value, a server responds to any client packet that matches its cryptotype capabilities. Thus, a server receiving an unauthenticated packet will respond with an unauthenticated packet, while the same server receiving a packet of a cryptotype it supports will respond with packets of that cryptotype. However, unconfigured broadcast or manycast client associations or symmetric passive associations will not be mobilized unless the server supports a cryptotype compatible with the first packet received. By default, unauthenticated associations will not be mobilized unless overridden in a decidedly dangerous way.&lt;/p&gt;
&lt;p&gt;Some examples may help to reduce confusion. Client Alice has no specific cryptotype selected. Server Bob has both a symmetric key file and minimal Autokey files. Alice&amp;rsquo;s unauthenticated messages arrive at Bob, who replies with unauthenticated messages. Cathy has a copy of Bob&amp;rsquo;s symmetric key file and has selected key ID 4 in messages to Bob. Bob verifies the message with his key ID 4. If it&amp;rsquo;s the same key and the message is verified, Bob sends Cathy a reply authenticated with that key. If verification fails, Bob sends Cathy a thing called a crypto-NAK, which tells her something broke. She can see the evidence using the &lt;tt&gt;ntpq&lt;/tt&gt; program.&lt;/p&gt;
&lt;p&gt;Denise has rolled her own host key and certificate. She also uses one of the identity schemes as Bob. She sends the first Autokey message to Bob and they both dance the protocol authentication and identity steps. If all comes out okay, Denise and Bob continue as described above.&lt;/p&gt;
&lt;p&gt;It should be clear from the above that Bob can support all the girls at the same time, as long as he has compatible authentication and identity credentials. Now, Bob can act just like the girls in his own choice of servers; he can run multiple configured associations with multiple different servers (or the same server, although that might not be useful). But, wise security policy might preclude some cryptotype combinations; for instance, running an identity scheme with one server and no authentication with another might not be wise.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;key-management&#34;&gt;Key Management&lt;/h4&gt;
&lt;p&gt;The cryptographic values used by the Autokey protocol are incorporated as a set of files generated by the &lt;a href=&#34;/archives/4.2.0/keygen&#34;&gt;ntp-keygen&lt;/a&gt; utility program, including symmetric key, host key and public certificate files, as well as sign key, identity parameters and leapseconds files. Alternatively, host and sign keys and certificate files can be generated by the OpenSSL utilities and certificates can be imported from public certificate authorities. Note that symmetric keys are necessary for the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; utility programs. The remaining files are necessary only for the Autokey protocol.&lt;/p&gt;
&lt;p&gt;Certificates imported from OpenSSL or public certificate authorities have certain limitations. The certificate should be in ASN.1 syntax, X.509 Version 3 format and encoded in PEM, which is the same format used by OpenSSL. The overall length of the certificate encoded in ASN.1 must not exceed 1024 bytes. The subject distinguished name field (&lt;tt&gt;CN&lt;/tt&gt;) is the fully qualified name of the host on which it is used; the remaining subject fields are ignored. The certificate extension fields must not contain either a subject key identifier or a issuer key identifier field; however, an extended key usage field for a trusted host must contain the value &lt;tt&gt;trustRoot;&lt;/tt&gt;. Other extension fields are ignored.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-commands&#34;&gt;Authentication Commands&lt;/h4&gt;
&lt;dt&gt;&lt;tt&gt;autokey [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between regenerations of the session key list used with the Autokey protocol. Note that the size of the key list for each association depends on this interval and the current poll interval. The default interval is 12 (4096 s or about 1.1 hours). For poll intervals above the specified interval, a session key list with a single entry will be regenerated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;controlkey&#34;&gt;&lt;tt&gt;controlkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.2.0/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; utility, which uses the standard protocol defined in RFC-1305. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is the key identifier for a trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;crypto&#34;&gt;&lt;tt&gt;crypto [cert _file_] [leap _file_] [randfile _file_] [host _file_] [sign _file_] [gq _file_] [gqpar _file_] [iffpar _file_] [mvpar _file_] [pw _password_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command requires the OpenSSL library. It activates public key cryptography, selects the message digest and signature encryption scheme and loads the required private and public values described above. If one or more files are left unspecified, the default names are used as described above. Unless the complete path and name of the file are specified, the location of a file is relative to the keys directory specified in the &lt;tt&gt;keysdir&lt;/tt&gt; command or default &lt;tt&gt;/usr/local/etc&lt;/tt&gt;. Following are the subcommands:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;cert &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the required host public certificate file. This overrides the link &lt;tt&gt;ntpkey_cert_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;gqpar &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the client GQ parameters file. This overrides the link &lt;tt&gt;ntpkey_gq_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;host &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;Â Â Â Â &lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the required host key file. This overrides the link &lt;tt&gt;ntpkey_key_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;iffpar &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the optional IFF parameters file.This overrides the link &lt;tt&gt;ntpkey_iff_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;leap &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the optional leapsecond file. This overrides the link &lt;tt&gt;ntpkey_leap&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;mvpar &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the client MV parameters file. This overrides the link &lt;tt&gt;ntpkey_mv_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;pw &lt;em&gt;password&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the password to decrypt files containing private keys and identity parameters. This is required only if these files have been encrypted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;randfile &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the random seed file used by the OpenSSL library. The defaults are described in the main text above.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;sign &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the optional sign key file. This overrides the link &lt;tt&gt;ntpkey_sign_hostname&lt;/tt&gt; in the keys directory. If this file is not found, the host key is also the sign key.&lt;/p&gt;
&lt;dt id=&#34;keys&#34;&gt;&lt;tt&gt;keys _keyfile_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the complete path to the MD5 key file containing the keys and key identifiers used by &lt;tt&gt;ntpd&lt;/tt&gt;, &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; when operating with symmetric key cryptography. This is the same operation as the &lt;tt&gt;-k&lt;/tt&gt; command line option.&lt;/p&gt;
&lt;dt id=&#34;keysdir&#34;&gt;&lt;tt&gt;keysdir _path_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command specifies the default directory path for cryptographic keys, parameters and certificates. The default is &lt;tt&gt;/usr/local/etc/&lt;/tt&gt;.&lt;/p&gt;
&lt;dt id=&#34;requestkey&#34;&gt;&lt;tt&gt;requestkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.2.0/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; program, which uses a proprietary protocol specific to this implementation of &lt;tt&gt;ntpd&lt;/tt&gt;. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is a key identifier for the trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;revoke&#34;&gt;&lt;tt&gt;revoke [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between re-randomization of certain cryptographic values used by the Autokey scheme, as a power of 2 in seconds. These values need to be updated frequently in order to deflect brute-force attacks on the algorithms of the scheme; however, updating some values is a relatively expensive operation. The default interval is 16 (65,536 s or about 18 hours). For poll intervals above the specified interval, the values will be updated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;trustedkey&#34;&gt;&lt;tt&gt;trustedkey [_key_] [...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifiers which are trusted for the purposes of authenticating peers with symmetric key cryptography, as well as keys used by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; programs. The authentication procedures require that both the local and remote servers share the same key and key identifier for this purpose, although different keys can be used with different servers. The &lt;tt&gt;key&lt;/tt&gt; arguments are 32-bit unsigned integers with values from 1 to 65,534.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;error-codes&#34;&gt;Error Codes&lt;/h4&gt;
&lt;p&gt;The following error codes are reported via the NTP control and monitoring protocol trap mechanism.&lt;/p&gt;
&lt;dt&gt;101 bad field format or length&lt;/dt&gt;
&lt;p&gt;The packet has invalid version, length or format.&lt;/p&gt;
&lt;dt&gt;102 bad timestamp&lt;/dt&gt;
&lt;p&gt;The packet timestamp is the same or older than the most recent received. This could be due to a replay or a server clock time step.&lt;/p&gt;
&lt;dt&gt;103 bad filestamp&lt;/dt&gt;
&lt;p&gt;The packet filestamp is the same or older than the most recent received. This could be due to a replay or a key file generation error.&lt;/p&gt;
&lt;dt&gt;104 bad or missing public key&lt;/dt&gt;
&lt;p&gt;The public key is missing, has incorrect format or is an unsupported type.&lt;/p&gt;
&lt;dt&gt;105 unsupported digest type&lt;/dt&gt;
&lt;p&gt;The server requires an unsupported digest/signature scheme.&lt;/p&gt;
&lt;dt&gt;106 unsupported identity type&lt;/dt&gt;
&lt;p&gt;The client or server has requested an identity scheme the other does not support.&lt;/p&gt;
&lt;dt&gt;107 bad signature length&lt;/dt&gt;
&lt;p&gt;The signature length does not match the current public key.&lt;/p&gt;
&lt;dt&gt;108 signature not verified&lt;/dt&gt;
&lt;p&gt;The message fails the signature check. It could be bogus or signed by a different private key.&lt;/p&gt;
&lt;dt&gt;109 certificate not verified&lt;/dt&gt;
&lt;p&gt;The certificate is invalid or signed with the wrong key.&lt;/p&gt;
&lt;dt&gt;110 host certificate expired&lt;/dt&gt;
&lt;p&gt;The old server certificate has expired.&lt;/p&gt;
&lt;dt&gt;111 bad or missing cookie&lt;/dt&gt;
&lt;p&gt;The cookie is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;112 bad or missing leapseconds table&lt;/dt&gt;
&lt;p&gt;The leapseconds table is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;113 bad or missing certificate&lt;/dt&gt;
&lt;p&gt;The certificate is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;114 bad or missing group key&lt;/dt&gt;
&lt;p&gt;The identity key is missing, corrupt or bogus.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;files&#34;&gt;Files&lt;/h4&gt;
&lt;p&gt;See the &lt;a href=&#34;/archives/4.2.0/keygen&#34;&gt;&lt;tt&gt;ntp-keygen&lt;/tt&gt;&lt;/a&gt; page.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;leapseconds-table&#34;&gt;Leapseconds Table&lt;/h4&gt;
&lt;p&gt;The NIST provides a file documenting the epoch for all historic occasions of leap second insertion since 1972. The leapsecond table shows each epoch of insertion along with the offset of International Atomic Time (TAI) with respect to Coordinated Universal Time (UTC), as disseminated by NTP. The table can be obtained directly from NIST national time servers using &lt;tt&gt;ftp&lt;/tt&gt; as the ASCII file &lt;tt&gt;pub/leap-seconds&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;While not strictly a security function, the Autokey protocol provides means to securely retrieve the leapsecond table from a server or peer. Servers load the leapsecond table directly from the file specified in the &lt;tt&gt;crypto&lt;/tt&gt; command, with default &lt;tt&gt;ntpkey_leap&lt;/tt&gt;, while clients can obtain the table indirectly from the servers using the Autokey protocol. Once loaded, the table can be provided on request to other clients and servers.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Authentication Options</title>
      <link>/archives/4.2.2-series/authopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.2-series/authopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice44.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/%7emills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Our resident cryptographer; now you see him, now you don&amp;rsquo;t.&lt;/p&gt;
&lt;p&gt;Last update: 	16:25 UTC Monday, April 17, 2006&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/authopt/#authentication-support&#34;&gt;Authentication Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/authopt/#symmetric-key-cryptography&#34;&gt;Symmetric Key Cryptography&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/authopt/#public-key-cryptography&#34;&gt;Public Key Cryptography&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/authopt/#configuration&#34;&gt;Configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/authopt/#operation&#34;&gt;Operation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/authopt/#key-management&#34;&gt;Key Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/authopt/#authentication-commands&#34;&gt;Authentication Commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/authopt/#error-codes&#34;&gt;Error Codes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/authopt/#files&#34;&gt;Files&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.2-series/authopt/#leapseconds-table&#34;&gt;Leapseconds Table&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-support&#34;&gt;Authentication Support&lt;/h4&gt;
&lt;p&gt;Authentication support allows the NTP client to verify that the server is in fact known and trusted and not an intruder intending accidentally or on purpose to masquerade as that server. The NTPv3 specification RFC-1305 defines a scheme which provides cryptographic authentication of received NTP packets. Originally, this was done using the Data Encryption Standard (DES) algorithm operating in Cipher Block Chaining (CBC) mode, commonly called DES-CBC. Subsequently, this was replaced by the RSA Message Digest 5 (MD5) algorithm using a private key, commonly called keyed-MD5. Either algorithm computes a message digest, or one-way hash, which can be used to verify the server has the correct private key and key identifier.&lt;/p&gt;
&lt;p&gt;NTPv4 retains the NTPv3 scheme, properly described as symmetric key cryptography, and, in addition, provides a new Autokey scheme based on public key cryptography. Public key cryptography is generally considered more secure than symmetric key cryptography, since the security is based on a private value which is generated by each host and never revealed. With the exception of the group key described later, all key distribution and management functions involve only public values, which considerably simplifies key distribution and storage. Public key management is based on X.509 certificates, which can be provided by commercial services or produced by utility programs in the OpenSSL software library or the NTPv4 distribution.&lt;/p&gt;
&lt;p&gt;While the algorithms for symmetric key cryptography are included in the NTPv4 distribution, public key cryptography requires the OpenSSL software library to be installed before building the NTP distribution. This library is available from &lt;a href=&#34;https://www.openssl.org&#34;&gt;https://www.openssl.org&lt;/a&gt; and can be installed using the procedures outlined in the &lt;a href=&#34;/archives/4.2.2-series/build&#34;&gt;Building and Installing the Distribution&lt;/a&gt; page. Once installed, the configure and build process automatically detects the library and links the library routines required.&lt;/p&gt;
&lt;p&gt;Authentication is configured separately for each association using the &lt;tt&gt;key&lt;/tt&gt; or &lt;tt&gt;autokey&lt;/tt&gt; subcommand on the &lt;tt&gt;peer&lt;/tt&gt;, &lt;tt&gt;server&lt;/tt&gt;, &lt;tt&gt;broadcast&lt;/tt&gt; and &lt;tt&gt;manycastclient&lt;/tt&gt; configuration commands as described in the &lt;a href=&#34;/archives/4.2.2-series/confopt&#34;&gt;Configuration Options&lt;/a&gt; page. The authentication options described below specify the locations of the key files, if other than default, which symmetric keys are trusted and the interval between various operations, if other than default.&lt;/p&gt;
&lt;p&gt;Authentication is always enabled, although ineffective if not configured as described below. If a NTP packet arrives including a message authentication code (MAC), it is accepted only if it passes all cryptographic checks. The checks require correct key ID, key value and message digest. If the packet has been modified in any way or replayed by an intruder, it will fail one or more of these checks and be discarded. Furthermore, the Autokey scheme requires a preliminary protocol exchange to obtain the server certificate, verify its credentials and initialize the protocol&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;auth&lt;/tt&gt; flag controls whether new associations or remote configuration commands require cryptographic authentication. This flag can be set or reset by the &lt;tt&gt;enable&lt;/tt&gt; and &lt;tt&gt;disable&lt;/tt&gt; commands and also by remote configuration commands sent by a &lt;tt&gt;ntpdc&lt;/tt&gt; program running on another machine. If this flag is enabled, which is the default case, new broadcast/manycast client and symmetric passive associations and remote configuration commands must be cryptographically authenticated using either symmetric key or public key cryptography. If this flag is disabled, these operations are effective even if not cryptographic authenticated. It should be understood that operating with the &lt;tt&gt;auth&lt;/tt&gt; flag disabled invites a significant vulnerability where a rogue hacker can masquerade as a truechimer and seriously disrupt system timekeeping. It is important to note that this flag has no purpose other than to allow or disallow a new association in response to new broadcast and symmetric active messages and remote configuration commands and, in particular, the flag has no effect on the authentication process itself.&lt;/p&gt;
&lt;p&gt;The security model and protocol schemes for both symmetric key and public key cryptography are summarized below; further details are in the briefings, papers and reports at the NTP project page linked from &lt;a href=&#34;http://www.ntp.org&#34;&gt;www.ntp.org&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-key-cryptography&#34;&gt;Symmetric Key Cryptography&lt;/h4&gt;
&lt;p&gt;The original RFC-1305 specification allows any one of possibly 65,534 keys, each distinguished by a 32-bit key identifier, to authenticate an association. The servers and clients involved must agree on the key and key identifier to authenticate NTP packets. Keys and related information are specified in a key file, usually called &lt;tt&gt;ntp.keys&lt;/tt&gt;, which must be distributed and stored using secure means beyond the scope of the NTP protocol itself. Besides the keys used for ordinary NTP associations, additional keys can be used as passwords for the &lt;a href=&#34;/archives/4.2.2-series/ntpq&#34;&gt;ntpq&lt;/a&gt; and &lt;a href=&#34;/archives/4.2.2-series/ntpdc&#34;&gt;ntpdc&lt;/a&gt; utility programs. Ordinarily, the &lt;tt&gt;ntp.keys&lt;/tt&gt; file is generated by the &lt;a href=&#34;/archives/4.2.2-series/keygen&#34;&gt;ntp-keygen&lt;/a&gt; program.&lt;/p&gt;
&lt;p&gt;When &lt;tt&gt;ntpd&lt;/tt&gt; is first started, it reads the key file specified in the &lt;tt&gt;keys&lt;/tt&gt; configuration command and installs the keys in the key cache. However, individual keys must be activated with the &lt;tt&gt;trustedkey&lt;/tt&gt; command before use. This allows, for instance, the installation of possibly several batches of keys and then activating or deactivating each batch remotely using &lt;tt&gt;ntpdc&lt;/tt&gt;. This also provides a revocation capability that can be used if a key becomes compromised. The &lt;tt&gt;requestkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpdc&lt;/tt&gt; utility, while the &lt;tt&gt;controlkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpq&lt;/tt&gt; utility.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;public-key-cryptography&#34;&gt;Public Key Cryptography&lt;/h4&gt;
&lt;p&gt;NTPv4 supports the original NTPv3 symmetric key scheme described in RFC-1305 and in addition the Autokey protocol, which is based on public key cryptography. The Autokey Version 2 protocol described on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/proto.html&#34;&gt;Autokey Protocol&lt;/a&gt; page verifies packet integrity using MD5 message digests and verifies the source with digital signatures and any of several digest/signature schemes. Optional identity schemes described on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/ident.html&#34;&gt;Identity Schemes&lt;/a&gt; page and based on cryptographic challenge/response algorithms are also available. Using these schemes provides strong security against replay with or without modification, spoofing, masquerade and most forms of clogging attacks.&lt;/p&gt;
&lt;p&gt;The Autokey protocol has several modes of operation corresponding to the various NTP modes supported. Most modes use a special cookie which can be computed independently by the client and server, but encrypted in transmission. All modes use in addition a variant of the S-KEY scheme, in which a pseudo-random key list is generated and used in reverse order. These schemes are described along with an executive summary, current status, briefing slides and reading list on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/autokey.html&#34;&gt;Autonomous Authentication&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The specific cryptographic environment used by Autokey servers and clients is determined by a set of files and soft links generated by the &lt;a href=&#34;/archives/4.2.2-series/keygen&#34;&gt;ntp-keygen&lt;/a&gt; program. This includes a required host key file, required host certificate file and optional sign key file, leapsecond file and identity scheme files. The digest/signature scheme is specified in the X.509 certificate along with the matching sign key. There are several schemes available in the OpenSSL software library, each identified by a specific string such as &lt;tt&gt;md5WithRSAEncryption&lt;/tt&gt;, which stands for the MD5 message digest with RSA encryption scheme. The current NTP distribution supports all the schemes in the OpenSSL library, including those based on RSA and DSA digital signatures.&lt;/p&gt;
&lt;p&gt;NTP secure groups can be used to define cryptographic compartments and security hierarchies. It is important that every host in the group be able to construct a certificate trail to one or more trusted hosts in the same group. Each group host runs the Autokey protocol to obtain the certificates for all hosts along the trail to one or more trusted hosts. This requires the configuration file in all hosts to be engineered so that, even under anticipated failure conditions, the NTP subnet will form such that every group host can find a trail to at least one trusted host.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;naming-and-addressing&#34;&gt;Naming and Addressing&lt;/h4&gt;
&lt;p&gt;It is important to note that Autokey does not use DNS to resolve addresses, since DNS can&amp;rsquo;t be completely trusted until the name servers have synchronized clocks. The cryptographic name used by Autokey to bind the host identity credentials and cryptographic values must be independent of interface, network and any other naming convention. The name appears in the host certificate in either or both the subject and issuer fields, so protection against DNS compromise is essential.&lt;/p&gt;
&lt;p&gt;By convention, the name of an Autokey host is the name returned by the Unix &lt;tt&gt;gethostname()&lt;/tt&gt; system call or equivalent in other systems. By the system design model, there are no provisions to allow alternate names or aliases. However, this is not to say that DNS aliases, different names for each interface, etc., are constrained in any way.&lt;/p&gt;
&lt;p&gt;It is also important to note that Autokey verifies authenticity using the host name, network address and public keys, all of which are bound together by the protocol specifically to deflect masquerade attacks. For this reason Autokey includes the source and destination IP addresses in message digest computations and so the same addresses must be available at both the server and client. For this reason operation with network address translation schemes is not possible. This reflects the intended robust security model where government and corporate NTP servers are operated outside firewall perimeters.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;configuration&#34;&gt;Configuration&lt;/h4&gt;
&lt;p&gt;Autokey has an intimidating number of options, most of which are not necessary in typical scenarios. The simplest configuration consists of a subnet with one or more servers at the same low stratum acting as trusted hosts and with dependent clients at higher strata and sharing a single secure group and identity scheme. Each trusted host generates a host key, trusted certificate and group key. Each client generates a host key, normal certificate and installs the group key of each trusted host using secure means and renames it as the name of the trusted host.&lt;/p&gt;
&lt;p&gt;For example, trusted host Alice generates keys using&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ntp-keygen -H -T -I -p xyz&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;where H specifies a new host key, T the trusted certificate, I the IFF identity scheme and p the password used to encrypt the private key files. The group key file is &lt;tt&gt;ntpkey_IFFpar_alice.filestamp&lt;/tt&gt;, where filestamp represents the NTP time in seconds when the file was generated.&lt;/p&gt;
&lt;p&gt;Host Bob generate keys using&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ntp-keygen -H -p abc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;where &lt;tt&gt;abc&lt;/tt&gt; is different for each group host. The trusted host generates a password-protected group key using&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ntp-keygen -q xyz -p abc -e &amp;gt;temp&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;where &lt;tt&gt;xyz&lt;/tt&gt; is the trusted host password, abc is the password supplied by the client and &lt;tt&gt;temp&lt;/tt&gt; is a temporary file. This file is transmitted to Bob using secure means and renamed to the fully qualified host name for Alice preceded by the string &lt;tt&gt;ntpkey_iff_&lt;/tt&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;operation&#34;&gt;Operation&lt;/h4&gt;
&lt;p&gt;A specific combination of authentication scheme (none, symmetric key, public key) and identity scheme is called a cryptotype, although not all combinations are compatible. There may be management configurations where the clients, servers and peers may not all support the same cryptotypes. A secure NTPv4 subnet can be configured in many ways while keeping in mind the principles explained above and in this section. Note however that some cryptotype combinations may successfully interoperate with each other, but may not represent good security practice.&lt;/p&gt;
&lt;p&gt;The cryptotype of an association is determined at the time of mobilization, either at configuration time or some time later when a message of appropriate cryptotype arrives. When mobilized by a &lt;tt&gt;server&lt;/tt&gt; or &lt;tt&gt;peer&lt;/tt&gt; configuration command and no &lt;tt&gt;key&lt;/tt&gt; or &lt;tt&gt;autokey&lt;/tt&gt; subcommands are present, the association is not authenticated; if the &lt;tt&gt;key&lt;/tt&gt; subcommand is present, the association is authenticated using the symmetric key ID specified; if the &lt;tt&gt;autokey&lt;/tt&gt; subcommand is present, the association is authenticated using Autokey.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;key-management&#34;&gt;Key Management&lt;/h4&gt;
&lt;p&gt;The cryptographic values used by the Autokey protocol are incorporated as a set of files generated by the &lt;a href=&#34;/archives/4.2.2-series/keygen&#34;&gt;ntp-keygen&lt;/a&gt; utility program, including symmetric key, host key and public certificate files, as well as sign key, identity parameters and leapseconds files. Alternatively, host and sign keys and certificate files can be generated by the OpenSSL utilities and certificates can be imported from public certificate authorities. Note that symmetric keys are necessary for the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; utility programs. The remaining files are necessary only for the Autokey protocol.&lt;/p&gt;
&lt;p&gt;Certificates imported from OpenSSL or public certificate authorities have certain limitations. The certificate should be in ASN.1 syntax, X.509 Version 3 format and encoded in PEM, which is the same format used by OpenSSL. The overall length of the certificate encoded in ASN.1 must not exceed 1024 bytes. The subject distinguished name field (&lt;tt&gt;CN&lt;/tt&gt;) is the fully qualified name of the host on which it is used; the remaining subject fields are ignored. The certificate extension fields must not contain either a subject key identifier or a issuer key identifier field; however, an extended key usage field for a trusted host must contain the value &lt;tt&gt;trustRoot;&lt;/tt&gt;. Other extension fields are ignored.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-commands&#34;&gt;Authentication Commands&lt;/h4&gt;
&lt;dt&gt;&lt;tt&gt;autokey [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between regenerations of the session key list used with the Autokey protocol. Note that the size of the key list for each association depends on this interval and the current poll interval. The default interval is 12 (4096 s or about 1.1 hours). For poll intervals above the specified interval, a session key list with a single entry will be regenerated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;controlkey&#34;&gt;&lt;tt&gt;controlkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.2.2-series/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; utility, which uses the standard protocol defined in RFC-1305. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is the key identifier for a trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;crypto&#34;&gt;&lt;tt&gt;crypto [cert _file_] [leap _file_] [randfile _file_] [host _file_] [sign _file_] [ident _scheme_] [iffpar _file_] [ggpar _file_] [mvpar _file_] [pw _password_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command requires the OpenSSL library. It activates public key cryptography, selects the message digest and signature encryption scheme and loads the required private and public values described above. If one or more files are left unspecified, the default names are used as described above. Unless the complete path and name of the file are specified, the location of a file is relative to the keys directory specified in the &lt;tt&gt;keysdir&lt;/tt&gt; command or default &lt;tt&gt;/usr/local/etc&lt;/tt&gt;. Following are the subcommands:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;cert &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the required host public certificate file. This overrides the link &lt;tt&gt;ntpkey_cert_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ggpar &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the client GQ parameters file. This overrides the link &lt;tt&gt;ntpkey_gq_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;host &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;Â Â Â Â &lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the required host key file. This overrides the link &lt;tt&gt;ntpkey_key_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ident &lt;em&gt;scheme&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Requests the server identity &lt;tt&gt;scheme&lt;/tt&gt;, which can be &lt;tt&gt;IFF&lt;/tt&gt;, &lt;tt&gt;GQ&lt;/tt&gt; or &lt;tt&gt;MV&lt;/tt&gt;. This is used when the host will not be a server for a dependent client.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;iffpar &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the optional IFF parameters file.This overrides the link &lt;tt&gt;ntpkey_iff_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;leap &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the client leapsecond file. This overrides the link &lt;tt&gt;ntpkey_leap&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;mv&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Requests the MV server identity scheme.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;mvpar &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the client MV parameters file. This overrides the link &lt;tt&gt;ntpkey_mv_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;pw &lt;em&gt;password&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the password to decrypt files containing private keys and identity parameters. This is required only if these files have been encrypted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;randfile &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the random seed file used by the OpenSSL library. The defaults are described in the main text above.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;sign &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the optional sign key file. This overrides the link &lt;tt&gt;ntpkey_sign_hostname&lt;/tt&gt; in the keys directory. If this file is not found, the host key is also the sign key.&lt;/p&gt;
&lt;dt id=&#34;keys&#34;&gt;&lt;tt&gt;keys _keyfile_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the complete path to the MD5 key file containing the keys and key identifiers used by &lt;tt&gt;ntpd&lt;/tt&gt;, &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; when operating with symmetric key cryptography. This is the same operation as the &lt;tt&gt;-k&lt;/tt&gt; command line option.&lt;/p&gt;
&lt;dt id=&#34;keysdir&#34;&gt;&lt;tt&gt;keysdir _path_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command specifies the default directory path for cryptographic keys, parameters and certificates. The default is &lt;tt&gt;/usr/local/etc/&lt;/tt&gt;.&lt;/p&gt;
&lt;dt id=&#34;requestkey&#34;&gt;&lt;tt&gt;requestkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.2.2-series/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; program, which uses a proprietary protocol specific to this implementation of &lt;tt&gt;ntpd&lt;/tt&gt;. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is a key identifier for the trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;revoke&#34;&gt;&lt;tt&gt;revoke [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between re-randomization of certain cryptographic values used by the Autokey scheme, as a power of 2 in seconds. These values need to be updated frequently in order to deflect brute-force attacks on the algorithms of the scheme; however, updating some values is a relatively expensive operation. The default interval is 16 (65,536 s or about 18 hours). For poll intervals above the specified interval, the values will be updated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;trustedkey&#34;&gt;&lt;tt&gt;trustedkey [_key_] [...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifiers which are trusted for the purposes of authenticating peers with symmetric key cryptography, as well as keys used by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; programs. The authentication procedures require that both the local and remote servers share the same key and key identifier for this purpose, although different keys can be used with different servers. The &lt;tt&gt;key&lt;/tt&gt; arguments are 32-bit unsigned integers with values from 1 to 65,534.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;error-codes&#34;&gt;Error Codes&lt;/h4&gt;
&lt;p&gt;Errors can occur due to mismatched configurations, unexpected restarts, expired certificates and unfriendly people. In most cases the protocol state machine recovers automatically by retransmission, timeout and restart, where necessary. Some errors are due to mismatched keys, digest schemes or identity schemes and must be corrected by installing the correct media and/or correcting the configuration file. One of the most common errors is expired certificates, which must be regenerated and signed at least once per year using the &lt;a href=&#34;/archives/4.2.2-series/keygen&#34;&gt;&lt;tt&gt;ntp-keygen&lt;/tt&gt;&lt;/a&gt; program.&lt;/p&gt;
&lt;p&gt;The following error codes are reported via the NTP control and monitoring protocol trap mechanism.&lt;/p&gt;
&lt;dt&gt;101 bad field format or length&lt;/dt&gt;
&lt;p&gt;The packet has invalid version, length or format.&lt;/p&gt;
&lt;dt&gt;102 bad timestamp&lt;/dt&gt;
&lt;p&gt;The packet timestamp is the same or older than the most recent received. This could be due to a replay or a server clock time step.&lt;/p&gt;
&lt;dt&gt;103 bad filestamp&lt;/dt&gt;
&lt;p&gt;The packet filestamp is the same or older than the most recent received. This could be due to a replay or a key file generation error.&lt;/p&gt;
&lt;dt&gt;104 bad or missing public key&lt;/dt&gt;
&lt;p&gt;The public key is missing, has incorrect format or is an unsupported type.&lt;/p&gt;
&lt;dt&gt;105 unsupported digest type&lt;/dt&gt;
&lt;p&gt;The server requires an unsupported digest/signature scheme.&lt;/p&gt;
&lt;dt&gt;106 unsupported identity type&lt;/dt&gt;
&lt;p&gt;The client or server has requested an identity scheme the other does not support.&lt;/p&gt;
&lt;dt&gt;107 bad signature length&lt;/dt&gt;
&lt;p&gt;The signature length does not match the current public key.&lt;/p&gt;
&lt;dt&gt;108 signature not verified&lt;/dt&gt;
&lt;p&gt;The message fails the signature check. It could be bogus or signed by a different private key.&lt;/p&gt;
&lt;dt&gt;109 certificate not verified&lt;/dt&gt;
&lt;p&gt;The certificate is invalid or signed with the wrong key.&lt;/p&gt;
&lt;dt&gt;110 host certificate expired&lt;/dt&gt;
&lt;p&gt;The old server certificate has expired.&lt;/p&gt;
&lt;dt&gt;111 bad or missing cookie&lt;/dt&gt;
&lt;p&gt;The cookie is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;112 bad or missing leapseconds table&lt;/dt&gt;
&lt;p&gt;The leapseconds table is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;113 bad or missing certificate&lt;/dt&gt;
&lt;p&gt;The certificate is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;114 bad or missing group key&lt;/dt&gt;
&lt;p&gt;The identity key is missing, corrupt or bogus.&lt;/p&gt;
&lt;dt&gt;115 protocol error&lt;/dt&gt;
&lt;p&gt;The protocol state machine has wedged due to unexpected restart.&lt;/p&gt;
&lt;dt&gt;116 (server certificate expired)&lt;/dt&gt;
&lt;p&gt;The old server certificate has expired.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;files&#34;&gt;Files&lt;/h4&gt;
&lt;p&gt;See the &lt;a href=&#34;/archives/4.2.2-series/keygen&#34;&gt;&lt;tt&gt;ntp-keygen&lt;/tt&gt;&lt;/a&gt; page.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;leapseconds-table&#34;&gt;Leapseconds Table&lt;/h4&gt;
&lt;p&gt;The NIST provides a file documenting the epoch for all historic occasions of leap second insertion since 1972. The leapsecond table shows each epoch of insertion along with the offset of International Atomic Time (TAI) with respect to Coordinated Universal Time (UTC), as disseminated by NTP. The table can be obtained directly from NIST national time servers using &lt;tt&gt;ftp&lt;/tt&gt; as the ASCII file &lt;tt&gt;pub/leap-seconds&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;While not strictly a security function, the Autokey protocol provides means to securely retrieve the leapsecond table from a server or peer. Servers load the leapsecond table directly from the file specified in the &lt;tt&gt;crypto&lt;/tt&gt; command, with default &lt;tt&gt;ntpkey_leap&lt;/tt&gt;, while clients can obtain the table indirectly from the servers using the Autokey protocol. Once loaded, the table can be provided on request to other clients and servers.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Authentication Options</title>
      <link>/archives/4.2.4-series/authopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.4-series/authopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice44.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/%7emills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Our resident cryptographer; now you see him, now you don&amp;rsquo;t.&lt;/p&gt;
&lt;p&gt;Last update: 	01:29 UTC Wednesday, September 13, 2006&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/authopt/#authentication-support&#34;&gt;Authentication Support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/authopt/#symmetric-key-cryptography&#34;&gt;Symmetric Key Cryptography&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/authopt/#public-key-cryptography&#34;&gt;Public Key Cryptography&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/authopt/#configuration&#34;&gt;Configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/authopt/#operation&#34;&gt;Operation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/authopt/#key-management&#34;&gt;Key Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/authopt/#authentication-commands&#34;&gt;Authentication Commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/authopt/#error-codes&#34;&gt;Error Codes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/authopt/#files&#34;&gt;Files&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.4-series/authopt/#leapseconds-table&#34;&gt;Leapseconds Table&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-support&#34;&gt;Authentication Support&lt;/h4&gt;
&lt;p&gt;Authentication support allows the NTP client to verify that the server is in fact known and trusted and not an intruder intending accidentally or on purpose to masquerade as that server. The NTPv3 specification RFC-1305 defines a scheme which provides cryptographic authentication of received NTP packets. Originally, this was done using the Data Encryption Standard (DES) algorithm operating in Cipher Block Chaining (CBC) mode, commonly called DES-CBC. Subsequently, this was replaced by the RSA Message Digest 5 (MD5) algorithm using a private key, commonly called keyed-MD5. Either algorithm computes a message digest, or one-way hash, which can be used to verify the server has the correct private key and key identifier.&lt;/p&gt;
&lt;p&gt;NTPv4 retains the NTPv3 scheme, properly described as symmetric key cryptography, and, in addition, provides a new Autokey scheme based on public key cryptography. Public key cryptography is generally considered more secure than symmetric key cryptography, since the security is based on a private value which is generated by each host and never revealed. With the exception of the group key described later, all key distribution and management functions involve only public values, which considerably simplifies key distribution and storage. Public key management is based on X.509 certificates, which can be provided by commercial services or produced by utility programs in the OpenSSL software library or the NTPv4 distribution.&lt;/p&gt;
&lt;p&gt;While the algorithms for symmetric key cryptography are included in the NTPv4 distribution, public key cryptography requires the OpenSSL software library to be installed before building the NTP distribution. This library is available from &lt;a href=&#34;https://www.openssl.org&#34;&gt;https://www.openssl.org&lt;/a&gt; and can be installed using the procedures outlined in the &lt;a href=&#34;/archives/4.2.4-series/build&#34;&gt;Building and Installing the Distribution&lt;/a&gt; page. Once installed, the configure and build process automatically detects the library and links the library routines required.&lt;/p&gt;
&lt;p&gt;Authentication is configured separately for each association using the &lt;tt&gt;key&lt;/tt&gt; or &lt;tt&gt;autokey&lt;/tt&gt; subcommand on the &lt;tt&gt;peer&lt;/tt&gt;, &lt;tt&gt;server&lt;/tt&gt;, &lt;tt&gt;broadcast&lt;/tt&gt; and &lt;tt&gt;manycastclient&lt;/tt&gt; configuration commands as described in the &lt;a href=&#34;/archives/4.2.4-series/confopt&#34;&gt;Configuration Options&lt;/a&gt; page. The authentication options described below specify the locations of the key files, if other than default, which symmetric keys are trusted and the interval between various operations, if other than default.&lt;/p&gt;
&lt;p&gt;Authentication is always enabled, although ineffective if not configured as described below. If a NTP packet arrives including a message authentication code (MAC), it is accepted only if it passes all cryptographic checks. The checks require correct key ID, key value and message digest. If the packet has been modified in any way or replayed by an intruder, it will fail one or more of these checks and be discarded. Furthermore, the Autokey scheme requires a preliminary protocol exchange to obtain the server certificate, verify its credentials and initialize the protocol&lt;/p&gt;
&lt;p&gt;The &lt;tt&gt;auth&lt;/tt&gt; flag controls whether new associations or remote configuration commands require cryptographic authentication. This flag can be set or reset by the &lt;tt&gt;enable&lt;/tt&gt; and &lt;tt&gt;disable&lt;/tt&gt; commands and also by remote configuration commands sent by a &lt;tt&gt;ntpdc&lt;/tt&gt; program running on another machine. If this flag is enabled, which is the default case, new broadcast/manycast client and symmetric passive associations and remote configuration commands must be cryptographically authenticated using either symmetric key or public key cryptography. If this flag is disabled, these operations are effective even if not cryptographic authenticated. It should be understood that operating with the &lt;tt&gt;auth&lt;/tt&gt; flag disabled invites a significant vulnerability where a rogue hacker can masquerade as a truechimer and seriously disrupt system timekeeping. It is important to note that this flag has no purpose other than to allow or disallow a new association in response to new broadcast and symmetric active messages and remote configuration commands and, in particular, the flag has no effect on the authentication process itself.&lt;/p&gt;
&lt;p&gt;The security model and protocol schemes for both symmetric key and public key cryptography are summarized below; further details are in the briefings, papers and reports at the NTP project page linked from &lt;a href=&#34;http://www.ntp.org&#34;&gt;www.ntp.org&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-key-cryptography&#34;&gt;Symmetric Key Cryptography&lt;/h4&gt;
&lt;p&gt;The original RFC-1305 specification allows any one of possibly 65,534 keys, each distinguished by a 32-bit key identifier, to authenticate an association. The servers and clients involved must agree on the key and key identifier to authenticate NTP packets. Keys and related information are specified in a key file, usually called &lt;tt&gt;ntp.keys&lt;/tt&gt;, which must be distributed and stored using secure means beyond the scope of the NTP protocol itself. Besides the keys used for ordinary NTP associations, additional keys can be used as passwords for the &lt;a href=&#34;/archives/4.2.4-series/ntpq&#34;&gt;ntpq&lt;/a&gt; and &lt;a href=&#34;/archives/4.2.4-series/ntpdc&#34;&gt;ntpdc&lt;/a&gt; utility programs. Ordinarily, the &lt;tt&gt;ntp.keys&lt;/tt&gt; file is generated by the &lt;a href=&#34;/archives/4.2.4-series/keygen&#34;&gt;ntp-keygen&lt;/a&gt; program.&lt;/p&gt;
&lt;p&gt;When &lt;tt&gt;ntpd&lt;/tt&gt; is first started, it reads the key file specified in the &lt;tt&gt;keys&lt;/tt&gt; configuration command and installs the keys in the key cache. However, individual keys must be activated with the &lt;tt&gt;trustedkey&lt;/tt&gt; command before use. This allows, for instance, the installation of possibly several batches of keys and then activating or deactivating each batch remotely using &lt;tt&gt;ntpdc&lt;/tt&gt;. This also provides a revocation capability that can be used if a key becomes compromised. The &lt;tt&gt;requestkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpdc&lt;/tt&gt; utility, while the &lt;tt&gt;controlkey&lt;/tt&gt; command selects the key used as the password for the &lt;tt&gt;ntpq&lt;/tt&gt; utility.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;public-key-cryptography&#34;&gt;Public Key Cryptography&lt;/h4&gt;
&lt;p&gt;NTPv4 supports the original NTPv3 symmetric key scheme described in RFC-1305 and in addition the Autokey protocol, which is based on public key cryptography. The Autokey Version 2 protocol described on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/proto.html&#34;&gt;Autokey Protocol&lt;/a&gt; page verifies packet integrity using MD5 message digests and verifies the source with digital signatures and any of several digest/signature schemes. Optional identity schemes described on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/ident.html&#34;&gt;Identity Schemes&lt;/a&gt; page and based on cryptographic challenge/response algorithms are also available. Using these schemes provides strong security against replay with or without modification, spoofing, masquerade and most forms of clogging attacks.&lt;/p&gt;
&lt;p&gt;The Autokey protocol has several modes of operation corresponding to the various NTP modes supported. Most modes use a special cookie which can be computed independently by the client and server, but encrypted in transmission. All modes use in addition a variant of the S-KEY scheme, in which a pseudo-random key list is generated and used in reverse order. These schemes are described along with an executive summary, current status, briefing slides and reading list on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/autokey.html&#34;&gt;Autonomous Authentication&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;The specific cryptographic environment used by Autokey servers and clients is determined by a set of files and soft links generated by the &lt;a href=&#34;/archives/4.2.4-series/keygen&#34;&gt;ntp-keygen&lt;/a&gt; program. This includes a required host key file, required host certificate file and optional sign key file, leapsecond file and identity scheme files. The digest/signature scheme is specified in the X.509 certificate along with the matching sign key. There are several schemes available in the OpenSSL software library, each identified by a specific string such as &lt;tt&gt;md5WithRSAEncryption&lt;/tt&gt;, which stands for the MD5 message digest with RSA encryption scheme. The current NTP distribution supports all the schemes in the OpenSSL library, including those based on RSA and DSA digital signatures.&lt;/p&gt;
&lt;p&gt;NTP secure groups can be used to define cryptographic compartments and security hierarchies. It is important that every host in the group be able to construct a certificate trail to one or more trusted hosts in the same group. Each group host runs the Autokey protocol to obtain the certificates for all hosts along the trail to one or more trusted hosts. This requires the configuration file in all hosts to be engineered so that, even under anticipated failure conditions, the NTP subnet will form such that every group host can find a trail to at least one trusted host.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;naming-and-addressing&#34;&gt;Naming and Addressing&lt;/h4&gt;
&lt;p&gt;It is important to note that Autokey does not use DNS to resolve addresses, since DNS can&amp;rsquo;t be completely trusted until the name servers have synchronized clocks. The cryptographic name used by Autokey to bind the host identity credentials and cryptographic values must be independent of interface, network and any other naming convention. The name appears in the host certificate in either or both the subject and issuer fields, so protection against DNS compromise is essential.&lt;/p&gt;
&lt;p&gt;By convention, the name of an Autokey host is the name returned by the Unix &lt;tt&gt;gethostname()&lt;/tt&gt; system call or equivalent in other systems. By the system design model, there are no provisions to allow alternate names or aliases. However, this is not to say that DNS aliases, different names for each interface, etc., are constrained in any way.&lt;/p&gt;
&lt;p&gt;It is also important to note that Autokey verifies authenticity using the host name, network address and public keys, all of which are bound together by the protocol specifically to deflect masquerade attacks. For this reason Autokey includes the source and destination IP addresses in message digest computations and so the same addresses must be available at both the server and client. For this reason operation with network address translation schemes is not possible. This reflects the intended robust security model where government and corporate NTP servers are operated outside firewall perimeters.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;configuration&#34;&gt;Configuration&lt;/h4&gt;
&lt;p&gt;Autokey has an intimidating number of options, most of which are not necessary in typical scenarios. The simplest configuration consists of a subnet with one or more servers at the same low stratum acting as trusted hosts and with dependent clients at higher strata and sharing a single secure group and identity scheme. Each trusted host generates a host key, trusted certificate and group key. Each client generates a host key, normal certificate and installs the group key of each trusted host using secure means and renames it as the name of the trusted host.&lt;/p&gt;
&lt;p&gt;For example, trusted host Alice generates keys using&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ntp-keygen -H -T -I -p xyz&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;where H specifies a new host key, T the trusted certificate, I the IFF identity scheme and p the password used to encrypt the private key files. The group key file is &lt;tt&gt;ntpkey_IFFpar_alice.filestamp&lt;/tt&gt;, where filestamp represents the NTP time in seconds when the file was generated.&lt;/p&gt;
&lt;p&gt;Host Bob generate keys using&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ntp-keygen -H -p abc&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;where &lt;tt&gt;abc&lt;/tt&gt; is different for each group host. The trusted host generates a password-protected group key using&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ntp-keygen -q xyz -p abc -e &amp;gt;temp&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;where &lt;tt&gt;xyz&lt;/tt&gt; is the trusted host password, abc is the password supplied by the client and &lt;tt&gt;temp&lt;/tt&gt; is a temporary file. This file is transmitted to Bob using secure means and renamed to the fully qualified host name for Alice preceded by the string &lt;tt&gt;ntpkey_iff_&lt;/tt&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;operation&#34;&gt;Operation&lt;/h4&gt;
&lt;p&gt;A specific combination of authentication scheme (none, symmetric key, public key) and identity scheme is called a cryptotype, although not all combinations are compatible. There may be management configurations where the clients, servers and peers may not all support the same cryptotypes. A secure NTPv4 subnet can be configured in many ways while keeping in mind the principles explained above and in this section. Note however that some cryptotype combinations may successfully interoperate with each other, but may not represent good security practice.&lt;/p&gt;
&lt;p&gt;The cryptotype of an association is determined at the time of mobilization, either at configuration time or some time later when a message of appropriate cryptotype arrives. When mobilized by a &lt;tt&gt;server&lt;/tt&gt; or &lt;tt&gt;peer&lt;/tt&gt; configuration command and no &lt;tt&gt;key&lt;/tt&gt; or &lt;tt&gt;autokey&lt;/tt&gt; subcommands are present, the association is not authenticated; if the &lt;tt&gt;key&lt;/tt&gt; subcommand is present, the association is authenticated using the symmetric key ID specified; if the &lt;tt&gt;autokey&lt;/tt&gt; subcommand is present, the association is authenticated using Autokey.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;key-management&#34;&gt;Key Management&lt;/h4&gt;
&lt;p&gt;The cryptographic values used by the Autokey protocol are incorporated as a set of files generated by the &lt;a href=&#34;/archives/4.2.4-series/keygen&#34;&gt;ntp-keygen&lt;/a&gt; utility program, including symmetric key, host key and public certificate files, as well as sign key, identity parameters and leapseconds files. Alternatively, host and sign keys and certificate files can be generated by the OpenSSL utilities and certificates can be imported from public certificate authorities. Note that symmetric keys are necessary for the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; utility programs. The remaining files are necessary only for the Autokey protocol.&lt;/p&gt;
&lt;p&gt;Certificates imported from OpenSSL or public certificate authorities have certain limitations. The certificate should be in ASN.1 syntax, X.509 Version 3 format and encoded in PEM, which is the same format used by OpenSSL. The overall length of the certificate encoded in ASN.1 must not exceed 1024 bytes. The subject distinguished name field (&lt;tt&gt;CN&lt;/tt&gt;) is the fully qualified name of the host on which it is used; the remaining subject fields are ignored. The certificate extension fields must not contain either a subject key identifier or a issuer key identifier field; however, an extended key usage field for a trusted host must contain the value &lt;tt&gt;trustRoot;&lt;/tt&gt;. Other extension fields are ignored.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-commands&#34;&gt;Authentication Commands&lt;/h4&gt;
&lt;dt&gt;&lt;tt&gt;autokey [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between regenerations of the session key list used with the Autokey protocol. Note that the size of the key list for each association depends on this interval and the current poll interval. The default interval is 12 (4096 s or about 1.1 hours). For poll intervals above the specified interval, a session key list with a single entry will be regenerated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;controlkey&#34;&gt;&lt;tt&gt;controlkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.2.4-series/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; utility, which uses the standard protocol defined in RFC-1305. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is the key identifier for a trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;crypto&#34;&gt;&lt;tt&gt;crypto [cert _file_] [leap _file_] [randfile _file_] [host _file_] [sign _file_] [ident _scheme_] [iffpar _file_] [ggpar _file_] [mwpar _file_] [pw _password_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command requires the OpenSSL library. It activates public key cryptography, selects the message digest and signature encryption scheme and loads the required private and public values described above. If one or more files are left unspecified, the default names are used as described above. Unless the complete path and name of the file are specified, the location of a file is relative to the keys directory specified in the &lt;tt&gt;keysdir&lt;/tt&gt; command or default &lt;tt&gt;/usr/local/etc&lt;/tt&gt;. Following are the subcommands:&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;cert &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the required host public certificate file. This overrides the link &lt;tt&gt;ntpkey_cert_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ggpar &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the client GQ parameters file. This overrides the link &lt;tt&gt;ntpkey_gq_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;host &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;Â Â Â Â &lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the required host key file. This overrides the link &lt;tt&gt;ntpkey_key_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ident &lt;em&gt;scheme&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Requests the server identity &lt;tt&gt;scheme&lt;/tt&gt;, which can be &lt;tt&gt;IFF&lt;/tt&gt;, &lt;tt&gt;GQ&lt;/tt&gt; or &lt;tt&gt;MV&lt;/tt&gt;. This is used when the host will not be a server for a dependent client.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;iffpar &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the optional IFF parameters file.This overrides the link &lt;tt&gt;ntpkey_iff_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;leap &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the client leapsecond file. This overrides the link &lt;tt&gt;ntpkey_leap&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;mv&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Requests the MV server identity scheme.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;mvpar &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the client MV parameters file. This overrides the link &lt;tt&gt;ntpkey_mv_hostname&lt;/tt&gt; in the keys directory.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;pw &lt;em&gt;password&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the password to decrypt files containing private keys and identity parameters. This is required only if these files have been encrypted.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;randfile &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the random seed file used by the OpenSSL library. The defaults are described in the main text above.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;sign &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the optional sign key file. This overrides the link &lt;tt&gt;ntpkey_sign_hostname&lt;/tt&gt; in the keys directory. If this file is not found, the host key is also the sign key.&lt;/p&gt;
&lt;dt id=&#34;keys&#34;&gt;&lt;tt&gt;keys _keyfile_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the complete path to the MD5 key file containing the keys and key identifiers used by &lt;tt&gt;ntpd&lt;/tt&gt;, &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; when operating with symmetric key cryptography. This is the same operation as the &lt;tt&gt;-k&lt;/tt&gt; command line option.&lt;/p&gt;
&lt;dt id=&#34;keysdir&#34;&gt;&lt;tt&gt;keysdir _path_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command specifies the default directory path for cryptographic keys, parameters and certificates. The default is &lt;tt&gt;/usr/local/etc/&lt;/tt&gt;.&lt;/p&gt;
&lt;dt id=&#34;requestkey&#34;&gt;&lt;tt&gt;requestkey _key_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifier to use with the &lt;a href=&#34;/archives/4.2.4-series/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; program, which uses a proprietary protocol specific to this implementation of &lt;tt&gt;ntpd&lt;/tt&gt;. The &lt;tt&gt;&lt;em&gt;key&lt;/em&gt;&lt;/tt&gt; argument is a key identifier for the trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;revoke&#34;&gt;&lt;tt&gt;revoke [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between re-randomization of certain cryptographic values used by the Autokey scheme, as a power of 2 in seconds. These values need to be updated frequently in order to deflect brute-force attacks on the algorithms of the scheme; however, updating some values is a relatively expensive operation. The default interval is 16 (65,536 s or about 18 hours). For poll intervals above the specified interval, the values will be updated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;trustedkey&#34;&gt;&lt;tt&gt;trustedkey [_key_] [...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key identifiers which are trusted for the purposes of authenticating peers with symmetric key cryptography, as well as keys used by the &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; programs. The authentication procedures require that both the local and remote servers share the same key and key identifier for this purpose, although different keys can be used with different servers. The &lt;tt&gt;key&lt;/tt&gt; arguments are 32-bit unsigned integers with values from 1 to 65,534.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;error-codes&#34;&gt;Error Codes&lt;/h4&gt;
&lt;p&gt;Errors can occur due to mismatched configurations, unexpected restarts, expired certificates and unfriendly people. In most cases the protocol state machine recovers automatically by retransmission, timeout and restart, where necessary. Some errors are due to mismatched keys, digest schemes or identity schemes and must be corrected by installing the correct media and/or correcting the configuration file. One of the most common errors is expired certificates, which must be regenerated and signed at least once per year using the &lt;a href=&#34;/archives/4.2.4-series/keygen&#34;&gt;&lt;tt&gt;ntp-keygen&lt;/tt&gt;&lt;/a&gt; program.&lt;/p&gt;
&lt;p&gt;The following error codes are reported via the NTP control and monitoring protocol trap mechanism.&lt;/p&gt;
&lt;dl&gt;
&lt;dt&gt;101 bad field format or length&lt;/dt&gt;
&lt;p&gt;The packet has invalid version, length or format.&lt;/p&gt;
&lt;dt&gt;102 bad timestamp&lt;/dt&gt;
&lt;p&gt;The packet timestamp is the same or older than the most recent received. This could be due to a replay or a server clock time step.&lt;/p&gt;
&lt;dt&gt;103 bad filestamp&lt;/dt&gt;
&lt;p&gt;The packet filestamp is the same or older than the most recent received. This could be due to a replay or a key file generation error.&lt;/p&gt;
&lt;dt&gt;104 bad or missing public key&lt;/dt&gt;
&lt;p&gt;The public key is missing, has incorrect format or is an unsupported type.&lt;/p&gt;
&lt;dt&gt;105 unsupported digest type&lt;/dt&gt;
&lt;p&gt;The server requires an unsupported digest/signature scheme.&lt;/p&gt;
&lt;dt&gt;106 unsupported identity type&lt;/dt&gt;
&lt;p&gt;The client or server has requested an identity scheme the other does not support.&lt;/p&gt;
&lt;dt&gt;107 bad signature length&lt;/dt&gt;
&lt;p&gt;The signature length does not match the current public key.&lt;/p&gt;
&lt;dt&gt;108 signature not verified&lt;/dt&gt;
&lt;p&gt;The message fails the signature check. It could be bogus or signed by a different private key.&lt;/p&gt;
&lt;dt&gt;109 certificate not verified&lt;/dt&gt;
&lt;p&gt;The certificate is invalid or signed with the wrong key.&lt;/p&gt;
&lt;dt&gt;110 host certificate expired&lt;/dt&gt;
&lt;p&gt;The old server certificate has expired.&lt;/p&gt;
&lt;dt&gt;111 bad or missing cookie&lt;/dt&gt;
&lt;p&gt;The cookie is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;112 bad or missing leapseconds table&lt;/dt&gt;
&lt;p&gt;The leapseconds table is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;113 bad or missing certificate&lt;/dt&gt;
&lt;p&gt;The certificate is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;114 bad or missing group key&lt;/dt&gt;
&lt;p&gt;The identity key is missing, corrupt or bogus.&lt;/p&gt;
&lt;dt&gt;115 protocol error&lt;/dt&gt;
&lt;p&gt;The protocol state machine has wedged due to unexpected restart.&lt;/p&gt;
&lt;dt&gt;116 (server certificate expired)&lt;/dt&gt;
&lt;p&gt;The old server certificate has expired.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;files&#34;&gt;Files&lt;/h4&gt;
&lt;p&gt;See the &lt;a href=&#34;/archives/4.2.4-series/keygen&#34;&gt;&lt;tt&gt;ntp-keygen&lt;/tt&gt;&lt;/a&gt; page.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;leapseconds-table&#34;&gt;Leapseconds Table&lt;/h4&gt;
&lt;p&gt;The NIST provides a file documenting the epoch for all historic occasions of leap second insertion since 1972. The leapsecond table shows each epoch of insertion along with the offset of International Atomic Time (TAI) with respect to Coordinated Universal Time (UTC), as disseminated by NTP. The table can be obtained directly from NIST national time servers using &lt;tt&gt;ftp&lt;/tt&gt; as the ASCII file &lt;tt&gt;pub/leap-seconds&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;While not strictly a security function, the Autokey protocol provides means to securely retrieve the leapsecond table from a server or peer. Servers load the leapsecond table directly from the file specified in the &lt;tt&gt;crypto&lt;/tt&gt; command, with default &lt;tt&gt;ntpkey_leap&lt;/tt&gt;, while clients can obtain the table indirectly from the servers using the Autokey protocol. Once loaded, the table can be provided on request to other clients and servers.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Archives: Authentication Options</title>
      <link>/archives/4.2.6-series/authopt/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/archives/4.2.6-series/authopt/</guid>
      <description>
        
        
        &lt;p&gt;&lt;img src=&#34;/archives/pic/alice44.gif&#34; alt=&#34;gif&#34;&gt;&lt;a href=&#34;http://www.eecis.udel.edu/%7emills/pictures.html&#34;&gt;from &lt;em&gt;Alice&amp;rsquo;s Adventures in Wonderland&lt;/em&gt;, Lewis Carroll&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Our resident cryptographer; now you see him, now you don&amp;rsquo;t.&lt;/p&gt;
&lt;p&gt;Last update: 	14-Apr-2010 20:49 UTC&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;table-of-contents&#34;&gt;Table of Contents&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/authopt/#introduction&#34;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/authopt/#symmetric-key-cryptography&#34;&gt;Symmetric Key Cryptography&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/authopt/#public-key-cryptography&#34;&gt;Public Key Cryptography&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/authopt/#ntp-secure-groups&#34;&gt;NTP Secure Groups&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/authopt/#identity-schemes-and-cryptotypes&#34;&gt;Identity Schemes and Cryptotypes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/authopt/#configuration&#34;&gt;Configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/authopt/#examples&#34;&gt;Examples&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/authopt/#authentication-commands&#34;&gt;Authentication Commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/authopt/#error-codes&#34;&gt;Error Codes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/archives/4.2.6-series/authopt/#files&#34;&gt;Files&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id=&#34;introduction&#34;&gt;Introduction&lt;/h4&gt;
&lt;p&gt;This page describes the various cryptographic authentication provisions in NTPv4. Details about the configuration commands and options are given on the &lt;a href=&#34;/archives/4.2.6-series/confopt&#34;&gt;Configuration Options&lt;/a&gt; page. Details about the automatic server discovery schemes are described on the &lt;a href=&#34;/archives/4.2.6-series/manyopt&#34;&gt;Automatic Server Discovery Schemes&lt;/a&gt; page. Additional information is available in the papers, reports, memoranda and briefings cited on the &lt;a href=&#34;http://www.eecis.udel.edu/~mills/ntp.html&#34;&gt;NTP Project&lt;/a&gt; page. Authentication support allows the NTP client to verify that servers are in fact known and trusted and not intruders intending accidentally or intentionally to masquerade as a legitimate server.&lt;/p&gt;
&lt;p&gt;The NTPv3 specification RFC-1305 defines a scheme properly described as symmetric key cryptography. It uses the Data Encryption Standard (DES) algorithm operating in cipher-block chaining (CBC) mode. Subsequently, this scheme was replaced by the RSA Message Digest 5 (MD5) algorithm commonly called keyed-MD5. Either algorithm computes a message digest or one-way hash which can be used to verify the client has the same key and key identifier as the server. If the OpenSSL cryptographic library is installed, support is available for all algorithms included in the library. Note however, if conformance to FIPS 140-2 is required, only a limited subset of these algorithms is available.&lt;/p&gt;
&lt;p&gt;NTPv4 includes the NTPv3 scheme and optionally a new scheme based on public key cryptography and called Autokey. Public key cryptography is generally considered more secure than symmetric key cryptography, since the security is based on private and public values which are generated by each participant and where the private value is never revealed. Autokey uses X.509 public certificates, which can be produced by commercial services, utility programs in the OpenSSL software library or the &lt;a href=&#34;/archives/4.2.6-series/keygen&#34;&gt;&lt;tt&gt;ntp-keygen&lt;/tt&gt;&lt;/a&gt; utility program in the NTP software distribution.&lt;/p&gt;
&lt;p&gt;While the algorithms for MD5 symmetric key cryptography are included in the NTPv4 software distribution, modern algorithms for symmetric key and public key cryptograpny requires the OpenSSL software library to be installed before building the NTP distribution. This library is available from &lt;a href=&#34;https://www.openssl.org&#34;&gt;https://www.openssl.org&lt;/a&gt; and can be installed using the procedures outlined in the &lt;a href=&#34;/archives/4.2.6-series/build&#34;&gt;Building and Installing the Distribution&lt;/a&gt; page. Once installed, the configure and build process automatically detects the library and links the library routines required.&lt;/p&gt;
&lt;p&gt;Note that according to US law, NTP binaries including OpenSSL library components, including the OpenSSL library itself, cannot be exported outside the US without license from the US Department of Commerce. Builders outside the US are advised to obtain the OpenSSL library directly from OpenSSL, which is outside the US, and build outside the US.&lt;/p&gt;
&lt;p&gt;Authentication is configured separately for each association using the &lt;tt&gt;key&lt;/tt&gt; or &lt;tt&gt;autokey&lt;/tt&gt; option of the &lt;tt&gt;server&lt;/tt&gt; configuration command, as described in the &lt;a href=&#34;/archives/4.2.6-series/confopt&#34;&gt;Server Options&lt;/a&gt; page, and the options described on this page. The &lt;a href=&#34;/archives/4.2.6-series/keygen&#34;&gt;ntp-keygen&lt;/a&gt; page describes the files required for the various authentication schemes. Further details are in the briefings, papers and reports at the NTP project page linked from &lt;a href=&#34;http://www.ntp.org&#34;&gt;www.ntp.org&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;symmetric-key-cryptography&#34;&gt;Symmetric Key Cryptography&lt;/h4&gt;
&lt;p&gt;The original RFC-1305 specification allows any one of possibly 65,534 keys (excluding zero), each distinguished by a 32-bit key ID, to authenticate an association. The servers and clients involved must agree on the key, key ID and key type to authenticate NTP packets. If an NTP packet includes a message authentication code (MAC), consisting of a key ID and message digest, it is accepted only if the key ID matches a trusted key and the message digest is verified with this key. Note that for historic reasons the message digest algorithm is not consistent with RFC-1828. The digest is computed directly from the concatenation of the key string followed by the packet contents with the exception of the MAC itself.&lt;/p&gt;
&lt;p&gt;Keys and related information are specified in a keys file, usually called &lt;tt&gt;ntp.keys&lt;/tt&gt;, which must be distributed and stored using secure means beyond the scope of the NTP protocol itself. Besides the keys used for ordinary NTP associations, additional keys can be used as passwords for the &lt;tt&gt;&lt;a href=&#34;/archives/4.2.6-series/ntpq&#34;&gt;ntpq&lt;/a&gt;&lt;/tt&gt; and &lt;tt&gt;&lt;a href=&#34;/archives/4.2.6-series/ntpdc&#34;&gt;ntpdc&lt;/a&gt;&lt;/tt&gt; utility programs. Ordinarily, the &lt;tt&gt;ntp.keys&lt;/tt&gt; file is generated by the &lt;tt&gt;&lt;a href=&#34;/archives/4.2.6-series/keygen&#34;&gt;ntp-keygen&lt;/a&gt;&lt;/tt&gt; program, but it can be constructed and edited using an ordinary text editor. The program generates pseudo-random keys, one key for each line. Each line consists of three fields, the key identifier as a decimal number from 1 to 65534 inclusive, a key type chosen from the keywords of the &lt;tt&gt;digest&lt;/tt&gt; option of the &lt;tt&gt;crypto&lt;/tt&gt; command, and a 20-character printable ASCII string or a 40-character hex string as the key itself.&lt;/p&gt;
&lt;p&gt;When &lt;tt&gt;ntpd&lt;/tt&gt; is first started, it reads the key file specified by the &lt;tt&gt;keys&lt;/tt&gt; command and installs the keys in the key cache. However, individual keys must be activated with the &lt;tt&gt;trustedkey&lt;/tt&gt; configuration command before use. This allows, for instance, the installation of possibly several batches of keys and then activating a key remotely using &lt;tt&gt;ntpdc&lt;/tt&gt;. The &lt;tt&gt;requestkey&lt;/tt&gt; command selects the key ID used as the password for the &lt;tt&gt;ntpdc&lt;/tt&gt; utility, while the &lt;tt&gt;controlkey&lt;/tt&gt; command selects the key ID used as the password for the &lt;tt&gt;ntpq&lt;/tt&gt; utility.&lt;/p&gt;
&lt;p&gt;By default, the message digest algorithm is MD5 selected by the key type &lt;tt&gt;M&lt;/tt&gt; in the keys file. However, if the OpenSSL library is installed, any message digest algorithm supported by that library can be used. The key type is selected as the algorithm name given in the OpenSSL documentation. The key type is associated with the key and can be different for different keys. The server and client must share the same key, key ID and key type and both must be trusted. Note that if conformance to FIPS 140-2 is required, the message digest algorithm must conform to the Secure Hash Standard (SHS), which requires an algorithm from the Secure Hash Algorithm (SHA) family, and the digital signature encryption algorithm, if used, must conform to the Digital Signature Standard (DSS), which requires the Digital Signature Algorithm (DSA).&lt;/p&gt;
&lt;p&gt;In addition to the above means, &lt;tt&gt;ntpd&lt;/tt&gt; now supports Microsoft Windows MS-SNTP authentication using Active Directory services. This support was contributed by the Samba Team and is still in development. It is enabled using the &lt;tt&gt;mssntp&lt;/tt&gt; flag of the &lt;tt&gt;restrict&lt;/tt&gt; command described on the &lt;a href=&#34;/archives/4.2.6-series/authopt&#34;&gt;Access Control Options&lt;/a&gt; page. &lt;strong&gt;Note: Potential users should be aware that these services involve a TCP connection to another process that could potentially block, denying services to other users. Therefore, this flag should be used only for a dedicated server with no clients other than MS-SNTP.&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;public-key-cryptography&#34;&gt;Public Key Cryptography&lt;/h4&gt;
&lt;p&gt;NTPv4 supports the Autokey security protocol, which is based on public key cryptography. The Autokey Version 2 protocol described on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/proto.html&#34;&gt;Autokey Protocol&lt;/a&gt; page verifies packet integrity using MD5 message digests and verifies the source using digital signatures and any of several digest/signature schemes. Optional identity schemes described on the &lt;a href=&#34;http://www.eecis.udel.edu/~mills/ident.html&#34;&gt;Autokey Identity Schemes&lt;/a&gt; page are based on cryptographic challenge/response exchanges. These schemes provide strong security against replay with or without message modification, spoofing, masquerade and most forms of clogging attacks. These schemes are described along with an executive summary, current status, briefing slides and reading list on the &lt;a href=&#34;http://www.eecis.udel.edu/~mills/autokey.html&#34;&gt;Autonomous Authentication&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;Autokey authenticates individual packets using cookies bound to the IP source and destination addresses. The cookies must have the same addresses at both the server and client. For this reason operation with network address translation schemes is not possible. This reflects the intended robust security model where government and corporate NTP servers are operated outside firewall perimeters.&lt;/p&gt;
&lt;p&gt;There are three timeouts associated with the Autokey scheme. The key list timeout, which defaults to about 1.1 h, specifies the interval between generating new key lists. The revoke timeout, which defaults to about 36 h, specifies the interval between generating new private values. The restart timeout, with default about 5 d, specifies the interval between protocol restarts to refresh public values. In general, the behavior when these timeouts expire is not affected by the issues discussed on this page.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;ntp-secure-groups&#34;&gt;NTP Secure Groups&lt;/h4&gt;
&lt;p&gt;NTP secure groups are used to define cryptographic compartments and security hierarchies. All hosts belonging to a secure group have the same group name but different host names. The string specified in the &lt;tt&gt;host&lt;/tt&gt; option of the &lt;tt&gt;crypto&lt;/tt&gt; command is the name of the host and the name used in the host key, sign key and certificate files. The string specified in the &lt;tt&gt;ident&lt;/tt&gt; option of the &lt;tt&gt;crypto&lt;/tt&gt; command is the group name of all group hosts and the name used in the identity files. The file naming conventions are described on the &lt;a href=&#34;/archives/4.2.6-series/keygen&#34;&gt;ntp-keygen&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;Each group includes one or more trusted hosts (THs) operating at the root, or lowest stratum in the group. The group name is used in the subject and issuer fields of the TH self-signed trusted certificate for these hosts. The host name is used in the subject and issuer fields of the self-signed certificates for all other hosts.&lt;/p&gt;
&lt;p&gt;All group hosts are configured to provide an unbroken path, called a certificate trail, from each host, possibly via intermediate hosts and ending at a TH. When a host starts up, it recursively retrieves the certificates along the trail in order to verify group membership and avoid masquerade and middleman attacks.&lt;/p&gt;
&lt;p&gt;Secure groups can be configured as hierarchies where a TH of one group can be a client of one or more other groups operating at a lower stratum. A certificate trail consist of a chain of hosts starting at a client, leading through secondary servers of progressively lower stratum and ending at a TH. In one scenario, groups RED and GREEN can be cryptographically distinct, but both be clients of group BLUE operating at a lower stratum. In another scenario, group CYAN can be a client of multiple groups YELLOW and MAGENTA, both operating at a lower stratum. There are many other scenarios, but all must be configured to include only acyclic certificate trails.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;identity-schemes-and-cryptotypes&#34;&gt;Identity Schemes and Cryptotypes&lt;/h4&gt;
&lt;p&gt;All configurations include a public/private host key pair and matching certificate. Absent an identity scheme, this is a Trusted Certificate (TC) scheme. There are three identity schemes, IFF, GQ and MV described on the &lt;a href=&#34;http://www.eecis.udel.edu/%7emills/ident.html&#34;&gt;Identity Schemes&lt;/a&gt; page. With these schemes all servers in the group have encrypted server identity keys, while clients have nonencrypted client identity parameters. The client parameters can be obtained from a trusted agent (TA), usually one of the THs of the lower stratum group. Further information on identity schemes is on the &lt;a href=&#34;http://www.eecis.udel.edu/~mills/ident.html&#34;&gt;Autokey Identity Schemes&lt;/a&gt; page.&lt;/p&gt;
&lt;p&gt;A specific combination of authentication and identity schemes is called a cryptotype, which applies to clients and servers separately. A group can be configured using more than one cryptotype combination, although not all combinations are interoperable. Note however that some cryptotype combinations may successfully intemperate with each other, but may not represent good security practice. The server and client cryptotypes are defined by the following codes.&lt;/p&gt;
&lt;dt&gt;NONE&lt;/dt&gt;
&lt;p&gt;A client or server is type NONE if authentication is not available or not configured. Packets exchanged between client and server have no MAC.&lt;/p&gt;
&lt;dt&gt;AUTH&lt;/dt&gt;
&lt;p&gt;A client or server is type AUTH if the &lt;tt&gt;key&lt;/tt&gt; option is specified with the &lt;tt&gt;server&lt;/tt&gt; configuration command and the client and server keys are compatible. Packets exchanged between clients and servers have a MAC.&lt;/p&gt;
&lt;dt&gt;PC&lt;/dt&gt;
&lt;p&gt;A client or server is type PC if the &lt;tt&gt;autokey&lt;/tt&gt; option is specified with the &lt;tt&gt;server&lt;/tt&gt; configuration command and compatible host key and private certificate files are present. Packets exchanged between clients and servers have a MAC.&lt;/p&gt;
&lt;dt&gt;TC&lt;/dt&gt;
&lt;p&gt;A client or server is type TC if the &lt;tt&gt;autokey&lt;/tt&gt; option is specified with the &lt;tt&gt;server&lt;/tt&gt; configuration command and compatible host key and public certificate files are present. Packets exchanged between clients and servers have a MAC.&lt;/p&gt;
&lt;dt&gt;IDENT&lt;/dt&gt;
&lt;p&gt;A client or server is type IDENT if the &lt;tt&gt;autokey&lt;/tt&gt; option is specified with the &lt;tt&gt;server&lt;/tt&gt; configuration command and compatible host key, public certificate and identity scheme files are present. Packets exchanged between clients and servers have a MAC.&lt;/p&gt;
&lt;/dl&gt;
&lt;p&gt;The compatible cryptotypes for clients and servers are listed in the following table.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Client/Server&lt;/th&gt;
&lt;th&gt;NONE&lt;/th&gt;
&lt;th&gt;AUTH&lt;/th&gt;
&lt;th&gt;PC&lt;/th&gt;
&lt;th&gt;TC&lt;/th&gt;
&lt;th&gt;IDENT&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;NONE&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;yes*&lt;/td&gt;
&lt;td&gt;yes*&lt;/td&gt;
&lt;td&gt;yes*&lt;/td&gt;
&lt;td&gt;yes*&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AUTH&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PC&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;TC&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IDENT&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;* These combinations are not valid if the restriction list includes the &lt;tt&gt;notrust&lt;/tt&gt; option.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;configuration&#34;&gt;Configuration&lt;/h4&gt;
&lt;p&gt;Autokey has an intimidating number of configuration options, most of which are not necessary in typical scenarios. The simplest scenario consists of a TH where the host name of the TH is also the name of the group. For the simplest identity scheme TC, the TH generates host key and trusted certificate files using the &lt;tt&gt;ntp-keygen -T&lt;/tt&gt; command, while the remaining group hosts use the same command with no options to generate the host key and public certificate files. All hosts use the &lt;tt&gt;crypto&lt;/tt&gt; configuration command with no options. Configuration with passwords is described in the &lt;a href=&#34;/archives/4.2.6-series/keygen&#34;&gt;ntp-keygen&lt;/a&gt; page. All group hosts are configured as an acyclic tree with root the TH.&lt;/p&gt;
&lt;p&gt;When an identity scheme is included, for example IFF, the TH generates host key, trusted certificate and private server identity key files using the &lt;tt&gt;ntp-keygen -T -I -i &lt;em&gt;group&lt;/em&gt;&lt;/tt&gt; command, where &lt;tt&gt;&lt;em&gt;group&lt;/em&gt;&lt;/tt&gt; is the group name. The remaining group hosts use the same command as above. All hosts use the &lt;tt&gt;crypto ident group&lt;/tt&gt; configuration command.&lt;/p&gt;
&lt;p&gt;Hosts with no dependent clients can retrieve client parameter files from an archive or web page. The &lt;tt&gt;ntp-keygen&lt;/tt&gt; can export these data using the &lt;tt&gt;-e&lt;/tt&gt; option. Hosts with dependent clients other than the TH must retrieve copies of the server key files using secure means. The &lt;tt&gt;ntp-keygen&lt;/tt&gt; can export these data using the &lt;tt&gt;-q&lt;/tt&gt; option. In either case the data are installed as a file and then renamed using the name given as the first line in the file, but without the filestamp.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;examples&#34;&gt;Examples&lt;/h4&gt;
&lt;p&gt;Consider a scenario involving three secure groups RED, GREEN and BLUE. RED and BLUE are typical of national laboratories providing certified time to the Internet at large. As shown ion the figure, RED TH mort and BLUE TH macabre run NTP symmetric mode with each other for monitoring or backup. For the purpose of illustration, assume both THs are primary servers. GREEN is typical of a large university providing certified time to the campus community. GREEN TH howland is a broadcast client of both RED and BLUE. BLUE uses the IFF scheme, while both RED and GREEN use the GQ scheme, but with different keys. YELLOW is a client of GREEN and for purposes of illustration a TH for YELLOW.&lt;/p&gt;
&lt;p&gt;The BLUE TH macabre uses configuration commands&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;crypto pw qqsv ident blue&lt;/tt&gt;&lt;br&gt;
&lt;tt&gt;peer mort autokey&lt;/tt&gt;&lt;br&gt;
&lt;tt&gt;broadcast &lt;em&gt;address&lt;/em&gt; autokey&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;where &lt;tt&gt;qqsv&lt;/tt&gt; is the password for macabre files and &lt;em&gt;address&lt;/em&gt; is the broadcast address for the local LAN. It generates BLUE files using the commands&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntp-keygen -p qqsv -T -G -i blue&lt;/tt&gt;&lt;br&gt;
&lt;tt&gt;ntp-keygen -p qqsv -e &amp;gt;ntpkey_gqpar_blue&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;The first line generates the host, trusted certificate and private GQ server keys file. The second generates the public GQ client parameters file, which can have any nonconflicting mnemonic name.&lt;/p&gt;
&lt;p&gt;The RED TH mort uses configuration commands&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;crypto pw xxx ident red&lt;/tt&gt;&lt;br&gt;
&lt;tt&gt;peer macabre autokey&lt;/tt&gt;&lt;br&gt;
&lt;tt&gt;broadcast &lt;em&gt;address&lt;/em&gt; autokey&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;where &lt;tt&gt;xxx&lt;/tt&gt; is the password for mort files. It generates RED files using the commands&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntp-keygen -p xxx -T -I -i red&lt;/tt&gt;&lt;br&gt;
&lt;tt&gt;ntp-keygen -p xxx -e &amp;gt;ntpkey_iffpar_red&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;The GREEN TH howland uses configuration commands&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;crypto pw yyy ident green&lt;/tt&gt;&lt;br&gt;
&lt;tt&gt;broadcastclient&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;where &lt;tt&gt;yyy&lt;/tt&gt; is the password for howland files. It generates GREEN files using the commands&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntp-keygen -p yyy -T -G -i green&lt;/tt&gt;&lt;br&gt;
&lt;tt&gt;ntp-keygen -p yyy -e &amp;gt;ntpkey_gqpar_green&lt;/tt&gt;&lt;br&gt;
&lt;tt&gt;ntp-keygen -p yyy -q zzz &amp;gt;zzz_ntpkey_gqkey_green&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;The first two lines serve the same purpose as the preceding examples. The third line generates a copy of the private GREEN server file for use on another server in the same group, say YELLOW, but encrypted with the &lt;tt&gt;zzz&lt;/tt&gt; password.&lt;/p&gt;
&lt;p&gt;A client of GREEN, for example YELLOW, uses the configuration commands&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;crypto pw abc ident green&lt;/tt&gt;&lt;br&gt;
&lt;tt&gt;server howland autokey&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;where &lt;tt&gt;abc&lt;/tt&gt; is the password for its files. It generates files using the command&lt;/p&gt;
&lt;p&gt;&lt;tt&gt;ntp-keygen -p abc&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;The client retrieves the client file for that group from a public archive or web page using nonsecure means. In addition, each server in a group retrieves the private server keys file from the TH of that group, but it is encrypted and so must be sent using secure means. The files are installed in the keys directory with name taken from the first line in the file, but without the filestamp.&lt;/p&gt;
&lt;p&gt;Note that if servers of different groups, in this case RED and BLUE, share the same broadcast media, each server must have client files for all groups other than its own, while each client must have client files for all groups. Note also that this scenario is for illustration only and probably would not be wise for practical use, as if one of the TH reference clocks fails, the certificate trail becomes cyclic. In such cases the symmetric path between RED and BLUE, each in a different group, would not be a good idea.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;authentication-commands&#34;&gt;Authentication Commands&lt;/h4&gt;
&lt;dt id=&#34;automax&#34;&gt;&lt;tt&gt;automax [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between regenerations of the session key list used with the Autokey protocol, as a power of 2 in seconds. Note that the size of the key list for each association depends on this interval and the current poll interval. The default interval is 12 (about 1.1 h). For poll intervals above the specified interval, a session key list with a single entry will be regenerated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;controlkey&#34;&gt;&lt;tt&gt;controlkey _keyid_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key ID to use with the &lt;a href=&#34;/archives/4.2.6-series/ntpq&#34;&gt;&lt;tt&gt;ntpq&lt;/tt&gt;&lt;/a&gt; utility, which uses the standard protocol defined in RFC-1305. The &lt;tt&gt;&lt;em&gt;keyid&lt;/em&gt;&lt;/tt&gt; argument is the key ID for a trusted key, where the value can be in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;crypto&#34;&gt;&lt;tt&gt;crypto [randfile _file_] [host _name_] [ident _name_] [pw _password_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;This command requires the OpenSSL library. It activates public key cryptography and loads the required host key and public certificate. If one or more files are left unspecified, the default names are used as described below. Unless the complete path and name of the file are specified, the location of a file is relative to the keys directory specified in the &lt;tt&gt;keysdir&lt;/tt&gt; configuration command or default &lt;tt&gt;/usr/local/etc&lt;/tt&gt;. Following are the options.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;digest&lt;/tt&gt; &lt;tt&gt;MD2&lt;/tt&gt; | &lt;tt&gt;MD4&lt;/tt&gt; | &lt;tt&gt;MD5&lt;/tt&gt; | &lt;tt&gt;MDC2&lt;/tt&gt; | &lt;tt&gt;RIPEMD160&lt;/tt&gt; | &lt;tt&gt;SHA&lt;/tt&gt; | &lt;tt&gt;SHA1&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specify the message digest algorithm, with default MD5. If the OpenSSL library is installed, &lt;tt&gt;&lt;em&gt;name&lt;/em&gt;&lt;/tt&gt; can be any message digest algorithm supported by the library not exceeding 160 bits in length. However, all Autokey participants in an Autokey subnet must use the same algorithm. Note that the Autokey message digest algorithm is separate and distinct form the symmetric key message digest algorithms. Note: If compliance with FIPS 140-2 is required, the algorithm must be ether &lt;tt&gt;SHA&lt;/tt&gt; or &lt;tt&gt;SHA1&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;host &lt;em&gt;name&lt;/em&gt;&lt;/tt&gt;Â Â Â Â &lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the string used when constructing the names for the host, sign and certificate files generated by the &lt;tt&gt;ntp-keygen&lt;/tt&gt; program with the &lt;tt&gt;-s &lt;em&gt;name&lt;/em&gt;&lt;/tt&gt; option.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;ident &lt;em&gt;name&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the string used in constructing the identity files generated by the &lt;tt&gt;ntp-keygen&lt;/tt&gt; program with the &lt;tt&gt;-i &lt;em&gt;name&lt;/em&gt;&lt;/tt&gt; option.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;pw &lt;em&gt;password&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the password to decrypt files previously encrypted by the &lt;tt&gt;ntp-keygen&lt;/tt&gt; program with the &lt;tt&gt;-p&lt;/tt&gt; option.&lt;/p&gt;
&lt;p&gt;Â Â Â Â &lt;tt&gt;randfile &lt;em&gt;file&lt;/em&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Â Â Â Â Specifies the location of the random seed file used by the OpenSSL library. The defaults are described on the &lt;tt&gt;ntp-keygen&lt;/tt&gt; page.&lt;/p&gt;
&lt;dt id=&#34;keys&#34;&gt;&lt;tt&gt;keys _keyfile_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the complete path to the MD5 key file containing the keys and key IDs used by &lt;tt&gt;ntpd&lt;/tt&gt;, &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; when operating with symmetric key cryptography. This is the same operation as the &lt;tt&gt;-k&lt;/tt&gt; command line option. Note that the directory path for Autokey media is specified by the &lt;tt&gt;keysdir&lt;/tt&gt; command.&lt;/p&gt;
&lt;dt id=&#34;keysdir&#34;&gt;&lt;tt&gt;keysdir _path_&lt;/tt&gt;K&lt;/dt&gt;
&lt;p&gt;This command specifies the default directory path for Autokey cryptographic keys, parameters and certificates. The default is &lt;tt&gt;/usr/local/etc/&lt;/tt&gt;. Note that the path for the symmetric keys file is specified by the &lt;tt&gt;keys&lt;/tt&gt; command.&lt;/p&gt;
&lt;dt id=&#34;requestkey&#34;&gt;&lt;tt&gt;requestkey _keyid_&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key ID to use with the &lt;a href=&#34;/archives/4.2.6-series/ntpdc&#34;&gt;&lt;tt&gt;ntpdc&lt;/tt&gt;&lt;/a&gt; utility program, which uses a proprietary protocol specific to this implementation of &lt;tt&gt;ntpd&lt;/tt&gt;. The &lt;tt&gt;&lt;em&gt;keyid&lt;/em&gt;&lt;/tt&gt; argument is a key ID for a trusted key, in the range 1 to 65534, inclusive.&lt;/p&gt;
&lt;dt id=&#34;revoke&#34;&gt;&lt;tt&gt;revoke [_logsec_]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the interval between re-randomization of certain cryptographic values used by the Autokey scheme, as a power of 2 in seconds. These values need to be updated frequently in order to deflect brute-force attacks on the algorithms; however, updating some values is a relatively expensive operation. The default interval is 17 (about 36 h). For poll intervals above the specified interval, the values will be updated for every message sent.&lt;/p&gt;
&lt;dt id=&#34;trustedkey&#34;&gt;&lt;tt&gt;trustedkey [_keyid_ | (_lowid_ ... _highid_)] [...]&lt;/tt&gt;&lt;/dt&gt;
&lt;p&gt;Specifies the key ID(s) which are trusted for the purposes of authenticating peers with symmetric key cryptography. Key IDs used to authenticate &lt;tt&gt;ntpq&lt;/tt&gt; and &lt;tt&gt;ntpdc&lt;/tt&gt; operations must be listed here and additionally be enabled with &lt;em&gt;controlkey&lt;/em&gt; and/or &lt;em&gt;requestkey&lt;/em&gt;. The authentication procedure for time transfer require that both the local and remote NTP servers employ the same key ID and secret for this purpose, although different keys IDs may be used with different servers. Ranges of trusted key IDs may be specified: &amp;ldquo;&lt;tt&gt;trustedkey (1 &amp;hellip; 19) 1000 (100 &amp;hellip; 199)&lt;/tt&gt;&amp;rdquo; enables the lowest 120 key IDs which start with the digit 1. The spaces surrounding the ellipsis are required when specifying a range.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;error-codes&#34;&gt;Error Codes&lt;/h4&gt;
&lt;p&gt;Errors can occur due to mismatched configurations, unexpected protocol restarts, expired certificates and unfriendly people. In most cases the protocol state machine recovers automatically by retransmission, timeout and restart, where necessary. Some errors are due to mismatched keys, digest schemes or identity schemes and must be corrected by installing the correct media and/or correcting the configuration file. One of the most common errors is expired certificates, which must be regenerated and signed at least once per year using the &lt;a href=&#34;/archives/4.2.6-series/keygen&#34;&gt;&lt;tt&gt;ntp-keygen&lt;/tt&gt;&lt;/a&gt; program.&lt;/p&gt;
&lt;p&gt;The following error codes are reported via the NTP control and monitoring protocol trap mechanism and to the &lt;tt&gt;cryptostats&lt;/tt&gt; monitoring file if configured.&lt;/p&gt;
&lt;dl&gt;
&lt;dt&gt;101 bad field format or length&lt;/dt&gt;
&lt;p&gt;The packet has invalid version, length or format.&lt;/p&gt;
&lt;dt&gt;102 bad timestamp&lt;/dt&gt;
&lt;p&gt;The packet timestamp is the same or older than the most recent received. This could be due to a replay or a server clock time step.&lt;/p&gt;
&lt;dt&gt;103 bad filestamp&lt;/dt&gt;
&lt;p&gt;The packet filestamp is the same or older than the most recent received. This could be due to a replay or a key file generation error.&lt;/p&gt;
&lt;dt&gt;104 bad or missing public key&lt;/dt&gt;
&lt;p&gt;The public key is missing, has incorrect format or is an unsupported type.&lt;/p&gt;
&lt;dt&gt;105 unsupported digest type&lt;/dt&gt;
&lt;p&gt;The server requires an unsupported digest/signature scheme.&lt;/p&gt;
&lt;dt&gt;106 unsupported identity type&lt;/dt&gt;
&lt;p&gt;The client or server has requested an identity scheme the other does not support.&lt;/p&gt;
&lt;dt&gt;107 bad signature length&lt;/dt&gt;
&lt;p&gt;The signature length does not match the current public key.&lt;/p&gt;
&lt;dt&gt;108 signature not verified&lt;/dt&gt;
&lt;p&gt;The message fails the signature check. It could be bogus or signed by a different private key.&lt;/p&gt;
&lt;dt&gt;109 certificate not verified&lt;/dt&gt;
&lt;p&gt;The certificate is invalid or signed with the wrong key.&lt;/p&gt;
&lt;dt&gt;110 host certificate expired&lt;/dt&gt;
&lt;p&gt;The old server certificate has expired.&lt;/p&gt;
&lt;dt&gt;111 bad or missing cookie&lt;/dt&gt;
&lt;p&gt;The cookie is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;112 bad or missing leapseconds table&lt;/dt&gt;
&lt;p&gt;The leapseconds table is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;113 bad or missing certificate&lt;/dt&gt;
&lt;p&gt;The certificate is missing, corrupted or bogus.&lt;/p&gt;
&lt;dt&gt;114 bad or missing group key&lt;/dt&gt;
&lt;p&gt;The identity key is missing, corrupt or bogus.&lt;/p&gt;
&lt;dt&gt;115 protocol error&lt;/dt&gt;
&lt;p&gt;The protocol state machine has wedged due to unexpected restart.&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&#34;files&#34;&gt;Files&lt;/h4&gt;
&lt;p&gt;See the &lt;a href=&#34;/archives/4.2.6-series/keygen&#34;&gt;&lt;tt&gt;ntp-keygen&lt;/tt&gt;&lt;/a&gt; page. Note that provisions to load leap second values from the NIST files have been removed. These provisions are now available whether or not the OpenSSL library is available. However, the functions that can download these values from servers remains available.&lt;/p&gt;

      </description>
    </item>
    
  </channel>
</rss>
