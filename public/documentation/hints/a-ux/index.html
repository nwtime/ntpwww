<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8"><META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
<link rel="canonical" href="https://www.ntp.org/documentation/hints/a-ux/" />
  
  <meta property="og:title" content="A-UX Hints" />
<meta property="og:description" content="Introduction Included in this distribution of XNTP V3 is a configuration file suitable for use under Apple&rsquo;s A/UX Version 3.x.x There is also one for A/UX 2.0.1 but it has not been fully tested. To make the executables follow the steps outlined below.
 NOTE: You must have gcc installed to successfully compile the current distribution; the native cc supplied with A/UX will NOT correctly compile this source. See the FAQ in comp." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ntp.org/documentation/hints/a-ux/" /><meta property="og:image" content="https://www.ntp.org/images/NTPLogo800x418.webp"/><meta property="article:section" content="documentation" />

<meta property="article:modified_time" content="2022-05-04T17:05:38&#43;01:00" /><meta property="og:site_name" content="NTP: Network Time Protocol" />


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.ntp.org/images/NTPLogo800x418.webp"/>

<meta name="twitter:title" content="A-UX Hints"/>
<meta name="twitter:description" content="Introduction Included in this distribution of XNTP V3 is a configuration file suitable for use under Apple&rsquo;s A/UX Version 3.x.x There is also one for A/UX 2.0.1 but it has not been fully tested. To make the executables follow the steps outlined below.
 NOTE: You must have gcc installed to successfully compile the current distribution; the native cc supplied with A/UX will NOT correctly compile this source. See the FAQ in comp."/>





<script async src="https://www.googletagmanager.com/gtag/js?id=G-BN61ZTDHBP"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-BN61ZTDHBP', { 'anonymize_ip': true });
</script>




<script>
window.onload = demo;
function demo() {
    document.getElementById("gsc-i-id1").setAttribute("placeholder", "Search...")
}
</script>


<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "c33igkoodm");
</script>


  
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,400i,700,800,800i,900i&display=swap" rel="stylesheet"/>
   
  <title>A-UX Hints</title>

  <!-- Mobile Responsive Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="The NTP Project conducts Research and Development in NTP, a protocol designed to synchronize the clocks of computers over a network to a common timebase.">
  
  <meta name="generator" content="Hugo 0.83.1" />

  <!-- Plugins -->
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://www.ntp.org/scss/nwtime.min.e9ca9b60a754990f6372651dffda1018.css" media="screen">

  <!-- Favicon -->
  <link rel="shortcut icon" href="https://www.ntp.org/favicons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="https://www.ntp.org/favicons/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" href="https://www.ntp.org/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="https://www.ntp.org/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://www.ntp.org/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="https://www.ntp.org/favicons/android-chrome-512x512.png" sizes="512x512"></head>
<body><!-- navigation -->

<nav class="navbar navbar-expand-lg navbar-light">
  <div class="container-fluid">


	<div>
	  <a class="navbar-brand" href="https://www.nwtime.org"><img height="80" width="80" src="https://www.ntp.org/images/logo.png" alt=""></a>
	  <a class="navbar-brand" href="https://www.ntp.org/"><img height="80" width="80" src="https://www.ntp.org/images/ntp_logo.jpg" alt="NTP: Network Time Protocol"></a> 
    </div>


    <div>
      
		<button class="btn btn-light btn-lg" type="button" aria-expanded="false"><a class="nav-item" style="text-decoration: none; text-transform: uppercase" href="https://www.ntp.org/support/">Support</a>
        </button>
      
		<button class="btn btn-light btn-lg" type="button" aria-expanded="false"><a class="nav-item" style="text-decoration: none; text-transform: uppercase" href="https://www.ntp.org/reflib/">Reference Library</a>
        </button>
      
		<button class="btn btn-light btn-lg" type="button" aria-expanded="false"><a class="nav-item" style="text-decoration: none; text-transform: uppercase" href="https://www.ntp.org/current-stable/">Documentation</a>
        </button>
      
    </div>



<script async src="https://cse.google.com/cse.js?cx=bb3c9b3e375d856be"></script>
  <div class="gcse-search">
  </div>

</nav>


  <div class="header-border">
  </div>
<!-- /navigation --><nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="https://www.ntp.org/documentation/">NTP Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="https://www.ntp.org/documentation/hints/">Hints</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="https://www.ntp.org/documentation/hints/a-ux/">A-UX Hints</a>
</li>

	</ol>
</nav	>


<section class="section pt-0  pb-auto">
  <div class="container">
  	<h1>A-UX Hints</h1> 
    <p style="font-size: small; color: grey;">Last update: May 4, 2022 17:05 UTC (<a href="https://bitbucket.nwtime.org/projects/WEBSITES/repos/ntpwww/commits/dbea9b7d4daf047a65cdfd64d621e7efa23484da">dbea9b7d4</a>)</p>
	<h4 id="introduction">Introduction</h4>
<p>Included in this distribution of XNTP V3 is a configuration file suitable for use under Apple&rsquo;s A/UX Version 3.x.x  There is also one for A/UX 2.0.1 but it has not been fully tested. To make the executables follow the steps outlined below.</p>
<blockquote>
<p><strong>NOTE:</strong>  You must have <code>gcc</code> installed to successfully compile the current distribution; the native <code>cc</code> supplied with A/UX will NOT correctly compile this source.  See the FAQ in comp.unix.aux for places to obtain <code>gcc</code> from and how to install it.</p>
</blockquote>
<hr>
<h4 id="making-xntpd-for-aux">Making XNTPD for A/UX</h4>
<p>First, you need to create the makefiles (after you&rsquo;ve downloaded the source, of course):</p>
<p><code>make clean</code></p>
<p><code>make refconf</code></p>
<p>After that, you should edit <code>Config.local</code> to make sure that <code>BINDIR</code> is correct for where you wish the programs to be installed. The default (and what I use) is <code>/usr/local/etc</code>. Make sure that <code>DEFS_LOCAL</code> and <code>CLOCKDEFS</code> are commented out! Presently, only the <code>LOCAL_CLOCK/REFCLOCK</code> clock is used and supported.</p>
<p>After this is done (you should be told that your system is A/UX 3), make <code>xntpd</code> (the options to <code>gcc</code> are held in <code>compilers/aux3.gcc</code>):</p>
<p><code>make</code></p>
<p>I do not normally use the <code>make install</code> option and so have not verified its compatibility with A/UX.  Rather, I pull out each of the executables and place them in the locally appropriate locations.</p>
<hr>
<h4 id="starting-xntpd">Starting XNTPD</h4>
<p>At this point you need to set things up so that <code>xntpd</code> is started upon boot-up. You can do this in 1 of 2 ways: either add entries in <code>/etc/inittab</code> or, more ideally, create and use an <code>/etc/rc.local</code> file. Since <code>rc.local</code> is what I recommend, here&rsquo;s how you do it:</p>
<p>By default, A/UX doesn&rsquo;t have <code>rc.local</code>, so you&rsquo;ll need to add the following to <code>/etc/inittab</code>:</p>
<pre>
net6:2:wait:/etc/syslogd		        # set to "wait" to run a syslog daemon
jmj0:2:wait:/etc/rc.local 1>/dev/syscon 2>&1	# Local stuff
dbg2::wait:/etc/telinit v	                # turn off init's verbose mode
</pre>
<p>Now, the look of a sample <code>/etc/rc.local</code> is as follows:</p>
<pre><code>#!/bin/sh
:
: rc.local
:
#	@(#)Copyright Apple Computer 1987	Version 1.17 of rc.sh on 91/11/08 15:56:21 (ATT 1.12)

#	Push line discipline/set the device so it will print
/etc/line_sane 1
echo &quot; &quot;
echo &quot;Entering rc.local...&quot;

set `/bin/who -r`
if [ &quot;$7&quot; = 2 ]
then
    /bin/echo &quot; now setting the time...&quot;
    /usr/local/etc/ntpdate -s -b &lt;host.domain&gt;
    sleep 5
#
# start up 'xntpd' if we want
#
    if [ -f /etc/ntp.conf ]
    then
	/bin/echo &quot; setting tick and tickadj...&quot;
	/usr/local/etc/tickadj -t 16672 -a 54
	sleep 5
	/bin/echo &quot; starting xntpd...&quot;
	/usr/local/etc/xntpd &lt;&amp;- &gt; /dev/null 2&gt;&amp;1
	sleep 5
    fi
#
fi

echo &quot;Leaving rc.local...&quot;
</code></pre>
<p>There are a few things to notice about the above:</p>
<ul>
<li>
<p>When run, <code>ntpdate</code> forces your clock to the time returned by the host(s) specified by <code>&lt;host.domain&gt;</code> (you&rsquo;ll need to replace this with the IP address(es) of your timehosts). This is good since it gets things close to start off with. You can use more than one time server.</p>
</li>
<li>
<p><code>tickadj</code> is also called. This does two things: changes the default value of <code>tick</code> (which is the amount of time, in ms, that is added to the clock every 1/60 seconds) and changes the value of <code>tickadj</code> which is the amount that is added or subtracted from <code>tickadj</code> when <code>adjtime()</code> is called.</p>
</li>
</ul>
<p>Now Mac clocks are pretty bad and tend to be slow. So, instead of having A/UX add the default of 16666 ms every 1/60th of a second, you may want it to add more (or less) so that it keeps better time. The above value works for me but your best value may be different and will likely require some fooling around to find the best value. As a general rule of thumb, if you see <code>xntpd</code> make a lot of negative clock  adjustments, then your clock is fast and you&rsquo;ll need to <em>decrease</em> the value of <code>tick</code>. If your adjustments are positive, then you need to increase <code>tick</code>. To make a guess on how fast/slow your clock is, use <code>ntpdate</code> to sync your clock. Now watch <code>xntpd</code> and see how it operates. If, for example, it resets your clock by 1 second every 30 minutes, then your clock is (<code>1/(30*60)</code>) about 0.056% off and you&rsquo;ll need to adjust <code>tick</code> by 16666*0.00056 or about 9 (i.e. <code>tick</code> should be ~16675 if slow or ~16657 if fast).</p>
<p>A/UX&rsquo;s default value of <code>tickadj</code> is 1666 which is too big for <code>xntpd</code> so it also needs to be adjusted. I like using larger values than the recommended value of 9 for <code>tickadj</code> (although not anything near as big as 1666) since this allows for quick slews when adjusting the clock. Even with semi-large values of <code>tickadj</code> (~200), getting 5ms (1/200 s) accuracy is easy.</p>
<p>Finally, before A/UX and <code>xntpd</code> will work happily together, you need to patch the kernel. This is due to the fact that A/UX attempts to keep the UNIX-software clock and the Mac-hardware clock in sync. Neither the h/w or the s/w clock are too accurate. Also, <code>xntpd</code> will be attempting to adjust the software clock as well, so having A/UX muck around with it is asking for headaches. What you therefore need to do is tell the kernel <em>not</em> to sync the s/w clock with the h/w one. This is done using <code>adb</code>. The following is a shell script that will do the patch for you:</p>
<pre><code>#! /bin/sh
adb -w /unix &lt;&lt;!
init_time_fix_timeout?4i
init_time_fix_timeout?w 0x4e75
init_time_fix_timeout?4i
$q
!
</code></pre>
<p>This must be done <em>every</em> time you create a new kernel (via <code>newconfig</code> or <code>newunix</code>) or else <code>xntpd</code> will go crazy.</p>
<hr>
<h4 id="history">History</h4>
<p>John Dundas was the original porter of <code>xntpd</code> and a lot of the additions and A/UX-ports are from him. I got involved when I wanted to run <code>xntpd</code> on jagubox. It was also around this time that the base-patchlevel of <code>xntpd</code> changed relatively (the so-called &ldquo;jones&rdquo; version). Since then, I&rsquo;ve been maintaining <code>xntpd</code> for A/UX for the xntp development team.</p>
<p>The original kernel patch (which patched <code>time_fix_timeout</code>) was from Richard Todd. I suggest patching <code>init_time_fix_timeout</code> which prevents <code>time_fix_timeout</code> from even being called.</p>
<hr>
<h4 id="technical-notes">Technical Notes</h4>
<ul>
<li>
<p>As configured (see <code>machines/aux3</code>), <code>xntpd</code> will log messages via <code>syslogd</code> using the <code>LOC_LOCAL1</code> facility. I would suggest the following in <code>/etc/syslog.conf</code>:</p>
<p><code>local1.notice		/usr/adm/ntpd-syslog</code></p>
</li>
<li>
<p>As mentioned above, the clocks on A/UX and Macs are kinda bad. Not only that, but logging in and out of the MacOS mode as well as extensive floppy use causes A/UX to drop and lose clock interupts (these are sent every 1/60th of a second). So, if you do these activities a lot, you find out that you lose about 300ms of time (i.e., you become 300ms slow). The <code>xntpd</code> default way of handling this is to call <code>settimeofday()</code> and step the clock to the correct time. I prefer having <code>xntpd</code> slew the clock back into line by making gradual adjustments to the clock over a couple of minutes or so. It&rsquo;s for this reason that <code>SLEWALWAYS</code> is defined in <code>include/ntp_machine.h</code> for SYS_AUX3. It&rsquo;s also for this reason than I like larger values of <code>tickadj</code>.</p>
</li>
</ul>
<p>Good luck!  If you have problems under A/UX feel free to contact me (e-mail is preferred).</p>
<pre><code>Jim Jagielski               |  &quot;That is no ordinary rabbit... 'tis the
                            |   most foul, cruel and bad-tempered
NASA/GSFC, Code 734.4       |   rodent you ever set eyes on&quot;
Greenbelt, MD 20771         |                   Tim the Enchanter</code></pre>

	  
  </div>
</section>
<nav class="site-footer navbar navbar-expand-sm mt-auto">
  <div class="container">
      <ul class="navbar-nav">
        
        <li class="nav-item" title="Twitter" aria-label="Twitter">
          <a class="nav-link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/ntp">
          <img src="https://www.ntp.org/images/icons/twitter.svg" width="20" height="20"></img>
          </a>
       </li>
       
        <li class="nav-item" title="LinkedIn" aria-label="LinkedIn">
          <a class="nav-link" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/groups/4651343">
          <img src="https://www.ntp.org/images/icons/linkedin.svg" width="20" height="20"></img>
          </a>
       </li>
       
        <li class="nav-item" title="Facebook" aria-label="Facebook">
          <a class="nav-link" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/networktimeprotocol">
          <img src="https://www.ntp.org/images/icons/facebook.svg" width="20" height="20"></img>
          </a>
       </li>
       
	  </ul>
	  <ul class="mx-auto pt-3">
        <p>&copy; 2023 <a class="navbar-text text-white" href="https://www.nwtime.org/">Network Time Foundation</a></p>	
      </ul>
    </div>
</nav>
</body>
</html>